{"version":3,"file":"DeviceActivity-D0k2Rv1S.js","sources":["../../../../../../../../../node_modules/.pnpm/@patternfly+react-icons@5.4_f39c5b970058b42208dac3bfc1f9d8fb/node_modules/@patternfly/react-icons/dist/esm/icons/desktop-icon.js","../../../../../../../../../node_modules/.pnpm/@patternfly+react-icons@5.4_f39c5b970058b42208dac3bfc1f9d8fb/node_modules/@patternfly/react-icons/dist/esm/icons/mobile-alt-icon.js","../../../../../../../src/account-security/DeviceActivity.tsx"],"sourcesContent":["import { createIcon } from '../createIcon';\n\nexport const DesktopIconConfig = {\n  name: 'DesktopIcon',\n  height: 512,\n  width: 576,\n  svgPath: 'M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z',\n  yOffset: 0,\n  xOffset: 0,\n};\n\nexport const DesktopIcon = createIcon(DesktopIconConfig);\n\nexport default DesktopIcon;","import { createIcon } from '../createIcon';\n\nexport const MobileAltIconConfig = {\n  name: 'MobileAltIcon',\n  height: 512,\n  width: 320,\n  svgPath: 'M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z',\n  yOffset: 0,\n  xOffset: 0,\n};\n\nexport const MobileAltIcon = createIcon(MobileAltIconConfig);\n\nexport default MobileAltIcon;","import {\r\n  ContinueCancelModal,\r\n  useEnvironment,\r\n  label,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  DataList,\r\n  DataListContent,\r\n  DataListItem,\r\n  DataListItemRow,\r\n  DescriptionList,\r\n  DescriptionListDescription,\r\n  DescriptionListGroup,\r\n  DescriptionListTerm,\r\n  Grid,\r\n  GridItem,\r\n  Label,\r\n  Spinner,\r\n  Split,\r\n  SplitItem,\r\n  Title,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  DesktopIcon,\r\n  MobileAltIcon,\r\n  SyncAltIcon,\r\n} from \"@patternfly/react-icons\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport { deleteSession, getDevices } from \"../api/methods\";\r\nimport {\r\n  ClientRepresentation,\r\n  DeviceRepresentation,\r\n  SessionRepresentation,\r\n} from \"../api/representations\";\r\nimport { Page } from \"../components/page/Page\";\r\nimport { formatDate } from \"../utils/formatDate\";\r\nimport { useAccountAlerts } from \"../utils/useAccountAlerts\";\r\nimport { usePromise } from \"../utils/usePromise\";\r\n\r\nexport const DeviceActivity = () => {\r\n  const { t } = useTranslation();\r\n  const context = useEnvironment();\r\n  const { addAlert, addError } = useAccountAlerts();\r\n\r\n  const [devices, setDevices] = useState<DeviceRepresentation[]>();\r\n  const [key, setKey] = useState(0);\r\n  const refresh = () => setKey(key + 1);\r\n\r\n  const moveCurrentToTop = (devices: DeviceRepresentation[]) => {\r\n    let currentDevice = devices[0];\r\n\r\n    const index = devices.findIndex((d) => d.current);\r\n    currentDevice = devices.splice(index, 1)[0];\r\n    devices.unshift(currentDevice);\r\n\r\n    const sessionIndex = currentDevice.sessions.findIndex((s) => s.current);\r\n    const currentSession = currentDevice.sessions.splice(sessionIndex, 1)[0];\r\n    currentDevice.sessions.unshift(currentSession);\r\n\r\n    setDevices(devices);\r\n  };\r\n\r\n  usePromise((signal) => getDevices({ signal, context }), moveCurrentToTop, [\r\n    key,\r\n  ]);\r\n\r\n  const signOutAll = async () => {\r\n    await deleteSession(context);\r\n    await context.keycloak.logout();\r\n  };\r\n\r\n  const signOutSession = async (\r\n    session: SessionRepresentation,\r\n    device: DeviceRepresentation,\r\n  ) => {\r\n    try {\r\n      await deleteSession(context, session.id);\r\n      addAlert(\r\n        t(\"signedOutSession\", { browser: session.browser, os: device.os }),\r\n      );\r\n      refresh();\r\n    } catch (error) {\r\n      addError(\"errorSignOutMessage\", error);\r\n    }\r\n  };\r\n\r\n  const makeClientsString = (clients: ClientRepresentation[]): string => {\r\n    let clientsString = \"\";\r\n    clients.forEach((client, index) => {\r\n      let clientName: string;\r\n      if (client.clientName !== \"\") {\r\n        clientName = label(t, client.clientName);\r\n      } else {\r\n        clientName = client.clientId;\r\n      }\r\n\r\n      clientsString += clientName;\r\n\r\n      if (clients.length > index + 1) clientsString += \", \";\r\n    });\r\n\r\n    return clientsString;\r\n  };\r\n\r\n  if (!devices) {\r\n    return <Spinner />;\r\n  }\r\n\r\n  return (\r\n    <Page\r\n      title={t(\"deviceActivity\")}\r\n      description={t(\"signedInDevicesExplanation\")}\r\n    >\r\n      <Split hasGutter className=\"pf-v5-u-mb-lg\">\r\n        <SplitItem isFilled>\r\n          <Title headingLevel=\"h2\" size=\"xl\">\r\n            {t(\"signedInDevices\")}\r\n          </Title>\r\n        </SplitItem>\r\n        <SplitItem>\r\n          <Button\r\n            id=\"refresh-page\"\r\n            variant=\"link\"\r\n            onClick={() => refresh()}\r\n            icon={<SyncAltIcon />}\r\n          >\r\n            {t(\"refreshPage\")}\r\n          </Button>\r\n\r\n          {(devices.length > 1 || devices[0].sessions.length > 1) && (\r\n            <ContinueCancelModal\r\n              buttonTitle={t(\"signOutAllDevices\")}\r\n              modalTitle={t(\"signOutAllDevices\")}\r\n              continueLabel={t(\"confirm\")}\r\n              cancelLabel={t(\"cancel\")}\r\n              onContinue={() => signOutAll()}\r\n            >\r\n              {t(\"signOutAllDevicesWarning\")}\r\n            </ContinueCancelModal>\r\n          )}\r\n        </SplitItem>\r\n      </Split>\r\n      <DataList\r\n        className=\"signed-in-device-list\"\r\n        aria-label={t(\"signedInDevices\")}\r\n      >\r\n        <DataListItem aria-labelledby={`sessions-${key}`}>\r\n          {devices.map((device) =>\r\n            device.sessions.map((session, index) => (\r\n              <DataListItemRow key={device.id} data-testid={`row-${index}`}>\r\n                <DataListContent\r\n                  aria-label=\"device-sessions-content\"\r\n                  className=\"pf-v5-u-flex-grow-1\"\r\n                >\r\n                  <Grid hasGutter>\r\n                    <GridItem span={1} rowSpan={2}>\r\n                      {device.mobile ? <MobileAltIcon /> : <DesktopIcon />}\r\n                    </GridItem>\r\n                    <GridItem sm={8} md={9} span={10}>\r\n                      <span className=\"pf-v5-u-mr-md session-title\">\r\n                        {device.os.toLowerCase().includes(\"unknown\")\r\n                          ? t(\"unknownOperatingSystem\")\r\n                          : device.os}{\" \"}\r\n                        {!device.osVersion.toLowerCase().includes(\"unknown\") &&\r\n                          device.osVersion}{\" \"}\r\n                        / {session.browser}\r\n                      </span>\r\n                      {session.current && (\r\n                        <Label color=\"green\">{t(\"currentSession\")}</Label>\r\n                      )}\r\n                    </GridItem>\r\n                    <GridItem\r\n                      className=\"pf-v5-u-text-align-right\"\r\n                      sm={3}\r\n                      md={2}\r\n                      span={1}\r\n                    >\r\n                      {!session.current && (\r\n                        <ContinueCancelModal\r\n                          buttonTitle={t(\"signOut\")}\r\n                          modalTitle={t(\"signOut\")}\r\n                          continueLabel={t(\"confirm\")}\r\n                          cancelLabel={t(\"cancel\")}\r\n                          buttonVariant=\"secondary\"\r\n                          onContinue={() => signOutSession(session, device)}\r\n                        >\r\n                          {t(\"signOutWarning\")}\r\n                        </ContinueCancelModal>\r\n                      )}\r\n                    </GridItem>\r\n                    <GridItem span={11}>\r\n                      <DescriptionList\r\n                        className=\"signed-in-device-grid\"\r\n                        columnModifier={{ sm: \"2Col\", lg: \"3Col\" }}\r\n                        cols={5}\r\n                        rows={1}\r\n                      >\r\n                        <DescriptionListGroup>\r\n                          <DescriptionListTerm>\r\n                            {t(\"ipAddress\")}\r\n                          </DescriptionListTerm>\r\n                          <DescriptionListDescription>\r\n                            {session.ipAddress}\r\n                          </DescriptionListDescription>\r\n                        </DescriptionListGroup>\r\n                        <DescriptionListGroup>\r\n                          <DescriptionListTerm>\r\n                            {t(\"lastAccessedOn\")}\r\n                          </DescriptionListTerm>\r\n                          <DescriptionListDescription>\r\n                            {formatDate(new Date(session.lastAccess * 1000))}\r\n                          </DescriptionListDescription>\r\n                        </DescriptionListGroup>\r\n                        <DescriptionListGroup>\r\n                          <DescriptionListTerm>\r\n                            {t(\"clients\")}\r\n                          </DescriptionListTerm>\r\n                          <DescriptionListDescription>\r\n                            {makeClientsString(session.clients)}\r\n                          </DescriptionListDescription>\r\n                        </DescriptionListGroup>\r\n                        <DescriptionListGroup>\r\n                          <DescriptionListTerm>\r\n                            {t(\"started\")}\r\n                          </DescriptionListTerm>\r\n                          <DescriptionListDescription>\r\n                            {formatDate(new Date(session.started * 1000))}\r\n                          </DescriptionListDescription>\r\n                        </DescriptionListGroup>\r\n                        <DescriptionListGroup>\r\n                          <DescriptionListTerm>\r\n                            {t(\"expires\")}\r\n                          </DescriptionListTerm>\r\n                          <DescriptionListDescription>\r\n                            {formatDate(new Date(session.expires * 1000))}\r\n                          </DescriptionListDescription>\r\n                        </DescriptionListGroup>\r\n                      </DescriptionList>\r\n                    </GridItem>\r\n                  </Grid>\r\n                </DataListContent>\r\n              </DataListItemRow>\r\n            )),\r\n          )}\r\n        </DataListItem>\r\n      </DataList>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default DeviceActivity;\r\n"],"names":["DesktopIconConfig","DesktopIcon","createIcon","MobileAltIconConfig","MobileAltIcon","DeviceActivity","t","useTranslation","context","useEnvironment","addAlert","addError","useAccountAlerts","devices","setDevices","useState","key","setKey","refresh","usePromise","signal","getDevices","currentDevice","index","d","sessionIndex","s","currentSession","signOutAll","deleteSession","signOutSession","session","device","error","makeClientsString","clients","clientsString","client","clientName","label","jsxs","Page","Split","jsx","SplitItem","Title","Button","SyncAltIcon","ContinueCancelModal","DataList","DataListItem","DataListItemRow","DataListContent","Grid","GridItem","Label","DescriptionList","DescriptionListGroup","DescriptionListTerm","DescriptionListDescription","formatDate","Spinner"],"mappings":"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","x_google_ignoreList":[0,1]}