{"version":3,"file":"api-1dv78egC.js","sources":["../../../../../../../src/api/parse-links.ts","../../../../../../../src/api.ts"],"sourcesContent":["export type Links = {\r\n  prev?: Record<string, string>;\r\n  next?: Record<string, string>;\r\n};\r\n\r\nexport function parseLinks(response: Response): Links {\r\n  const linkHeader = response.headers.get(\"link\");\r\n\r\n  if (!linkHeader) {\r\n    return {};\r\n  }\r\n\r\n  const links = linkHeader.split(/,\\s*</);\r\n  return links.reduce<Links>((acc: Links, link: string) => {\r\n    const matcher = /<?([^>]*)>(.*)/.exec(link);\r\n    if (!matcher) return {};\r\n    const linkUrl = matcher[1];\r\n    const rel = /\\s*(.+)\\s*=\\s*\"?([^\"]+)\"?/.exec(matcher[2]);\r\n    if (rel) {\r\n      const link: Record<string, string> = {};\r\n      for (const [key, value] of new URL(linkUrl).searchParams.entries()) {\r\n        link[key] = value;\r\n      }\r\n      acc[rel[2] as keyof Links] = link;\r\n    }\r\n    return acc;\r\n  }, {});\r\n}\r\n","import {\r\n  KeycloakContext,\r\n  type BaseEnvironment,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\n\r\nimport { CallOptions } from \"./api/methods\";\r\nimport { Links, parseLinks } from \"./api/parse-links\";\r\nimport { parseResponse } from \"./api/parse-response\";\r\nimport {\r\n  CredentialsIssuer,\r\n  Permission,\r\n  Resource,\r\n  Scope,\r\n  SupportedCredentialConfiguration,\r\n} from \"./api/representations\";\r\nimport { request } from \"./api/request\";\r\nimport { joinPath } from \"./utils/joinPath\";\r\n\r\nexport const fetchResources = async (\r\n  { signal, context }: CallOptions,\r\n  requestParams: Record<string, string>,\r\n  shared: boolean | undefined = false,\r\n): Promise<{ data: Resource[]; links: Links }> => {\r\n  const response = await request(\r\n    `/resources${shared ? \"/shared-with-me?\" : \"?\"}`,\r\n    context,\r\n    { searchParams: shared ? requestParams : undefined, signal },\r\n  );\r\n\r\n  const links = parseLinks(response);\r\n\r\n  return {\r\n    data: checkResponse(await response.json()),\r\n    links,\r\n  };\r\n};\r\n\r\nexport const fetchPermission = async (\r\n  { signal, context }: CallOptions,\r\n  resourceId: string,\r\n): Promise<Permission[]> => {\r\n  const response = await request(\r\n    `/resources/${resourceId}/permissions`,\r\n    context,\r\n    { signal },\r\n  );\r\n  return parseResponse<Permission[]>(response);\r\n};\r\n\r\nexport const updateRequest = (\r\n  context: KeycloakContext<BaseEnvironment>,\r\n  resourceId: string,\r\n  username: string,\r\n  scopes: Scope[] | string[],\r\n) =>\r\n  request(`/resources/${resourceId}/permissions`, context, {\r\n    method: \"PUT\",\r\n    body: [{ username, scopes }],\r\n  });\r\n\r\nexport const updatePermissions = (\r\n  context: KeycloakContext<BaseEnvironment>,\r\n  resourceId: string,\r\n  permissions: Permission[],\r\n) =>\r\n  request(`/resources/${resourceId}/permissions`, context, {\r\n    method: \"PUT\",\r\n    body: permissions,\r\n  });\r\n\r\nfunction checkResponse<T>(response: T) {\r\n  if (!response) throw new Error(\"Could not fetch\");\r\n  return response;\r\n}\r\n\r\nexport async function getIssuer(context: KeycloakContext<BaseEnvironment>) {\r\n  const response = await request(\r\n    joinPath(\r\n      \"/realms/\",\r\n      context.environment.realm,\r\n      \"/.well-known/openid-credential-issuer\",\r\n    ),\r\n    context,\r\n    {},\r\n    new URL(\r\n      joinPath(\r\n        context.environment.serverBaseUrl,\r\n        \"/realms/\",\r\n        context.environment.realm,\r\n        \"/.well-known/openid-credential-issuer\",\r\n      ),\r\n    ),\r\n  );\r\n  return parseResponse<CredentialsIssuer>(response);\r\n}\r\n\r\nexport async function requestVCOffer(\r\n  context: KeycloakContext<BaseEnvironment>,\r\n  supportedCredentialConfiguration: SupportedCredentialConfiguration,\r\n  credentialsIssuer: CredentialsIssuer,\r\n) {\r\n  const response = await request(\r\n    \"/protocol/oid4vc/credential-offer-uri\",\r\n    context,\r\n    {\r\n      searchParams: {\r\n        credential_configuration_id: supportedCredentialConfiguration.id,\r\n        type: \"qr-code\",\r\n        width: \"500\",\r\n        height: \"500\",\r\n      },\r\n    },\r\n    new URL(\r\n      joinPath(\r\n        credentialsIssuer.credential_issuer +\r\n          \"/protocol/oid4vc/credential-offer-uri\",\r\n      ),\r\n    ),\r\n  );\r\n  return response.blob();\r\n}\r\n"],"names":["parseLinks","response","linkHeader","acc","link","matcher","linkUrl","rel","key","value","fetchResources","signal","context","requestParams","shared","request","links","checkResponse","fetchPermission","resourceId","parseResponse","updateRequest","username","scopes","updatePermissions","permissions","getIssuer","joinPath","requestVCOffer","supportedCredentialConfiguration","credentialsIssuer"],"mappings":"wDAKO,SAASA,EAAWC,EAA2B,CACpD,MAAMC,EAAaD,EAAS,QAAQ,IAAI,MAAM,EAE9C,OAAKC,EAISA,EAAW,MAAM,OAAO,EACzB,OAAc,CAACC,EAAYC,IAAiB,CACvD,MAAMC,EAAU,iBAAiB,KAAKD,CAAI,EAC1C,GAAI,CAACC,EAAS,MAAO,CAAA,EACrB,MAAMC,EAAUD,EAAQ,CAAC,EACnBE,EAAM,4BAA4B,KAAKF,EAAQ,CAAC,CAAC,EACvD,GAAIE,EAAK,CACP,MAAMH,EAA+B,CAAA,EACrC,SAAW,CAACI,EAAKC,CAAK,IAAK,IAAI,IAAIH,CAAO,EAAE,aAAa,UACvDF,EAAKI,CAAG,EAAIC,EAEdN,EAAII,EAAI,CAAC,CAAgB,EAAIH,CAC/B,CACA,OAAOD,CACT,EAAG,CAAA,CAAE,EAjBI,CAAA,CAkBX,CCTO,MAAMO,EAAiB,MAC5B,CAAE,OAAAC,EAAQ,QAAAC,GACVC,EACAC,EAA8B,KACkB,CAChD,MAAMb,EAAW,MAAMc,EACrB,aAAaD,EAAS,mBAAqB,GAAG,GAC9CF,EACA,CAAE,aAAcE,EAASD,EAAgB,OAAW,OAAAF,CAAA,CAAO,EAGvDK,EAAQhB,EAAWC,CAAQ,EAEjC,MAAO,CACL,KAAMgB,EAAc,MAAMhB,EAAS,MAAM,EACzC,MAAAe,CAAA,CAEJ,EAEaE,EAAkB,MAC7B,CAAE,OAAAP,EAAQ,QAAAC,CAAA,EACVO,IAC0B,CAC1B,MAAMlB,EAAW,MAAMc,EACrB,cAAcI,CAAU,eACxBP,EACA,CAAE,OAAAD,CAAA,CAAO,EAEX,OAAOS,EAA4BnB,CAAQ,CAC7C,EAEaoB,EAAgB,CAC3BT,EACAO,EACAG,EACAC,IAEAR,EAAQ,cAAcI,CAAU,eAAgBP,EAAS,CACvD,OAAQ,MACR,KAAM,CAAC,CAAE,SAAAU,EAAU,OAAAC,EAAQ,CAC7B,CAAC,EAEUC,EAAoB,CAC/BZ,EACAO,EACAM,IAEAV,EAAQ,cAAcI,CAAU,eAAgBP,EAAS,CACvD,OAAQ,MACR,KAAMa,CACR,CAAC,EAEH,SAASR,EAAiBhB,EAAa,CACrC,GAAI,CAACA,EAAU,MAAM,IAAI,MAAM,iBAAiB,EAChD,OAAOA,CACT,CAEA,eAAsByB,EAAUd,EAA2C,CACzE,MAAMX,EAAW,MAAMc,EACrBY,EACE,WACAf,EAAQ,YAAY,MACpB,uCAAA,EAEFA,EACA,CAAA,EACA,IAAI,IACFe,EACEf,EAAQ,YAAY,cACpB,WACAA,EAAQ,YAAY,MACpB,uCAAA,CACF,CACF,EAEF,OAAOQ,EAAiCnB,CAAQ,CAClD,CAEA,eAAsB2B,EACpBhB,EACAiB,EACAC,EACA,CAmBA,OAlBiB,MAAMf,EACrB,wCACAH,EACA,CACE,aAAc,CACZ,4BAA6BiB,EAAiC,GAC9D,KAAM,UACN,MAAO,MACP,OAAQ,KAAA,CACV,EAEF,IAAI,IACFF,EACEG,EAAkB,kBAChB,uCAAA,CACJ,CACF,GAEc,KAAA,CAClB"}