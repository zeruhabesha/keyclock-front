import{jsx as r,jsxs as P}from"react/jsx-runtime";import{R as O,U as V,_ as j,V as N,f as m,A as F,u as H,q as B,W as G,a as $,S as X,P as Y,X as J,Y as K,B as E,$ as Q,a0 as Z,a1 as ee,a2 as te,a3 as ae,L as ne,a4 as ie,a5 as se,a6 as oe,a7 as le,a8 as re}from"./main-BYB5eVdi.js";import*as u from"react";import{useState as U}from"react";import{u as de}from"./useAccountAlerts-DdS4nV6_.js";import"react-dom";const l={expandableSection:"pf-v5-c-expandable-section",expandableSectionContent:"pf-v5-c-expandable-section__content",expandableSectionToggle:"pf-v5-c-expandable-section__toggle",expandableSectionToggleIcon:"pf-v5-c-expandable-section__toggle-icon",expandableSectionToggleText:"pf-v5-c-expandable-section__toggle-text",modifiers:{expanded:"pf-m-expanded",detached:"pf-m-detached",truncate:"pf-m-truncate",limitWidth:"pf-m-limit-width",displayLg:"pf-m-display-lg",indented:"pf-m-indented",active:"pf-m-active"}},w={name:"--pf-v5-c-expandable-section--m-truncate__content--LineClamp",value:"3"};var d;(function(t){t.default="default",t.truncate="truncate"})(d||(d={}));const z=(t,e)=>{!e||t<1||e.style.setProperty(w.name,t.toString())};class R extends u.Component{constructor(e){super(e),this.expandableContentRef=u.createRef(),this.observer=()=>{},this.checkToggleVisibility=()=>{var a;if(!((a=this.expandableContentRef)===null||a===void 0)&&a.current){const c=this.props.truncateMaxLines||parseInt(w.value),p=this.expandableContentRef.current.scrollHeight/parseInt(getComputedStyle(this.expandableContentRef.current).lineHeight);this.setState({hasToggle:p>c})}},this.resize=()=>{if(!this.expandableContentRef.current)return;const{offsetWidth:a}=this.expandableContentRef.current;this.state.previousWidth!==a&&(this.setState({previousWidth:a}),this.checkToggleVisibility())},this.handleResize=O(this.resize,250),this.state={isExpanded:e.isExpanded||!1,hasToggle:!0,previousWidth:void 0}}calculateToggleText(e,a,c,p){return p&&a!==""?a:!p&&c!==""?c:e}componentDidMount(){if(this.props.variant===d.truncate){const e=this.expandableContentRef.current;if(!e)return;this.setState({previousWidth:e.offsetWidth}),this.observer=V(e,this.handleResize,!1),this.props.truncateMaxLines&&z(this.props.truncateMaxLines,e),this.checkToggleVisibility()}}componentDidUpdate(e){if(this.props.variant===d.truncate&&this.props.truncateMaxLines&&this.expandableContentRef.current&&(e.truncateMaxLines!==this.props.truncateMaxLines||e.children!==this.props.children)){const a=this.expandableContentRef.current;z(this.props.truncateMaxLines,a),this.checkToggleVisibility()}}componentWillUnmount(){this.props.variant===d.truncate&&this.observer()}render(){const e=this.props,{onToggle:a,isActive:c,className:p,toggleText:S,toggleTextExpanded:f,toggleTextCollapsed:C,toggleContent:x,children:L,isExpanded:b,isDetached:h,displaySize:y,isWidthLimited:_,isIndented:I,contentId:A,toggleId:v,variant:g,truncateMaxLines:n}=e,s=j(e,["onToggle","isActive","className","toggleText","toggleTextExpanded","toggleTextCollapsed","toggleContent","children","isExpanded","isDetached","displaySize","isWidthLimited","isIndented","contentId","toggleId","variant","truncateMaxLines"]);h&&!v&&console.warn("ExpandableSection: The toggleId value must be passed in and must match the toggleId of the ExpandableSectionToggle.");let o=a,i=b;const T=A||N("expandable-section-content"),M=v||N("expandable-section-toggle");b===void 0&&(i=this.state.isExpanded,o=(k,q)=>{this.setState({isExpanded:q},()=>a?.(k,this.state.isExpanded))});const D=this.calculateToggleText(S,f,C,i),W=!h&&u.createElement("button",{className:m(l.expandableSectionToggle),type:"button","aria-expanded":i,"aria-controls":T,id:M,onClick:k=>o?.(k,!i)},g!==d.truncate&&u.createElement("span",{className:m(l.expandableSectionToggleIcon)},u.createElement(F,{"aria-hidden":!0})),u.createElement("span",{className:m(l.expandableSectionToggleText)},x||D));return u.createElement("div",Object.assign({className:m(l.expandableSection,i&&l.modifiers.expanded,c&&l.modifiers.active,h&&l.modifiers.detached,y==="lg"&&l.modifiers.displayLg,_&&l.modifiers.limitWidth,I&&l.modifiers.indented,g===d.truncate&&l.modifiers.truncate,p)},s),g===d.default&&W,u.createElement("div",{ref:this.expandableContentRef,className:m(l.expandableSectionContent),hidden:g!==d.truncate&&!i,id:T,"aria-labelledby":M,role:"region"},L),g===d.truncate&&this.state.hasToggle&&W)}}R.displayName="ExpandableSection";R.defaultProps={className:"",toggleText:"",toggleTextExpanded:"",toggleTextCollapsed:"",onToggle:(t,e)=>{},isActive:!1,isDetached:!1,displaySize:"default",isWidthLimited:!1,isIndented:!1,variant:"default"};const me=()=>{const{t}=H(),e=B(),[a,c]=U(),[p,S]=U([]),f=G({mode:"onChange"}),{handleSubmit:C,reset:x,setValue:L,setError:b}=f,{addAlert:h}=de();$(n=>Promise.all([le({signal:n,context:e}),re({signal:n,context:e})]),([n,s])=>{c(n.userProfileMetadata),S(s),x(n),Object.entries(n.attributes||{}).forEach(([o,i])=>L(`attributes[${oe(o)}]`,i))});const y=async n=>{try{const s=Object.fromEntries(Object.entries(n.attributes||{}).map(([i,T])=>[te(i),T]));await ae(e,{...n,attributes:s});const o=s.locale?.toString();o&&await ne.changeLanguage(o,i=>{i&&console.warn("Error(s) loading locale",o,i)}),await e.keycloak.updateToken(),h(t("accountUpdatedMessage"))}catch(s){h(t("accountUpdatedError"),ie.danger),se({responseData:{errors:s}},(o,i)=>b(o,i),((o,i)=>t(o,i)))}};if(!a)return r(X,{});const _=()=>a?.attributes?.map(n=>n.readOnly).reduce((n,s)=>n&&s,!0),{updateEmailFeatureEnabled:I,updateEmailActionEnabled:A,isRegistrationEmailAsUsername:v,isEditUserNameAllowed:g}=e.environment.features;return r(Y,{title:t("personalInfo"),description:t("personalInfoDescription"),children:P(J,{isHorizontal:!0,onSubmit:C(y),children:[r(K,{form:f,userProfileMetadata:a,supportedLocales:p,currentLocale:e.environment.locale,t:((n,s)=>t(n,s)),renderer:n=>{const s=n.annotations?n.annotations:{};return n.name==="email"&&I&&A&&s["kc.required.action.supported"]&&(!v||g)?r(E,{id:"update-email-btn",variant:"link",onClick:()=>e.keycloak.login({action:"UPDATE_EMAIL"}),icon:r(Q,{}),iconPosition:"right",children:t("updateEmail")}):void 0}}),!_()&&P(Z,{children:[r(E,{"data-testid":"save",type:"submit",id:"save-btn",variant:"primary",children:t("save")}),r(E,{"data-testid":"cancel",id:"cancel-btn",variant:"link",onClick:()=>x(),children:t("cancel")})]}),e.environment.features.deleteAccountAllowed&&r(R,{"data-testid":"delete-account",toggleText:t("deleteAccount"),children:r(ee,{isInline:!0,title:t("deleteAccount"),variant:"danger",actionLinks:r(E,{id:"delete-account-btn",variant:"danger",onClick:()=>e.keycloak.login({action:"delete_account"}),className:"delete-button",children:t("delete")}),children:t("deleteAccountWarning")})})]})})};export{me as PersonalInfo,me as default};
//# sourceMappingURL=PersonalInfo-COYkAkD4.js.map
