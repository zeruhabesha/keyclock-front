import{jsxs as u,Fragment as A,jsx as r}from"react/jsx-runtime";import{u as B,a as j,_ as k,j as K,b as H,d as L,e as N,a$ as $,b0 as q,y as G,m as Q,B as R,o as v,aT as U,b1 as _,D as z,P as J,l as W,O as X,a3 as Y,Q as Z,A as ee,g as S,L as oe,n as te}from"./main-o1hptXRo.js";import{useState as b}from"react";import{u as ae}from"./ConfirmDialog-BkU7melV.js";import{D as re}from"./DynamicComponents-CnLlz98z.js";import{F as pe}from"./FormAccess-BnhQnYb9.js";import{V as ie}from"./ViewHeader-BDBsroi3.js";import{u as ne}from"./useParams-CGVhlaFZ.js";import"react-dom";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./useLocaleSort-C-diWts5.js";import"./CodeEditor-C4IS5oxi.js";function Fe(){const{adminClient:i}=B(),{t:o}=j(),{addAlert:f,addError:g}=k(),{id:t,mapperId:p,viewMode:T}=ne(),y=K(),{setValue:D,handleSubmit:C}=y,[d,P]=b(),[F,I]=b(),M=H(),{realm:w}=L(),h=N(),n=T==="edit",c=!!$(q.path),m=()=>c?U({realm:w,id:t,tab:"mappers"}):_({realm:w,clientId:t,tab:"mappers"});G(async()=>{let e;if(n){if(c?e=await i.clientScopes.findProtocolMapper({id:t,mapperId:p}):e=await i.clients.findProtocolMapperById({id:t,mapperId:p}),!e)throw new Error(o("notFound"));const a=h.protocolMapperTypes[e.protocol].find(l=>l.id===e.protocolMapper);return{config:{protocol:e.protocol,protocolMapper:e.protocolMapper},mapping:a,data:e}}else{const s=c?await i.clientScopes.findOne({id:t}):await i.clients.findOne({id:t});if(!s)throw new Error(o("notFound"));const l=h.protocolMapperTypes[s.protocol].find(x=>x.id===p);if(!l)throw new Error(o("notFound"));return{mapping:l,config:{protocol:s.protocol,protocolMapper:p}}}},({config:e,mapping:s,data:a})=>{I(e),P(s),a&&Q(a,D)},[]);const[V,E]=ae({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:R.danger,onConfirm:async()=>{try{c?await i.clientScopes.delProtocolMapper({id:t,mapperId:p}):await i.clients.delProtocolMapper({id:t,mapperId:p}),f(o("mappingDeletedSuccess"),v.success),M(m())}catch(e){g("mappingDeletedError",e)}}}),O=async e=>{const s=n?"Updated":"Created";try{const a={...F,...te(e)};n?c?await i.clientScopes.updateProtocolMapper({id:t,mapperId:p},{id:p,...a}):await i.clients.updateProtocolMapper({id:t,mapperId:p},{id:p,...a}):c?await i.clientScopes.addProtocolMapper({id:t},a):await i.clients.addProtocolMapper({id:t},a),f(o(`mapping${s}Success`),v.success),n||M(m())}catch(a){g(`mapping${s}Error`,a)}};return u(A,{children:[r(E,{}),r(ie,{titleKey:n?d?.name:o("addMapper"),subKey:n?p:"addMapperExplain",dropdownItems:n?[r(z,{value:"delete",onClick:V,children:o("delete")},"delete")]:void 0}),r(J,{variant:"light",children:r(W,{...y,children:u(pe,{isHorizontal:!0,onSubmit:C(O),role:"manage-clients",children:[r(X,{label:o("mapperType"),fieldId:"mapperType",children:r(Y,{type:"text",id:"mapperType",name:"mapperType",readOnlyVariant:"default",value:d?.name})}),r(Z,{name:"name",label:o("name"),labelIcon:o("mapperNameHelp"),readOnlyVariant:n?"default":void 0,rules:{required:o("required")}}),r(re,{properties:d?.properties||[],isNew:!n,stringify:!0}),u(ee,{children:[r(S,{variant:"primary",type:"submit","data-testid":"save",children:o("save")}),r(S,{"data-testid":"cancel",variant:"link",component:e=>r(oe,{...e,to:m()}),children:o("cancel")})]})]})})})]})}export{Fe as default};
//# sourceMappingURL=MappingDetails-BWsuhcy0.js.map
