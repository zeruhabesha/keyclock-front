import{jsxs as c,jsx as e,Fragment as F}from"react/jsx-runtime";import{u as M,a as V,a0 as P,y as _,O as G,R as U,g as x,aQ as L,bo as z,ay as b,aK as S,aR as B,aP as I,a6 as j,a7 as H,W as N,V as A}from"./main-o1hptXRo.js";import{useState as y,useMemo as D}from"react";import{G as Q}from"./GroupPickerDialog-U3luvxlw.js";import{U as W}from"./NewPolicyDialog-CIlfdiTN.js";import{A as $,a as J,S as X}from"./RoleMapping-BOcI-Nkp.js";import{C as Y}from"./ClientSelect-BY77LEpN.js";import{s as Z}from"./sortBy-DjlFeX8O.js";const O=s=>s.map(({id:t})=>t),E=({name:s,label:t,helpText:n,defaultValue:l,isDisabled:C=!1,isRequired:i,variant:h="typeaheadMulti"})=>{const{adminClient:u}=M(),{t:p}=V(),{control:m,setValue:f,getValues:T,formState:{errors:k}}=P(),g=T(s),[r,o]=y(!1),[R,v]=y([]);_(()=>g&&g.length>0?Promise.all(g.map(a=>u.groups.findOne({id:a}))):Promise.resolve([]),a=>{v(a.flat().filter(d=>d))},[]);const q=h==="typeahead";return c(G,{label:p(t),labelIcon:e(N,{helpText:p(n),fieldLabelId:"groups"}),fieldId:"groups",isRequired:i,children:[e(U,{name:s,control:m,defaultValue:l,rules:{validate:a=>!i||a&&a.length>0},render:({field:a})=>c(F,{children:[r&&e(Q,{type:q?"selectOne":"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:d=>{q?(a.onChange(O(d||[])),v(d||[])):(a.onChange([...a.value||[],...O(d||[])]),v([...R,...d||[]])),o(!1)},onClose:()=>{o(!1)},filterGroups:R}),e(x,{"data-testid":"select-group-button",isDisabled:C,variant:"secondary",onClick:()=>{o(!0)},children:p("addGroups")})]})}),R.length>0&&c(L,{variant:"compact",children:[e(z,{children:c(b,{children:[e(S,{children:p("groups")}),e(S,{"aria-hidden":"true"})]})}),e(B,{children:R.map(a=>c(b,{children:[e(I,{children:a.path}),e(I,{children:e(x,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(j,{}),onClick:()=>{f(s,[...O((R||[]).filter(({id:d})=>d!==a.id))]),v([...R.filter(({id:d})=>d!==a.id)])}})})]},a.id))})]}),k[s]&&e(H,{message:p("requiredGroups")})]})},w=({name:s,isRadio:t=!1})=>{const{adminClient:n}=M(),{t:l}=V(),{getValues:C,setValue:i,formState:{errors:h}}=P(),u=C(s)||[],[p,m]=y(!1),[f,T]=y([]),[k,g]=y("clients");return _(async()=>{if(u.length>0){const r=await Promise.all(u.map(o=>n.roles.findOneById({id:o})));return Promise.all(r.map(async o=>({role:o,client:o.clientRole?await n.clients.findOne({id:o?.containerId}):void 0})))}return[]},T,[]),c(G,{label:l(t?"role":"roles"),labelIcon:e(N,{helpText:l(t?"selectRole":"policyRolesHelp"),fieldLabelId:"roles"}),fieldId:s,isRequired:!0,children:[p&&e($,{id:"role",type:"roles",title:l("selectRole"),actionLabel:l("select"),isRadio:t,onAssign:r=>{i(s,[...t?[]:u,...r.filter(o=>o.role.id!==void 0).map(o=>o.role.id)]),T(t?r:[...f,...r]),m(!1)},onClose:()=>m(!1),filterType:k}),e(J,{label:l(t?"selectRole":"addRoles"),"data-testid":"select-role-button",variant:"secondary",onFilerTypeChange:r=>{g(r),m(!0)}}),f.length>0&&c(L,{variant:"compact",children:[e(z,{children:c(b,{children:[e(S,{children:l("roles")}),e(S,{"aria-hidden":"true"})]})}),e(B,{children:f.map(r=>c(b,{children:[e(I,{children:e(X,{role:r.role,client:r.client})}),e(I,{children:e(x,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(j,{}),onClick:()=>{i(s,u.filter(o=>o!==r.role.id)),T(f.filter(o=>o.role.id!==r.role.id))}})})]},r.role.id))})]}),h[s]&&e(H,{message:l("requiredRoles")})]})},ee=s=>e(Y,{...s,clientKey:"id"}),K={users:W,clients:ee,groups:E,roles:w},se=s=>s in K,de=({resourceType:s,withEnforceAccessTo:t=!0})=>{const{t:n}=V(),l=P(),C=l.getValues("resources"),i=s.toLowerCase(),[h,u]=y(C?.some(f=>f!==s)||!t);function p(){return se(i)?K[i]:null}const m=p();return c(F,{children:[t&&c(G,{label:n("enforceAccessTo"),labelIcon:e(N,{helpText:n("enforceAccessToHelpText"),fieldLabelId:"enforce-access-to"}),fieldId:"EnforceAccessTo",hasNoPaddingTop:!0,isRequired:!0,children:[e(A,{id:"allResources","data-testid":"allResources",isChecked:!h,name:"EnforceAccessTo",label:n("allResourceType",{resourceType:s}),onChange:()=>{u(!1),l.setValue("resources",[])},className:"pf-v5-u-mb-md"}),e(A,{id:"specificResources","data-testid":"specificResources",isChecked:h,name:"EnforceAccessTo",label:n("specificResourceType",{resourceType:s}),onChange:()=>{u(!0),l.setValue("resources",[])},className:"pf-v5-u-mb-md"})]}),h&&m&&e(m,{name:t?"resources":"resource",label:`${i}Resources`,helpText:n("resourceTypeHelpText",{resourceType:i}),defaultValue:[],variant:t?"typeaheadMulti":"typeahead",isRequired:t,isRadio:!t})]})};function ue({clientId:s}){const{adminClient:t}=M(),[n,l]=y();return _(()=>t.clients.getResourceServer({id:s}),l,[s]),D(()=>{const i=n?.authorizationSchema?.resourceTypes;return i?Z(Object.values(i),"type"):[]},[n])}export{K as C,de as R,ue as u};
//# sourceMappingURL=useSortedResourceTypes-DOYOPDde.js.map
