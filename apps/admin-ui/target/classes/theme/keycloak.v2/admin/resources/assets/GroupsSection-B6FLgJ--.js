import{jsxs as j,jsx as t,Fragment as Y}from"react/jsx-runtime";import{aw as ie,av as U,cm as fe,aa as qe,c0 as Me,cn as lt,b7 as Pe,b6 as Te,co as Ae,cp as Re,ax as dt,cq as ut,cr as mt,cs as Ve,ct as pt,cu as ht,a as P,cv as ne,d as re,cw as oe,cx as gt,cy as _e,L as ue,u as H,_ as ee,j as ze,y as ce,c9 as De,P as be,cz as He,n as ft,o as me,an as We,M as Qe,k as Xe,l as bt,F as vt,aW as wt,Q as Oe,au as yt,g as Z,B as ve,ao as Ye,aS as le,C as z,T as te,aM as we,aN as ye,D as J,al as Ce,a_ as Ne,x as Ee,v as Ge,cA as Ct,am as Nt,aX as Le,cc as ke,E as Et,cB as Je,p as Ze,aY as he,bT as Gt,at as kt,bS as It,b as Ie,bm as Ke,aB as St,bw as xt,bx as Be,aL as et,cC as se,cD as Mt,cE as Tt,cF as At,cG as Rt,cH as Vt,ap as _t,cI as Dt}from"./main-o1hptXRo.js";import*as $ from"react";import D,{useState as S,useEffect as tt,useRef as Fe}from"react";import{P as Ot}from"./PermissionTab-CNBT0MGG.js";import{V as Lt}from"./ViewHeader-BDBsroi3.js";import{A as ge}from"./AdminEvents-DIrkh5pf.js";import{A as Kt}from"./AttributeForm-DTyI1Rh5.js";import{R as Bt}from"./RoleMapping-BOcI-Nkp.js";import{C as Ft}from"./ConfirmDialog-BkU7melV.js";import{G as Ut,a as $t}from"./GroupPickerDialog-U3luvxlw.js";import{M as jt}from"./MembersModal-C7pjKBVL.js";import{s as qt}from"./sortBy-DjlFeX8O.js";import{Q as Pt}from"./question-circle-icon-C0dl_LB7.js";import{b as zt}from"./_baseFlatten-BLlCkxtA.js";import{T as Ue,a as Q,b as X}from"./Tabs-DSwQhKoJ.js";import"react-dom";import"./useLocaleSort-C-diWts5.js";import"./Trans-CicUNvCL.js";import"./DropdownPanel-vRJu3PnV.js";import"./CodeEditor-C4IS5oxi.js";import"./useFormatDate-CuGjRZ4j.js";import"./DatePicker-DiXxo4Fo.js";import"./pickBy-JGveacY0.js";import"./DescriptionListTerm-CNzJUZBE.js";import"./FormAccess-BnhQnYb9.js";import"./KeyValueInput-BOsiIUR1.js";import"./ActionListItem-Cy-NQlq4.js";import"./translationFormatter-DQJeO7lr.js";import"./DataListItemRow-B_0B-ko6.js";import"./differenceBy-LE-r3AO1.js";const at=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement("div",Object.assign({className:U(fe.drawerBody,o&&fe.modifiers.noPadding,e)},c),n)};at.displayName="DrawerPanelBody";const nt=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement(at,{hasNoPadding:o},$.createElement("div",Object.assign({className:U(fe.drawerHead,e)},c),n))};nt.displayName="DrawerHead";const I={modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",selectable:"pf-m-selectable"},treeView:"pf-v5-c-tree-view",treeViewAction:"pf-v5-c-tree-view__action",treeViewContent:"pf-v5-c-tree-view__content",treeViewListItem:"pf-v5-c-tree-view__list-item",treeViewNode:"pf-v5-c-tree-view__node",treeViewNodeCheck:"pf-v5-c-tree-view__node-check",treeViewNodeContainer:"pf-v5-c-tree-view__node-container",treeViewNodeContent:"pf-v5-c-tree-view__node-content",treeViewNodeCount:"pf-v5-c-tree-view__node-count",treeViewNodeIcon:"pf-v5-c-tree-view__node-icon",treeViewNodeText:"pf-v5-c-tree-view__node-text",treeViewNodeTitle:"pf-v5-c-tree-view__node-title",treeViewNodeToggle:"pf-v5-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-v5-c-tree-view__node-toggle-icon"},st=a=>{var{isNested:e=!1,isMultiSelectable:n=!1,toolbar:o,children:c,"aria-label":s,"aria-labelledby":i}=a,r=ie(a,["isNested","isMultiSelectable","toolbar","children","aria-label","aria-labelledby"]);return $.createElement($.Fragment,null,o&&$.createElement($.Fragment,null,o,$.createElement(qe,null)),$.createElement("ul",Object.assign({className:U(`${I.treeView}__list`),role:e?"group":"tree","aria-multiselectable":e?void 0:n,"aria-label":s,"aria-labelledby":i},r),c))};st.displayName="TreeViewList";const Ht=({name:a,title:e,id:n,isExpanded:o,defaultExpanded:c=!1,children:s=null,onSelect:i,onExpand:r,onCollapse:d,onCheck:l,hasCheckbox:p=!1,checkProps:T={checked:!1},hasBadge:h=!1,customBadgeContent:G,badgeProps:m={isRead:!0},isSelectable:v=!1,isCompact:O,activeItems:B=[],itemData:x,parentItem:u,icon:w,expandedIcon:L,action:N,compareItems:E,useMemo:K})=>{const[A,b]=S(c);tt(()=>{o!=null?b(o):c!=null&&b(A||c)},[o,c]);let g="button";p?g="label":v&&(g="div");const f=p||v?"button":"span",y=C=>D.createElement(f,Object.assign({className:U(I.treeViewNodeToggle),onClick:M=>{(v||p)&&(A?d&&d(M,x,u):r&&r(M,x,u),b(!A)),v&&M.stopPropagation()}},(p||v)&&{"aria-labelledby":`label-${C}`},f==="button"&&{type:"button"},{tabIndex:-1}),D.createElement("span",{className:U(I.treeViewNodeToggleIcon)},D.createElement(Pe,{"aria-hidden":"true"}))),V=T.checked===null?!1:T.checked,R=C=>D.createElement("span",{className:U(I.treeViewNodeCheck)},D.createElement("input",Object.assign({type:"checkbox",onChange:M=>l&&l(M,x,u),onClick:M=>M.stopPropagation(),ref:M=>M&&(M.indeterminate=T.checked===null)},T,{checked:V,id:C,tabIndex:-1}))),F=D.createElement("span",{className:U(I.treeViewNodeIcon)},!A&&w,A&&(L||w)),q=()=>{const C=D.createElement(D.Fragment,null,O&&e&&D.createElement("span",{className:U(I.treeViewNodeTitle)},e),v?D.createElement("button",{tabIndex:-1,className:U(I.treeViewNodeText),type:"button"},a):D.createElement("span",{className:U(I.treeViewNodeText)},a));return O?D.createElement("span",{className:U(I.treeViewNodeContent)},C):C},k=D.createElement(D.Fragment,null,h&&s&&D.createElement("span",{className:U(I.treeViewNodeCount)},D.createElement(Me,Object.assign({},m),G||s.props.data.length)),h&&!s&&G!==void 0&&D.createElement("span",{className:U(I.treeViewNodeCount)},D.createElement(Me,Object.assign({},m),G))),_=(!s||v)&&B&&B.length>0&&B.some(C=>E&&C&&E(C,x));return D.createElement("li",Object.assign({id:n,className:U(I.treeViewListItem,A&&I.modifiers.expanded),"aria-expanded":A,role:"treeitem",tabIndex:-1},p&&{"aria-checked":V},!p&&{"aria-selected":_}),D.createElement("div",{className:U(I.treeViewContent)},D.createElement(lt,{prefix:v?"selectable-id":"checkbox-id"},C=>D.createElement(g,Object.assign({className:U(I.treeViewNode,s&&(v||p)&&I.modifiers.selectable,_&&I.modifiers.current),onClick:M=>{p||(i&&i(M,x,u),!v&&s&&M.isDefaultPrevented()!==!0&&(A?d&&d(M,x,u):r&&r(M,x,u),b(!A)))}},p&&{htmlFor:C},(p||v&&s)&&{id:`label-${C}`},g==="button"&&{type:"button"}),D.createElement("span",{className:U(I.treeViewNodeContainer)},s&&y(C),p&&R(C),w&&F,q(),k))),N&&D.createElement("div",{className:U(I.treeViewAction)},N)),A&&s)},it=D.memo(Ht,(a,e)=>{if(!e.useMemo)return!1;const n=a.activeItems&&a.activeItems.length>0&&a.activeItems.some(c=>a.compareItems&&c&&a.compareItems(c,a.itemData)),o=e.activeItems&&e.activeItems.length>0&&e.activeItems.some(c=>e.compareItems&&c&&e.compareItems(c,e.itemData));return!(n||o||a.name!==e.name||a.title!==e.title||a.id!==e.id||a.isExpanded!==e.isExpanded||a.defaultExpanded!==e.defaultExpanded||a.onSelect!==e.onSelect||a.onCheck!==e.onCheck||a.onExpand!==e.onExpand||a.onCollapse!==e.onCollapse||a.hasCheckbox!==e.hasCheckbox||a.checkProps!==e.checkProps||a.hasBadge!==e.hasBadge||a.customBadgeContent!==e.customBadgeContent||a.badgeProps!==e.badgeProps||a.isCompact!==e.isCompact||a.icon!==e.icon||a.expandedIcon!==e.expandedIcon||a.action!==e.action||a.parentItem!==e.parentItem||a.itemData!==e.itemData)});it.displayName="TreeViewListItem";class Wt extends $.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=$.createRef(),this.handleKeys=e=>{var n,o,c,s,i,r,d;if(!this.treeRef.current.contains(e.target)||!e.target.classList.contains(I.treeViewNode))return;const l=document.activeElement,p=e.key,T=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(I.treeViewNode)).filter(h=>!h.classList.contains("pf-m-disabled"));if(p===Te.Space&&(l.click(),e.preventDefault()),Ae(e,T,h=>l===h,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(p)){const h=(c=(o=l?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||c===void 0?void 0:c.classList.contains(I.treeViewNodeToggle),G=(s=l?.closest("li"))===null||s===void 0?void 0:s.classList.contains("pf-m-expanded");if(p==="ArrowLeft")if(h&&G)l.click();else{const m=(i=l?.closest("ul"))===null||i===void 0?void 0:i.parentElement;if(m?.tagName!=="DIV"){const v=m?.querySelector("button");l.tabIndex=-1,v&&(v.tabIndex=0,v.focus())}}else if(h&&!G){l.tabIndex=-1,l.click();const m=(d=(r=l?.closest("li"))===null||r===void 0?void 0:r.querySelector("ul > li"))===null||d===void 0?void 0:d.querySelector("button");m&&(m.tabIndex=0,m.focus())}e.preventDefault()}},this.handleKeysCheckbox=e=>{var n,o,c,s,i;if(!this.treeRef.current.contains(e.target))return;const r=document.activeElement,d=e.key;d===Te.Space&&(r.click(),e.preventDefault());const l=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(I.treeViewNode));Ae(e,l,p=>p.contains(r),p=>p.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(d)&&(d==="ArrowLeft"?r?.tagName==="INPUT"?!((o=r?.parentElement)===null||o===void 0)&&o.previousSibling&&r.parentElement.previousSibling.focus():r?.previousSibling&&(((c=r.previousElementSibling)===null||c===void 0?void 0:c.tagName)==="SPAN"?r.previousSibling.firstChild.focus():r.previousSibling.focus()):r?.tagName==="INPUT"?!((s=r.parentElement)===null||s===void 0)&&s.nextSibling&&r.parentElement.nextSibling.focus():r?.nextSibling&&(((i=r.nextElementSibling)===null||i===void 0?void 0:i.tagName)==="SPAN"?r.nextSibling.firstChild.focus():r.nextSibling.focus()),e.preventDefault())},this.variantStyleModifiers={default:"",compact:I.modifiers.compact,compactNoBackground:[I.modifiers.compact,I.modifiers.noBackground]}}componentDidMount(){var e;if(Re&&window.addEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasCheckboxes||this.props.hasSelectableNodes){const n=this.treeRef.current.getElementsByClassName(I.treeViewNodeToggle)[0];if(n&&(n.tabIndex=0),this.props.hasCheckboxes){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName(I.treeViewNodeText)[0];o&&(o.tabIndex=0)}}else((e=this.treeRef.current)===null||e===void 0?void 0:e.getElementsByClassName(I.treeViewNode)[0]).tabIndex=0}componentWillUnmount(){Re&&window.removeEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const e=this.props,{children:n,hasCheckboxes:o,hasGuides:c,variant:s,className:i,hasSelectableNodes:r}=e,d=ie(e,["children","hasCheckboxes","hasGuides","variant","className","hasSelectableNodes"]);return $.createElement("div",Object.assign({className:U(I.treeView,c&&I.modifiers.guides,this.variantStyleModifiers[s],i),ref:this.treeRef},d),n)}}const Se=a=>{var{data:e,isNested:n=!1,hasCheckboxes:o=!1,hasBadges:c=!1,hasGuides:s=!1,hasSelectableNodes:i=!1,variant:r="default",defaultAllExpanded:d=!1,allExpanded:l,icon:p,isMultiSelectable:T=!1,expandedIcon:h,parentItem:G,onSelect:m,onCheck:v,onExpand:O,onCollapse:B,toolbar:x,activeItems:u,compareItems:w=(g,f)=>g.id===f.id,className:L,useMemo:N,"aria-label":E,"aria-labelledby":K}=a,A=ie(a,["data","isNested","hasCheckboxes","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","isMultiSelectable","expandedIcon","parentItem","onSelect","onCheck","onExpand","onCollapse","toolbar","activeItems","compareItems","className","useMemo","aria-label","aria-labelledby"]);const b=$.createElement(st,{isNested:n,toolbar:x,isMultiSelectable:T,"aria-label":E,"aria-labelledby":K},e.map(g=>{var f,y;return $.createElement(it,Object.assign({key:((f=g.id)===null||f===void 0?void 0:f.toString())||((y=g.name)===null||y===void 0?void 0:y.toString()),name:g.name,title:g.title,id:g.id,isExpanded:l,isSelectable:i,defaultExpanded:g.defaultExpanded!==void 0?g.defaultExpanded:d,onSelect:m,onCheck:v,onExpand:O,onCollapse:B,hasCheckbox:g.hasCheckbox!==void 0?g.hasCheckbox:o,checkProps:g.checkProps,hasBadge:g.hasBadge!==void 0?g.hasBadge:c,customBadgeContent:g.customBadgeContent,badgeProps:g.badgeProps,activeItems:u,parentItem:G,itemData:g,icon:g.icon!==void 0?g.icon:p,expandedIcon:g.expandedIcon!==void 0?g.expandedIcon:h,action:g.action,compareItems:w,isCompact:r==="compact"||r==="compactNoBackground",useMemo:N},g.children&&{children:$.createElement(Se,{data:g.children,isNested:!0,parentItem:g,hasCheckboxes:o,hasBadges:c,hasGuides:s,hasSelectableNodes:i,variant:r,allExpanded:l,defaultAllExpanded:d,onSelect:m,onCheck:v,onExpand:O,onCollapse:B,activeItems:u,icon:p,expandedIcon:h})}))}));return $.createElement($.Fragment,null,G?b:$.createElement(Wt,Object.assign({hasSelectableNodes:i,hasCheckboxes:o,hasGuides:s,variant:r,className:L},A),b))};Se.displayName="TreeView";const Qt={name:"TreeIcon",height:512,width:384,svgPath:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z",yOffset:0,xOffset:0},Xt=dt(Qt);var $e=ut(function(a){var e=mt(a);return Ve(e)&&(e=void 0),pt(zt(a,1,Ve,!0),ht(e))});const Yt=()=>{const{t:a}=P(),{clear:e,remove:n,subGroups:o}=ne(),{realm:c}=re(),s=oe();return tt(()=>{const{pathname:i}=s;(!i.includes("/groups")||i.endsWith("/groups"))&&e()},[s]),o.length!==0?j(gt,{children:[t(_e,{children:t(ue,{to:`/${c}/groups`,children:a("groups")})},"home"),o.map((i,r)=>{const d=r===o.length-1;return j(_e,{isActive:d,children:[!d&&t(ue,{to:s.pathname.substring(0,s.pathname.indexOf(i.id)+i.id.length),onClick:()=>n(i),children:i.name}),d&&(i.id==="search"?i.name:a("groupDetails"))]},i.id)})]}):null},rt=a=>{const e=a.substring(1).split("/");return e.length>1?e.splice(2):void 0},pe=a=>{const e=rt(a);return e?e[e.length-1]:void 0},Jt=()=>{const{adminClient:a}=H(),{t:e}=P(),{addAlert:n,addError:o}=ee(),c=ze({mode:"onChange"}),s=oe(),i=pe(s.pathname),[r,d]=S();ce(()=>a.groups.findOne({id:i}),p=>{c.reset({attributes:De(p?.attributes)}),d(p)},[i]);const l=async p=>{try{const T=ft(p).attributes;await a.groups.update({id:i},{...r,attributes:T}),d({...r,attributes:T}),n(e("groupUpdated"),me.success)}catch(T){o("groupUpdateError",T)}};return t(be,{variant:He.light,children:t(Kt,{form:c,save:l,fineGrainedAccess:r?.access?.manage,reset:()=>c.reset({attributes:De(r?.attributes)})})})},Zt=({id:a,name:e})=>{const{adminClient:n}=H(),{t:o}=P(),{addAlert:c,addError:s}=ee();return t(Bt,{name:e,id:a,type:"groups",save:async r=>{try{const d=r.filter(l=>l.client===void 0).map(l=>l.role).flat();await n.groups.addRealmRoleMappings({id:a,roles:d}),await Promise.all(r.filter(l=>l.client!==void 0).map(l=>n.groups.addClientRoleMappings({id:a,clientUniqueId:l.client.id,roles:[l.role]}))),c(o("roleMappingUpdatedSuccess"),me.success)}catch(d){s("roleMappingUpdatedError",d)}}})},ae=({id:a,rename:e,duplicateId:n,handleModalToggle:o,refresh:c})=>{const{adminClient:s}=H(),{t:i}=P(),{addAlert:r,addError:d}=ee(),l=We(),[p,T]=S(null),h=ze({defaultValues:{name:e?.name||"",description:e?.description||""}}),{handleSubmit:G,formState:m}=h;ce(async()=>{if(n)return s.groups.findOne({id:n})},u=>{u&&(T(u),h.reset({name:i("copyOf",{name:u.name})}))},[n]);const v=async u=>{try{const w=[],L=await s.clients.find();for(const N of L){const K=(await s.groups.listClientRoleMappings({id:u,clientUniqueId:N.id})).filter(A=>A.id&&A.name).map(A=>({id:A.id,name:A.name}));K.length>0&&w.push({clientId:N.id,roles:K})}return w}catch(w){throw d("couldNotFetchClientRoleMappings",w),w}},O=async(u,w,L=!1)=>{try{const N={...u,name:L?u.name:i("copyOf",{name:u.name}),...w?{}:{attributes:p?.attributes}};delete N.id;const E=w?await s.groups.createChildGroup({id:w},N):await s.groups.create(N),K=await s.groups.listMembers({id:u.id});for(const R of K)await s.users.addToGroup({id:R.id,groupId:E.id});if(l(Ye.AdminFineGrainedAuthz)){const R=await s.groups.listPermissions({id:u.id});R&&await s.groups.updatePermission({id:E.id},R)}const b=(await s.groups.listRealmRoleMappings({id:u.id})).map(R=>({id:R.id,name:R.name})),f=(await v(u.id))?.flatMap(R=>R.roles.map(F=>({id:F.id,name:F.name,clientUniqueId:R.clientId}))),y=[...b,...f];await B(y,E.id);const V=await s.groups.listSubGroups({parentId:u.id});for(const R of V){const F=R.attributes;await O({...R,attributes:F},E.id,!0)}return E}catch(N){throw d("couldNotDuplicateGroup",N),N}},B=async(u,w)=>{try{const L=u.filter(E=>!E.clientUniqueId&&E.name),N=u.filter(E=>E.clientUniqueId&&E.name);await s.groups.addRealmRoleMappings({id:w,roles:L.map(({id:E,name:K})=>({id:E,name:K}))}),await Promise.all(N.map(E=>E.clientUniqueId&&E.name?s.groups.addClientRoleMappings({id:w,clientUniqueId:E.clientUniqueId,roles:[{id:E.id,name:E.name}]}):Promise.resolve()))}catch(L){d("roleMappingUpdatedError",L)}},x=async u=>{u.name=u.name?.trim();try{n&&p?await O(p):a?e?await s.groups.update({id:a},{...e,name:u.name,description:u.description}):await s.groups.updateChildGroup({id:a},u):await s.groups.create(u),c(e?{...e,...u}:void 0),o(),r(i(e?"groupUpdated":n?"groupDuplicated":"groupCreated"),me.success)}catch(w){d("couldNotCreateGroup",w)}};return t(Qe,{variant:Xe.small,title:i(e?"editGroup":n?"duplicateAGroup":"createAGroup"),isOpen:!0,onClose:o,actions:[t(yt,{formState:m,"data-testid":`${e?"rename":n?"duplicate":"create"}Group`,form:"group-form",allowInvalid:!0,allowNonDirty:!0,children:i(e?"edit":n?"duplicate":"create")},"confirm"),t(Z,{id:"modal-cancel","data-testid":"cancel",variant:ve.link,onClick:o,children:i("cancel")},"cancel")],children:t(bt,{...h,children:j(vt,{id:"group-form",isHorizontal:!0,onSubmit:G(x),children:[n&&t(wt,{variant:"warning",component:"h2",isInline:!0,title:i("duplicateGroupWarning")}),t(Oe,{name:"name",label:i("name"),rules:{required:i("required")},autoFocus:!0}),t(Oe,{name:"description",label:i("description")})]})})})},xe=({selectedRows:a,show:e,toggleDialog:n,refresh:o})=>{const{adminClient:c}=H(),{t:s}=P(),{addAlert:i,addError:r}=ee(),d=async()=>{try{for(const l of a)await c.groups.del({id:l.id});o(),i(s("groupDeleted",{count:a.length}))}catch(l){r("groupDeleteError",l)}};return t(Ft,{titleKey:s("deleteConfirmTitle",{count:a.length}),messageKey:s("deleteConfirmGroup",{count:a.length,groupName:a[0]?.name}),continueButtonLabel:"delete",continueButtonVariant:ve.danger,onConfirm:d,open:e,toggleDialog:n})},ea=({toggleCreate:a,toggleDelete:e,kebabDisabled:n})=>{const{t:o}=P(),{currentGroup:c}=ne(),{hasAccess:s}=le(),i=s("manage-users")||c()?.access?.manage,[r,d]=z();return i?j(Y,{children:[t(te,{children:t(Z,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:a,children:o("createGroup")})}),t(te,{children:t(we,{onOpenChange:d,toggle:l=>t(Ce,{"data-testid":"kebab",ref:l,isExpanded:r,onClick:d,isDisabled:n,variant:"plain","aria-label":"Actions",children:t(Ne,{})}),isOpen:r,children:t(ye,{children:t(J,{component:"button",onClick:()=>{e(),d()},children:o("delete")},"action")})})})]}):t("div",{})},ta=(a,e)=>e.id?a.groups.updateRoot(e):a.groups.create(e),aa=async(a,e,n)=>a.groups.updateChildGroup({id:n.id},e),ot=({source:a,onClose:e,refresh:n})=>{const{adminClient:o}=H(),{t:c}=P(),{addAlert:s,addError:i}=ee();return t(Ut,{type:"selectOne",filterGroups:[a],text:{title:"moveToGroup",ok:"moveHere"},onClose:e,onConfirm:async d=>{try{await(d?aa(o,a,d[0]):ta(o,a)),n(),s(c("moveGroupSuccess"))}catch(l){i("moveGroupError",l)}},isMove:!0})},je=({refresh:a})=>{const{adminClient:e}=H(),{t:n}=P(),[o,c]=S([]),[s,i]=S(),[r,d]=z(),[l,p]=S(),[T,h]=z(),[G,m]=S(),{currentGroup:v}=ne(),[O,B]=S(0),x=()=>B(O+1),[u,w]=S(),L=oe(),N=pe(L.pathname),{hasAccess:E}=le(),K=E("manage-users")||v()?.access?.manage,A=async(b,g)=>{let f;if(N){const y={search:u||"",first:b,max:g,parentId:N};f=await e.groups.listSubGroups(y)}else{const y={search:u||"",first:b||void 0,max:g||void 0};f=await e.groups.find(y)}return f};return j(Y,{children:[t(xe,{show:T,toggleDialog:h,selectedRows:o,refresh:()=>{x(),a(),c([])}}),s&&t(ae,{id:s.id,rename:s,refresh:()=>{x(),a()},handleModalToggle:()=>i(void 0)}),r&&t(ae,{id:o[0]?.id||N,handleModalToggle:d,refresh:()=>{c([]),x(),a()}}),l&&t(ae,{id:l,duplicateId:l,refresh:()=>{x(),a()},handleModalToggle:()=>p(void 0)}),G&&t(ot,{source:G,refresh:()=>{m(void 0),x(),a()},onClose:()=>m(void 0)}),t(Ee,{onSelect:b=>c([...b]),canSelectAll:!0,loader:A,ariaLabelKey:"groups",isPaginated:!0,isSearching:!!u,toolbarItem:j(Y,{children:[t(te,{children:t(Ct,{"data-testid":"group-search",placeholder:n("filterGroups"),value:u,onChange:(b,g)=>{w(g),g===""&&x()},onSearch:x,onClear:()=>{w(""),x()}})}),t(ea,{toggleCreate:d,toggleDelete:h,kebabDisabled:o.length===0})]}),actions:K?[{title:n("edit"),onRowClick:async b=>(i(b),!1)},{title:n("moveTo"),onRowClick:async b=>(m(b),!1)},{title:n("createChildGroup"),onRowClick:async b=>(c([b]),d(),!1)},...N?[]:[{title:n("duplicate"),onRowClick:async b=>(p(b.id),!1)}],{isSeparator:!0},{title:n("delete"),onRowClick:async b=>(c([b]),h(),!0)}]:[],columns:[{name:"name",displayKey:"groupName",cellRenderer:b=>b.access?.view?t(ue,{to:`${L.pathname}/${b.id}`,children:b.name},b.id):t("span",{children:b.name})}],emptyState:t(Ge,{hasIcon:!0,message:n(`noGroupsInThis${N?"SubGroup":"Realm"}`),instructions:n(`noGroupsInThis${N?"SubGroup":"Realm"}Instructions`),primaryActionText:n("createGroup"),onPrimaryAction:d})},`${N}${O}`)]})},na=({user:a,onClose:e})=>{const{t:n}=P(),{adminClient:o}=H(),[c,s]=S(0),i=()=>s(c+1),[r,d]=S(!0),{enabled:l}=Nt(),p=h=>qt(h,G=>G.path?.toUpperCase()),T=async(h,G,m)=>{const v={first:h,max:G},O=m||"";O&&(v.search=O);const B=await o.users.listGroups({...v,id:a.id}),x=[];return r||B.forEach(u=>{const w=(u.path?.substring(1).match(/((~\/)|[^/])+/g)||[]).slice(0,-1);x.push(...w.map(L=>({name:L,path:u.path?.substring(0,u.path.indexOf(L)+L.length)})))}),p(Je([...B,...x],"path"))};return t(Qe,{variant:Xe.large,title:n("showMembershipsTitle",{username:a.username}),"data-testid":"showMembershipsDialog",isOpen:!0,onClose:e,actions:[t(Z,{id:"modal-cancel","data-testid":"cancel",variant:ve.primary,onClick:e,children:n("cancel")},"cancel")],children:t(Ee,{loader:T,className:"keycloak_user-section_groups-table",isPaginated:!0,ariaLabelKey:"roleList",searchPlaceholderKey:"searchGroup",toolbarItem:j(Y,{children:[t(ke,{label:n("directMembership"),id:"kc-direct-membership-checkbox",onChange:()=>{d(!r),i()},isChecked:r,className:"pf-v5-u-mt-sm"},"direct-membership-check"),l&&t(Et,{"aria-label":"Basic popover",position:"bottom",bodyContent:t("div",{children:n("whoWillAppearPopoverTextUsers")}),children:t(Z,{variant:"link",className:"kc-who-will-appear-button",icon:t(Pt,{}),children:n("whoWillAppearLinkTextUsers")},"who-will-appear-button")})]}),columns:[{name:"groupMembership",displayKey:"groupMembership",cellRenderer:h=>h.name||"-",transforms:[Le(40)]},{name:"path",displayKey:"path",cellRenderer:h=>t($t,{group:h}),transforms:[Le(45)]}],emptyState:t(Ge,{hasIcon:!0,message:n("noGroupMemberships"),instructions:n("noGroupMembershipsText")})},c)})},sa=a=>{const{realm:e}=re(),{t:n}=P();return j(ue,{to:Gt({realm:e,id:a.id,tab:"settings"}),children:[a.username," ",!a.enabled&&t(kt,{color:"red",icon:t(It,{}),children:n("disabled")})]},a.id)},ia=()=>{const{adminClient:a}=H(),{t:e}=P(),{addAlert:n,addError:o}=ee(),c=oe(),s=pe(c.pathname),[i,r]=S(!1),{currentGroup:d}=ne(),[l,p]=S(),[T,h]=S(!1),[G,m]=S(!1),[v,O]=S([]),[B,x]=S(),[u,w]=z(),{hasAccess:L}=le();ce(()=>a.groups.findOne({id:d().id}),p,[]);const N=L("manage-users")||l?.access.manageMembership,[E,K]=S(0),A=()=>K(new Date().getTime()),b=async(f,y=0)=>{let V=[];if(!y||!f)return V;const R={parentId:f,first:0,max:y},F=await a.groups.listSubGroups(R);return V=V.concat(F),await Promise.all(F.map(q=>b(q.id,q.subGroupCount))).then(q=>{q.forEach(k=>V=V.concat(k))}),V},g=async(f,y)=>{if(!s)return[];let V=await a.groups.listMembers({id:s,briefRepresentation:!0,first:f,max:y});if(i&&l?.subGroupCount&&l.id){const R=await b(l.id,l.subGroupCount);await Promise.all(R.map(F=>a.groups.listMembers({id:F.id,briefRepresentation:!0}))).then(F=>{F.forEach(q=>V=V.concat(q))}),V=Je(V,F=>F.username)}return V};return l?j(Y,{children:[T&&t(jt,{membersQuery:(f,y)=>a.groups.listMembers({id:s,first:f,max:y}),onAdd:async f=>{try{await Promise.all(f.map(y=>a.users.addToGroup({id:y.id,groupId:s}))),n(e("usersAdded",{count:f.length}))}catch(y){o("usersAddedError",y)}},onClose:()=>{h(!1),A()}}),u&&t(na,{onClose:()=>{w()},user:B}),t(Ee,{"data-testid":"members-table",loader:g,ariaLabelKey:"members",isPaginated:!0,canSelectAll:!0,onSelect:f=>O([...f]),toolbarItem:N&&j(Y,{children:[t(te,{children:t(Z,{"data-testid":"addMember",variant:"primary",onClick:()=>h(!0),children:e("addMember")})}),t(te,{children:t(ke,{"data-testid":"includeSubGroupsCheck",label:e("includeSubGroups"),id:"kc-include-sub-groups",isChecked:i,onChange:()=>r(!i)})}),t(te,{children:t(we,{onOpenChange:f=>m(f),toggle:f=>t(Ce,{"data-testid":"kebab",ref:f,variant:"plain",onClick:()=>m(!G),isExpanded:G,isDisabled:v.length===0,"aria-label":"Actions",children:t(Ne,{})}),shouldFocusToggleOnSelect:!0,isOpen:G,children:t(ye,{children:t(J,{component:"button",onClick:async()=>{try{await Promise.all(v.map(f=>a.users.delFromGroup({id:f.id,groupId:s}))),m(!1),n(e("usersLeft",{count:v.length}))}catch(f){o("usersLeftError",f)}A()},children:e("leave")},"action")})})})]}),actions:[...N?[{title:e("leave"),onRowClick:async f=>{try{await a.users.delFromGroup({id:f.id,groupId:s}),n(e("usersLeft",{count:1}))}catch(y){o("usersLeftError",y)}return!0}}]:[],{title:e("showMemberships"),onRowClick:f=>{x(f),w()}}],columns:[{name:"username",displayKey:"name",cellRenderer:sa},{name:"email",displayKey:"email",cellFormatters:[he()]},{name:"firstName",displayKey:"firstName",cellFormatters:[he()]},{name:"lastName",displayKey:"lastName",cellFormatters:[he()]}],emptyState:t(Ge,{message:e("noUsersFound"),instructions:N?e("emptyInstructions"):void 0,primaryActionText:N?e("addMember"):void 0,onPrimaryAction:()=>h(!0),secondaryActions:[{text:e("includeSubGroups"),onClick:()=>r(!0)}]})},`${s}${E}${i}`)]}):t(Ze,{})};function ct(a){let e=a.length;for(const n of a)n.subGroups&&(e+=ct(n.subGroups));return e}const ra=({group:a,refresh:e})=>{const{t:n}=P(),[o,c]=z(),[s,i]=z(),[r,d]=z(),[l,p]=z(),[T,h]=z(),G=Ie(),{realm:m}=re();return j(Y,{children:[s&&t(ae,{id:a.id,rename:a,refresh:()=>{G(se({realm:m})),e()},handleModalToggle:i}),r&&t(ae,{id:a.id,handleModalToggle:d,refresh:e}),l&&t(ot,{source:a,refresh:e,onClose:p}),t(xe,{show:T,toggleDialog:h,selectedRows:[a],refresh:()=>{G(se({realm:m})),e()}}),t(we,{popperProps:{position:"right"},onOpenChange:c,toggle:v=>t(Ce,{ref:v,onClick:c,isExpanded:o,variant:"plain","aria-label":"Actions",children:t(Ne,{})}),isOpen:o,children:j(ye,{children:[t(J,{onClick:i,children:n("edit")},"rename"),t(J,{onClick:p,children:n("moveTo")},"move"),t(J,{onClick:d,children:n("createChildGroup")},"create"),t(qe,{},"separator"),t(J,{onClick:h,children:n("delete")},"delete")]})})]})},de=50,oa=()=>{const{t:a}=P();return j(Y,{children:[t(Mt,{size:"sm"})," ",a("spinnerLoading")]})},ca=[{name:t(oa,{})}],la=({refresh:a,canViewDetails:e})=>{const{adminClient:n}=H(),{t:o}=P(),{realm:c}=re(),s=Ie(),{addAlert:i}=ee(),{hasAccess:r}=le(),[d,l]=S(),{subGroups:p,clear:T}=ne(),[h,G]=S(""),[m,v]=S(20),[O,B]=S(0),x=Fe(0),u=Fe(20),[w,L]=S(0),[N,E]=S(!1),[K,A]=S(),[b,g]=S(0),[f,y]=S(0),V=()=>{y(f+1),a()},R=(k,_)=>{const C=k.subGroupCount;return{id:k.id,name:t(et,{content:k.name,children:t("span",{children:k.name})}),access:k.access||{},children:C?h.length===0?ca:k.subGroups?.map(M=>R(M,_)):void 0,action:(r("manage-users")||k.access?.manage)&&t(ra,{group:k,refresh:_}),defaultExpanded:p.map(M=>M.id).includes(k.id)}};ce(async()=>{const k=await Ke(n,"groups",Object.assign({first:`${O}`,max:`${m+1}`,exact:`${N}`,global:`${h!==""}`},h===""?null:{search:h}));let _=[];return K&&(_=await Ke(n,`groups/${K.id}/children`,{first:`${b}`,max:`${de}`})),{groups:k,subGroups:_}},({groups:k,subGroups:_})=>{if(K){const C=F(d||[],K.id,[]);if(C.length&&_.length){const M=C.pop();M.children=[...($e(M.children||[]).splice(0,de),_.map(W=>R(W,V),"id")),..._.length===de?[{id:"next",name:t(Z,{variant:"plain",onClick:()=>g(b+de),children:t(Pe,{})})}]:[]]}}h||x.current!==O||u.current!==m?l(k.map(C=>R(C,V))):l($e(d,k.map(C=>R(C,V)),"id")),L(ct(k)),x.current=O,u.current=m},[f,O,b,m,h,N,K]);const F=(k,_,C)=>{for(let M=0;M<k.length;M++){const W=k[M];if(W.id===_)return C.push(W),C;W.children&&(C.push(W),F(W.children,_,C),C[C.length-1].id!==_&&C.pop())}return C},q=(k,_)=>{if(k.id==="next")return;A(k);const C=F(_,k.id,[]);p.every(({id:M})=>C.find(W=>W.id===M))||T(),e||C.at(-1)?.access?.view||p.at(-1)?.access?.view?s(se({realm:c,id:C.map(M=>M.id).join("/")})):(i(o("noViewRights"),me.warning),s(se({realm:c})))};return d?t(St,{count:w,first:O,max:m,onNextClick:B,onPreviousClick:B,onPerPageSelect:(k,_)=>{B(k),v(_)},inputGroupName:"searchForGroups",inputGroupPlaceholder:o("searchForGroups"),inputGroupOnEnter:G,toolbarItem:j(xt,{className:"pf-v5-u-pt-sm",children:[t(Be,{children:t(ke,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:N,onChange:(k,_)=>E(_),className:"pf-v5-u-mr-xs"})}),t(Be,{children:t("label",{htmlFor:"exact",className:"pf-v5-u-pl-sm",children:o("exactSearch")})})]}),children:d.length>0&&t(Se,{data:d.slice(0,m),allExpanded:h.length>0,activeItems:K?[K]:void 0,hasGuides:!0,hasSelectableNodes:!0,className:"keycloak_groups_treeview",onExpand:(k,_)=>{q(_,d)},onSelect:(k,_)=>{q(_,d)}})}):t(Ze,{})};function Fa(){const{adminClient:a}=H(),{t:e}=P(),[n,o]=S(0),{subGroups:c,setSubGroups:s,currentGroup:i}=ne(),{realm:r}=re(),[d,l]=S(),[p,T]=z(),h=Ie(),G=oe(),m=pe(G.pathname),[v,O]=z(!0),[B,x]=S(0),u=()=>x(B+1),{hasAccess:w}=le(),N=We()(Ye.AdminFineGrainedAuthz)&&w("manage-authorization","manage-users","manage-clients"),E=w("manage-users")||i()?.access?.manage,K=w("manage-users"),A=w("query-groups","view-users")||w("manage-users","query-groups"),b=w("view-users")||i()?.access?.viewMembers||i()?.access?.manageMembers,[g,f]=S("adminEvents");return ce(async()=>{const y=rt(G.pathname);if(y&&y.length>c.length){const R=[];for(const F of y){let q;if(F!=="search"?q=await a.groups.findOne({id:F}):q={name:e("searchGroups"),id:"search"},q)R.push(q);else throw new Error(e("notFound"))}return R}return[]},y=>{y.length&&s(y)},[m]),j(Y,{children:[t(xe,{show:p,toggleDialog:T,selectedRows:[i()],refresh:()=>{h(se({realm:r})),u()}}),d&&t(ae,{id:m,rename:d,refresh:y=>{u(),s([...c.slice(0,c.length-1),y])},handleModalToggle:()=>l(void 0)}),t(be,{variant:He.light,className:"pf-v5-u-p-0",children:t(Tt,{isInline:!0,isExpanded:v,position:"left",children:t(At,{panelContent:t(Dt,{isResizable:!0,children:t(nt,{children:t(la,{refresh:u,canViewDetails:A})})}),children:j(Rt,{children:[t(et,{content:e(v?"hide":"show"),children:t(Z,{"aria-label":e(v?"hide":"show"),variant:"plain",icon:v?t(Vt,{}):t(Xt,{}),onClick:O})}),t(Yt,{}),t(Lt,{titleKey:m?i()?.name:"groups",subKey:m?"":"groupsDescription",helpUrl:m?"":_t.groupsUrl,divider:!m,dropdownItems:m&&E?[t(J,{"data-testid":"renameGroupAction",onClick:()=>l(i()),children:e("edit")},"renameGroup"),t(J,{"data-testid":"deleteGroup",onClick:T,children:e("deleteGroup")},"deleteGroup")]:void 0}),t(be,{className:"pf-v5-u-pt-0",children:i()?.description}),c.length>0&&j(Ue,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:n,onSelect:(y,V)=>o(V),isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[t(Q,{"data-testid":"groups",eventKey:0,title:t(X,{children:e("childGroups")}),children:t(je,{refresh:u})}),b&&t(Q,{"data-testid":"members",eventKey:1,title:t(X,{children:e("members")}),children:t(ia,{})}),t(Q,{"data-testid":"attributesTab",eventKey:2,title:t(X,{children:e("attributes")}),children:t(Jt,{})}),K&&t(Q,{eventKey:3,"data-testid":"role-mapping-tab",title:t(X,{children:e("roleMapping")}),children:t(Zt,{id:m,name:i()?.name})}),N&&t(Q,{eventKey:4,"data-testid":"permissionsTab",title:t(X,{children:e("permissions")}),children:t(Ot,{id:m,type:"groups"})}),w("view-events")&&t(Q,{eventKey:5,"data-testid":"admin-events-tab",title:t(X,{children:e("adminEvents")}),children:j(Ue,{activeKey:g,onSelect:(y,V)=>f(V),children:[t(Q,{eventKey:"adminEvents",title:t(X,{children:e("adminEvents")}),children:t(ge,{resourcePath:`groups/${m}`})}),t(Q,{eventKey:"membershipEvents",title:t(X,{children:e("membershipEvents")}),children:t(ge,{resourcePath:`users/*/groups/${m}`})}),t(Q,{eventKey:"childGroupEvents",title:t(X,{children:e("childGroupEvents")}),children:t(ge,{resourcePath:`groups/${m}/children`})})]})})]}),c.length===0&&t(je,{refresh:u})]})})},B)})]})}export{Fa as default};
//# sourceMappingURL=GroupsSection-B6FLgJ--.js.map
