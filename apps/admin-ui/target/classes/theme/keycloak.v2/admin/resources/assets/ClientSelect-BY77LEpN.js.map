{"version":3,"file":"ClientSelect-BY77LEpN.js","sources":["../../../../../../../src/components/client/ClientSelect.tsx"],"sourcesContent":["import type ClientRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientRepresentation\";\r\nimport type { ClientQuery } from \"@keycloak/keycloak-admin-client/lib/resources/clients\";\r\nimport {\r\n  SelectControl,\r\n  SelectControlOption,\r\n  SelectVariant,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport type { ComponentProps } from \"../dynamic/components\";\r\nimport { PermissionsConfigurationTabsParams } from \"../../permissions-configuration/routes/PermissionsConfigurationTabs\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { useFormContext, useWatch } from \"react-hook-form\";\r\n\r\ntype ClientSelectProps = Omit<ComponentProps, \"convertToName\"> & {\r\n  variant?: `${SelectVariant}`;\r\n  isRequired?: boolean;\r\n  clientKey?: keyof ClientRepresentation;\r\n  placeholderText?: string;\r\n};\r\n\r\nexport const ClientSelect = ({\r\n  name,\r\n  label,\r\n  helpText,\r\n  defaultValue,\r\n  isDisabled = false,\r\n  isRequired,\r\n  variant = \"typeahead\",\r\n  clientKey = \"clientId\",\r\n  placeholderText,\r\n}: ClientSelectProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n\r\n  const [clients, setClients] = useState<ClientRepresentation[]>([]);\r\n  const [selectedClients, setSelectedClients] =\r\n    useState<SelectControlOption[]>();\r\n  const [search, setSearch] = useState(\"\");\r\n  const { tab } = useParams<PermissionsConfigurationTabsParams>();\r\n\r\n  const { control } = useFormContext();\r\n  const value = useWatch({\r\n    control,\r\n    name: name!,\r\n    defaultValue: defaultValue || \"\",\r\n  });\r\n\r\n  const getValue = (): string[] => {\r\n    if (typeof value === \"string\") {\r\n      return [value];\r\n    }\r\n    return value || [];\r\n  };\r\n\r\n  useFetch(\r\n    () => {\r\n      const params: ClientQuery = {\r\n        max: 20,\r\n      };\r\n      if (search) {\r\n        params.clientId = search;\r\n        params.search = true;\r\n      }\r\n      return adminClient.clients.find(params);\r\n    },\r\n    (clients) => setClients(clients),\r\n    [search],\r\n  );\r\n\r\n  useFetch(\r\n    () => {\r\n      const values = getValue().map(async (clientId) => {\r\n        if (clientKey === \"clientId\") {\r\n          return (await adminClient.clients.find({ clientId }))[0];\r\n        } else {\r\n          return adminClient.clients.findOne({ id: clientId });\r\n        }\r\n      });\r\n      return Promise.all(values);\r\n    },\r\n    (clients) => {\r\n      setSelectedClients(\r\n        clients\r\n          .filter((client) => !!client)\r\n          .map((client) => ({\r\n            key: client[clientKey] as string,\r\n            value: client.clientId!,\r\n          })),\r\n      );\r\n    },\r\n    [],\r\n  );\r\n\r\n  return (\r\n    <SelectControl\r\n      name={name!}\r\n      label={tab !== \"evaluation\" ? t(label!) : t(\"client\")}\r\n      labelIcon={tab !== \"evaluation\" ? t(helpText!) : t(\"selectClient\")}\r\n      controller={{\r\n        defaultValue: defaultValue || \"\",\r\n        rules: {\r\n          required: {\r\n            value: isRequired || false,\r\n            message: t(\"required\"),\r\n          },\r\n        },\r\n      }}\r\n      onFilter={(value) => setSearch(value)}\r\n      variant={variant}\r\n      isDisabled={isDisabled}\r\n      selectedOptions={selectedClients}\r\n      options={clients.map((client) => ({\r\n        key: client[clientKey] as string,\r\n        value: client.clientId!,\r\n      }))}\r\n      placeholderText={placeholderText}\r\n    />\r\n  );\r\n};\r\n"],"names":["ClientSelect","name","label","helpText","defaultValue","isDisabled","isRequired","variant","clientKey","placeholderText","adminClient","useAdminClient","t","useTranslation","clients","setClients","useState","selectedClients","setSelectedClients","search","setSearch","tab","useParams","control","useFormContext","value","useWatch","getValue","useFetch","params","values","clientId","client","jsx","SelectControl"],"mappings":"2JAuBO,MAAMA,EAAe,CAAC,CAC3B,KAAAC,EACA,MAAAC,EACA,SAAAC,EACA,aAAAC,EACA,WAAAC,EAAa,GACb,WAAAC,EACA,QAAAC,EAAU,YACV,UAAAC,EAAY,WACZ,gBAAAC,CACF,IAAyB,CACvB,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EAER,CAACC,EAASC,CAAU,EAAIC,EAAiC,CAAA,CAAE,EAC3D,CAACC,EAAiBC,CAAkB,EACxCF,EAAA,EACI,CAACG,EAAQC,CAAS,EAAIJ,EAAS,EAAE,EACjC,CAAE,IAAAK,CAAA,EAAQC,EAAA,EAEV,CAAE,QAAAC,CAAA,EAAYC,EAAA,EACdC,EAAQC,EAAS,CACrB,QAAAH,EACA,KAAAtB,EACA,aAAcG,GAAgB,EAAA,CAC/B,EAEKuB,EAAW,IACX,OAAOF,GAAU,SACZ,CAACA,CAAK,EAERA,GAAS,CAAA,EAGlBG,OAAAA,EACE,IAAM,CACJ,MAAMC,EAAsB,CAC1B,IAAK,EAAA,EAEP,OAAIV,IACFU,EAAO,SAAWV,EAClBU,EAAO,OAAS,IAEXnB,EAAY,QAAQ,KAAKmB,CAAM,CACxC,EACCf,GAAYC,EAAWD,CAAO,EAC/B,CAACK,CAAM,CAAA,EAGTS,EACE,IAAM,CACJ,MAAME,EAASH,EAAA,EAAW,IAAI,MAAOI,GAC/BvB,IAAc,YACR,MAAME,EAAY,QAAQ,KAAK,CAAE,SAAAqB,CAAA,CAAU,GAAG,CAAC,EAEhDrB,EAAY,QAAQ,QAAQ,CAAE,GAAIqB,EAAU,CAEtD,EACD,OAAO,QAAQ,IAAID,CAAM,CAC3B,EACChB,GAAY,CACXI,EACEJ,EACG,OAAQkB,GAAW,CAAC,CAACA,CAAM,EAC3B,IAAKA,IAAY,CAChB,IAAKA,EAAOxB,CAAS,EACrB,MAAOwB,EAAO,QAAA,EACd,CAAA,CAER,EACA,CAAA,CAAC,EAIDC,EAACC,EAAA,CACC,KAAAjC,EACA,MAA8BW,EAAvBS,IAAQ,aAAiBnB,EAAY,QAAN,EACtC,UAAkCU,EAAvBS,IAAQ,aAAiBlB,EAAe,cAAN,EAC7C,WAAY,CACV,aAAcC,GAAgB,GAC9B,MAAO,CACL,SAAU,CACR,MAAOE,GAAc,GACrB,QAASM,EAAE,UAAU,CAAA,CACvB,CACF,EAEF,SAAWa,GAAUL,EAAUK,CAAK,EACpC,QAAAlB,EACA,WAAAF,EACA,gBAAiBY,EACjB,QAASH,EAAQ,IAAKkB,IAAY,CAChC,IAAKA,EAAOxB,CAAS,EACrB,MAAOwB,EAAO,QAAA,EACd,EACF,gBAAAvB,CAAA,CAAA,CAGN"}