{"version":3,"file":"ClientScopeTypes-D2w5c8Pp.js","sources":["../../../../../../../src/components/client-scope/ClientScopeTypes.tsx"],"sourcesContent":["import type ClientScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientScopeRepresentation\";\r\n\r\nimport KeycloakAdminClient from \"@keycloak/keycloak-admin-client\";\r\nimport type { TFunction } from \"i18next\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { toUpperCase } from \"../../util\";\r\nimport {\r\n  DropdownItem,\r\n  MenuToggle,\r\n  Select,\r\n  SelectOption,\r\n  SelectProps,\r\n} from \"@patternfly/react-core\";\r\n\r\nexport enum ClientScope {\r\n  default = \"default\",\r\n  optional = \"optional\",\r\n}\r\n\r\nexport enum AllClientScopes {\r\n  none = \"none\",\r\n}\r\n\r\nexport type ClientScopeType = ClientScope;\r\nexport type AllClientScopeType = ClientScope | AllClientScopes;\r\n\r\nconst clientScopeTypes = Object.keys(ClientScope);\r\nexport const allClientScopeTypes = Object.keys({\r\n  ...AllClientScopes,\r\n  ...ClientScope,\r\n}) as AllClientScopeType[];\r\n\r\nexport const clientScopeTypesSelectOptions = (\r\n  t: TFunction,\r\n  scopeTypes: string[] | undefined = clientScopeTypes,\r\n) =>\r\n  scopeTypes.map((type) => (\r\n    <SelectOption key={type} value={type}>\r\n      {t(`clientScopeType.${type}`)}\r\n    </SelectOption>\r\n  ));\r\n\r\nexport const clientScopeTypesDropdown = (\r\n  t: TFunction,\r\n  onClick: (scope: ClientScopeType) => void,\r\n) =>\r\n  clientScopeTypes.map((type) => (\r\n    <DropdownItem key={type} onClick={() => onClick(type as ClientScopeType)}>\r\n      {t(`clientScopeType.${type}`)}\r\n    </DropdownItem>\r\n  ));\r\n\r\ntype CellDropdownProps = Omit<SelectProps, \"toggle\"> & {\r\n  clientScope: ClientScopeRepresentation;\r\n  type: ClientScopeType | AllClientScopeType;\r\n  all?: boolean;\r\n  onSelect: (value: ClientScopeType | AllClientScopeType) => void;\r\n  isDisabled?: boolean;\r\n};\r\n\r\nexport const CellDropdown = ({\r\n  clientScope,\r\n  type,\r\n  onSelect,\r\n  all = false,\r\n  isDisabled,\r\n  ...props\r\n}: CellDropdownProps) => {\r\n  const { t } = useTranslation();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  return (\r\n    <Select\r\n      key={clientScope.id}\r\n      toggle={(ref) => (\r\n        <MenuToggle\r\n          data-testid=\"cell-dropdown\"\r\n          className={`keycloak__client-scope__${type}`}\r\n          ref={ref}\r\n          onClick={() => setOpen(!open)}\r\n          isExpanded={open}\r\n          isDisabled={isDisabled}\r\n        >\r\n          {t(`clientScopeType.${type}`)}\r\n        </MenuToggle>\r\n      )}\r\n      isOpen={open}\r\n      onOpenChange={(isOpen) => setOpen(isOpen)}\r\n      selected={[type]}\r\n      onSelect={(_, value) => {\r\n        onSelect(\r\n          all ? (value as ClientScopeType) : (value as AllClientScopeType),\r\n        );\r\n        setOpen(false);\r\n      }}\r\n      {...props}\r\n    >\r\n      {clientScopeTypesSelectOptions(\r\n        t,\r\n        all ? allClientScopeTypes : clientScopeTypes,\r\n      )}\r\n    </Select>\r\n  );\r\n};\r\n\r\nexport type ClientScopeDefaultOptionalType = ClientScopeRepresentation & {\r\n  type: AllClientScopeType;\r\n};\r\n\r\nexport const changeScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientScope: ClientScopeDefaultOptionalType,\r\n  changeTo: AllClientScopeType,\r\n) => {\r\n  await removeScope(adminClient, clientScope);\r\n  await addScope(adminClient, clientScope, changeTo);\r\n};\r\n\r\nconst castAdminClient = (adminClient: KeycloakAdminClient) =>\r\n  adminClient.clientScopes as unknown as {\r\n    [index: string]: (params: { id: string }) => Promise<void>;\r\n  };\r\n\r\nexport const removeScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientScope: ClientScopeDefaultOptionalType,\r\n) => {\r\n  if (clientScope.type !== AllClientScopes.none)\r\n    await castAdminClient(adminClient)[\r\n      `delDefault${\r\n        clientScope.type === ClientScope.optional ? \"Optional\" : \"\"\r\n      }ClientScope`\r\n    ]({\r\n      id: clientScope.id!,\r\n    });\r\n};\r\n\r\nconst addScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientScope: ClientScopeDefaultOptionalType,\r\n  type: AllClientScopeType,\r\n) => {\r\n  if (type !== AllClientScopes.none)\r\n    await castAdminClient(adminClient)[\r\n      `addDefault${type === ClientScope.optional ? \"Optional\" : \"\"}ClientScope`\r\n    ]({\r\n      id: clientScope.id!,\r\n    });\r\n};\r\n\r\nexport const changeClientScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientId: string,\r\n  clientScope: ClientScopeRepresentation,\r\n  type: AllClientScopeType,\r\n  changeTo: ClientScopeType,\r\n) => {\r\n  if (type !== \"none\") {\r\n    await removeClientScope(adminClient, clientId, clientScope, type);\r\n  }\r\n  await addClientScope(adminClient, clientId, clientScope, changeTo);\r\n};\r\n\r\nexport const removeClientScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientId: string,\r\n  clientScope: ClientScopeRepresentation,\r\n  type: ClientScope,\r\n) => {\r\n  const methodName = `del${toUpperCase(type)}ClientScope` as const;\r\n\r\n  await adminClient.clients[methodName]({\r\n    id: clientId,\r\n    clientScopeId: clientScope.id!,\r\n  });\r\n};\r\n\r\nexport const addClientScope = async (\r\n  adminClient: KeycloakAdminClient,\r\n  clientId: string,\r\n  clientScope: ClientScopeRepresentation,\r\n  type: ClientScopeType,\r\n) => {\r\n  const methodName = `add${toUpperCase(type)}ClientScope` as const;\r\n\r\n  await adminClient.clients[methodName]({\r\n    id: clientId,\r\n    clientScopeId: clientScope.id!,\r\n  });\r\n};\r\n"],"names":["ClientScope","AllClientScopes","clientScopeTypes","allClientScopeTypes","clientScopeTypesSelectOptions","t","scopeTypes","type","SelectOption","clientScopeTypesDropdown","onClick","jsx","DropdownItem","CellDropdown","clientScope","onSelect","all","isDisabled","props","useTranslation","open","setOpen","useState","Select","ref","MenuToggle","isOpen","_","value","changeScope","adminClient","changeTo","removeScope","addScope","castAdminClient","changeClientScope","clientId","removeClientScope","addClientScope","methodName","toUpperCase"],"mappings":"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"}