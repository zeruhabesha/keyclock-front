{"version":3,"file":"CreateUser-ClGbe2Q7.js","sources":["../../../../../../../src/user/CreateUser.tsx"],"sourcesContent":["import type GroupRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/groupRepresentation\";\r\nimport type { UserProfileMetadata } from \"@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata\";\r\nimport {\r\n  isUserProfileError,\r\n  setUserProfileServerError,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { AlertVariant, PageSection } from \"@patternfly/react-core\";\r\nimport { TFunction } from \"i18next\";\r\nimport { useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { ViewHeader } from \"../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport { UserForm } from \"./UserForm\";\r\nimport { UserFormFields, toUserRepresentation } from \"./form-state\";\r\nimport { toUser } from \"./routes/User\";\r\n\r\nimport \"./user-section.css\";\r\n\r\nexport default function CreateUser() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { addAlert, addError } = useAlerts();\r\n  const navigate = useNavigate();\r\n  const { realm: realmName, realmRepresentation: realm } = useRealm();\r\n  const form = useForm<UserFormFields>({ mode: \"onChange\" });\r\n  const [addedGroups, setAddedGroups] = useState<GroupRepresentation[]>([]);\r\n  const [userProfileMetadata, setUserProfileMetadata] =\r\n    useState<UserProfileMetadata>();\r\n\r\n  useFetch(\r\n    () => adminClient.users.getProfileMetadata({ realm: realmName }),\r\n    (userProfileMetadata) => {\r\n      if (!userProfileMetadata) {\r\n        throw new Error(t(\"notFound\"));\r\n      }\r\n\r\n      setUserProfileMetadata(userProfileMetadata);\r\n    },\r\n    [],\r\n  );\r\n\r\n  const save = async (data: UserFormFields) => {\r\n    try {\r\n      const createdUser = await adminClient.users.create({\r\n        ...toUserRepresentation(data),\r\n        groups: addedGroups.map((group) => group.path!),\r\n        enabled: true,\r\n      });\r\n\r\n      addAlert(t(\"userCreated\"), AlertVariant.success);\r\n      navigate(\r\n        toUser({ id: createdUser.id, realm: realmName, tab: \"settings\" }),\r\n      );\r\n    } catch (error) {\r\n      if (isUserProfileError(error)) {\r\n        setUserProfileServerError(error, form.setError, ((key, param) =>\r\n          t(key as string, param as any)) as TFunction);\r\n      } else {\r\n        addError(\"userCreateError\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!realm || !userProfileMetadata) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader\r\n        titleKey={t(\"createUser\")}\r\n        className=\"kc-username-view-header\"\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <UserForm\r\n          form={form}\r\n          realm={realm}\r\n          userProfileMetadata={userProfileMetadata}\r\n          onGroupsUpdate={setAddedGroups}\r\n          save={save}\r\n        />\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["CreateUser","adminClient","useAdminClient","t","useTranslation","addAlert","addError","useAlerts","navigate","useNavigate","realmName","realm","useRealm","form","useForm","addedGroups","setAddedGroups","useState","userProfileMetadata","setUserProfileMetadata","useFetch","save","data","createdUser","toUserRepresentation","group","AlertVariant","toUser","error","isUserProfileError","setUserProfileServerError","key","param","KeycloakSpinner","jsxs","Fragment","jsx","ViewHeader","PageSection","UserForm"],"mappings":"olBAwBA,SAAwBA,GAAa,CACnC,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CAAE,SAAAC,EAAU,SAAAC,CAAA,EAAaC,EAAA,EACzBC,EAAWC,EAAA,EACX,CAAE,MAAOC,EAAW,oBAAqBC,CAAA,EAAUC,EAAA,EACnDC,EAAOC,EAAwB,CAAE,KAAM,WAAY,EACnD,CAACC,EAAaC,CAAc,EAAIC,EAAgC,CAAA,CAAE,EAClE,CAACC,EAAqBC,CAAsB,EAChDF,EAAA,EAEFG,EACE,IAAMnB,EAAY,MAAM,mBAAmB,CAAE,MAAOS,EAAW,EAC9DQ,GAAwB,CACvB,GAAI,CAACA,EACH,MAAM,IAAI,MAAMf,EAAE,UAAU,CAAC,EAG/BgB,EAAuBD,CAAmB,CAC5C,EACA,CAAA,CAAC,EAGH,MAAMG,EAAO,MAAOC,GAAyB,CAC3C,GAAI,CACF,MAAMC,EAAc,MAAMtB,EAAY,MAAM,OAAO,CACjD,GAAGuB,EAAqBF,CAAI,EAC5B,OAAQP,EAAY,IAAKU,GAAUA,EAAM,IAAK,EAC9C,QAAS,EAAA,CACV,EAEDpB,EAASF,EAAE,aAAa,EAAGuB,EAAa,OAAO,EAC/ClB,EACEmB,EAAO,CAAE,GAAIJ,EAAY,GAAI,MAAOb,EAAW,IAAK,UAAA,CAAY,CAAA,CAEpE,OAASkB,EAAO,CACVC,EAAmBD,CAAK,EAC1BE,EAA0BF,EAAOf,EAAK,UAAW,CAACkB,EAAKC,IACrD7B,EAAE4B,EAAeC,CAAY,EAAA,EAE/B1B,EAAS,kBAAmBsB,CAAK,CAErC,CACF,EAEA,MAAI,CAACjB,GAAS,CAACO,IACLe,EAAA,EAAgB,EAIxBC,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CACC,SAAUlC,EAAE,YAAY,EACxB,UAAU,yBAAA,CAAA,EAEZiC,EAACE,EAAA,CAAY,QAAQ,QACnB,SAAAF,EAACG,EAAA,CACC,KAAA1B,EACA,MAAAF,EACA,oBAAAO,EACA,eAAgBF,EAChB,KAAAK,CAAA,CAAA,CACF,CACF,CAAA,EACF,CAEJ"}