{"version":3,"file":"WorkflowsSection-Cu06eExY.js","sources":["../../../../../../../src/workflows/WorkflowsSection.tsx"],"sourcesContent":["import {\r\n  AlertVariant,\r\n  Button,\r\n  ButtonVariant,\r\n  PageSection,\r\n  Switch,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  Action,\r\n  KeycloakDataTable,\r\n  ListEmptyState,\r\n  useAlerts,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport WorkflowRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/workflowRepresentation\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { ViewHeader } from \"../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport helpUrls from \"../help-urls\";\r\nimport { useConfirmDialog } from \"../components/confirm-dialog/ConfirmDialog\";\r\nimport { toWorkflowDetail } from \"./routes/WorkflowDetail\";\r\n\r\nexport default function WorkflowsSection() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { realm } = useRealm();\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { addAlert, addError } = useAlerts();\r\n\r\n  const [key, setKey] = useState(0);\r\n  const refresh = () => setKey(key + 1);\r\n\r\n  const [selectedWorkflow, setSelectedWorkflow] =\r\n    useState<WorkflowRepresentation>();\r\n\r\n  const loader = async () => {\r\n    const workflows = await adminClient.workflows.find();\r\n    return workflows.sort(\r\n      (a: WorkflowRepresentation, b: WorkflowRepresentation) => {\r\n        const nameA = a.name ?? \"\";\r\n        const nameB = b.name ?? \"\";\r\n        return nameA.localeCompare(nameB);\r\n      },\r\n    );\r\n  };\r\n\r\n  const toggleEnabled = async (workflow: WorkflowRepresentation) => {\r\n    const enabled = !(workflow.enabled ?? true);\r\n    const workflowToUpdate = { ...workflow, enabled };\r\n    try {\r\n      await adminClient.workflows.update(\r\n        { id: workflow.id! },\r\n        workflowToUpdate,\r\n      );\r\n\r\n      addAlert(\r\n        workflowToUpdate.enabled ? t(\"workflowEnabled\") : t(\"workflowDisabled\"),\r\n        AlertVariant.success,\r\n      );\r\n      refresh();\r\n    } catch (error) {\r\n      addError(\"workflowUpdateError\", error);\r\n    }\r\n  };\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"workflowDeleteConfirm\",\r\n    messageKey: t(\"workflowDeleteConfirmDialog\", {\r\n      selectedRoleName: selectedWorkflow ? selectedWorkflow!.name : \"\",\r\n    }),\r\n    continueButtonLabel: \"delete\",\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.workflows.delById({ id: selectedWorkflow!.id! });\r\n        setSelectedWorkflow(undefined);\r\n        addAlert(t(\"workflowDeletedSuccess\"), AlertVariant.success);\r\n        refresh();\r\n      } catch (error) {\r\n        addError(\"workflowDeleteError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader\r\n        titleKey=\"titleWorkflows\"\r\n        subKey=\"workflowsExplain\"\r\n        helpUrl={helpUrls.workflowsUrl}\r\n      />\r\n      <PageSection variant=\"light\" padding={{ default: \"noPadding\" }}>\r\n        <DeleteConfirm />\r\n        <KeycloakDataTable\r\n          key={key}\r\n          toolbarItem={\r\n            <Button\r\n              data-testid=\"create-workflow\"\r\n              component={(props) => (\r\n                <Link\r\n                  {...props}\r\n                  to={toWorkflowDetail({ realm, mode: \"create\", id: \"new\" })}\r\n                />\r\n              )}\r\n            >\r\n              {t(\"createWorkflow\")}\r\n            </Button>\r\n          }\r\n          columns={[\r\n            {\r\n              name: \"name\",\r\n              displayKey: \"name\",\r\n              cellRenderer: (row: WorkflowRepresentation) => (\r\n                <Link\r\n                  to={toWorkflowDetail({ realm, mode: \"update\", id: row.id! })}\r\n                >\r\n                  {row.name}\r\n                </Link>\r\n              ),\r\n            },\r\n            {\r\n              name: \"id\",\r\n              displayKey: \"id\",\r\n            },\r\n            {\r\n              name: \"status\",\r\n              displayKey: \"status\",\r\n              cellRenderer: (workflow: WorkflowRepresentation) => (\r\n                <Switch\r\n                  label={t(\"enabled\")}\r\n                  labelOff={t(\"disabled\")}\r\n                  isChecked={workflow.enabled ?? true}\r\n                  onChange={() => toggleEnabled(workflow)}\r\n                />\r\n              ),\r\n            },\r\n          ]}\r\n          actions={[\r\n            {\r\n              title: t(\"delete\"),\r\n              onRowClick: (workflow) => {\r\n                setSelectedWorkflow(workflow);\r\n                toggleDeleteDialog();\r\n              },\r\n            } as Action<WorkflowRepresentation>,\r\n            {\r\n              title: t(\"copy\"),\r\n              onRowClick: (workflow) => {\r\n                setSelectedWorkflow(workflow);\r\n                navigate(\r\n                  toWorkflowDetail({ realm, mode: \"copy\", id: workflow.id! }),\r\n                );\r\n              },\r\n            } as Action<WorkflowRepresentation>,\r\n          ]}\r\n          loader={loader}\r\n          ariaLabelKey=\"workflows\"\r\n          emptyState={\r\n            <ListEmptyState\r\n              message={t(\"emptyWorkflows\")}\r\n              instructions={t(\"emptyWorkflowsInstructions\")}\r\n              primaryActionText={t(\"createWorkflow\")}\r\n              onPrimaryAction={() =>\r\n                navigate(toWorkflowDetail({ realm, mode: \"create\", id: \"new\" }))\r\n              }\r\n            />\r\n          }\r\n        />\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["WorkflowsSection","adminClient","useAdminClient","realm","useRealm","t","useTranslation","navigate","useNavigate","addAlert","addError","useAlerts","key","setKey","useState","refresh","selectedWorkflow","setSelectedWorkflow","loader","a","b","nameA","nameB","toggleEnabled","workflow","enabled","workflowToUpdate","AlertVariant","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","jsxs","Fragment","jsx","ViewHeader","helpUrls","PageSection","KeycloakDataTable","Button","props","Link","toWorkflowDetail","row","Switch","ListEmptyState"],"mappings":"2VAwBA,SAAwBA,GAAmB,CACzC,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,MAAAC,CAAA,EAAUC,EAAA,EACZ,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACRC,EAAWC,EAAA,EACX,CAAE,SAAAC,EAAU,SAAAC,CAAA,EAAaC,EAAA,EAEzB,CAACC,EAAKC,CAAM,EAAIC,EAAS,CAAC,EAC1BC,EAAU,IAAMF,EAAOD,EAAM,CAAC,EAE9B,CAACI,EAAkBC,CAAmB,EAC1CH,EAAA,EAEII,EAAS,UACK,MAAMjB,EAAY,UAAU,KAAA,GAC7B,KACf,CAACkB,EAA2BC,IAA8B,CACxD,MAAMC,EAAQF,EAAE,MAAQ,GAClBG,EAAQF,EAAE,MAAQ,GACxB,OAAOC,EAAM,cAAcC,CAAK,CAClC,CAAA,EAIEC,EAAgB,MAAOC,GAAqC,CAChE,MAAMC,EAAU,EAAED,EAAS,SAAW,IAChCE,EAAmB,CAAE,GAAGF,EAAU,QAAAC,CAAA,EACxC,GAAI,CACF,MAAMxB,EAAY,UAAU,OAC1B,CAAE,GAAIuB,EAAS,EAAA,EACfE,CAAA,EAGFjB,EACEiB,EAAiB,QAAUrB,EAAE,iBAAiB,EAAIA,EAAE,kBAAkB,EACtEsB,EAAa,OAAA,EAEfZ,EAAA,CACF,OAASa,EAAO,CACdlB,EAAS,sBAAuBkB,CAAK,CACvC,CACF,EAEM,CAACC,EAAoBC,CAAa,EAAIC,EAAiB,CAC3D,SAAU,wBACV,WAAY1B,EAAE,8BAA+B,CAC3C,iBAAkBW,EAAmBA,EAAkB,KAAO,EAAA,CAC/D,EACD,oBAAqB,SACrB,sBAAuBgB,EAAc,OACrC,UAAW,SAAY,CACrB,GAAI,CACF,MAAM/B,EAAY,UAAU,QAAQ,CAAE,GAAIe,EAAkB,GAAK,EACjEC,EAAoB,MAAS,EAC7BR,EAASJ,EAAE,wBAAwB,EAAGsB,EAAa,OAAO,EAC1DZ,EAAA,CACF,OAASa,EAAO,CACdlB,EAAS,sBAAuBkB,CAAK,CACvC,CACF,CAAA,CACD,EAED,OACEK,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CACC,SAAS,iBACT,OAAO,mBACP,QAASC,EAAS,YAAA,CAAA,EAEpBJ,EAACK,GAAY,QAAQ,QAAQ,QAAS,CAAE,QAAS,aAC/C,SAAA,CAAAH,EAACL,EAAA,EAAc,EACfK,EAACI,EAAA,CAEC,YACEJ,EAACK,EAAA,CACC,cAAY,kBACZ,UAAYC,GACVN,EAACO,EAAA,CACE,GAAGD,EACJ,GAAIE,EAAiB,CAAE,MAAAxC,EAAO,KAAM,SAAU,GAAI,MAAO,CAAA,CAAA,EAI5D,WAAE,gBAAgB,CAAA,CAAA,EAGvB,QAAS,CACP,CACE,KAAM,OACN,WAAY,OACZ,aAAeyC,GACbT,EAACO,EAAA,CACC,GAAIC,EAAiB,CAAE,MAAAxC,EAAO,KAAM,SAAU,GAAIyC,EAAI,GAAK,EAE1D,SAAAA,EAAI,IAAA,CAAA,CACP,EAGJ,CACE,KAAM,KACN,WAAY,IAAA,EAEd,CACE,KAAM,SACN,WAAY,SACZ,aAAepB,GACbW,EAACU,EAAA,CACC,MAAOxC,EAAE,SAAS,EAClB,SAAUA,EAAE,UAAU,EACtB,UAAWmB,EAAS,SAAW,GAC/B,SAAU,IAAMD,EAAcC,CAAQ,CAAA,CAAA,CACxC,CAEJ,EAEF,QAAS,CACP,CACE,MAAOnB,EAAE,QAAQ,EACjB,WAAamB,GAAa,CACxBP,EAAoBO,CAAQ,EAC5BK,EAAA,CACF,CAAA,EAEF,CACE,MAAOxB,EAAE,MAAM,EACf,WAAamB,GAAa,CACxBP,EAAoBO,CAAQ,EAC5BjB,EACEoC,EAAiB,CAAE,MAAAxC,EAAO,KAAM,OAAQ,GAAIqB,EAAS,GAAK,CAAA,CAE9D,CAAA,CACF,EAEF,OAAAN,EACA,aAAa,YACb,WACEiB,EAACW,EAAA,CACC,QAASzC,EAAE,gBAAgB,EAC3B,aAAcA,EAAE,4BAA4B,EAC5C,kBAAmBA,EAAE,gBAAgB,EACrC,gBAAiB,IACfE,EAASoC,EAAiB,CAAE,MAAAxC,EAAO,KAAM,SAAU,GAAI,MAAO,CAAC,CAAA,CAAA,CAEnE,EAvEGS,CAAA,CAyEP,CAAA,CACF,CAAA,EACF,CAEJ"}