{"version":3,"file":"DraggableTable-CH2dxmAN.js","sources":["../../../../../../../src/authentication/components/DraggableTable.tsx"],"sourcesContent":["import styles from \"@patternfly/react-styles/css/components/DataList/data-list\";\r\nimport {\r\n  ActionsColumn,\r\n  IAction,\r\n  Table,\r\n  Tbody,\r\n  Td,\r\n  Th,\r\n  Thead,\r\n  Tr,\r\n  type TableProps,\r\n  ThProps,\r\n} from \"@patternfly/react-table\";\r\nimport type { ThInfoType } from \"@patternfly/react-table/dist/esm/components/Table/base/types\";\r\nimport { get } from \"lodash-es\";\r\nimport {\r\n  DragEvent as ReactDragEvent,\r\n  ReactNode,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport type Field<T> = Pick<ThProps, \"width\"> & {\r\n  name: string;\r\n  displayKey?: string;\r\n  cellRenderer?: (row: T) => ReactNode;\r\n  thTooltipText?: string;\r\n};\r\n\r\nexport type Action<T> = IAction & { isActionable?: (item: T) => boolean };\r\n\r\ntype DraggableTableProps<T> = Omit<TableProps, \"data\" | \"ref\"> & {\r\n  keyField: string;\r\n  columns: Field<T>[];\r\n  data: T[];\r\n  actions?: Action<T>[];\r\n  onDragFinish: (dragged: string, newOrder: string[]) => void;\r\n};\r\n\r\nexport function DraggableTable<T>({\r\n  keyField,\r\n  columns,\r\n  data,\r\n  actions,\r\n  onDragFinish,\r\n  ...props\r\n}: DraggableTableProps<T>) {\r\n  const { t } = useTranslation();\r\n  const bodyRef = useRef<HTMLTableSectionElement>(null);\r\n\r\n  const [state, setState] = useState({\r\n    draggedItemId: \"\",\r\n    draggingToItemIndex: -1,\r\n    dragging: false,\r\n    tempItemOrder: [\"\"],\r\n  });\r\n\r\n  const itemOrder: string[] = useMemo(\r\n    () => data.map((d) => get(d, keyField)),\r\n    [data],\r\n  );\r\n\r\n  const onDragStart = (evt: ReactDragEvent) => {\r\n    evt.dataTransfer.effectAllowed = \"move\";\r\n    evt.dataTransfer.setData(\"text/plain\", evt.currentTarget.id);\r\n    const draggedItemId = evt.currentTarget.id;\r\n\r\n    evt.currentTarget.classList.add(styles.modifiers.ghostRow);\r\n    evt.currentTarget.setAttribute(\"aria-grabbed\", \"true\");\r\n    setState({ ...state, draggedItemId, dragging: true });\r\n  };\r\n\r\n  const moveItem = (arr: string[], i1: string, toIndex: number) => {\r\n    const fromIndex = arr.indexOf(i1);\r\n    if (fromIndex === toIndex) {\r\n      return arr;\r\n    }\r\n    const temp = arr.splice(fromIndex, 1);\r\n    arr.splice(toIndex, 0, temp[0]);\r\n\r\n    return arr;\r\n  };\r\n\r\n  const move = (itemOrder: string[]) => {\r\n    if (!bodyRef.current) return;\r\n    const ulNode = bodyRef.current;\r\n    const nodes = Array.from(ulNode.children);\r\n    if (nodes.map((node) => node.id).every((id, i) => id === itemOrder[i])) {\r\n      return;\r\n    }\r\n    while (ulNode.firstChild) {\r\n      ulNode.removeChild(ulNode.lastChild!);\r\n    }\r\n\r\n    itemOrder.forEach((id) => {\r\n      ulNode.appendChild(nodes.find((n) => n.id === id)!);\r\n    });\r\n  };\r\n\r\n  const onDragCancel = () => {\r\n    Array.from(bodyRef.current?.children || []).forEach((el) => {\r\n      el.classList.remove(styles.modifiers.ghostRow);\r\n      el.setAttribute(\"aria-grabbed\", \"false\");\r\n    });\r\n    setState({\r\n      ...state,\r\n      draggedItemId: \"\",\r\n      draggingToItemIndex: -1,\r\n      dragging: false,\r\n    });\r\n  };\r\n\r\n  const onDragLeave = (evt: ReactDragEvent) => {\r\n    if (!isValidDrop(evt)) {\r\n      move(itemOrder);\r\n      setState({ ...state, draggingToItemIndex: -1 });\r\n    }\r\n  };\r\n\r\n  const isValidDrop = (evt: ReactDragEvent) => {\r\n    const ulRect = bodyRef.current!.getBoundingClientRect();\r\n    return (\r\n      evt.clientX > ulRect.x &&\r\n      evt.clientX < ulRect.x + ulRect.width &&\r\n      evt.clientY > ulRect.y &&\r\n      evt.clientY < ulRect.y + ulRect.height\r\n    );\r\n  };\r\n\r\n  const onDrop = (evt: ReactDragEvent) => {\r\n    if (isValidDrop(evt)) {\r\n      onDragFinish(state.draggedItemId, state.tempItemOrder);\r\n    } else {\r\n      onDragCancel();\r\n    }\r\n  };\r\n\r\n  const onDragOver = (evt: ReactDragEvent) => {\r\n    evt.preventDefault();\r\n\r\n    const td = evt.target as HTMLTableCellElement;\r\n    const curListItem = td.closest(\"tr\");\r\n    if (\r\n      !curListItem ||\r\n      (bodyRef.current && !bodyRef.current.contains(curListItem)) ||\r\n      curListItem.id === state.draggedItemId\r\n    ) {\r\n      return null;\r\n    } else {\r\n      const dragId = curListItem.id;\r\n      const draggingToItemIndex = Array.from(\r\n        bodyRef.current?.children || [],\r\n      ).findIndex((item) => item.id === dragId);\r\n      if (draggingToItemIndex !== state.draggingToItemIndex) {\r\n        const tempItemOrder = moveItem(\r\n          itemOrder,\r\n          state.draggedItemId,\r\n          draggingToItemIndex,\r\n        );\r\n        move(tempItemOrder);\r\n\r\n        setState({\r\n          ...state,\r\n          draggingToItemIndex,\r\n          tempItemOrder,\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const onDragEnd = (evt: ReactDragEvent) => {\r\n    const tr = evt.target as HTMLTableRowElement;\r\n    tr.classList.remove(styles.modifiers.ghostRow);\r\n    tr.setAttribute(\"aria-grabbed\", \"false\");\r\n    setState({\r\n      ...state,\r\n      draggedItemId: \"\",\r\n      draggingToItemIndex: -1,\r\n      dragging: false,\r\n    });\r\n  };\r\n\r\n  const thInfo = (column: Field<T>): ThInfoType | undefined => {\r\n    if (!column.thTooltipText) return undefined;\r\n    return {\r\n      popover: <div>{t(column.thTooltipText)}</div>,\r\n      ariaLabel: t(column.thTooltipText),\r\n    };\r\n  };\r\n\r\n  return (\r\n    <Table\r\n      aria-label=\"Draggable table\"\r\n      className={state.dragging ? styles.modifiers.dragOver : \"\"}\r\n      {...props}\r\n    >\r\n      <Thead>\r\n        <Tr>\r\n          <Th aria-hidden=\"true\" />\r\n          {columns.map((column) => (\r\n            <Th\r\n              key={column.name}\r\n              info={thInfo(column)}\r\n              width={column.width}\r\n              modifier=\"fitContent\"\r\n            >\r\n              {t(column.displayKey || column.name)}\r\n            </Th>\r\n          ))}\r\n        </Tr>\r\n      </Thead>\r\n      <Tbody\r\n        ref={bodyRef}\r\n        onDragOver={onDragOver}\r\n        onDrop={onDragOver}\r\n        onDragLeave={onDragLeave}\r\n      >\r\n        {data.map((row) => (\r\n          <Tr\r\n            key={get(row, keyField)}\r\n            id={get(row, keyField)}\r\n            draggable\r\n            onDrop={onDrop}\r\n            onDragEnd={onDragEnd}\r\n            onDragStart={onDragStart}\r\n          >\r\n            <Td\r\n              draggableRow={{\r\n                id: `draggable-row-${get(row, keyField)}`,\r\n              }}\r\n            />\r\n            {columns.map((column) => (\r\n              <Td\r\n                key={`${get(row, keyField)}_${column.name}`}\r\n                dataLabel={column.name}\r\n              >\r\n                {column.cellRenderer\r\n                  ? column.cellRenderer(row)\r\n                  : get(row, column.name)}\r\n              </Td>\r\n            ))}\r\n            {actions && (\r\n              <Td isActionCell>\r\n                <ActionsColumn\r\n                  items={actions.map(({ isActionable, ...action }) =>\r\n                    isActionable\r\n                      ? { ...action, isDisabled: !isActionable(row) }\r\n                      : action,\r\n                  )}\r\n                  rowData={row!}\r\n                />\r\n              </Td>\r\n            )}\r\n          </Tr>\r\n        ))}\r\n      </Tbody>\r\n    </Table>\r\n  );\r\n}\r\n"],"names":["DraggableTable","keyField","columns","data","actions","onDragFinish","props","t","useTranslation","bodyRef","useRef","state","setState","useState","itemOrder","useMemo","d","get","onDragStart","evt","draggedItemId","styles","moveItem","arr","i1","toIndex","fromIndex","temp","move","ulNode","nodes","node","id","i","n","onDragCancel","el","onDragLeave","isValidDrop","ulRect","onDrop","onDragOver","curListItem","dragId","draggingToItemIndex","item","tempItemOrder","onDragEnd","tr","thInfo","column","jsx","jsxs","Table","Thead","Tr","Th","Tbody","row","Td","ActionsColumn","isActionable","action"],"mappings":"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"}