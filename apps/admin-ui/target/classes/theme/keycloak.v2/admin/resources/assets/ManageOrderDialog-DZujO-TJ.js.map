{"version":3,"file":"ManageOrderDialog-DZujO-TJ.js","sources":["../../../../../../../src/identity-providers/ManageOrderDialog.tsx"],"sourcesContent":["import type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\r\nimport {\r\n  KeycloakSpinner,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  ButtonVariant,\r\n  DataList,\r\n  DataListCell,\r\n  DataListControl,\r\n  DataListDragButton,\r\n  DataListItem,\r\n  DataListItemCells,\r\n  DataListItemRow,\r\n  DragDrop,\r\n  Draggable,\r\n  DraggableItemPosition,\r\n  Droppable,\r\n  Modal,\r\n  ModalVariant,\r\n  Text,\r\n  TextContent,\r\n} from \"@patternfly/react-core\";\r\nimport { sortBy } from \"lodash-es\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../admin-client\";\r\n\r\ntype ManageOrderDialogProps = {\r\n  orgId?: string;\r\n  hideRealmBasedIdps?: boolean;\r\n  onClose: () => void;\r\n};\r\n\r\nexport const ManageOrderDialog = ({\r\n  orgId,\r\n  hideRealmBasedIdps = false,\r\n  onClose,\r\n}: ManageOrderDialogProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { addAlert, addError } = useAlerts();\r\n\r\n  const [liveText, setLiveText] = useState(\"\");\r\n  const [providers, setProviders] =\r\n    useState<IdentityProviderRepresentation[]>();\r\n  const [order, setOrder] = useState<string[]>([]);\r\n\r\n  const onDragStart = ({ index }: DraggableItemPosition) => {\r\n    setLiveText(t(\"onDragStart\", { item: order[index] }));\r\n    return true;\r\n  };\r\n\r\n  const onDragMove = ({ index }: DraggableItemPosition) => {\r\n    setLiveText(t(\"onDragMove\", { item: order[index] }));\r\n  };\r\n\r\n  const onDragFinish = (\r\n    source: DraggableItemPosition,\r\n    dest?: DraggableItemPosition,\r\n  ) => {\r\n    if (dest) {\r\n      const result = [...order];\r\n      const [removed] = result.splice(source.index, 1);\r\n      result.splice(dest.index, 0, removed);\r\n      setLiveText(t(\"onDragFinish\", { list: result }));\r\n      setOrder(result);\r\n      return true;\r\n    } else {\r\n      setLiveText(t(\"onDragCancel\"));\r\n      return false;\r\n    }\r\n  };\r\n\r\n  useFetch(\r\n    () =>\r\n      orgId\r\n        ? adminClient.organizations.listIdentityProviders({ orgId })\r\n        : adminClient.identityProviders.find({ realmOnly: hideRealmBasedIdps }),\r\n    (providers) => {\r\n      setProviders(providers);\r\n      setOrder(\r\n        sortBy(providers, [\"config.guiOrder\", \"alias\"]).map(\r\n          (provider) => provider.alias!,\r\n        ),\r\n      );\r\n    },\r\n    [],\r\n  );\r\n\r\n  if (!providers) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      variant={ModalVariant.small}\r\n      title={t(\"manageDisplayOrder\")}\r\n      isOpen\r\n      onClose={onClose}\r\n      actions={[\r\n        <Button\r\n          id=\"modal-confirm\"\r\n          data-testid=\"confirm\"\r\n          key=\"confirm\"\r\n          onClick={async () => {\r\n            const updates = order.map((alias, index) => {\r\n              const provider = providers.find((p) => p.alias === alias)!;\r\n              provider.config!.guiOrder = index;\r\n              return adminClient.identityProviders.update({ alias }, provider);\r\n            });\r\n\r\n            try {\r\n              await Promise.all(updates);\r\n              addAlert(t(\"orderChangeSuccess\"));\r\n            } catch (error) {\r\n              addError(\"orderChangeError\", error);\r\n            }\r\n\r\n            onClose();\r\n          }}\r\n        >\r\n          {t(\"save\")}\r\n        </Button>,\r\n        <Button\r\n          id=\"modal-cancel\"\r\n          data-testid=\"cancel\"\r\n          key=\"cancel\"\r\n          variant={ButtonVariant.link}\r\n          onClick={onClose}\r\n        >\r\n          {t(\"cancel\")}\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <TextContent className=\"pf-v5-u-pb-lg\">\r\n        <Text>{t(\"orderDialogIntro\")}</Text>\r\n      </TextContent>\r\n\r\n      <DragDrop\r\n        onDrag={onDragStart}\r\n        onDragMove={onDragMove}\r\n        onDrop={onDragFinish}\r\n      >\r\n        <Droppable hasNoWrapper>\r\n          <DataList\r\n            aria-label={t(\"manageOrderTableAria\")}\r\n            data-testid=\"manageOrderDataList\"\r\n            isCompact\r\n          >\r\n            {order.map((alias) => (\r\n              <Draggable hasNoWrapper key={alias}>\r\n                <DataListItem aria-label={alias} id={alias}>\r\n                  <DataListItemRow>\r\n                    <DataListControl>\r\n                      <DataListDragButton aria-label={t(\"dragHelp\")} />\r\n                    </DataListControl>\r\n                    <DataListItemCells\r\n                      dataListCells={[\r\n                        <DataListCell key={alias} data-testid={alias}>\r\n                          {alias}\r\n                        </DataListCell>,\r\n                      ]}\r\n                    />\r\n                  </DataListItemRow>\r\n                </DataListItem>\r\n              </Draggable>\r\n            ))}\r\n          </DataList>\r\n        </Droppable>\r\n      </DragDrop>\r\n      <div className=\"pf-v5-screen-reader\" aria-live=\"assertive\">\r\n        {liveText}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n"],"names":["ManageOrderDialog","orgId","hideRealmBasedIdps","onClose","adminClient","useAdminClient","t","useTranslation","addAlert","addError","useAlerts","liveText","setLiveText","useState","providers","setProviders","order","setOrder","onDragStart","index","onDragMove","onDragFinish","source","dest","result","removed","useFetch","sortBy","provider","jsxs","Modal","ModalVariant","jsx","Button","updates","alias","p","error","ButtonVariant","TextContent","Text","DragDrop","Droppable","DataList","Draggable","DataListItem","DataListItemRow","DataListControl","DataListDragButton","DataListItemCells","DataListCell","KeycloakSpinner"],"mappings":"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"}