import{jsx as e,jsxs as y,Fragment as de}from"react/jsx-runtime";import{u as $,b as O,d as j,a as z,am as ue,P as G,x as pe,aY as C,c5 as be,v as he,g as R,E as fe,an as Re,j as ye,_ as ve,aS as ge,N as V,y as M,a$ as L,c6 as we,c7 as Ce,B as Te,o as F,p as ke,D as Ie,l as Ae,bc as U,c8 as W,ao as Ne,c9 as Fe,bC as De,ca as Ee,bX as Pe}from"./main-o1hptXRo.js";import{useState as D}from"react";import{u as Se}from"./ConfirmDialog-BkU7melV.js";import{A as xe}from"./AttributeForm-DTyI1Rh5.js";import{P as Be}from"./PermissionTab-CNBT0MGG.js";import{R as Ke}from"./RoleForm-CeKzSlwp.js";import{R as Ve}from"./RoleMapping-BOcI-Nkp.js";import{u as p,R as Me}from"./RoutableTabs-DyhWhd6v.js";import{V as Le}from"./ViewHeader-BDBsroi3.js";import{A as Ue}from"./AdminEvents-DIrkh5pf.js";import{u as Q}from"./useParams-CGVhlaFZ.js";import{Q as We}from"./question-circle-icon-C0dl_LB7.js";import{a as b,b as h}from"./Tabs-DSwQhKoJ.js";import"react-dom";import"./FormAccess-BnhQnYb9.js";import"./KeyValueInput-BOsiIUR1.js";import"./ActionListItem-Cy-NQlq4.js";import"./useLocaleSort-C-diWts5.js";import"./Trans-CicUNvCL.js";import"./translationFormatter-DQJeO7lr.js";import"./PageHandler-B1ed5nYb.js";import"./DynamicComponents-CnLlz98z.js";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./MultiLineInput-OP0faqms.js";import"./CodeEditor-C4IS5oxi.js";import"./constants-BclHbWtx.js";import"./DropdownPanel-vRJu3PnV.js";import"./useFormatDate-CuGjRZ4j.js";import"./DatePicker-DiXxo4Fo.js";import"./pickBy-JGveacY0.js";import"./DescriptionListTerm-CNzJUZBE.js";const $e=()=>{const{adminClient:i}=$(),m=O(),{realm:a}=j(),{t:s}=z(),{id:v,clientId:T}=Q(),k=async(o,l)=>{const n=await i.roles.findOneById({id:v});if(!n)throw new Error(s("notFound"));return n.clientRole?i.clients.findUsersWithRole({roleName:n.name,id:T,briefRepresentation:!0,first:o,max:l}):i.roles.findUsersWithRole({name:n.name,briefRepresentation:!0,first:o,max:l})},{enabled:g}=ue();return e(G,{"data-testid":"users-page",variant:"light",children:e(pe,{isPaginated:!0,loader:k,ariaLabelKey:"roleList",searchPlaceholderKey:"","data-testid":"users-in-role-table",toolbarItem:g&&e(fe,{"aria-label":"Basic popover",position:"bottom",bodyContent:y("div",{children:[s("whoWillAppearPopoverTextRoles"),e(R,{className:"kc-groups-link",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),y(R,{className:"kc-users-link",variant:"link",onClick:()=>m(`/${a}/users`),children:[s("users"),"."]})]}),footerContent:s("whoWillAppearPopoverFooterText"),children:e(R,{variant:"link",className:"kc-who-will-appear-button",icon:e(We,{}),children:s("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(he,{hasIcon:!0,message:s("noDirectUsers"),instructions:y("div",{children:[s("noUsersEmptyStateDescription"),e(R,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),e(R,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>m(`/${a}/users`),children:s("users")}),s("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[C()]},{name:"email",displayKey:"email",cellFormatters:[C()]},{name:"lastName",displayKey:"lastName",cellFormatters:[C()]},{name:"firstName",displayKey:"firstName",cellFormatters:[be(),C()]}]})})};function Tt(){const{adminClient:i}=$(),m=Re(),{t:a}=z(),s=ye({mode:"onChange"}),{control:v,reset:T,setValue:k}=s,g=O(),{id:o,clientId:l}=Q(),{realm:n,realmRepresentation:w}=j(),[E,_]=D(0),[q,P]=D(),H=()=>_(E+1),{addAlert:I,addError:A}=ve(),{hasAccess:S}=ge(),X=S("query-clients","manage-authorization"),[Y,J]=D(!1),Z=t=>{const{attributes:r,...N}=t;return{attributes:Fe(r),...N}},d=V({control:v,defaultValue:void 0,name:"name"}),ee=V({control:v,defaultValue:!1,name:"composite"});M(async()=>i.roles.findOneById({id:o}),t=>{if(!t)throw new Error(a("notFound"));const r=Z(t);T(r),P(r.attributes)},[E]),M(async()=>i.clients.findOne({id:l}),t=>{l&&J(t?.access?.manage)},[]);const x=async t=>{try{const{attributes:r,...N}=t,f=N;f.name=f.name?.trim(),f.attributes=De(r),l?await i.clients.updateRole({id:l,roleName:t.name},f):await i.roles.updateById({id:o},f),P(r),I(a("roleSaveSuccess"),F.success)}catch(r){A("roleSaveError",r)}},B=L(we.path),u=L(Ce.path),te=()=>{if(B)return W({realm:n});if(u)return U({realm:n,clientId:u.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},c=t=>{if(B)return Ee({realm:n,id:o,tab:t});if(u)return Pe({realm:n,id:o,clientId:u.params.clientId,tab:t});throw new Error("Route could not be determined.")},ae=p(c("details")),se=p(c("associated-roles")),re=p(c("attributes")),oe=p(c("users-in-role")),ie=p(c("permissions")),ne=p(c("events")),[le,ce]=Se({titleKey:"roleDeleteConfirm",messageKey:a("roleDeleteConfirmDialog",{selectedRoleName:d||a("createRole")}),continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{l?await i.clients.delRole({id:l,roleName:d}):await i.roles.delById({id:o}),I(a("roleDeletedSuccess"),F.success),g(te())}catch(t){A("roleDeleteError",t)}}}),me=async t=>{try{await i.roles.createComposite({roleId:o,realm:w.realm},t),H(),g(c("associated-roles")),I(a("addAssociatedRolesSuccess"),F.success)}catch(r){A("addAssociatedRolesError",r)}},K=t=>w?.defaultRole&&w.defaultRole.name===t;return w?y(de,{children:[e(ce,{}),e(Le,{titleKey:d,badges:[{id:"composite-role-badge",text:ee?a("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:[e(Ie,{component:"button",onClick:()=>{le()},children:a("deleteRole")},"delete-role")],divider:!1}),e(G,{variant:"light",className:"pf-v5-u-p-0",children:e(Ae,{...s,children:y(Me,{isBox:!0,mountOnEnter:!0,defaultLocation:c("details"),children:[e(b,{title:e(h,{children:a("details")}),...ae,children:e(Ke,{form:s,onSubmit:x,role:u?"manage-clients":"manage-realm",cancelLink:u?U({realm:n,clientId:l,tab:"roles"}):W({realm:n}),editMode:!0})}),e(b,{"data-testid":"associatedRolesTab",title:e(h,{children:a("associatedRolesText")}),...se,children:e(Ve,{name:d,id:o,type:"roles",isManager:!0,save:t=>me(t.map(r=>r.role))})}),!K(d)&&e(b,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(h,{children:a("attributes")}),...re,children:e(xe,{form:s,save:x,fineGrainedAccess:Y,reset:()=>k("attributes",q,{shouldDirty:!1})})}),!K(d)&&e(b,{"data-testid":"usersInRoleTab",title:e(h,{children:a("usersInRole")}),...oe,children:e($e,{"data-cy":"users-in-role-tab"})}),m(Ne.AdminFineGrainedAuthz)&&X&&e(b,{title:e(h,{children:a("permissions")}),...ie,children:e(Be,{id:o,type:"roles"})}),S("view-events")&&e(b,{"data-testid":"admin-events-tab",title:e(h,{children:a("adminEvents")}),...ne,children:e(Ue,{resourcePath:`roles-by-id/${o}`})})]})})})]}):e(ke,{})}export{Tt as default};
//# sourceMappingURL=RealmRoleTabs-D61llsy-.js.map
