{"version":3,"file":"PermissionConfigurationDetails-u0qyxpbK.js","sources":["../../../../../../../src/permissions-configuration/permission-configuration/NewPermissionPolicyDialog.tsx","../../../../../../../src/permissions-configuration/permission-configuration/ExistingPoliciesDialog.tsx","../../../../../../../src/permissions-configuration/permission-configuration/AssignedPolicies.tsx","../../../../../../../src/permissions-configuration/permission-configuration/PermissionConfigurationDetails.tsx"],"sourcesContent":["import PolicyRepresentation, {\r\n  DecisionStrategy,\r\n  Logic,\r\n} from \"@keycloak/keycloak-admin-client/lib/defs/policyRepresentation\";\r\nimport PolicyProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyProviderRepresentation\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport {\r\n  Modal,\r\n  ModalVariant,\r\n  TextContent,\r\n  Text,\r\n  TextVariants,\r\n  ActionGroup,\r\n  Button,\r\n  Form,\r\n  ButtonVariant,\r\n  AlertVariant,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  SelectControl,\r\n  TextControl,\r\n  useAlerts,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { FormProvider, useForm, useWatch } from \"react-hook-form\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport { Client } from \"../../clients/authorization/policy/Client\";\r\nimport { User } from \"../../clients/authorization/policy/User\";\r\nimport {\r\n  ClientScope,\r\n  RequiredIdValue,\r\n} from \"../../clients/authorization/policy/ClientScope\";\r\nimport { Group, GroupValue } from \"../../clients/authorization/policy/Group\";\r\nimport { Regex } from \"../../clients/authorization/policy/Regex\";\r\nimport { Role } from \"../../clients/authorization/policy/Role\";\r\nimport { Time } from \"../../clients/authorization/policy/Time\";\r\nimport { JavaScript } from \"../../clients/authorization/policy/JavaScript\";\r\nimport { LogicSelector } from \"../../clients/authorization/policy/LogicSelector\";\r\nimport { Aggregate } from \"../../clients/authorization/policy/Aggregate\";\r\nimport { capitalize } from \"lodash-es\";\r\nimport { useEffect, type JSX } from \"react\";\r\n\r\ntype Policy = Omit<PolicyRepresentation, \"roles\"> & {\r\n  groups?: GroupValue[];\r\n  clientScopes?: RequiredIdValue[];\r\n  roles?: RequiredIdValue[];\r\n  clients?: [];\r\n};\r\n\r\ntype ComponentsProps = {\r\n  isPermissionClient?: boolean;\r\n  permissionClientId: string;\r\n};\r\n\r\nconst defaultValues: Policy = {\r\n  name: \"\",\r\n  description: \"\",\r\n  type: \"group\",\r\n  policies: [],\r\n  decisionStrategy: DecisionStrategy.UNANIMOUS,\r\n  logic: Logic.POSITIVE,\r\n};\r\n\r\nconst COMPONENTS: {\r\n  [index: string]: ({\r\n    isPermissionClient,\r\n    permissionClientId,\r\n  }: ComponentsProps) => JSX.Element;\r\n} = {\r\n  aggregate: Aggregate,\r\n  client: Client,\r\n  user: User,\r\n  \"client-scope\": ClientScope,\r\n  group: Group,\r\n  regex: Regex,\r\n  role: Role,\r\n  time: Time,\r\n  js: JavaScript,\r\n  default: Group,\r\n} as const;\r\n\r\nexport const isValidComponentType = (value: string) => value in COMPONENTS;\r\n\r\ntype NewPermissionConfigurationDialogProps = {\r\n  permissionClientId: string;\r\n  providers: PolicyProviderRepresentation[];\r\n  policies: PolicyRepresentation[];\r\n  resourceType: string;\r\n  toggleDialog: () => void;\r\n  onAssign: (newPolicy: PolicyRepresentation) => void;\r\n};\r\n\r\nexport const NewPermissionPolicyDialog = ({\r\n  permissionClientId,\r\n  providers,\r\n  policies,\r\n  toggleDialog,\r\n  onAssign,\r\n}: NewPermissionConfigurationDialogProps) => {\r\n  const { adminClient } = useAdminClient();\r\n  const { realmRepresentation } = useRealm();\r\n  const { t } = useTranslation();\r\n  const form = useForm<Policy>({\r\n    mode: \"onChange\",\r\n    defaultValues,\r\n  });\r\n  const { addAlert, addError } = useAlerts();\r\n  const { handleSubmit, reset } = form;\r\n  const isPermissionClient = realmRepresentation?.adminPermissionsEnabled;\r\n\r\n  const policyTypeSelector = useWatch({\r\n    control: form.control,\r\n    name: \"type\",\r\n  });\r\n\r\n  function getComponentType() {\r\n    if (policyTypeSelector && isValidComponentType(policyTypeSelector)) {\r\n      return COMPONENTS[policyTypeSelector];\r\n    }\r\n    return COMPONENTS[\"default\"];\r\n  }\r\n\r\n  const ComponentType = getComponentType();\r\n\r\n  useEffect(() => {\r\n    if (policyTypeSelector) {\r\n      const { name, description, decisionStrategy, logic } = form.getValues();\r\n\r\n      reset({\r\n        type: policyTypeSelector,\r\n        name,\r\n        description,\r\n        decisionStrategy,\r\n        logic,\r\n      });\r\n    }\r\n  }, [policyTypeSelector, reset, form]);\r\n\r\n  const save = async (policy: Policy) => {\r\n    const { groups, roles, policies, clients, ...rest } = policy;\r\n\r\n    const cleanedPolicy = {\r\n      ...rest,\r\n      ...(groups && groups.length > 0 && { groups }),\r\n      ...(roles && roles.length > 0 && { roles }),\r\n      ...(policies && policies.length > 0 && { policies }),\r\n      ...(clients && clients.length > 0 && { clients }),\r\n      ...(rest.type === \"group\" &&\r\n        (!groups || groups.length === 0) && { groups: [] }),\r\n      ...(rest.type === \"client\" &&\r\n        (!clients || clients.length === 0) && { clients: [] }),\r\n    };\r\n\r\n    try {\r\n      const createdPolicy = await adminClient.clients.createPolicy(\r\n        { id: permissionClientId, type: policyTypeSelector! },\r\n        cleanedPolicy,\r\n      );\r\n\r\n      onAssign(createdPolicy);\r\n      toggleDialog();\r\n      addAlert(t(\"createPolicySuccess\"), AlertVariant.success);\r\n    } catch (error) {\r\n      addError(\"policySaveError\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      aria-label={t(\"createPermissionPolicy\")}\r\n      variant={ModalVariant.medium}\r\n      header={\r\n        <TextContent>\r\n          <Text component={TextVariants.h1}>{t(\"createPermissionPolicy\")}</Text>\r\n        </TextContent>\r\n      }\r\n      isOpen\r\n      onClose={toggleDialog}\r\n    >\r\n      <Form\r\n        id=\"createPermissionPolicy-form\"\r\n        onSubmit={async (e) => {\r\n          e.stopPropagation();\r\n          await handleSubmit(save)(e);\r\n        }}\r\n        isHorizontal\r\n      >\r\n        <FormProvider {...form}>\r\n          <TextControl\r\n            name=\"name\"\r\n            label={t(\"name\")}\r\n            rules={{ required: t(\"required\") }}\r\n          />\r\n          <TextControl name=\"description\" label={t(\"description\")} />\r\n          {providers && providers.length > 0 && (\r\n            <SelectControl\r\n              name=\"type\"\r\n              label={t(\"policyType\")}\r\n              labelIcon={t(\"policyTypeHelpText\")}\r\n              options={providers.map((provider) => ({\r\n                key: provider.type!,\r\n                value: capitalize(provider.type!),\r\n              }))}\r\n              controller={{ defaultValue: \"\" }}\r\n            />\r\n          )}\r\n          <ComponentType\r\n            isPermissionClient={isPermissionClient}\r\n            permissionClientId={permissionClientId}\r\n          />\r\n          <LogicSelector />\r\n        </FormProvider>\r\n        <ActionGroup>\r\n          <div className=\"pf-v5-u-mt-md\">\r\n            <Button\r\n              variant={ButtonVariant.primary}\r\n              className=\"pf-v5-u-mr-md\"\r\n              type=\"submit\"\r\n              data-testid=\"save\"\r\n              isDisabled={\r\n                policies?.length === 0 && policyTypeSelector === \"aggregate\"\r\n              }\r\n            >\r\n              {t(\"save\")}\r\n            </Button>\r\n            <Button variant=\"link\" data-testid=\"cancel\" onClick={toggleDialog}>\r\n              {t(\"cancel\")}\r\n            </Button>\r\n          </div>\r\n        </ActionGroup>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n","import PolicyRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyRepresentation\";\r\nimport { PolicyQuery } from \"@keycloak/keycloak-admin-client/lib/resources/clients\";\r\nimport {\r\n  KeycloakDataTable,\r\n  ListEmptyState,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  ButtonVariant,\r\n  Dropdown,\r\n  DropdownItem,\r\n  DropdownList,\r\n  MenuToggle,\r\n  Modal,\r\n  ModalVariant,\r\n} from \"@patternfly/react-core\";\r\nimport { CaretDownIcon, FilterIcon } from \"@patternfly/react-icons\";\r\nimport { sortBy } from \"lodash-es\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { capitalizeFirstLetterFormatter } from \"../../util\";\r\nimport useToggle from \"../../utils/useToggle\";\r\n\r\nexport type ExistingPoliciesDialogProps = {\r\n  toggleDialog: () => void;\r\n  onAssign: (policies: { policy: PolicyRepresentation }[]) => void;\r\n  open: boolean;\r\n  permissionClientId: string;\r\n};\r\n\r\nexport const ExistingPoliciesDialog = ({\r\n  toggleDialog,\r\n  onAssign,\r\n  open,\r\n  permissionClientId,\r\n}: ExistingPoliciesDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { adminClient } = useAdminClient();\r\n  const [rows, setRows] = useState<PolicyRepresentation[]>([]);\r\n  const [filterType, setFilterType] = useState<string | undefined>(undefined);\r\n  const [isFilterTypeDropdownOpen, toggleIsFilterTypeDropdownOpen] =\r\n    useToggle();\r\n  const [providers, setProviders] = useState<string[]>([]);\r\n\r\n  useFetch(\r\n    () =>\r\n      adminClient.clients.listPolicyProviders({\r\n        id: permissionClientId!,\r\n      }),\r\n    (providers) => {\r\n      const formattedProviders = providers\r\n        .filter((p) => p.type !== \"resource\" && p.type !== \"scope\")\r\n        .map((provider) => provider.name)\r\n        .filter((name) => name !== undefined);\r\n      setProviders(sortBy(formattedProviders));\r\n    },\r\n    [permissionClientId],\r\n  );\r\n\r\n  const loader = async (first?: number, max?: number, search?: string) => {\r\n    const params: PolicyQuery = {\r\n      id: permissionClientId!,\r\n      permission: \"false\",\r\n      first,\r\n      max,\r\n    };\r\n\r\n    if (search) {\r\n      params.name = search;\r\n    }\r\n\r\n    if (filterType) {\r\n      params.type = filterType;\r\n    }\r\n\r\n    return (await adminClient.clients.listPolicies(params)) || [];\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      variant={ModalVariant.medium}\r\n      title={t(\"assignExistingPolicies\")}\r\n      isOpen={open}\r\n      onClose={toggleDialog}\r\n      actions={[\r\n        <>\r\n          <Button\r\n            id=\"modal-assignExistingPolicies\"\r\n            data-testid=\"confirm\"\r\n            key=\"assign\"\r\n            variant={ButtonVariant.primary}\r\n            onClick={() => {\r\n              const selectedPolicies = rows.map((policy) => ({ policy }));\r\n              onAssign(selectedPolicies);\r\n              toggleDialog();\r\n            }}\r\n            isDisabled={rows.length === 0}\r\n          >\r\n            {t(\"assign\")}\r\n          </Button>\r\n          <Button\r\n            id=\"modal-cancelExistingPolicies\"\r\n            data-testid=\"cancel\"\r\n            key=\"cancel\"\r\n            variant={ButtonVariant.link}\r\n            onClick={() => {\r\n              setRows([]);\r\n              toggleDialog();\r\n            }}\r\n          >\r\n            {t(\"cancel\")}\r\n          </Button>\r\n        </>,\r\n      ]}\r\n    >\r\n      <KeycloakDataTable\r\n        key={filterType}\r\n        loader={loader}\r\n        ariaLabelKey={t(\"chooseAPolicyType\")}\r\n        searchPlaceholderKey={t(\"searchClientAuthorizationPolicy\")}\r\n        isSearching={true}\r\n        searchTypeComponent={\r\n          <Dropdown\r\n            onSelect={(_, value) => {\r\n              setFilterType(value as string | undefined);\r\n              toggleIsFilterTypeDropdownOpen();\r\n            }}\r\n            onOpenChange={toggleIsFilterTypeDropdownOpen}\r\n            toggle={(ref) => (\r\n              <MenuToggle\r\n                ref={ref}\r\n                data-testid=\"filter-type-dropdown-existingPolicies\"\r\n                id=\"toggle-id-10\"\r\n                onClick={toggleIsFilterTypeDropdownOpen}\r\n                icon={<FilterIcon />}\r\n                statusIcon={<CaretDownIcon />}\r\n              >\r\n                {filterType ? filterType : t(\"allTypes\")}\r\n              </MenuToggle>\r\n            )}\r\n            isOpen={isFilterTypeDropdownOpen}\r\n          >\r\n            <DropdownList>\r\n              <DropdownItem\r\n                data-testid=\"filter-type-dropdown-existingPolicies-all\"\r\n                key=\"all\"\r\n                onClick={() => setFilterType(undefined)}\r\n              >\r\n                {t(\"allTypes\")}\r\n              </DropdownItem>\r\n              {providers.map((name) => (\r\n                <DropdownItem\r\n                  data-testid={`filter-type-dropdown-existingPolicies-${name}`}\r\n                  key={name}\r\n                  onClick={() => setFilterType(name)}\r\n                >\r\n                  {name}\r\n                </DropdownItem>\r\n              ))}\r\n            </DropdownList>\r\n          </Dropdown>\r\n        }\r\n        canSelectAll\r\n        onSelect={(selectedRows) => setRows(selectedRows)}\r\n        columns={[\r\n          { name: \"name\" },\r\n          {\r\n            name: \"type\",\r\n            cellFormatters: [capitalizeFirstLetterFormatter()],\r\n          },\r\n          { name: \"description\" },\r\n        ]}\r\n        emptyState={\r\n          <ListEmptyState\r\n            message={t(\"emptyAssignExistingPolicies\")}\r\n            instructions={t(\"emptyAssignExistingPoliciesInstructions\")}\r\n          />\r\n        }\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n","import PolicyRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyRepresentation\";\r\nimport {\r\n  Action,\r\n  FormErrorText,\r\n  HelpItem,\r\n  KeycloakDataTable,\r\n  ListEmptyState,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  Dropdown,\r\n  DropdownItem,\r\n  DropdownList,\r\n  FormGroup,\r\n  MenuToggle,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { Controller, useFormContext } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { NewPermissionPolicyDialog } from \"./NewPermissionPolicyDialog\";\r\nimport PolicyProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyProviderRepresentation\";\r\nimport { ExistingPoliciesDialog } from \"./ExistingPoliciesDialog\";\r\nimport { CaretDownIcon, FilterIcon } from \"@patternfly/react-icons\";\r\nimport { capitalize, sortBy } from \"lodash-es\";\r\nimport useToggle from \"../../utils/useToggle\";\r\nimport { IRowData } from \"@patternfly/react-table\";\r\n\r\ntype AssignedPoliciesProps = {\r\n  permissionClientId: string;\r\n  providers: PolicyProviderRepresentation[];\r\n  policies: PolicyRepresentation[] | undefined;\r\n  resourceType: string;\r\n};\r\n\r\ntype AssignedPolicyForm = {\r\n  policies?: { id: string; type?: string }[];\r\n};\r\n\r\nexport const AssignedPolicies = ({\r\n  permissionClientId,\r\n  providers,\r\n  policies,\r\n  resourceType,\r\n}: AssignedPoliciesProps) => {\r\n  const { adminClient } = useAdminClient();\r\n  const { t } = useTranslation();\r\n  const {\r\n    control,\r\n    getValues,\r\n    setValue,\r\n    trigger,\r\n    formState: { errors },\r\n  } = useFormContext<AssignedPolicyForm>();\r\n  const values = getValues(\"policies\");\r\n  const [existingPoliciesOpen, setExistingPoliciesOpen] = useState(false);\r\n  const [newPolicyOpen, setNewPolicyOpen] = useState(false);\r\n  const [selectedPolicies, setSelectedPolicies] = useState<\r\n    PolicyRepresentation[]\r\n  >([]);\r\n  const [filterType, setFilterType] = useState<string | undefined>(undefined);\r\n  const [isFilterTypeDropdownOpen, toggleIsFilterTypeDropdownOpen] =\r\n    useToggle();\r\n\r\n  useFetch(\r\n    () => {\r\n      if (values && values.length > 0)\r\n        return Promise.all(\r\n          values.map((p) =>\r\n            adminClient.clients.findOnePolicyWithType({\r\n              id: permissionClientId,\r\n              type: p.type!,\r\n              policyId: p.id,\r\n            }),\r\n          ),\r\n        );\r\n      return Promise.resolve([]);\r\n    },\r\n    (policies) => {\r\n      const filteredPolicy = policies.filter((p) => p) as [];\r\n      setSelectedPolicies(filteredPolicy);\r\n    },\r\n    [policies],\r\n  );\r\n\r\n  const sortedProviders = sortBy(\r\n    providers\r\n      ? providers\r\n          .filter((p) => p.type !== \"resource\" && p.type !== \"scope\")\r\n          .map((provider) => provider.name)\r\n      : [],\r\n  );\r\n\r\n  const assign = async (policies: { policy: PolicyRepresentation }[]) => {\r\n    const assignedPolicies = policies.map(({ policy }) => ({\r\n      id: policy.id!,\r\n    }));\r\n\r\n    setValue(\"policies\", [\r\n      ...(getValues(\"policies\") || []),\r\n      ...assignedPolicies,\r\n    ]);\r\n    await trigger(\"policies\");\r\n    setSelectedPolicies([\r\n      ...selectedPolicies,\r\n      ...policies.map(({ policy }) => policy),\r\n    ]);\r\n  };\r\n\r\n  const unAssign = (policy: PolicyRepresentation) => {\r\n    const updatedPolicies = selectedPolicies.filter(\r\n      (selectedPolicy) => selectedPolicy.id !== policy.id,\r\n    );\r\n    setSelectedPolicies(updatedPolicies);\r\n    setValue(\r\n      \"policies\",\r\n      updatedPolicies.map((policy) => ({\r\n        id: policy.id!,\r\n        name: policy.name!,\r\n        type: policy.type!,\r\n        description: policy.description!,\r\n      })),\r\n    );\r\n  };\r\n\r\n  const filteredPolicies = filterType\r\n    ? selectedPolicies.filter(\r\n        (policy) => capitalize(policy.type) === filterType,\r\n      )\r\n    : selectedPolicies;\r\n\r\n  return (\r\n    <FormGroup\r\n      label={t(\"policies\")}\r\n      labelIcon={\r\n        <HelpItem\r\n          helpText={t(\"permissionPoliciesHelp\")}\r\n          fieldLabelId=\"policies\"\r\n        />\r\n      }\r\n      fieldId=\"policies\"\r\n      isRequired\r\n    >\r\n      <Controller\r\n        name=\"policies\"\r\n        control={control}\r\n        defaultValue={[]}\r\n        rules={{\r\n          validate: (value?: { id: string }[]) => {\r\n            if (!value || value.length === 0) return false;\r\n            return value.every(({ id }) => id && id.trim().length > 0);\r\n          },\r\n        }}\r\n        render={() => (\r\n          <>\r\n            {existingPoliciesOpen && (\r\n              <ExistingPoliciesDialog\r\n                permissionClientId={permissionClientId}\r\n                open={existingPoliciesOpen}\r\n                toggleDialog={() =>\r\n                  setExistingPoliciesOpen(!existingPoliciesOpen)\r\n                }\r\n                onAssign={assign}\r\n              />\r\n            )}\r\n            {newPolicyOpen && (\r\n              <NewPermissionPolicyDialog\r\n                toggleDialog={() => setNewPolicyOpen(!newPolicyOpen)}\r\n                permissionClientId={permissionClientId}\r\n                providers={providers!}\r\n                policies={policies!}\r\n                resourceType={resourceType}\r\n                onAssign={async (newPolicy) => {\r\n                  await assign([{ policy: newPolicy }]);\r\n                }}\r\n              />\r\n            )}\r\n            <Button\r\n              data-testid=\"select-assignedPolicy-button\"\r\n              variant=\"secondary\"\r\n              onClick={() => {\r\n                setExistingPoliciesOpen(true);\r\n              }}\r\n            >\r\n              {t(\"assignExistingPolicies\")}\r\n            </Button>\r\n            <Button\r\n              data-testid=\"select-createNewPolicy-button\"\r\n              className=\"pf-v5-u-ml-md\"\r\n              variant=\"secondary\"\r\n              onClick={() => {\r\n                setNewPolicyOpen(true);\r\n              }}\r\n            >\r\n              {t(\"createNewPolicy\")}\r\n            </Button>\r\n          </>\r\n        )}\r\n      />\r\n      {selectedPolicies.length > 0 && (\r\n        <KeycloakDataTable\r\n          loader={filteredPolicies}\r\n          ariaLabelKey={t(\"policies\")}\r\n          searchPlaceholderKey={t(\"searchClientAuthorizationPolicy\")}\r\n          isSearching={true}\r\n          searchTypeComponent={\r\n            <Dropdown\r\n              onSelect={(event, value) => {\r\n                setFilterType(value as string | undefined);\r\n                toggleIsFilterTypeDropdownOpen();\r\n              }}\r\n              onOpenChange={toggleIsFilterTypeDropdownOpen}\r\n              toggle={(ref) => (\r\n                <MenuToggle\r\n                  ref={ref}\r\n                  data-testid=\"filter-type-dropdown-existingPolicies\"\r\n                  id=\"toggle-id-10\"\r\n                  onClick={toggleIsFilterTypeDropdownOpen}\r\n                  icon={<FilterIcon />}\r\n                  statusIcon={<CaretDownIcon />}\r\n                >\r\n                  {filterType ? capitalize(filterType) : t(\"allTypes\")}\r\n                </MenuToggle>\r\n              )}\r\n              isOpen={isFilterTypeDropdownOpen}\r\n            >\r\n              <DropdownList>\r\n                <DropdownItem\r\n                  data-testid=\"filter-type-dropdown-existingPolicies-all\"\r\n                  key=\"all\"\r\n                  onClick={() => setFilterType(undefined)}\r\n                >\r\n                  {t(\"allTypes\")}\r\n                </DropdownItem>\r\n                {sortedProviders.map((name) => (\r\n                  <DropdownItem\r\n                    data-testid={`filter-type-dropdown-existingPolicies-${name}`}\r\n                    key={name}\r\n                    onClick={() => setFilterType(name)}\r\n                  >\r\n                    {name}\r\n                  </DropdownItem>\r\n                ))}\r\n              </DropdownList>\r\n            </Dropdown>\r\n          }\r\n          actionResolver={(rowData: IRowData) => [\r\n            {\r\n              title: t(\"unAssignPolicy\"),\r\n              onClick: () => unAssign(rowData.data as PolicyRepresentation),\r\n            } as Action<PolicyRepresentation>,\r\n          ]}\r\n          columns={[\r\n            { name: \"name\", displayKey: t(\"name\") },\r\n            {\r\n              name: \"type\",\r\n              displayKey: t(\"type\"),\r\n              cellFormatters: [(value) => capitalize(String(value || \"\"))],\r\n            },\r\n            { name: \"description\", displayKey: t(\"description\") },\r\n          ]}\r\n          emptyState={\r\n            <ListEmptyState\r\n              message={t(\"emptyAssignExistingPolicies\")}\r\n              instructions={t(\"emptyAssignExistingPoliciesInstructions\")}\r\n            />\r\n          }\r\n        />\r\n      )}\r\n      {errors.policies && <FormErrorText message={t(\"requiredPolicies\")} />}\r\n    </FormGroup>\r\n  );\r\n};\r\n","import PolicyProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyProviderRepresentation\";\r\nimport { useAlerts, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  ButtonVariant,\r\n  DropdownItem,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { useMemo, useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useParams } from \"../../utils/useParams\";\r\nimport {\r\n  PermissionConfigurationDetailsParams,\r\n  toPermissionConfigurationDetails,\r\n} from \"../routes/PermissionConfigurationDetails\";\r\nimport { toPermissionsConfigurationTabs } from \"../routes/PermissionsConfigurationTabs\";\r\nimport PolicyRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/policyRepresentation\";\r\nimport { AssignedPolicies } from \"./AssignedPolicies\";\r\nimport { ScopePicker } from \"../../clients/authorization/ScopePicker\";\r\nimport { ResourceType } from \"../resource-types/ResourceType\";\r\nimport { sortBy } from \"lodash-es\";\r\nimport { NameDescription } from \"../../clients/authorization/policy/NameDescription\";\r\nimport useSortedResourceTypes from \"../../utils/useSortedResourceTypes\";\r\n\r\nexport default function PermissionConfigurationDetails() {\r\n  const { adminClient } = useAdminClient();\r\n  const { t } = useTranslation();\r\n  const { realm, permissionClientId, permissionId, resourceType } =\r\n    useParams<PermissionConfigurationDetailsParams>();\r\n  const navigate = useNavigate();\r\n  const form = useForm();\r\n  const { handleSubmit, reset } = form;\r\n  const { addAlert, addError } = useAlerts();\r\n  const [permission, setPermission] = useState<PolicyRepresentation>();\r\n  const [providers, setProviders] = useState<PolicyProviderRepresentation[]>();\r\n  const [policies, setPolicies] = useState<PolicyRepresentation[]>();\r\n  const resourceTypes = useSortedResourceTypes({\r\n    clientId: permissionClientId,\r\n  });\r\n\r\n  const resourceTypeScopes = useMemo(\r\n    () =>\r\n      resourceTypes\r\n        .filter(({ type }) => type === resourceType)\r\n        .flatMap(({ scopes = [] }) => scopes)\r\n        .map((scope) => scope || \"\"),\r\n    [resourceTypes, resourceType],\r\n  );\r\n\r\n  useFetch(\r\n    async () => {\r\n      if (!permissionClientId) {\r\n        return {};\r\n      }\r\n\r\n      const [providers, policies] = await Promise.all([\r\n        adminClient.clients.listPolicyProviders({ id: permissionClientId }),\r\n        adminClient.clients.listPolicies({\r\n          id: permissionClientId,\r\n          permission: \"false\",\r\n        }),\r\n      ]);\r\n\r\n      return { providers, policies };\r\n    },\r\n    ({ providers, policies }) => {\r\n      const filteredProviders = providers?.filter(\r\n        (p) => p.type !== \"resource\" && p.type !== \"scope\",\r\n      );\r\n\r\n      setProviders(\r\n        sortBy(\r\n          filteredProviders,\r\n          (provider: PolicyProviderRepresentation) => provider.type,\r\n        ),\r\n      );\r\n      setPolicies(policies || []);\r\n    },\r\n    [permissionClientId],\r\n  );\r\n\r\n  useFetch(\r\n    async () => {\r\n      if (!permissionId) {\r\n        return {};\r\n      }\r\n      const [permission, resources, policies, scopes] = await Promise.all([\r\n        adminClient.clients.findOnePermission({\r\n          id: permissionClientId,\r\n          type: \"scope\",\r\n          permissionId,\r\n        }),\r\n        adminClient.clients.getAssociatedResources({\r\n          id: permissionClientId,\r\n          permissionId,\r\n        }),\r\n        adminClient.clients.getAssociatedPolicies({\r\n          id: permissionClientId,\r\n          permissionId,\r\n        }),\r\n        adminClient.clients.getAssociatedScopes({\r\n          id: permissionClientId,\r\n          permissionId,\r\n        }),\r\n      ]);\r\n\r\n      if (!permission) {\r\n        throw new Error(t(\"notFound\"));\r\n      }\r\n\r\n      return {\r\n        permission,\r\n        resources,\r\n        policies,\r\n        scopes,\r\n      };\r\n    },\r\n    ({ permission, resources, policies, scopes }) => {\r\n      const resourceIds = resources?.map((resource) => resource.name!) || [];\r\n      const policyIds = policies?.map((policy) => policy.id!) || [];\r\n      const scopeNames = scopes?.map((scope) => scope.name) || [];\r\n\r\n      reset({\r\n        ...permission,\r\n        resources: resourceIds!,\r\n        policies,\r\n        scopes,\r\n      });\r\n\r\n      setPermission({\r\n        ...permission,\r\n        resources: resourceIds!,\r\n        policies: policyIds,\r\n        scopes: scopeNames,\r\n      });\r\n    },\r\n    [permissionClientId, permissionId],\r\n  );\r\n\r\n  const save = async (permission: PolicyRepresentation) => {\r\n    try {\r\n      const newPermission = {\r\n        ...permission,\r\n        policies: permission.policies?.map((policy: any) => policy.id),\r\n        scopes: permission.scopes?.map((scope: any) => scope.name),\r\n        resourceType: resourceType,\r\n      };\r\n\r\n      if (permissionId) {\r\n        await adminClient.clients.updatePermission(\r\n          { id: permissionClientId, type: \"scope\", permissionId },\r\n          newPermission,\r\n        );\r\n      } else {\r\n        const result = await adminClient.clients.createPermission(\r\n          { id: permissionClientId, type: \"scope\" },\r\n          newPermission,\r\n        );\r\n        setPermission(result);\r\n        navigate(\r\n          toPermissionConfigurationDetails({\r\n            realm,\r\n            permissionClientId: permissionClientId,\r\n            permissionId: result.id!,\r\n            resourceType,\r\n          }),\r\n        );\r\n      }\r\n\r\n      addAlert(\r\n        t(permissionId ? \"updatePermissionSuccess\" : \"createPermissionSuccess\"),\r\n        AlertVariant.success,\r\n      );\r\n    } catch (error) {\r\n      addError(\"permissionSaveError\", error);\r\n    }\r\n  };\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"deletePermission\",\r\n    messageKey: t(\"deleteAdminPermissionConfirm\", {\r\n      permission: permission?.name,\r\n    }),\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    continueButtonLabel: \"confirm\",\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.clients.delPermission({\r\n          id: permissionClientId!,\r\n          type: \"scope\",\r\n          permissionId: permissionId,\r\n        });\r\n        addAlert(t(\"permissionDeletedSuccess\"), AlertVariant.success);\r\n        navigate(\r\n          toPermissionsConfigurationTabs({\r\n            realm,\r\n            permissionClientId,\r\n            tab: \"permissions\",\r\n          }),\r\n        );\r\n      } catch (error) {\r\n        addError(\"permissionDeletedError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  if (!permission) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <DeleteConfirm />\r\n      <ViewHeader\r\n        titleKey={permissionId ? permission?.name! : t(\"createPermission\")}\r\n        subKey={\r\n          permissionId\r\n            ? permission?.description!\r\n            : t(\"createPermissionOfType\", { resourceType })\r\n        }\r\n        dropdownItems={\r\n          permissionId\r\n            ? [\r\n                <DropdownItem\r\n                  key=\"delete\"\r\n                  data-testid=\"delete-permission\"\r\n                  onClick={() => toggleDeleteDialog()}\r\n                >\r\n                  {t(\"delete\")}\r\n                </DropdownItem>,\r\n              ]\r\n            : undefined\r\n        }\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <FormAccess isHorizontal onSubmit={handleSubmit(save)} role=\"anyone\">\r\n          <FormProvider {...form}>\r\n            <NameDescription clientId={permissionClientId} />\r\n            <ScopePicker\r\n              clientId={permissionClientId}\r\n              resourceTypeScopes={resourceTypeScopes ?? []}\r\n            />\r\n            <ResourceType resourceType={resourceType} />\r\n            <AssignedPolicies\r\n              permissionClientId={permissionClientId}\r\n              providers={providers!}\r\n              policies={policies!}\r\n              resourceType={resourceType}\r\n            />\r\n          </FormProvider>\r\n          <ActionGroup>\r\n            <div className=\"pf-v5-u-mt-md\">\r\n              <Button\r\n                variant={ButtonVariant.primary}\r\n                className=\"pf-v5-u-mr-md\"\r\n                type=\"submit\"\r\n                data-testid=\"save\"\r\n              >\r\n                {t(\"save\")}\r\n              </Button>\r\n              <Button\r\n                variant=\"link\"\r\n                data-testid=\"cancel\"\r\n                component={(props) => (\r\n                  <Link\r\n                    {...props}\r\n                    to={toPermissionsConfigurationTabs({\r\n                      realm,\r\n                      permissionClientId,\r\n                      tab: \"permissions\",\r\n                    })}\r\n                  />\r\n                )}\r\n              >\r\n                {t(\"cancel\")}\r\n              </Button>\r\n            </div>\r\n          </ActionGroup>\r\n        </FormAccess>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["defaultValues","DecisionStrategy","Logic","COMPONENTS","Aggregate","Client","User","ClientScope","Group","Regex","Role","Time","JavaScript","isValidComponentType","value","NewPermissionPolicyDialog","permissionClientId","providers","policies","toggleDialog","onAssign","adminClient","useAdminClient","realmRepresentation","useRealm","t","useTranslation","form","useForm","addAlert","addError","useAlerts","handleSubmit","reset","isPermissionClient","policyTypeSelector","useWatch","getComponentType","ComponentType","useEffect","name","description","decisionStrategy","logic","save","policy","groups","roles","clients","rest","cleanedPolicy","createdPolicy","AlertVariant","error","jsx","Modal","ModalVariant","TextContent","Text","TextVariants","jsxs","Form","e","FormProvider","TextControl","SelectControl","provider","capitalize","LogicSelector","ActionGroup","Button","ButtonVariant","ExistingPoliciesDialog","open","rows","setRows","useState","filterType","setFilterType","isFilterTypeDropdownOpen","toggleIsFilterTypeDropdownOpen","useToggle","setProviders","useFetch","formattedProviders","p","sortBy","loader","first","max","search","params","Fragment","selectedPolicies","KeycloakDataTable","Dropdown","_","ref","MenuToggle","FilterIcon","CaretDownIcon","DropdownList","DropdownItem","selectedRows","capitalizeFirstLetterFormatter","ListEmptyState","AssignedPolicies","resourceType","control","getValues","setValue","trigger","errors","useFormContext","values","existingPoliciesOpen","setExistingPoliciesOpen","newPolicyOpen","setNewPolicyOpen","setSelectedPolicies","filteredPolicy","sortedProviders","assign","assignedPolicies","unAssign","updatedPolicies","selectedPolicy","filteredPolicies","FormGroup","HelpItem","Controller","id","newPolicy","event","rowData","FormErrorText","PermissionConfigurationDetails","realm","permissionId","useParams","navigate","useNavigate","permission","setPermission","setPolicies","resourceTypes","useSortedResourceTypes","resourceTypeScopes","useMemo","type","scopes","scope","filteredProviders","resources","resourceIds","resource","policyIds","scopeNames","newPermission","result","toPermissionConfigurationDetails","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","toPermissionsConfigurationTabs","ViewHeader","PageSection","FormAccess","NameDescription","ScopePicker","ResourceType","props","Link","KeycloakSpinner"],"mappings":"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"}