import{jsx as e,jsxs as o,Fragment as x}from"react/jsx-runtime";import{u as z,a as J,b as W,j as Y,bn as U,_ as X,e as Z,y as ee,B as te,o as y,er as w,en as T,p as ie,D as ae,at as re,P as oe,l as le,Q as se,aO as ne,A as ce,g as d,L as P,aC as de,aD as L,I as F,J as S,W as V,ae as me,es as ue,et as fe,aa as pe}from"./main-o1hptXRo.js";import{useState as h,useMemo as xe,Fragment as Pe}from"react";import{u as he}from"./ConfirmDialog-BkU7melV.js";import{F as Ce}from"./FormAccess-BnhQnYb9.js";import{V as be}from"./ViewHeader-BDBsroi3.js";import{u as ge}from"./useParams-CGVhlaFZ.js";/* empty css                               */import{D as ve,a as ke,b as ye,c as Te,d as Ee}from"./DataListItemRow-B_0B-ko6.js";import{T as De}from"./trash-icon-BwwarfOm.js";import"react-dom";const Ie={name:"",description:"",executors:[]};function je(){const{adminClient:p}=z(),{t}=J(),C=W(),E=Y({defaultValues:Ie,mode:"onChange"}),{handleSubmit:A,setValue:b,getValues:B,formState:{isDirty:D},control:H}=E,{fields:g,remove:G}=U({name:"executors",control:H}),{addAlert:v,addError:k}=X(),[m,K]=h(),[r,j]=h(!1),{realm:n,profileName:l}=ge(),q=Z(),O=xe(()=>q.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,$]=h(),c=!!l,[I,M]=h(0),Q=()=>M(I+1);ee(()=>p.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{K({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),a=i.profiles?.find(f=>f.name===l);j(s!==void 0),b("name",s?.name??a?.name??""),b("description",s?.description??a?.description??""),b("executors",s?.executors??a?.executors??[])},[I]);const R=async i=>{const s=i;try{await p.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),v(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),y.success),C(w({realm:n,profileName:i.name}))}catch(a){k(c?"updateClientProfileError":"createClientProfileError",a)}},[N,_]=he({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{if(u?.name){G(u.idx);try{await p.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],B()]}),v(t("deleteExecutorSuccess"),y.success),C(w({realm:n,profileName:l}))}catch(i){k("deleteExecutorError",i)}}else try{await p.clientPolicies.createProfiles(m),v(t("deleteClientSuccess"),y.success),C(T({realm:n,tab:"profiles"}))}catch(i){k("deleteClientError",i)}}});return m?o(x,{children:[e(_,{}),e(be,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:r?e(re,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!r?[e(ae,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(oe,{variant:"light",children:e(le,{...E,children:o(Ce,{isHorizontal:!0,role:"view-realm",className:"pf-v5-u-mt-lg",children:[e(se,{name:"name",label:t("newClientProfileName"),helperText:t("createClientProfileNameHelperText"),readOnly:r,rules:{required:t("required")}}),e(ne,{name:"description",label:t("description"),readOnly:r}),o(ce,{children:[!r&&e(d,{variant:"primary",onClick:()=>A(R)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!r&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:Q,children:t("reload")}),!c&&!r&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(x,{children:[o(de,{children:[e(L,{children:o(F,{className:"kc-executors",component:S.h1,children:[t("executors"),e(V,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!r&&e(L,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:ue({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(me,{}),children:t("addExecutor")})})]}),g.length>0&&o(x,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(ke,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ye,{"data-testid":"executors-list-row",children:e(Te,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:a=>e(P,{...a,to:fe({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),O?.filter(a=>a.id===i.executor).map(a=>o(Pe,{children:[e(V,{helpText:a.helpText,fieldLabelId:"executorTypeTextHelpText"},a.id),!r&&e(d,{"data-testid":`deleteExecutor-${a.id}`,variant:"link",isInline:!0,icon:e(De,{className:"kc-executor-trash-icon"},`executorType-trash-icon-${a.id}`),onClick:()=>{N(),$({idx:s,name:a.id})},"aria-label":t("remove")})]},a.id))]},"executor")]})})},i.executor))}),r&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(x,{children:[e(pe,{}),e(F,{className:"kc-emptyExecutors",component:S.h2,children:t("emptyExecutors")})]})]})]})})})]}):e(ie,{})}export{je as default};
//# sourceMappingURL=ClientProfileForm-Nd4CiDuL.js.map
