{"version":3,"file":"DetailProvider-CWVbA3_r.js","sources":["../../../../../../../src/clients/registration/DetailProvider.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport ComponentTypeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentTypeRepresentation\";\r\nimport { TextControl, useAlerts, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  Button,\r\n  ButtonVariant,\r\n  DropdownItem,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { FormProvider, useForm, useWatch } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\r\nimport { DynamicComponents } from \"../../components/dynamic/DynamicComponents\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport { useParams } from \"../../utils/useParams\";\r\nimport {\r\n  RegistrationProviderParams,\r\n  toRegistrationProvider,\r\n} from \"../routes/AddRegistrationProvider\";\r\nimport { toClientRegistration } from \"../routes/ClientRegistration\";\r\n\r\nexport default function DetailProvider() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { id, providerId, subTab } = useParams<RegistrationProviderParams>();\r\n  const navigate = useNavigate();\r\n  const form = useForm<ComponentRepresentation>({\r\n    defaultValues: { providerId },\r\n  });\r\n  const { control, handleSubmit, reset } = form;\r\n\r\n  const { realm, realmRepresentation } = useRealm();\r\n  const { addAlert, addError } = useAlerts();\r\n  const [provider, setProvider] = useState<ComponentTypeRepresentation>();\r\n\r\n  useFetch(\r\n    async () =>\r\n      await Promise.all([\r\n        adminClient.realms.getClientRegistrationPolicyProviders({ realm }),\r\n        id ? adminClient.components.findOne({ id }) : Promise.resolve(),\r\n      ]),\r\n    ([providers, data]) => {\r\n      setProvider(providers.find((p) => p.id === providerId));\r\n      reset(data || { providerId });\r\n    },\r\n    [],\r\n  );\r\n\r\n  const providerName = useWatch({ control, defaultValue: \"\", name: \"name\" });\r\n\r\n  const onSubmit = async (component: ComponentRepresentation) => {\r\n    if (component.config)\r\n      Object.entries(component.config).forEach(\r\n        ([key, value]) =>\r\n          (component.config![key] = Array.isArray(value) ? value : [value]),\r\n      );\r\n    try {\r\n      const updatedComponent = {\r\n        ...component,\r\n        subType: subTab,\r\n        parentId: realmRepresentation?.id,\r\n        providerType:\r\n          \"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy\",\r\n        providerId,\r\n      };\r\n      if (id) {\r\n        await adminClient.components.update({ id }, updatedComponent);\r\n      } else {\r\n        const { id } = await adminClient.components.create(updatedComponent);\r\n        navigate(toRegistrationProvider({ id, realm, subTab, providerId }));\r\n      }\r\n      addAlert(t(`provider${id ? \"Updated\" : \"Create\"}Success`));\r\n    } catch (error) {\r\n      addError(`provider${id ? \"Updated\" : \"Create\"}Error`, error);\r\n    }\r\n  };\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"clientRegisterPolicyDeleteConfirmTitle\",\r\n    messageKey: t(\"clientRegisterPolicyDeleteConfirm\", {\r\n      name: providerName,\r\n    }),\r\n    continueButtonLabel: \"delete\",\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.components.del({\r\n          realm,\r\n          id: id!,\r\n        });\r\n        addAlert(t(\"clientRegisterPolicyDeleteSuccess\"));\r\n        navigate(toClientRegistration({ realm, subTab }));\r\n      } catch (error) {\r\n        addError(\"clientRegisterPolicyDeleteError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  if (!provider) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader\r\n        titleKey={id ? providerName! : \"createPolicy\"}\r\n        subKey={id}\r\n        dropdownItems={\r\n          id\r\n            ? [\r\n                <DropdownItem\r\n                  data-testid=\"delete\"\r\n                  key=\"delete\"\r\n                  onClick={toggleDeleteDialog}\r\n                >\r\n                  {t(\"delete\")}\r\n                </DropdownItem>,\r\n              ]\r\n            : undefined\r\n        }\r\n      />\r\n      <DeleteConfirm />\r\n      <PageSection variant=\"light\">\r\n        <FormProvider {...form}>\r\n          <FormAccess\r\n            role=\"manage-clients\"\r\n            isHorizontal\r\n            onSubmit={handleSubmit(onSubmit)}\r\n          >\r\n            <TextControl name=\"providerId\" label={t(\"provider\")} readOnly />\r\n            <TextControl\r\n              name=\"name\"\r\n              label={t(\"name\")}\r\n              labelIcon={t(\"clientPolicyNameHelp\")}\r\n              rules={{ required: t(\"required\") }}\r\n            />\r\n            <DynamicComponents properties={provider.properties} />\r\n            <ActionGroup>\r\n              <Button data-testid=\"save\" type=\"submit\">\r\n                {t(\"save\")}\r\n              </Button>\r\n              <Button\r\n                data-testid=\"cancel\"\r\n                variant=\"link\"\r\n                component={(props) => (\r\n                  <Link\r\n                    {...props}\r\n                    to={toClientRegistration({ realm, subTab })}\r\n                  ></Link>\r\n                )}\r\n              >\r\n                {t(\"cancel\")}\r\n              </Button>\r\n            </ActionGroup>\r\n          </FormAccess>\r\n        </FormProvider>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["DetailProvider","adminClient","useAdminClient","useTranslation","id","providerId","subTab","useParams","navigate","useNavigate","form","useForm","control","handleSubmit","reset","realm","realmRepresentation","useRealm","addAlert","addError","useAlerts","provider","setProvider","useState","useFetch","providers","data","p","providerName","useWatch","onSubmit","component","key","value","updatedComponent","toRegistrationProvider","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","toClientRegistration","jsxs","Fragment","jsx","ViewHeader","DropdownItem","PageSection","FormProvider","FormAccess","TextControl","DynamicComponents","ActionGroup","Button","props","Link","KeycloakSpinner"],"mappings":"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"}