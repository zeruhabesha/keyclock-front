{"version":3,"file":"MembersModal-C7pjKBVL.js","sources":["../../../../../../../src/groups/MembersModal.tsx"],"sourcesContent":["import type UserRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/userRepresentation\";\r\nimport { Button, Modal, ModalVariant, Label } from \"@patternfly/react-core\";\r\nimport { InfoCircleIcon } from \"@patternfly/react-icons\";\r\nimport { differenceBy } from \"lodash-es\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { ListEmptyState } from \"@keycloak/keycloak-ui-shared\";\r\nimport { KeycloakDataTable } from \"@keycloak/keycloak-ui-shared\";\r\nimport { emptyFormatter } from \"../util\";\r\n\r\ntype MemberModalProps = {\r\n  membersQuery: (first?: number, max?: number) => Promise<UserRepresentation[]>;\r\n  onAdd: (users: UserRepresentation[]) => Promise<void>;\r\n  onClose: () => void;\r\n};\r\n\r\nconst UserDetail = (user: UserRepresentation) => {\r\n  const { t } = useTranslation();\r\n  return (\r\n    <>\r\n      {user.username}{\" \"}\r\n      {!user.enabled && (\r\n        <Label color=\"red\" icon={<InfoCircleIcon />}>\r\n          {t(\"disabled\")}\r\n        </Label>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport const MemberModal = ({\r\n  membersQuery,\r\n  onAdd,\r\n  onClose,\r\n}: MemberModalProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { addError } = useAlerts();\r\n  const [selectedRows, setSelectedRows] = useState<UserRepresentation[]>([]);\r\n\r\n  const loader = async (first?: number, max?: number, search?: string) => {\r\n    const members = await membersQuery(first, max);\r\n    const params: { [name: string]: string | number } = {\r\n      first: first!,\r\n      max: max! + members.length,\r\n      search: search || \"\",\r\n    };\r\n\r\n    try {\r\n      const users = await adminClient.users.find({ ...params });\r\n      return differenceBy(users, members, \"id\").slice(0, max);\r\n    } catch (error) {\r\n      addError(\"noUsersFoundError\", error);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      variant={ModalVariant.large}\r\n      title={t(\"addMember\")}\r\n      isOpen\r\n      onClose={onClose}\r\n      actions={[\r\n        <Button\r\n          data-testid=\"add\"\r\n          key=\"confirm\"\r\n          variant=\"primary\"\r\n          onClick={async () => {\r\n            await onAdd(selectedRows);\r\n            onClose();\r\n          }}\r\n        >\r\n          {t(\"add\")}\r\n        </Button>,\r\n        <Button\r\n          data-testid=\"cancel\"\r\n          key=\"cancel\"\r\n          variant=\"link\"\r\n          onClick={onClose}\r\n        >\r\n          {t(\"cancel\")}\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <KeycloakDataTable\r\n        loader={loader}\r\n        isPaginated\r\n        ariaLabelKey=\"titleUsers\"\r\n        searchPlaceholderKey=\"searchForUser\"\r\n        canSelectAll\r\n        onSelect={(rows) => setSelectedRows([...rows])}\r\n        emptyState={\r\n          <ListEmptyState\r\n            message={t(\"noUsersFound\")}\r\n            instructions={t(\"emptyInstructions\")}\r\n          />\r\n        }\r\n        columns={[\r\n          {\r\n            name: \"username\",\r\n            displayKey: \"username\",\r\n            cellRenderer: UserDetail,\r\n          },\r\n          {\r\n            name: \"email\",\r\n            displayKey: \"email\",\r\n            cellFormatters: [emptyFormatter()],\r\n          },\r\n          {\r\n            name: \"lastName\",\r\n            displayKey: \"lastName\",\r\n            cellFormatters: [emptyFormatter()],\r\n          },\r\n          {\r\n            name: \"firstName\",\r\n            displayKey: \"firstName\",\r\n            cellFormatters: [emptyFormatter()],\r\n          },\r\n        ]}\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n"],"names":["UserDetail","user","t","useTranslation","jsxs","Fragment","jsx","Label","InfoCircleIcon","MemberModal","membersQuery","onAdd","onClose","adminClient","useAdminClient","addError","useAlerts","selectedRows","setSelectedRows","useState","loader","first","max","search","members","params","users","differenceBy","error","Modal","ModalVariant","Button","KeycloakDataTable","rows","ListEmptyState","emptyFormatter"],"mappings":"gQAkBA,MAAMA,EAAcC,GAA6B,CAC/C,KAAM,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACd,OACEC,EAAAC,EAAA,CACG,SAAA,CAAAJ,EAAK,SAAU,IACf,CAACA,EAAK,SACLK,EAACC,EAAA,CAAM,MAAM,MAAM,KAAMD,EAACE,EAAA,CAAA,CAAe,EACtC,SAAAN,EAAE,UAAU,CAAA,CACf,CAAA,EAEJ,CAEJ,EAEaO,EAAc,CAAC,CAC1B,aAAAC,EACA,MAAAC,EACA,QAAAC,CACF,IAAwB,CACtB,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAZ,CAAA,EAAMC,EAAA,EACR,CAAE,SAAAY,CAAA,EAAaC,EAAA,EACf,CAACC,EAAcC,CAAe,EAAIC,EAA+B,CAAA,CAAE,EAEnEC,EAAS,MAAOC,EAAgBC,EAAcC,IAAoB,CACtE,MAAMC,EAAU,MAAMd,EAAaW,EAAOC,CAAG,EACvCG,EAA8C,CAClD,MAAAJ,EACA,IAAKC,EAAOE,EAAQ,OACpB,OAAQD,GAAU,EAAA,EAGpB,GAAI,CACF,MAAMG,EAAQ,MAAMb,EAAY,MAAM,KAAK,CAAE,GAAGY,EAAQ,EACxD,OAAOE,EAAaD,EAAOF,EAAS,IAAI,EAAE,MAAM,EAAGF,CAAG,CACxD,OAASM,EAAO,CACd,OAAAb,EAAS,oBAAqBa,CAAK,EAC5B,CAAA,CACT,CACF,EAEA,OACEtB,EAACuB,EAAA,CACC,QAASC,EAAa,MACtB,MAAO5B,EAAE,WAAW,EACpB,OAAM,GACN,QAAAU,EACA,QAAS,CACPN,EAACyB,EAAA,CACC,cAAY,MAEZ,QAAQ,UACR,QAAS,SAAY,CACnB,MAAMpB,EAAMM,CAAY,EACxBL,EAAA,CACF,EAEC,WAAE,KAAK,CAAA,EAPJ,SAAA,EASNN,EAACyB,EAAA,CACC,cAAY,SAEZ,QAAQ,OACR,QAASnB,EAER,WAAE,QAAQ,CAAA,EAJP,QAAA,CAKN,EAGF,SAAAN,EAAC0B,EAAA,CACC,OAAAZ,EACA,YAAW,GACX,aAAa,aACb,qBAAqB,gBACrB,aAAY,GACZ,SAAWa,GAASf,EAAgB,CAAC,GAAGe,CAAI,CAAC,EAC7C,WACE3B,EAAC4B,EAAA,CACC,QAAShC,EAAE,cAAc,EACzB,aAAcA,EAAE,mBAAmB,CAAA,CAAA,EAGvC,QAAS,CACP,CACE,KAAM,WACN,WAAY,WACZ,aAAcF,CAAA,EAEhB,CACE,KAAM,QACN,WAAY,QACZ,eAAgB,CAACmC,EAAA,CAAgB,CAAA,EAEnC,CACE,KAAM,WACN,WAAY,WACZ,eAAgB,CAACA,EAAA,CAAgB,CAAA,EAEnC,CACE,KAAM,YACN,WAAY,YACZ,eAAgB,CAACA,EAAA,CAAgB,CAAA,CACnC,CACF,CAAA,CACF,CAAA,CAGN"}