{"version":3,"file":"KeyValueInput-BOsiIUR1.js","sources":["../../../../../../../src/components/key-value-form/KeyValueInput.tsx"],"sourcesContent":["import {\r\n  ActionList,\r\n  ActionListItem,\r\n  Button,\r\n  EmptyState,\r\n  EmptyStateBody,\r\n  EmptyStateFooter,\r\n  Grid,\r\n  GridItem,\r\n  HelperText,\r\n  HelperTextItem,\r\n  TextInput,\r\n} from \"@patternfly/react-core\";\r\nimport { MinusCircleIcon, PlusCircleIcon } from \"@patternfly/react-icons\";\r\nimport { Fragment, FunctionComponent, PropsWithChildren } from \"react\";\r\nimport {\r\n  FieldValues,\r\n  useFieldArray,\r\n  useFormContext,\r\n  useWatch,\r\n} from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport type DefaultValue = {\r\n  key: string;\r\n  values?: string[];\r\n  label: string;\r\n};\r\n\r\ntype Field = {\r\n  name: string;\r\n};\r\n\r\ntype ValueField = Field & {\r\n  keyValue: string;\r\n};\r\n\r\ntype KeyValueInputProps = PropsWithChildren & {\r\n  name: string;\r\n  label?: string;\r\n  isDisabled?: boolean;\r\n  KeyComponent?: FunctionComponent<Field>;\r\n  ValueComponent?: FunctionComponent<ValueField>;\r\n};\r\n\r\nexport const KeyValueInput = ({\r\n  name,\r\n  label = \"attributes\",\r\n  isDisabled = false,\r\n  KeyComponent,\r\n  ValueComponent,\r\n}: KeyValueInputProps) => {\r\n  const { t } = useTranslation();\r\n  const {\r\n    control,\r\n    register,\r\n    formState: { errors },\r\n  } = useFormContext();\r\n\r\n  const { fields, append, remove } = useFieldArray({\r\n    control,\r\n    name,\r\n  });\r\n\r\n  const appendNew = () => append({ key: \"\", value: \"\" });\r\n\r\n  const values = useWatch<FieldValues>({\r\n    name,\r\n    control,\r\n    defaultValue: [],\r\n  });\r\n\r\n  return fields.length > 0 ? (\r\n    <>\r\n      <Grid hasGutter>\r\n        <GridItem className=\"pf-v5-c-form__label\" span={5}>\r\n          <span className=\"pf-v5-c-form__label-text\">{t(\"key\")}</span>\r\n        </GridItem>\r\n        <GridItem className=\"pf-v5-c-form__label\" span={7}>\r\n          <span className=\"pf-v5-c-form__label-text\">{t(\"value\")}</span>\r\n        </GridItem>\r\n        {fields.map((attribute, index) => {\r\n          const error = (errors as any)[name]?.[index];\r\n          const keyError = !!error?.key;\r\n          const valueErrorPresent = !!error?.value || !!error?.message;\r\n          const valueError = error?.message || t(\"valueError\");\r\n          return (\r\n            <Fragment key={attribute.id}>\r\n              <GridItem span={5}>\r\n                {KeyComponent ? (\r\n                  <KeyComponent name={`${name}.${index}.key`} />\r\n                ) : (\r\n                  <TextInput\r\n                    placeholder={t(\"keyPlaceholder\")}\r\n                    aria-label={t(\"key\")}\r\n                    data-testid={`${name}-key`}\r\n                    {...register(`${name}.${index}.key`, { required: true })}\r\n                    validated={keyError ? \"error\" : \"default\"}\r\n                    isRequired\r\n                    isDisabled={isDisabled}\r\n                  />\r\n                )}\r\n                {keyError && (\r\n                  <HelperText>\r\n                    <HelperTextItem variant=\"error\">\r\n                      {t(\"keyError\")}\r\n                    </HelperTextItem>\r\n                  </HelperText>\r\n                )}\r\n              </GridItem>\r\n              <GridItem span={5}>\r\n                {ValueComponent ? (\r\n                  <ValueComponent\r\n                    name={`${name}.${index}.value`}\r\n                    keyValue={values[index]?.key}\r\n                  />\r\n                ) : (\r\n                  <TextInput\r\n                    placeholder={t(\"valuePlaceholder\")}\r\n                    aria-label={t(\"value\")}\r\n                    data-testid={`${name}-value`}\r\n                    {...register(`${name}.${index}.value`, { required: true })}\r\n                    validated={valueErrorPresent ? \"error\" : \"default\"}\r\n                    isRequired\r\n                    isDisabled={isDisabled}\r\n                  />\r\n                )}\r\n                {valueErrorPresent && (\r\n                  <HelperText>\r\n                    <HelperTextItem variant=\"error\">\r\n                      {valueError}\r\n                    </HelperTextItem>\r\n                  </HelperText>\r\n                )}\r\n              </GridItem>\r\n              <GridItem span={2}>\r\n                <Button\r\n                  variant=\"link\"\r\n                  title={t(\"removeAttribute\")}\r\n                  onClick={() => remove(index)}\r\n                  data-testid={`${name}-remove`}\r\n                  isDisabled={isDisabled}\r\n                >\r\n                  <MinusCircleIcon />\r\n                </Button>\r\n              </GridItem>\r\n            </Fragment>\r\n          );\r\n        })}\r\n      </Grid>\r\n      <ActionList>\r\n        <ActionListItem>\r\n          <Button\r\n            data-testid={`${name}-add-row`}\r\n            className=\"pf-v5-u-px-0 pf-v5-u-mt-sm\"\r\n            variant=\"link\"\r\n            icon={<PlusCircleIcon />}\r\n            onClick={appendNew}\r\n            isDisabled={isDisabled}\r\n          >\r\n            {t(\"addAttribute\", { label })}\r\n          </Button>\r\n        </ActionListItem>\r\n      </ActionList>\r\n    </>\r\n  ) : (\r\n    <EmptyState\r\n      data-testid={`${name}-empty-state`}\r\n      className=\"pf-v5-u-p-0\"\r\n      variant=\"xs\"\r\n    >\r\n      <EmptyStateBody>{t(\"missingAttributes\", { label })}</EmptyStateBody>\r\n      <EmptyStateFooter>\r\n        <Button\r\n          data-testid={`${name}-add-row`}\r\n          variant=\"link\"\r\n          icon={<PlusCircleIcon />}\r\n          size=\"sm\"\r\n          onClick={appendNew}\r\n          isDisabled={isDisabled}\r\n        >\r\n          {t(\"addAttribute\", { label })}\r\n        </Button>\r\n      </EmptyStateFooter>\r\n    </EmptyState>\r\n  );\r\n};\r\n"],"names":["KeyValueInput","name","label","isDisabled","KeyComponent","ValueComponent","t","useTranslation","control","register","errors","useFormContext","fields","append","remove","useFieldArray","appendNew","values","useWatch","jsxs","Fragment","Grid","jsx","GridItem","attribute","index","error","keyError","valueErrorPresent","valueError","TextInput","HelperText","HelperTextItem","Button","MinusCircleIcon","ActionList","ActionListItem","PlusCircleIcon","EmptyState","EmptyStateBody","EmptyStateFooter"],"mappings":"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"}