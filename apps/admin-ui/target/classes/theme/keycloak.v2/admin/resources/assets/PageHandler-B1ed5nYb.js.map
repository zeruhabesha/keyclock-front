{"version":3,"file":"PageHandler-B1ed5nYb.js","sources":["../../../../../../../src/page/PageHandler.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport ComponentTypeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentTypeRepresentation\";\r\nimport {\r\n  KeycloakSpinner,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { ActionGroup, Button, Form, PageSection } from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { DynamicComponents } from \"../components/dynamic/DynamicComponents\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport { useParams } from \"../utils/useParams\";\r\nimport { type PAGE_PROVIDER, TAB_PROVIDER } from \"./constants\";\r\nimport { toPage } from \"./routes\";\r\n\r\ntype PageHandlerProps = {\r\n  id?: string;\r\n  providerType: typeof TAB_PROVIDER | typeof PAGE_PROVIDER;\r\n  page: ComponentTypeRepresentation;\r\n};\r\n\r\nexport const PageHandler = ({\r\n  id: idAttribute,\r\n  providerType,\r\n  page: { id: providerId, ...page },\r\n}: PageHandlerProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const form = useForm<ComponentTypeRepresentation>();\r\n  const { realm: realmName, realmRepresentation: realm } = useRealm();\r\n  const { addAlert, addError } = useAlerts();\r\n  const [id, setId] = useState(idAttribute);\r\n  const params = useParams();\r\n\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useFetch(\r\n    async () =>\r\n      await Promise.all([\r\n        id ? adminClient.components.findOne({ id }) : Promise.resolve(),\r\n        providerType === TAB_PROVIDER\r\n          ? adminClient.components.find({ type: TAB_PROVIDER })\r\n          : Promise.resolve(),\r\n      ]),\r\n    ([data, tabs]) => {\r\n      const tab = (tabs || []).find((t) => t.providerId === providerId);\r\n      form.reset(data || tab || {});\r\n      if (tab) setId(tab.id);\r\n      setIsLoading(false);\r\n    },\r\n    [],\r\n  );\r\n\r\n  const onSubmit = async (component: ComponentRepresentation) => {\r\n    if (component.config || params) {\r\n      component.config = Object.assign(component.config || {}, params);\r\n      Object.entries(component.config).forEach(\r\n        ([key, value]) =>\r\n          (component.config![key] = Array.isArray(value) ? value : [value]),\r\n      );\r\n    }\r\n    try {\r\n      const updatedComponent = {\r\n        ...component,\r\n        providerId,\r\n        providerType,\r\n        parentId: realm?.id,\r\n      };\r\n      if (id) {\r\n        await adminClient.components.update({ id }, updatedComponent);\r\n      } else {\r\n        const { id } = await adminClient.components.create(updatedComponent);\r\n        setId(id);\r\n      }\r\n      addAlert(t(\"itemSaveSuccessful\"));\r\n    } catch (error) {\r\n      addError(\"itemSaveError\", error);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <PageSection variant=\"light\">\r\n      <Form\r\n        isHorizontal\r\n        onSubmit={form.handleSubmit(onSubmit)}\r\n        className=\"keycloak__form\"\r\n      >\r\n        <FormProvider {...form}>\r\n          <DynamicComponents properties={page.properties} />\r\n        </FormProvider>\r\n\r\n        <ActionGroup>\r\n          <Button data-testid=\"save\" type=\"submit\">\r\n            {t(\"save\")}\r\n          </Button>\r\n          <Button\r\n            variant=\"link\"\r\n            component={(props) => (\r\n              <Link\r\n                {...props}\r\n                to={toPage({ realm: realmName, providerId: providerId! })}\r\n              />\r\n            )}\r\n          >\r\n            {t(\"cancel\")}\r\n          </Button>\r\n        </ActionGroup>\r\n      </Form>\r\n    </PageSection>\r\n  );\r\n};\r\n"],"names":["PageHandler","idAttribute","providerType","providerId","page","adminClient","useAdminClient","t","useTranslation","form","useForm","realmName","realm","useRealm","addAlert","addError","useAlerts","id","setId","useState","params","useParams","isLoading","setIsLoading","useFetch","TAB_PROVIDER","data","tabs","tab","onSubmit","component","key","value","updatedComponent","error","KeycloakSpinner","jsx","PageSection","jsxs","Form","FormProvider","DynamicComponents","ActionGroup","Button","props","Link","toPage"],"mappings":"iWAyBO,MAAMA,EAAc,CAAC,CAC1B,GAAIC,EACJ,aAAAC,EACA,KAAM,CAAE,GAAIC,EAAY,GAAGC,CAAA,CAC7B,IAAwB,CACtB,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACRC,EAAOC,EAAA,EACP,CAAE,MAAOC,EAAW,oBAAqBC,CAAA,EAAUC,EAAA,EACnD,CAAE,SAAAC,EAAU,SAAAC,CAAA,EAAaC,EAAA,EACzB,CAACC,EAAIC,CAAK,EAAIC,EAASlB,CAAW,EAClCmB,EAASC,EAAA,EAET,CAACC,EAAWC,CAAY,EAAIJ,EAAS,EAAI,EAE/CK,EACE,SACE,MAAM,QAAQ,IAAI,CAChBP,EAAKZ,EAAY,WAAW,QAAQ,CAAE,GAAAY,EAAI,EAAI,QAAQ,QAAA,EACtDf,IAAiBuB,EACbpB,EAAY,WAAW,KAAK,CAAE,KAAMoB,CAAA,CAAc,EAClD,QAAQ,QAAA,CAAQ,CACrB,EACH,CAAC,CAACC,EAAMC,CAAI,IAAM,CAChB,MAAMC,GAAOD,GAAQ,IAAI,KAAMpB,GAAMA,EAAE,aAAeJ,CAAU,EAChEM,EAAK,MAAMiB,GAAQE,GAAO,CAAA,CAAE,EACxBA,GAAKV,EAAMU,EAAI,EAAE,EACrBL,EAAa,EAAK,CACpB,EACA,CAAA,CAAC,EAGH,MAAMM,EAAW,MAAOC,GAAuC,EACzDA,EAAU,QAAUV,KACtBU,EAAU,OAAS,OAAO,OAAOA,EAAU,QAAU,CAAA,EAAIV,CAAM,EAC/D,OAAO,QAAQU,EAAU,MAAM,EAAE,QAC/B,CAAC,CAACC,EAAKC,CAAK,IACTF,EAAU,OAAQC,CAAG,EAAI,MAAM,QAAQC,CAAK,EAAIA,EAAQ,CAACA,CAAK,CAAA,GAGrE,GAAI,CACF,MAAMC,EAAmB,CACvB,GAAGH,EACH,WAAA3B,EACA,aAAAD,EACA,SAAUU,GAAO,EAAA,EAEnB,GAAIK,EACF,MAAMZ,EAAY,WAAW,OAAO,CAAE,GAAAY,CAAA,EAAMgB,CAAgB,MACvD,CACL,KAAM,CAAE,GAAAhB,CAAAA,EAAO,MAAMZ,EAAY,WAAW,OAAO4B,CAAgB,EACnEf,EAAMD,CAAE,CACV,CACAH,EAASP,EAAE,oBAAoB,CAAC,CAClC,OAAS2B,EAAO,CACdnB,EAAS,gBAAiBmB,CAAK,CACjC,CACF,EAEA,OAAIZ,IACMa,EAAA,EAAgB,EAIxBC,EAACC,EAAA,CAAY,QAAQ,QACnB,SAAAC,EAACC,EAAA,CACC,aAAY,GACZ,SAAU9B,EAAK,aAAaoB,CAAQ,EACpC,UAAU,iBAEV,SAAA,CAAAO,EAACI,EAAA,CAAc,GAAG/B,EAChB,SAAA2B,EAACK,GAAkB,WAAYrC,EAAK,WAAY,CAAA,CAClD,IAECsC,EAAA,CACC,SAAA,CAAAN,EAACO,GAAO,cAAY,OAAO,KAAK,SAC7B,SAAApC,EAAE,MAAM,EACX,EACA6B,EAACO,EAAA,CACC,QAAQ,OACR,UAAYC,GACVR,EAACS,EAAA,CACE,GAAGD,EACJ,GAAIE,EAAO,CAAE,MAAOnC,EAAW,WAAAR,EAAyB,CAAA,CAAA,EAI3D,WAAE,QAAQ,CAAA,CAAA,CACb,CAAA,CACF,CAAA,CAAA,CAAA,EAEJ,CAEJ"}