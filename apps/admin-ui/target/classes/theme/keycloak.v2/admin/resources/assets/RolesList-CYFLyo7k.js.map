{"version":3,"file":"RolesList-CYFLyo7k.js","sources":["../../../../../../../src/components/roles-list/RolesList.tsx"],"sourcesContent":["import type RoleRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/roleRepresentation\";\r\nimport { HelpItem, useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { AlertVariant, Button, ButtonVariant } from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, To, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useAccess } from \"../../context/access/Access\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport { toRealmSettings } from \"../../realm-settings/routes/RealmSettings\";\r\nimport { emptyFormatter, upperCaseFormatter } from \"../../util\";\r\nimport { translationFormatter } from \"../../utils/translationFormatter\";\r\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\r\nimport { ListEmptyState } from \"@keycloak/keycloak-ui-shared\";\r\nimport { Action, KeycloakDataTable } from \"@keycloak/keycloak-ui-shared\";\r\n\r\nimport \"./RolesList.css\";\r\n\r\ntype RoleDetailLinkProps = RoleRepresentation & {\r\n  defaultRoleName?: string;\r\n  toDetail: (roleId: string) => To;\r\n  messageBundle?: string;\r\n};\r\n\r\nconst RoleDetailLink = ({\r\n  defaultRoleName,\r\n  toDetail,\r\n  ...role\r\n}: RoleDetailLinkProps) => {\r\n  const { t } = useTranslation();\r\n  const { realm } = useRealm();\r\n  const { hasAccess, hasSomeAccess } = useAccess();\r\n  const canViewUserRegistration =\r\n    hasAccess(\"view-realm\") && hasSomeAccess(\"view-clients\", \"manage-clients\");\r\n\r\n  return role.name !== defaultRoleName ? (\r\n    <Link to={toDetail(role.id!)}>{role.name}</Link>\r\n  ) : (\r\n    <>\r\n      {canViewUserRegistration ? (\r\n        <Link to={toRealmSettings({ realm, tab: \"user-registration\" })}>\r\n          {role.name}\r\n        </Link>\r\n      ) : (\r\n        <span>{role.name}</span>\r\n      )}{\" \"}\r\n      <HelpItem helpText={t(\"defaultRole\")} fieldLabelId=\"defaultRole\" />\r\n    </>\r\n  );\r\n};\r\n\r\ntype RolesListProps = {\r\n  paginated?: boolean;\r\n  parentRoleId?: string;\r\n  messageBundle?: string;\r\n  isReadOnly: boolean;\r\n  toCreate: To;\r\n  toDetail: (roleId: string) => To;\r\n  loader?: (\r\n    first?: number,\r\n    max?: number,\r\n    search?: string,\r\n  ) => Promise<RoleRepresentation[]>;\r\n};\r\n\r\nexport const RolesList = ({\r\n  loader,\r\n  paginated = true,\r\n  parentRoleId,\r\n  messageBundle = \"roles\",\r\n  toCreate,\r\n  toDetail,\r\n  isReadOnly,\r\n}: RolesListProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { addAlert, addError } = useAlerts();\r\n  const { realmRepresentation: realm } = useRealm();\r\n\r\n  const [selectedRole, setSelectedRole] = useState<RoleRepresentation>();\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"roleDeleteConfirm\",\r\n    messageKey: t(\"roleDeleteConfirmDialog\", {\r\n      selectedRoleName: selectedRole ? selectedRole!.name : \"\",\r\n    }),\r\n    continueButtonLabel: \"delete\",\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    onConfirm: async () => {\r\n      try {\r\n        if (!parentRoleId) {\r\n          await adminClient.roles.delById({\r\n            id: selectedRole!.id!,\r\n          });\r\n        } else {\r\n          await adminClient.roles.delCompositeRoles({ id: parentRoleId }, [\r\n            selectedRole!,\r\n          ]);\r\n        }\r\n        setSelectedRole(undefined);\r\n        addAlert(t(\"roleDeletedSuccess\"), AlertVariant.success);\r\n      } catch (error) {\r\n        addError(\"roleDeleteError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <DeleteConfirm />\r\n      <KeycloakDataTable\r\n        key={selectedRole ? selectedRole.id : \"roleList\"}\r\n        loader={loader!}\r\n        ariaLabelKey=\"roleList\"\r\n        searchPlaceholderKey=\"searchForRoles\"\r\n        isPaginated={paginated}\r\n        toolbarItem={\r\n          !isReadOnly && (\r\n            <Button\r\n              data-testid=\"create-role\"\r\n              component={(props) => <Link {...props} to={toCreate} />}\r\n            >\r\n              {t(\"createRole\")}\r\n            </Button>\r\n          )\r\n        }\r\n        actions={\r\n          isReadOnly\r\n            ? undefined\r\n            : [\r\n                {\r\n                  title: t(\"delete\"),\r\n                  onRowClick: (role) => {\r\n                    setSelectedRole(role);\r\n                    if (\r\n                      realm?.defaultRole &&\r\n                      role.name === realm!.defaultRole!.name\r\n                    ) {\r\n                      addAlert(\r\n                        t(\"defaultRoleDeleteError\"),\r\n                        AlertVariant.danger,\r\n                      );\r\n                    } else toggleDeleteDialog();\r\n                  },\r\n                } as Action<RoleRepresentation>,\r\n              ]\r\n        }\r\n        columns={[\r\n          {\r\n            name: \"name\",\r\n            displayKey: \"roleName\",\r\n            cellRenderer: (row) => (\r\n              <RoleDetailLink\r\n                {...row}\r\n                defaultRoleName={realm?.defaultRole?.name}\r\n                toDetail={toDetail}\r\n                messageBundle={messageBundle}\r\n              />\r\n            ),\r\n          },\r\n          {\r\n            name: \"composite\",\r\n            displayKey: \"composite\",\r\n            cellFormatters: [upperCaseFormatter(), emptyFormatter()],\r\n          },\r\n          {\r\n            name: \"description\",\r\n            cellFormatters: [translationFormatter(t)],\r\n          },\r\n        ]}\r\n        emptyState={\r\n          <ListEmptyState\r\n            hasIcon={true}\r\n            message={t(`noRoles-${messageBundle}`)}\r\n            instructions={\r\n              isReadOnly ? \"\" : t(`noRolesInstructions-${messageBundle}`)\r\n            }\r\n            primaryActionText={isReadOnly ? \"\" : t(\"createRole\")}\r\n            onPrimaryAction={() => navigate(toCreate)}\r\n          />\r\n        }\r\n      />\r\n    </>\r\n  );\r\n};\r\n"],"names":["RoleDetailLink","defaultRoleName","toDetail","role","t","useTranslation","realm","useRealm","hasAccess","hasSomeAccess","useAccess","canViewUserRegistration","jsx","Link","jsxs","Fragment","toRealmSettings","HelpItem","RolesList","loader","paginated","parentRoleId","messageBundle","toCreate","isReadOnly","adminClient","useAdminClient","navigate","useNavigate","addAlert","addError","useAlerts","selectedRole","setSelectedRole","useState","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","AlertVariant","error","KeycloakDataTable","Button","props","row","upperCaseFormatter","emptyFormatter","translationFormatter","ListEmptyState"],"mappings":"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"}