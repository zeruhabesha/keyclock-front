{"version":3,"file":"AddIdentityProvider-Cs4I_w8G.js","sources":["../../../../../../../src/identity-providers/add/AddIdentityProvider.tsx"],"sourcesContent":["import type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { useMemo } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { DynamicComponents } from \"../../components/dynamic/DynamicComponents\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\r\nimport { toUpperCase } from \"../../util\";\r\nimport { useParams } from \"../../utils/useParams\";\r\nimport { toIdentityProvider } from \"../routes/IdentityProvider\";\r\nimport type { IdentityProviderCreateParams } from \"../routes/IdentityProviderCreate\";\r\nimport { toIdentityProviders } from \"../routes/IdentityProviders\";\r\nimport { GeneralSettings } from \"./GeneralSettings\";\r\n\r\nexport default function AddIdentityProvider() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { providerId } = useParams<IdentityProviderCreateParams>();\r\n  const form = useForm<IdentityProviderRepresentation>({ mode: \"onChange\" });\r\n  const serverInfo = useServerInfo();\r\n\r\n  const providerInfo = useMemo(() => {\r\n    const namespaces = [\r\n      \"org.keycloak.broker.social.SocialIdentityProvider\",\r\n      \"org.keycloak.broker.provider.IdentityProvider\",\r\n    ];\r\n\r\n    for (const namespace of namespaces) {\r\n      const social = serverInfo.componentTypes?.[namespace]?.find(\r\n        ({ id }) => id === providerId,\r\n      );\r\n\r\n      if (social) {\r\n        return social;\r\n      }\r\n    }\r\n  }, [serverInfo, providerId]);\r\n\r\n  const {\r\n    handleSubmit,\r\n    formState: { isValid },\r\n  } = form;\r\n\r\n  const { addAlert, addError } = useAlerts();\r\n  const navigate = useNavigate();\r\n  const { realm } = useRealm();\r\n\r\n  const onSubmit = async (provider: IdentityProviderRepresentation) => {\r\n    try {\r\n      await adminClient.identityProviders.create({\r\n        ...provider,\r\n        providerId,\r\n        alias: provider.alias!,\r\n      });\r\n      addAlert(t(\"createIdentityProviderSuccess\"), AlertVariant.success);\r\n      navigate(\r\n        toIdentityProvider({\r\n          realm,\r\n          providerId,\r\n          alias: provider.alias!,\r\n          tab: \"settings\",\r\n        }),\r\n      );\r\n    } catch (error) {\r\n      addError(\"createError\", error);\r\n    }\r\n  };\r\n\r\n  const alias = form.getValues(\"alias\");\r\n\r\n  if (!alias) {\r\n    form.setValue(\"alias\", providerId);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader\r\n        titleKey={t(\"addIdentityProvider\", {\r\n          provider: toUpperCase(providerId),\r\n        })}\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <FormAccess\r\n          role=\"manage-identity-providers\"\r\n          isHorizontal\r\n          onSubmit={handleSubmit(onSubmit)}\r\n        >\r\n          <FormProvider {...form}>\r\n            <GeneralSettings id={providerId} />\r\n            {providerInfo && (\r\n              <DynamicComponents\r\n                stringify\r\n                properties={providerInfo.properties}\r\n              />\r\n            )}\r\n          </FormProvider>\r\n          <ActionGroup>\r\n            <Button\r\n              isDisabled={!isValid}\r\n              variant=\"primary\"\r\n              type=\"submit\"\r\n              data-testid=\"createProvider\"\r\n            >\r\n              {t(\"add\")}\r\n            </Button>\r\n            <Button\r\n              variant=\"link\"\r\n              data-testid=\"cancel\"\r\n              component={(props) => (\r\n                <Link {...props} to={toIdentityProviders({ realm })} />\r\n              )}\r\n            >\r\n              {t(\"cancel\")}\r\n            </Button>\r\n          </ActionGroup>\r\n        </FormAccess>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["AddIdentityProvider","adminClient","useAdminClient","t","useTranslation","providerId","useParams","form","useForm","serverInfo","useServerInfo","providerInfo","useMemo","namespaces","namespace","social","id","handleSubmit","isValid","addAlert","addError","useAlerts","navigate","useNavigate","realm","useRealm","onSubmit","provider","AlertVariant","toIdentityProvider","error","jsxs","Fragment","jsx","ViewHeader","toUpperCase","PageSection","FormAccess","FormProvider","GeneralSettings","DynamicComponents","ActionGroup","Button","props","Link","toIdentityProviders"],"mappings":"s9BAyBA,SAAwBA,IAAsB,CAC5C,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CAAE,WAAAC,CAAA,EAAeC,EAAA,EACjBC,EAAOC,EAAwC,CAAE,KAAM,WAAY,EACnEC,EAAaC,EAAA,EAEbC,EAAeC,EAAQ,IAAM,CACjC,MAAMC,EAAa,CACjB,oDACA,+CAAA,EAGF,UAAWC,KAAaD,EAAY,CAClC,MAAME,EAASN,EAAW,iBAAiBK,CAAS,GAAG,KACrD,CAAC,CAAE,GAAAE,CAAA,IAASA,IAAOX,CAAA,EAGrB,GAAIU,EACF,OAAOA,CAEX,CACF,EAAG,CAACN,EAAYJ,CAAU,CAAC,EAErB,CACJ,aAAAY,EACA,UAAW,CAAE,QAAAC,CAAA,CAAQ,EACnBX,EAEE,CAAE,SAAAY,EAAU,SAAAC,CAAA,EAAaC,EAAA,EACzBC,EAAWC,EAAA,EACX,CAAE,MAAAC,CAAA,EAAUC,EAAA,EAEZC,EAAW,MAAOC,GAA6C,CACnE,GAAI,CACF,MAAM1B,EAAY,kBAAkB,OAAO,CACzC,GAAG0B,EACH,WAAAtB,EACA,MAAOsB,EAAS,KAAA,CACjB,EACDR,EAAShB,EAAE,+BAA+B,EAAGyB,EAAa,OAAO,EACjEN,EACEO,EAAmB,CACjB,MAAAL,EACA,WAAAnB,EACA,MAAOsB,EAAS,MAChB,IAAK,UAAA,CACN,CAAA,CAEL,OAASG,EAAO,CACdV,EAAS,cAAeU,CAAK,CAC/B,CACF,EAIA,OAFcvB,EAAK,UAAU,OAAO,GAGlCA,EAAK,SAAS,QAASF,CAAU,EAIjC0B,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CACC,SAAU/B,EAAE,sBAAuB,CACjC,SAAUgC,EAAY9B,CAAU,CAAA,CACjC,CAAA,CAAA,EAEH4B,EAACG,EAAA,CAAY,QAAQ,QACnB,SAAAL,EAACM,EAAA,CACC,KAAK,4BACL,aAAY,GACZ,SAAUpB,EAAaS,CAAQ,EAE/B,SAAA,CAAAK,EAACO,EAAA,CAAc,GAAG/B,EAChB,SAAA,CAAA0B,EAACM,EAAA,CAAgB,GAAIlC,CAAA,CAAY,EAChCM,GACCsB,EAACO,EAAA,CACC,UAAS,GACT,WAAY7B,EAAa,UAAA,CAAA,CAC3B,EAEJ,IACC8B,EAAA,CACC,SAAA,CAAAR,EAACS,EAAA,CACC,WAAY,CAACxB,EACb,QAAQ,UACR,KAAK,SACL,cAAY,iBAEX,WAAE,KAAK,CAAA,CAAA,EAEVe,EAACS,EAAA,CACC,QAAQ,OACR,cAAY,SACZ,UAAYC,GACVV,EAACW,EAAA,CAAM,GAAGD,EAAO,GAAIE,EAAoB,CAAE,MAAArB,CAAA,CAAO,CAAA,CAAG,EAGtD,WAAE,QAAQ,CAAA,CAAA,CACb,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CACF,CAAA,EACF,CAEJ"}