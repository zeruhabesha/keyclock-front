{"version":3,"file":"RoutableTabs-DyhWhd6v.js","sources":["../../../../../../../src/components/routable-tabs/RoutableTabs.tsx"],"sourcesContent":["import {\r\n  Tab,\r\n  TabProps,\r\n  Tabs,\r\n  TabsComponent,\r\n  TabsProps,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  Children,\r\n  JSXElementConstructor,\r\n  PropsWithChildren,\r\n  ReactElement,\r\n  isValidElement,\r\n} from \"react\";\r\nimport {\r\n  Path,\r\n  generatePath,\r\n  matchPath,\r\n  useHref,\r\n  useLocation,\r\n  useParams,\r\n} from \"react-router-dom\";\r\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\r\nimport { PageHandler } from \"../../page/PageHandler\";\r\nimport { TAB_PROVIDER } from \"../../page/constants\";\r\nimport useIsFeatureEnabled, { Feature } from \"../../utils/useIsFeatureEnabled\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\n// TODO: Remove the custom 'children' props and type once the following issue has been resolved:\r\n// https://github.com/patternfly/patternfly-react/issues/6766\r\ntype ChildElement = ReactElement<TabProps, JSXElementConstructor<TabProps>>;\r\ntype Child = ChildElement | boolean | null | undefined;\r\n\r\n// TODO: Figure out why we need to omit 'ref' from the props.\r\ntype RoutableTabsProps = {\r\n  children: Child | Child[];\r\n  defaultLocation?: Partial<Path>;\r\n} & Omit<\r\n  TabsProps,\r\n  \"ref\" | \"activeKey\" | \"defaultActiveKey\" | \"component\" | \"children\"\r\n>;\r\n\r\nexport const RoutableTabs = ({\r\n  children,\r\n  defaultLocation,\r\n  ...otherProps\r\n}: RoutableTabsProps) => {\r\n  const { pathname } = useLocation();\r\n  const params = useParams();\r\n  const { componentTypes } = useServerInfo();\r\n  const tabs = componentTypes?.[TAB_PROVIDER] || [];\r\n  const isFeatureEnabled = useIsFeatureEnabled();\r\n  const { t } = useTranslation();\r\n\r\n  const matchedTabs = tabs\r\n    .filter((tab) => matchPath({ path: tab.metadata.path }, pathname))\r\n    .map((t) => ({\r\n      ...t,\r\n      pathname: generatePath(t.metadata.path, {\r\n        ...params,\r\n        ...t.metadata.params,\r\n      }),\r\n    }));\r\n  // Extract all keys from matchedTabs\r\n  const matchedTabsKeys = matchedTabs.map((t) => t.pathname);\r\n\r\n  // Extract event keys from children\r\n  const eventKeys = Children.toArray(children)\r\n    .filter((child): child is ChildElement => isValidElement(child))\r\n    .map((child) => child.props.eventKey.toString());\r\n\r\n  const allKeys = [...eventKeys, ...matchedTabsKeys];\r\n\r\n  // Determine if there is an exact match.\r\n  const exactMatch = allKeys.find(\r\n    (eventKey) => eventKey === decodeURI(pathname),\r\n  );\r\n\r\n  // Determine which event keys at least partially match the current path, then sort them so the nearest match ends up on top.\r\n  const nearestMatch = eventKeys\r\n    .filter((eventKey) => pathname.includes(eventKey))\r\n    .sort((a, b) => a.length - b.length)\r\n    .pop();\r\n\r\n  return (\r\n    <Tabs\r\n      activeKey={\r\n        exactMatch ?? nearestMatch ?? defaultLocation?.pathname ?? pathname\r\n      }\r\n      component={TabsComponent.nav}\r\n      inset={{\r\n        default: \"insetNone\",\r\n        xl: \"insetLg\",\r\n        \"2xl\": \"inset2xl\",\r\n      }}\r\n      unmountOnExit\r\n      mountOnEnter\r\n      {...otherProps}\r\n    >\r\n      {children as any}\r\n      {isFeatureEnabled(Feature.DeclarativeUI) &&\r\n        matchedTabs.map<any>((tab) => (\r\n          <DynamicTab key={tab.id} eventKey={tab.pathname} title={t(tab.id)}>\r\n            <PageHandler page={tab} providerType={TAB_PROVIDER} />\r\n          </DynamicTab>\r\n        ))}\r\n    </Tabs>\r\n  );\r\n};\r\n\r\ntype DynamicTabProps = {\r\n  title: string;\r\n  eventKey: string;\r\n};\r\n\r\nconst DynamicTab = ({\r\n  children,\r\n  ...props\r\n}: PropsWithChildren<DynamicTabProps>) => {\r\n  const href = useHref(props.eventKey);\r\n\r\n  return (\r\n    <Tab href={href} {...props}>\r\n      {children}\r\n    </Tab>\r\n  );\r\n};\r\n\r\nexport const useRoutableTab = (to: Partial<Path>) => ({\r\n  eventKey: to.pathname ?? \"\",\r\n  href: useHref(to),\r\n});\r\n"],"names":["RoutableTabs","children","defaultLocation","otherProps","pathname","useLocation","params","useParams","componentTypes","useServerInfo","tabs","TAB_PROVIDER","isFeatureEnabled","useIsFeatureEnabled","t","useTranslation","matchedTabs","tab","matchPath","generatePath","matchedTabsKeys","eventKeys","Children","child","isValidElement","exactMatch","eventKey","nearestMatch","a","jsxs","Tabs","TabsComponent","Feature","jsx","DynamicTab","PageHandler","props","href","useHref","Tab","useRoutableTab","to"],"mappings":"2VA0CO,MAAMA,EAAe,CAAC,CAC3B,SAAAC,EACA,gBAAAC,EACA,GAAGC,CACL,IAAyB,CACvB,KAAM,CAAE,SAAAC,CAAA,EAAaC,EAAA,EACfC,EAASC,EAAA,EACT,CAAE,eAAAC,CAAA,EAAmBC,EAAA,EACrBC,EAAOF,IAAiBG,CAAY,GAAK,CAAA,EACzCC,EAAmBC,EAAA,EACnB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EAERC,EAAcN,EACjB,OAAQO,GAAQC,EAAU,CAAE,KAAMD,EAAI,SAAS,MAAQb,CAAQ,CAAC,EAChE,IAAKU,IAAO,CACX,GAAGA,EACH,SAAUK,EAAaL,EAAE,SAAS,KAAM,CACtC,GAAGR,EACH,GAAGQ,EAAE,SAAS,MAAA,CACf,CAAA,EACD,EAEEM,EAAkBJ,EAAY,IAAKF,GAAMA,EAAE,QAAQ,EAGnDO,EAAYC,EAAS,QAAQrB,CAAQ,EACxC,OAAQsB,GAAiCC,EAAeD,CAAK,CAAC,EAC9D,IAAKA,GAAUA,EAAM,MAAM,SAAS,UAAU,EAK3CE,EAHU,CAAC,GAAGJ,EAAW,GAAGD,CAAe,EAGtB,KACxBM,GAAaA,IAAa,UAAUtB,CAAQ,CAAA,EAIzCuB,EAAeN,EAClB,OAAQK,GAAatB,EAAS,SAASsB,CAAQ,CAAC,EAChD,KAAK,CAACE,EAAG,IAAMA,EAAE,OAAS,EAAE,MAAM,EAClC,IAAA,EAEH,OACEC,EAACC,EAAA,CACC,UACEL,GAAcE,GAAgBzB,GAAiB,UAAYE,EAE7D,UAAW2B,EAAc,IACzB,MAAO,CACL,QAAS,YACT,GAAI,UACJ,MAAO,UAAA,EAET,cAAa,GACb,aAAY,GACX,GAAG5B,EAEH,SAAA,CAAAF,EACAW,EAAiBoB,EAAQ,aAAa,GACrChB,EAAY,IAAUC,GACpBgB,EAACC,EAAA,CAAwB,SAAUjB,EAAI,SAAU,MAAOH,EAAEG,EAAI,EAAE,EAC9D,SAAAgB,EAACE,EAAA,CAAY,KAAMlB,EAAK,aAAcN,CAAA,CAAc,CAAA,EADrCM,EAAI,EAErB,CACD,CAAA,CAAA,CAAA,CAGT,EAOMiB,EAAa,CAAC,CAClB,SAAAjC,EACA,GAAGmC,CACL,IAA0C,CACxC,MAAMC,EAAOC,EAAQF,EAAM,QAAQ,EAEnC,OACEH,EAACM,EAAA,CAAI,KAAAF,EAAa,GAAGD,EAClB,SAAAnC,EACH,CAEJ,EAEauC,EAAkBC,IAAuB,CACpD,SAAUA,EAAG,UAAY,GACzB,KAAMH,EAAQG,CAAE,CAClB"}