{"version":3,"file":"CopyToClipboardButton-Cl576S4v.js","sources":["../../../../../../../src/utils/useQueryPermission.ts","../../../../../../../src/components/copy-to-clipboard-button/CopyToClipboardButton.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\n\r\n/** A 'plain' object version of the permission status. */\r\nexport type PlainPermissionStatus = {\r\n  readonly name: string;\r\n  readonly state: PermissionState;\r\n};\r\n\r\nexport default function useQueryPermission(\r\n  name: PermissionName,\r\n): PlainPermissionStatus | null {\r\n  const [status, setStatus] = useState<PermissionStatus | null>(null);\r\n  const [plainStatus, setPlainStatus] = useState<PlainPermissionStatus | null>(\r\n    null,\r\n  );\r\n\r\n  function updatePlainStatus(newStatus: PermissionStatus) {\r\n    setPlainStatus({\r\n      name: newStatus.name,\r\n      state: newStatus.state,\r\n    });\r\n  }\r\n\r\n  // Query the permission status when the name changes.\r\n  useEffect(() => {\r\n    setStatus(null);\r\n    setPlainStatus(null);\r\n\r\n    void navigator.permissions.query({ name }).then((newStatus) => {\r\n      setStatus(newStatus);\r\n      updatePlainStatus(newStatus);\r\n    });\r\n  }, [name]);\r\n\r\n  // Update the 'plain' status when the permission status changes.\r\n  useEffect(() => {\r\n    if (!status) {\r\n      return;\r\n    }\r\n\r\n    function onStatusChange() {\r\n      if (!status) {\r\n        return;\r\n      }\r\n\r\n      updatePlainStatus(status);\r\n    }\r\n\r\n    status.addEventListener(\"change\", onStatusChange);\r\n    return () => status.removeEventListener(\"change\", onStatusChange);\r\n  }, [status]);\r\n\r\n  return plainStatus;\r\n}\r\n","import { useSetTimeout } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ClipboardCopyButton,\r\n  ClipboardCopyButtonProps,\r\n} from \"@patternfly/react-core\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport useQueryPermission from \"../../utils/useQueryPermission\";\r\n\r\nenum CopyState {\r\n  Ready,\r\n  Copied,\r\n  Error,\r\n}\r\n\r\ntype CopyToClipboardButtonProps = Pick<ClipboardCopyButtonProps, \"variant\"> & {\r\n  id: string;\r\n  label: string;\r\n  text: string;\r\n};\r\n\r\nexport const CopyToClipboardButton = ({\r\n  id,\r\n  label,\r\n  text,\r\n  variant = \"plain\",\r\n}: CopyToClipboardButtonProps) => {\r\n  const { t } = useTranslation();\r\n  const setTimeout = useSetTimeout();\r\n  const permission = useQueryPermission(\"clipboard-write\" as PermissionName);\r\n  const permissionDenied = permission?.state === \"denied\";\r\n  const [copyState, setCopyState] = useState(CopyState.Ready);\r\n\r\n  // Determine the message to use for the copy button.\r\n  const copyMessageKey = useMemo(() => {\r\n    if (permissionDenied) {\r\n      return \"clipboardCopyDenied\";\r\n    }\r\n\r\n    switch (copyState) {\r\n      case CopyState.Ready:\r\n        return \"copyToClipboard\";\r\n      case CopyState.Copied:\r\n        return \"copySuccess\";\r\n      case CopyState.Error:\r\n        return \"clipboardCopyError\";\r\n    }\r\n  }, [permissionDenied, copyState]);\r\n\r\n  // Reset the message of the copy button after copying to the clipboard.\r\n  useEffect(() => {\r\n    if (copyState !== CopyState.Ready) {\r\n      return setTimeout(() => setCopyState(CopyState.Ready), 1000);\r\n    }\r\n  }, [copyState, setTimeout]);\r\n\r\n  const copyToClipboard = async (text: string) => {\r\n    try {\r\n      await navigator.clipboard.writeText(text);\r\n      setCopyState(CopyState.Copied);\r\n    } catch {\r\n      setCopyState(CopyState.Error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ClipboardCopyButton\r\n      id={`copy-button-${id}`}\r\n      textId={label}\r\n      aria-label={t(\"copyToClipboard\")}\r\n      onClick={() => copyToClipboard(text)}\r\n      exitDelay={600}\r\n      variant={variant}\r\n    >\r\n      {t(copyMessageKey)}\r\n    </ClipboardCopyButton>\r\n  );\r\n};\r\n"],"names":["useQueryPermission","name","status","setStatus","useState","plainStatus","setPlainStatus","updatePlainStatus","newStatus","useEffect","onStatusChange","CopyToClipboardButton","id","label","text","variant","t","useTranslation","setTimeout","useSetTimeout","permissionDenied","copyState","setCopyState","copyMessageKey","useMemo","copyToClipboard","jsx","ClipboardCopyButton"],"mappings":"iMAQA,SAAwBA,EACtBC,EAC8B,CAC9B,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAkC,IAAI,EAC5D,CAACC,EAAaC,CAAc,EAAIF,EACpC,IAAA,EAGF,SAASG,EAAkBC,EAA6B,CACtDF,EAAe,CACb,KAAME,EAAU,KAChB,MAAOA,EAAU,KAAA,CAClB,CACH,CAGA,OAAAC,EAAU,IAAM,CACdN,EAAU,IAAI,EACdG,EAAe,IAAI,EAEd,UAAU,YAAY,MAAM,CAAE,KAAAL,EAAM,EAAE,KAAMO,GAAc,CAC7DL,EAAUK,CAAS,EACnBD,EAAkBC,CAAS,CAC7B,CAAC,CACH,EAAG,CAACP,CAAI,CAAC,EAGTQ,EAAU,IAAM,CACd,GAAI,CAACP,EACH,OAGF,SAASQ,GAAiB,CACnBR,GAILK,EAAkBL,CAAM,CAC1B,CAEA,OAAAA,EAAO,iBAAiB,SAAUQ,CAAc,EACzC,IAAMR,EAAO,oBAAoB,SAAUQ,CAAc,CAClE,EAAG,CAACR,CAAM,CAAC,EAEJG,CACT,CC/BO,MAAMM,EAAwB,CAAC,CACpC,GAAAC,EACA,MAAAC,EACA,KAAAC,EACA,QAAAC,EAAU,OACZ,IAAkC,CAChC,KAAM,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACRC,EAAaC,EAAA,EAEbC,EADapB,EAAmB,iBAAmC,GACpC,QAAU,SACzC,CAACqB,EAAWC,CAAY,EAAIlB,EAAS,CAAA,EAGrCmB,EAAiBC,EAAQ,IAAM,CACnC,GAAIJ,EACF,MAAO,sBAGT,OAAQC,EAAA,CACN,IAAK,GACH,MAAO,kBACT,IAAK,GACH,MAAO,cACT,IAAK,GACH,MAAO,oBAAA,CAEb,EAAG,CAACD,EAAkBC,CAAS,CAAC,EAGhCZ,EAAU,IAAM,CACd,GAAIY,IAAc,EAChB,OAAOH,EAAW,IAAMI,EAAa,CAAA,EAAkB,GAAI,CAE/D,EAAG,CAACD,EAAWH,CAAU,CAAC,EAE1B,MAAMO,EAAkB,MAAOX,GAAiB,CAC9C,GAAI,CACF,MAAM,UAAU,UAAU,UAAUA,CAAI,EACxCQ,EAAa,CAAA,CACf,MAAQ,CACNA,EAAa,CAAA,CACf,CACF,EAEA,OACEI,EAACC,EAAA,CACC,GAAI,eAAef,CAAE,GACrB,OAAQC,EACR,aAAYG,EAAE,iBAAiB,EAC/B,QAAS,IAAMS,EAAgBX,CAAI,EACnC,UAAW,IACX,QAAAC,EAEC,WAAEQ,CAAc,CAAA,CAAA,CAGvB"}