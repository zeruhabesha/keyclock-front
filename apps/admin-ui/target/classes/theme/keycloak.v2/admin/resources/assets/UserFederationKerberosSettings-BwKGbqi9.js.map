{"version":3,"file":"UserFederationKerberosSettings-BwKGbqi9.js","sources":["../../../../../../../src/user-federation/kerberos/KerberosSettingsRequired.tsx","../../../../../../../src/user-federation/UserFederationKerberosSettings.tsx"],"sourcesContent":["import {\r\n  HelpItem,\r\n  SelectControl,\r\n  TextControl,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { FormGroup, Switch } from \"@patternfly/react-core\";\r\nimport { isEqual } from \"lodash-es\";\r\nimport { useEffect } from \"react\";\r\nimport {\r\n  Controller,\r\n  FormProvider,\r\n  UseFormReturn,\r\n  useWatch,\r\n} from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { WizardSectionHeader } from \"../../components/wizard-section-header/WizardSectionHeader\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\n\r\nexport type KerberosSettingsRequiredProps = {\r\n  form: UseFormReturn;\r\n  showSectionHeading?: boolean;\r\n  showSectionDescription?: boolean;\r\n};\r\n\r\nexport const KerberosSettingsRequired = ({\r\n  form,\r\n  showSectionHeading = false,\r\n  showSectionDescription = false,\r\n}: KerberosSettingsRequiredProps) => {\r\n  const { t } = useTranslation();\r\n  const { realm, realmRepresentation } = useRealm();\r\n\r\n  const allowPassAuth = useWatch({\r\n    control: form.control,\r\n    name: \"config.allowPasswordAuthentication\",\r\n  });\r\n\r\n  useEffect(() => form.setValue(\"parentId\", realmRepresentation?.id), []);\r\n\r\n  return (\r\n    <FormProvider {...form}>\r\n      {showSectionHeading && (\r\n        <WizardSectionHeader\r\n          title={t(\"requiredSettings\")}\r\n          description={t(\"kerberosRequiredSettingsDescription\")}\r\n          showDescription={showSectionDescription}\r\n        />\r\n      )}\r\n\r\n      {/* Required settings */}\r\n      <FormAccess role=\"manage-realm\" isHorizontal>\r\n        {/* These hidden fields are required so data object written back matches data retrieved */}\r\n        <input\r\n          type=\"hidden\"\r\n          defaultValue=\"kerberos\"\r\n          {...form.register(\"providerId\")}\r\n        />\r\n        <input\r\n          type=\"hidden\"\r\n          defaultValue=\"org.keycloak.storage.UserStorageProvider\"\r\n          {...form.register(\"providerType\")}\r\n        />\r\n        <input\r\n          type=\"hidden\"\r\n          defaultValue={realm}\r\n          {...form.register(\"parentId\")}\r\n        />\r\n        <TextControl\r\n          name=\"name\"\r\n          label={t(\"uiDisplayName\")}\r\n          labelIcon={t(\"uiDisplayNameHelp\")}\r\n          rules={{\r\n            required: t(\"validateName\"),\r\n          }}\r\n        />\r\n        <TextControl\r\n          name=\"config.kerberosRealm.0\"\r\n          label={t(\"kerberosRealm\")}\r\n          labelIcon={t(\"kerberosRealmHelp\")}\r\n          rules={{\r\n            required: t(\"validateRealm\"),\r\n          }}\r\n        />\r\n        <TextControl\r\n          name=\"config.serverPrincipal.0\"\r\n          label={t(\"serverPrincipal\")}\r\n          labelIcon={t(\"serverPrincipalHelp\")}\r\n          rules={{\r\n            required: t(\"validateServerPrincipal\"),\r\n          }}\r\n        />\r\n        <TextControl\r\n          name=\"config.keyTab.0\"\r\n          label={t(\"keyTab\")}\r\n          labelIcon={t(\"keyTabHelp\")}\r\n          rules={{\r\n            required: t(\"validateKeyTab\"),\r\n          }}\r\n        />\r\n        <FormGroup\r\n          label={t(\"debug\")}\r\n          labelIcon={\r\n            <HelpItem helpText={t(\"debugHelp\")} fieldLabelId=\"debug\" />\r\n          }\r\n          fieldId=\"kc-debug\"\r\n          hasNoPaddingTop\r\n        >\r\n          <Controller\r\n            name=\"config.debug\"\r\n            defaultValue={[\"false\"]}\r\n            control={form.control}\r\n            render={({ field }) => (\r\n              <Switch\r\n                id={\"kc-debug\"}\r\n                data-testid=\"debug\"\r\n                onChange={(_event, value) => field.onChange([`${value}`])}\r\n                isChecked={field.value?.[0] === \"true\"}\r\n                label={t(\"on\")}\r\n                labelOff={t(\"off\")}\r\n                aria-label={t(\"debug\")}\r\n              />\r\n            )}\r\n          />\r\n        </FormGroup>\r\n        <FormGroup\r\n          label={t(\"allowPasswordAuthentication\")}\r\n          labelIcon={\r\n            <HelpItem\r\n              helpText={t(\"allowPasswordAuthenticationHelp\")}\r\n              fieldLabelId=\"allowPasswordAuthentication\"\r\n            />\r\n          }\r\n          fieldId=\"kc-allow-password-authentication\"\r\n          hasNoPaddingTop\r\n        >\r\n          <Controller\r\n            name=\"config.allowPasswordAuthentication\"\r\n            defaultValue={[\"false\"]}\r\n            control={form.control}\r\n            render={({ field }) => (\r\n              <Switch\r\n                id={\"kc-allow-password-authentication\"}\r\n                data-testid=\"allow-password-authentication\"\r\n                onChange={(_event, value) => field.onChange([`${value}`])}\r\n                isChecked={field.value?.[0] === \"true\"}\r\n                label={t(\"on\")}\r\n                labelOff={t(\"off\")}\r\n                aria-label={t(\"allowPasswordAuthentication\")}\r\n              />\r\n            )}\r\n          />\r\n        </FormGroup>\r\n        {isEqual(allowPassAuth, [\"true\"]) ? (\r\n          <SelectControl\r\n            name=\"config.editMode[0]\"\r\n            label={t(\"editMode\")}\r\n            labelIcon={t(\"editModeKerberosHelp\")}\r\n            controller={{\r\n              rules: { required: t(\"required\") },\r\n              defaultValue: \"READ_ONLY\",\r\n            }}\r\n            options={[\"READ_ONLY\", \"UNSYNCED\"]}\r\n          />\r\n        ) : null}\r\n        <FormGroup\r\n          label={t(\"updateFirstLogin\")}\r\n          labelIcon={\r\n            <HelpItem\r\n              helpText={t(\"updateFirstLoginHelp\")}\r\n              fieldLabelId=\"updateFirstLogin\"\r\n            />\r\n          }\r\n          fieldId=\"kc-update-first-login\"\r\n          hasNoPaddingTop\r\n        >\r\n          <Controller\r\n            name=\"config.updateProfileFirstLogin\"\r\n            defaultValue={[\"false\"]}\r\n            control={form.control}\r\n            render={({ field }) => (\r\n              <Switch\r\n                id={\"kc-update-first-login\"}\r\n                data-testid=\"update-first-login\"\r\n                onChange={(_event, value) => field.onChange([`${value}`])}\r\n                isChecked={field.value?.[0] === \"true\"}\r\n                label={t(\"on\")}\r\n                labelOff={t(\"off\")}\r\n                aria-label={t(\"updateFirstLogin\")}\r\n              />\r\n            )}\r\n          />\r\n        </FormGroup>\r\n      </FormAccess>\r\n    </FormProvider>\r\n  );\r\n};\r\n","import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport { useAlerts, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  Form,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport { useParams } from \"../utils/useParams\";\r\nimport { KerberosSettingsRequired } from \"./kerberos/KerberosSettingsRequired\";\r\nimport { toUserFederation } from \"./routes/UserFederation\";\r\nimport { Header } from \"./shared/Header\";\r\nimport { SettingsCache } from \"./shared/SettingsCache\";\r\n\r\nexport default function UserFederationKerberosSettings() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const form = useForm<ComponentRepresentation>({ mode: \"onChange\" });\r\n  const navigate = useNavigate();\r\n  const { realm } = useRealm();\r\n\r\n  const { id } = useParams<{ id?: string }>();\r\n\r\n  const { addAlert, addError } = useAlerts();\r\n\r\n  useFetch(\r\n    async () => {\r\n      if (id) {\r\n        return adminClient.components.findOne({ id });\r\n      }\r\n    },\r\n    (fetchedComponent) => {\r\n      if (fetchedComponent) {\r\n        setupForm(fetchedComponent);\r\n      } else if (id) {\r\n        throw new Error(t(\"notFound\"));\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  const setupForm = (component: ComponentRepresentation) => {\r\n    form.reset({ ...component });\r\n  };\r\n\r\n  const save = async (component: ComponentRepresentation) => {\r\n    try {\r\n      if (!id) {\r\n        await adminClient.components.create(component);\r\n        navigate(`/${realm}/user-federation`);\r\n      } else {\r\n        await adminClient.components.update({ id }, component);\r\n      }\r\n      setupForm(component as ComponentRepresentation);\r\n      addAlert(\r\n        t(!id ? \"createUserProviderSuccess\" : \"userProviderSaveSuccess\"),\r\n        AlertVariant.success,\r\n      );\r\n    } catch (error) {\r\n      addError(\r\n        !id ? \"createUserProviderError\" : \"userProviderSaveError\",\r\n        error,\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <FormProvider {...form}>\r\n      <Header provider=\"Kerberos\" save={() => form.handleSubmit(save)()} />\r\n      <PageSection variant=\"light\">\r\n        <KerberosSettingsRequired form={form} showSectionHeading />\r\n      </PageSection>\r\n      <PageSection variant=\"light\" isFilled>\r\n        <SettingsCache form={form} showSectionHeading />\r\n        <Form onSubmit={form.handleSubmit(save)}>\r\n          <ActionGroup>\r\n            <Button\r\n              isDisabled={!form.formState.isDirty}\r\n              variant=\"primary\"\r\n              type=\"submit\"\r\n              data-testid=\"kerberos-save\"\r\n            >\r\n              {t(\"save\")}\r\n            </Button>\r\n            <Button\r\n              variant=\"link\"\r\n              onClick={() => navigate(toUserFederation({ realm }))}\r\n              data-testid=\"kerberos-cancel\"\r\n            >\r\n              {t(\"cancel\")}\r\n            </Button>\r\n          </ActionGroup>\r\n        </Form>\r\n      </PageSection>\r\n    </FormProvider>\r\n  );\r\n}\r\n"],"names":["KerberosSettingsRequired","form","showSectionHeading","showSectionDescription","t","useTranslation","realm","realmRepresentation","useRealm","allowPassAuth","useWatch","useEffect","jsxs","FormProvider","jsx","WizardSectionHeader","FormAccess","TextControl","FormGroup","HelpItem","Controller","field","Switch","_event","value","isEqual","SelectControl","UserFederationKerberosSettings","adminClient","useAdminClient","useForm","navigate","useNavigate","id","useParams","addAlert","addError","useAlerts","useFetch","fetchedComponent","setupForm","component","save","AlertVariant","error","Header","PageSection","SettingsCache","Form","ActionGroup","Button","toUserFederation"],"mappings":"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"}