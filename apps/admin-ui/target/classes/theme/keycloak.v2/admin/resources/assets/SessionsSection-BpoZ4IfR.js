import{jsxs as S,jsx as e,Fragment as D}from"react/jsx-runtime";import{u as k,a as R,_ as T,d as L,j as x,M as E,k as I,H as U,F as q,O as V,a3 as M,g as v,B as P,o as d,ap as j,D as N,P as H,bm as K,C as G,bp as _,ak as A}from"./main-o1hptXRo.js";import{useState as y}from"react";import{u as $}from"./ConfirmDialog-BkU7melV.js";import{V as z}from"./ViewHeader-BDBsroi3.js";import{S as J}from"./SessionsTable-4N_7uyd-.js";import{F as Q}from"./filter-icon-DYNmdQ7O.js";import"react-dom";import"./useFormatDate-CuGjRZ4j.js";const W=({handleModalToggle:n,save:c})=>{const{adminClient:a}=k(),{t}=R(),{addAlert:s,addError:l}=T(),{realm:r,realmRepresentation:u,refresh:g}=L(),{register:m,handleSubmit:w}=x(),C=(o,p)=>{const i=o.successRequests?.length||0,h=o.failedRequests?.length||0;i===0&&h===0?s(t("noAdminUrlSet"),d.warning):h>0?(s(t(p+"Success",{successNodes:o.successRequests}),d.success),s(t(p+"Fail",{failedNodes:o.failedRequests}),d.danger)):s(t(p+"Success",{successNodes:o.successRequests}),d.success)},b=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:Date.now()/1e3}),s(t("notBeforeSuccess"),d.success)}catch(o){l("setToNowError",o)}},f=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:0}),s(t("notBeforeClearedSuccess"),d.success),g()}catch(o){l("notBeforeError",o)}},B=async()=>{const o=await a.realms.pushRevocation({realm:r});C(o,"notBeforePush"),g()};return S(E,{variant:I.small,title:t("revocation"),isOpen:!0,onClose:n,actions:[e(v,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:async()=>{await b(),n()},form:"revocation-modal-form",children:t("setToNow")},"set-to-now"),e(v,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:async()=>{await f(),n()},form:"revocation-modal-form",children:t("clear")},"clear"),e(v,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:async()=>{await B(),n()},form:"revocation-modal-form",children:t("push")},"push"),e(v,{id:"modal-cancel","data-testid":"cancel",variant:P.link,onClick:()=>{n()},children:t("cancel")},"cancel")],children:[e(U,{className:"kc-revocation-description-text",children:t("revocationDescription")}),e(q,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:w(c),children:e(V,{className:"kc-revocation-modal-form-group",label:t("notBefore"),name:"notBefore",fieldId:"not-before",children:e(M,{"data-testid":"not-before-input",autoFocus:!0,readOnly:!0,value:u?.notBefore===0?t("none"):new Date(u?.notBefore*1e3).toString(),type:"text",id:"not-before",...m("notBefore")})})})]})},X=({filterType:n,onChange:c})=>{const{t:a}=R(),[t,s]=G();return S(_,{"data-testid":"filter-session-type-select",isOpen:t,onToggle:s,toggleIcon:e(Q,{}),onSelect:l=>{c(l),s()},selections:n,children:[e(A,{"data-testid":"all-sessions-option",value:"ALL",children:a("sessionsType.allSessions")}),e(A,{"data-testid":"regular-sso-option",value:"REGULAR",children:a("sessionsType.regularSSO")}),e(A,{"data-testid":"offline-option",value:"OFFLINE",children:a("sessionsType.offline")})]})};function ie(){const{adminClient:n}=k(),{t:c}=R(),[a,t]=y(0),s=()=>t(a+1),{addError:l}=T(),{realm:r}=L(),[u,g]=y(!1),[m,w]=y("ALL"),[C,b]=y(!1),f=()=>{g(!u)},B=async(i,h,O)=>{const F=await K(n,"ui-ext/sessions",{first:`${i}`,max:`${h}`,type:m,search:O||""});return b(F.length===0),F},[o,p]=$({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.realms.logoutAll({realm:r}),s()}catch(i){l("logoutAllSessionsError",i)}}});return S(D,{children:[e(p,{}),e(z,{dropdownItems:[e(N,{"data-testid":"revocation",component:"button",onClick:()=>f(),children:c("revocation")},"toggle-modal"),e(N,{"data-testid":"logout-all",component:"button",isDisabled:C,onClick:o,children:c("signOutAllActiveSessions")},"delete-role")],titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:j.sessionsUrl}),S(H,{variant:"light",className:"pf-v5-u-p-0",children:[u&&e(W,{handleModalToggle:f,save:()=>{f()}}),e(J,{loader:B,isSearching:m!=="ALL",isPaginated:!0,filter:e(X,{filterType:m,onChange:i=>{w(i),s()}})},a)]})]})}export{ie as default};
//# sourceMappingURL=SessionsSection-BpoZ4IfR.js.map
