import{jsx as t,jsxs as g,Fragment as _}from"react/jsx-runtime";import{u as N,a as H,b as W,d as $,_ as q,am as z,aS as G,y as J,aT as m,B as Q,o as d,aU as X,p as Y,D as Z,P as b,aV as w,aW as ee,n as te}from"./main-o1hptXRo.js";import{useState as T}from"react";import{C as E,A as ae,c as oe}from"./ClientScopeTypes-D2w5c8Pp.js";import{u as ie}from"./ConfirmDialog-BkU7melV.js";import{R as ne}from"./RoleMapping-BOcI-Nkp.js";import{u,R as se}from"./RoutableTabs-DyhWhd6v.js";import{V as re}from"./ViewHeader-BDBsroi3.js";import{u as ce}from"./useParams-CGVhlaFZ.js";import{M as pe}from"./MapperList-Vu_yIY9K.js";import{S as le}from"./ScopeForm-BaMejMtZ.js";import{A as de}from"./AdminEvents-DIrkh5pf.js";import{a as S,b as f}from"./Tabs-DSwQhKoJ.js";import"react-dom";import"./translationFormatter-DQJeO7lr.js";import"./useLocaleSort-C-diWts5.js";import"./PageHandler-B1ed5nYb.js";import"./DynamicComponents-CnLlz98z.js";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./CodeEditor-C4IS5oxi.js";import"./constants-BclHbWtx.js";import"./utils-C-TUnOch.js";import"./SwitchControl-CU1bUhmR.js";import"./FormAccess-BnhQnYb9.js";import"./DropdownPanel-vRJu3PnV.js";import"./useFormatDate-CuGjRZ4j.js";import"./DatePicker-DiXxo4Fo.js";import"./pickBy-JGveacY0.js";import"./DescriptionListTerm-CNzJUZBE.js";function Ge(){const{adminClient:r}=N(),{t:o}=H(),y=W(),{realm:c,realmRepresentation:M}=$(),{id:i}=ce(),{addAlert:p,addError:l}=q(),{enabled:A}=z(),[n,D]=T(),[C,R]=T(0),v=()=>R(C+1),{hasAccess:x}=G();J(async()=>{const e=await r.clientScopes.findOne({id:i});if(!e)throw new Error(o("notFound"));return{...e,type:await O(e)}},e=>{D(e)},[C,i]);async function O(e){return(await r.clientScopes.listDefaultClientScopes()).find(h=>h.name===e.name)?E.default:(await r.clientScopes.listDefaultOptionalClientScopes()).find(h=>h.name===e.name)?E.optional:ae.none}const P=u(m({realm:c,id:i,tab:"settings"})),V=u(m({realm:c,id:i,tab:"mappers"})),I=u(m({realm:c,id:i,tab:"scope"})),B=u(m({realm:c,id:i,tab:"events"})),F=async e=>{const a=te({...e,name:e.name?.trim().replace(/ /g,"_")});try{await r.clientScopes.update({id:i},a),await oe(r,{...a,id:i},a.type),p(o("updateSuccessClientScope"),d.success)}catch(s){l("updateErrorClientScope",s)}},[K,L]=ie({titleKey:o("deleteClientScope",{count:1,name:n?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:Q.danger,onConfirm:async()=>{try{await r.clientScopes.del({id:i}),p(o("deletedSuccessClientScope"),d.success),y(X({realm:c}))}catch(e){l("deleteErrorClientScope",e)}}}),j=async e=>{try{const a=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await r.clientScopes.addRealmScopeMappings({id:i},a),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>r.clientScopes.addClientScopeMappings({id:i,client:s.client.id},[s.role]))),p(o("roleMappingUpdatedSuccess"),d.success)}catch(a){l("roleMappingUpdatedError",a)}},k=async e=>{if(Array.isArray(e))try{await r.clientScopes.addMultipleProtocolMappers({id:n.id},e),v(),p(o("mappingCreatedSuccess"),d.success)}catch(a){l("mappingCreatedError",a)}else{const a=e;y(w({realm:c,id:n.id,mapperId:a.id,viewMode:"new"}))}},U=async e=>{try{await r.clientScopes.delProtocolMapper({id:n.id,mapperId:e.id}),p(o("mappingDeletedSuccess"),d.success),v()}catch(a){l("mappingDeletedError",a)}return!0};return n?g(_,{children:[t(L,{}),t(re,{titleKey:n.name,dropdownItems:[t(Z,{onClick:K,children:o("delete")},"delete")],badges:[{text:n.protocol}],divider:!1}),t(b,{variant:"light",className:"pf-v5-u-p-0",children:g(se,{isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[t(S,{id:"settings","data-testid":"settings",title:t(f,{children:o("settings")}),...P,children:t(b,{variant:"light",children:t(le,{save:F,clientScope:n})})}),t(S,{id:"mappers","data-testid":"mappers",title:t(f,{children:o("mappers")}),...V,children:t(pe,{model:n,onAdd:k,onDelete:U,detailLink:e=>w({realm:c,id:n.id,mapperId:e,viewMode:"edit"})})}),g(S,{id:"scope","data-testid":"scopeTab",title:t(f,{children:o("scope")}),...I,children:[A&&t(b,{children:t(ee,{variant:"info",isInline:!0,title:o("clientScopesRolesScope"),component:"h2"})}),t(ne,{id:n.id,name:n.name,type:"clientScopes",save:j})]}),M?.adminEventsEnabled&&x("view-events")&&t(S,{"data-testid":"admin-events-tab",title:t(f,{children:o("adminEvents")}),...B,children:t(de,{resourcePath:`*client-scopes/${i}`})})]})})]}):t(Y,{})}export{Ge as default};
//# sourceMappingURL=EditClientScope-hsJ1BW_a.js.map
