import{jsxs as u,Fragment as K,jsx as o}from"react/jsx-runtime";import{u as M,a as W,b as J,_ as Q,e as U,j as X,y as Y,P as Z,O as $,R as ee,bp as te,bq as oe,ak as re,W as S,l as ae,A as ce,g,L as V,er as h,o as se}from"./main-o1hptXRo.js";import{useState as l}from"react";import{D as ie}from"./DynamicComponents-CnLlz98z.js";import{F as ne}from"./FormAccess-BnhQnYb9.js";import{V as le}from"./ViewHeader-BDBsroi3.js";import{u as F}from"./useParams-CGVhlaFZ.js";import"react-dom";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./ConfirmDialog-BkU7melV.js";import"./useLocaleSort-C-diWts5.js";import"./CodeEditor-C4IS5oxi.js";const I={config:{},executor:""};function Ae(){const{adminClient:P}=M(),{t:c}=W(),C=J(),{realm:d,profileName:i}=F(),{executorName:n}=F(),{addAlert:A,addError:O}=Q(),[H,T]=l(!1),p=U().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,N]=l([]),[D,G]=l([]),[v,L]=l([]),[j,B]=l([]),f=X({defaultValues:I}),{control:q,reset:y,handleSubmit:w}=f,a=!!n,E=e=>{const r=e.find(s=>s.name===i)?.executors?.find(s=>s.executor===n);r&&y({config:r.configuration})};Y(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{L(e.globalProfiles),B(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const R=async()=>{const e=f.getValues(),t=j.map(r=>{if(r.name!==i)return r;const s=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(a){const k=r.executors.find(z=>z.executor===n);k.configuration={...k.configuration,...e.config}}return a?r:{...r,executors:s}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),A(c(a?"updateExecutorSuccess":"addExecutorSuccess"),se.success),C(h({realm:d,profileName:i}))}catch(r){O(a?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===i),b=p?.find(e=>e.id===n),_=b?.properties.map(e=>{const t=a?e.defaultValue:"";return{...e,defaultValue:t}});return u(K,{children:[o(le,{titleKey:a?n:c("addExecutor"),divider:!0}),u(Z,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o($,{label:c("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(S,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):a?o(S,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:q,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...I,executor:t.toString()});const r=p?.filter(s=>s.id===t);N(r??[]),G(r?.[0].properties??[]),T(!1)},selections:a?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":c("executorType"),isOpen:H,maxHeight:580,isDisabled:a,children:p?.map(t=>o(re,{"data-testid":t.id,selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ae,{...f,children:o(ie,{properties:a?_:D})}),!x&&u(ce,{children:[o(g,{variant:"primary",onClick:()=>w(R)(),"data-testid":"addExecutor-saveBtn",children:c(a?"save":"add")}),o(g,{variant:"link",component:e=>o(V,{...e,to:h({realm:d,profileName:i})}),"data-testid":"addExecutor-cancelBtn",children:c("cancel")})]})]}),a&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(V,{...e,to:h({realm:d,profileName:i})}),variant:"primary",children:c("back")})})]})]})}export{Ae as default};
//# sourceMappingURL=ExecutorForm-Dt5MaWsz.js.map
