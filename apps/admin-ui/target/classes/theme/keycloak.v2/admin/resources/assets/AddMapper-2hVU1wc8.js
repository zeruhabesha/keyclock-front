import{jsxs as m,Fragment as S,jsx as r}from"react/jsx-runtime";import{a as O,Q as F,U as k,O as q,R as B,bp as j,bq as x,ak as E,W as K,u as L,j as H,_ as N,b as G,d as Q,B as R,o as P,cK as I,y as _,m as z,p as W,P as $,D as J,l as X,A as Y,g as T,L as Z,n as ee,cM as re}from"./main-o1hptXRo.js";import{useState as C}from"react";import{u as ae}from"./ConfirmDialog-BkU7melV.js";import{D as te}from"./DynamicComponents-CnLlz98z.js";import{F as ie}from"./FormAccess-BnhQnYb9.js";import{V as se}from"./ViewHeader-BDBsroi3.js";import{u as oe,m as ne}from"./useLocaleSort-C-diWts5.js";import{u as pe}from"./useParams-CGVhlaFZ.js";import"react-dom";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./CodeEditor-C4IS5oxi.js";const de=({mapperTypes:n,mapperType:a,form:d,id:M,updateMapperType:u})=>{const{t:s}=O(),{control:f}=d,[g,l]=C(!1),t=["inherit","import","legacy","force"];return m(S,{children:[r(F,{name:"name",label:s("name"),labelIcon:s("addIdpMapperNameHelp"),readOnly:!!M,rules:{required:s("required")}}),r(k,{name:"config.syncMode",label:s("syncModeOverride"),labelIcon:s("syncModeOverrideHelp"),options:t.map(i=>({key:i.toUpperCase(),value:s(`syncModes.${i}`)})),controller:{defaultValue:t[0].toUpperCase()}}),r(q,{label:s("mapperType"),labelIcon:r(K,{helpText:a.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:r(B,{name:"identityProviderMapper",defaultValue:n[0].id,control:f,render:({field:i})=>r(j,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!M,onToggle:()=>l(!g),onSelect:e=>{const y=e;u(y),i.onChange(y.id),l(!1)},selections:a.name,variant:x.single,"aria-label":s("mapperType"),isOpen:g,children:n.map(e=>r(E,{selected:e===i.value,"data-testid":e.id,value:e,children:e.name},e.name))})})})]})};function Ae(){const{adminClient:n}=L(),{t:a}=O(),d=H({shouldUnregister:!0}),{handleSubmit:M}=d,{addAlert:u,addError:s}=N(),f=G(),g=oe(),{realm:l}=Q(),{id:t,providerId:i,alias:e}=pe(),[y,V]=C(),[v,h]=C(),A=async o=>{const b=ee(o),c={...b,config:{...b.config},identityProviderAlias:e};if(t)try{await n.identityProviders.updateMapper({id:t,alias:e},{...c,id:t}),u(a("mapperSaveSuccess"),P.success)}catch(p){s("mapperSaveError",p)}else try{const p=await n.identityProviders.createMapper({identityProviderMapper:c,alias:e});u(a("mapperCreateSuccess"),P.success),f(re({realm:l,alias:e,providerId:i,id:p.id}))}catch(p){s("mapperCreateError",p)}},[D,w]=ae({titleKey:"deleteProviderMapper",messageKey:a("deleteMapperConfirm",{mapper:v?.name}),continueButtonLabel:"delete",continueButtonVariant:R.danger,onConfirm:async()=>{try{await n.identityProviders.delMapper({alias:e,id:t}),u(a("deleteMapperSuccess"),P.success),f(I({providerId:i,alias:e,tab:"mappers",realm:l}))}catch(o){s("deleteErrorIdentityProvider",o)}}});_(()=>Promise.all([t?n.identityProviders.findOneMapper({alias:e,id:t}):null,n.identityProviders.findMapperTypes({alias:e})]),([o,b])=>{const c=g(Object.values(b),ne("name"));o?(h(c.find(({id:p})=>p===o.identityProviderMapper)),U(o)):h(c[0]),V(c)},[t]);const U=o=>{z(o,d.setValue)};return!y||!v?r(W,{}):m($,{variant:"light",children:[r(w,{}),r(se,{className:"kc-add-mapper-title",titleKey:t?a("editIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}):a("addIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}),dropdownItems:t?[r(J,{onClick:D,children:a("delete")},"delete")]:void 0,divider:!0}),m(ie,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:M(A),className:"pf-v5-u-mt-lg",children:[m(X,{...d,children:[t&&r(F,{name:"id",label:a("id"),readOnly:!0,rules:{required:a("required")}}),v.properties&&m(S,{children:[r(de,{form:d,id:t,mapperTypes:y,updateMapperType:h,mapperType:v}),r(te,{properties:v.properties})]})]}),m(Y,{children:[r(T,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:a("save")}),r(T,{"data-testid":"new-mapper-cancel-button",variant:"link",component:o=>r(Z,{...o,to:I({realm:l,providerId:i,alias:e,tab:"mappers"})}),children:a("cancel")})]})]})]})}export{Ae as default};
//# sourceMappingURL=AddMapper-2hVU1wc8.js.map
