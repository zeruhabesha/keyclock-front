{"version":3,"file":"DiscoveryEndpointField-CeImOp4h.js","sources":["../../../../../../../../../node_modules/.pnpm/p-debounce@5.0.0/node_modules/p-debounce/index.js","../../../../../../../src/identity-providers/component/DiscoveryEndpointField.tsx"],"sourcesContent":["const pDebounce = (function_, wait, options = {}) => {\n\tif (!Number.isFinite(wait)) {\n\t\tthrow new TypeError('Expected `wait` to be a finite number');\n\t}\n\n\tlet leadingValue;\n\tlet timeout;\n\tlet resolveList = [];\n\tlet rejectList = [];\n\n\tconst onAbort = () => {\n\t\tclearTimeout(timeout);\n\t\ttimeout = null;\n\n\t\ttry {\n\t\t\toptions.signal?.throwIfAborted();\n\t\t} catch (error) {\n\t\t\tfor (const reject of rejectList) {\n\t\t\t\treject(error);\n\t\t\t}\n\n\t\t\tresolveList = [];\n\t\t\trejectList = [];\n\t\t}\n\t};\n\n\treturn function (...arguments_) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// Check if already aborted\n\t\t\ttry {\n\t\t\t\toptions.signal?.throwIfAborted();\n\t\t\t} catch (error) {\n\t\t\t\treject(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst shouldCallNow = options.before && !timeout;\n\n\t\t\tclearTimeout(timeout);\n\n\t\t\ttimeout = setTimeout(async () => {\n\t\t\t\ttimeout = null;\n\n\t\t\t\t// Capture the current resolve/reject lists for this execution\n\t\t\t\tconst currentResolveList = resolveList;\n\t\t\t\tconst currentRejectList = rejectList;\n\n\t\t\t\t// Clear lists for next cycle (new calls during execution will add to new lists)\n\t\t\t\tresolveList = [];\n\t\t\t\trejectList = [];\n\n\t\t\t\ttry {\n\t\t\t\t\tconst result = options.before ? leadingValue : await function_.apply(this, arguments_);\n\n\t\t\t\t\tfor (const resolveFunction of currentResolveList) {\n\t\t\t\t\t\tresolveFunction(result);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tfor (const rejectFunction of currentRejectList) {\n\t\t\t\t\t\trejectFunction(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Clear leading value for next cycle\n\t\t\t\tleadingValue = undefined;\n\n\t\t\t\t// Remove abort listener\n\t\t\t\toptions.signal?.removeEventListener('abort', onAbort);\n\t\t\t}, wait);\n\n\t\t\tif (shouldCallNow) {\n\t\t\t\t// Execute immediately for leading edge\n\t\t\t\t(async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tleadingValue = await function_.apply(this, arguments_);\n\t\t\t\t\t\tresolve(leadingValue);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t} else {\n\t\t\t\t// Add to lists for later resolution\n\t\t\t\tresolveList.push(resolve);\n\t\t\t\trejectList.push(reject);\n\n\t\t\t\t// Set up abort listener (only once per batch)\n\t\t\t\tif (options.signal && resolveList.length === 1) {\n\t\t\t\t\toptions.signal.addEventListener('abort', onAbort, {once: true});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n};\n\npDebounce.promise = function_ => {\n\tlet currentPromise;\n\n\treturn async function (...arguments_) {\n\t\tif (currentPromise) {\n\t\t\treturn currentPromise;\n\t\t}\n\n\t\ttry {\n\t\t\tcurrentPromise = function_.apply(this, arguments_);\n\t\t\treturn await currentPromise;\n\t\t} finally {\n\t\t\tcurrentPromise = undefined;\n\t\t}\n\t};\n};\n\nexport default pDebounce;\n","import { FormGroup, Spinner, Switch } from \"@patternfly/react-core\";\r\nimport debouncePromise from \"p-debounce\";\r\nimport { ReactNode, useMemo, useState } from \"react\";\r\nimport { useFormContext } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { HelpItem, TextControl } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\n\r\ntype DiscoveryEndpointFieldProps = {\r\n  id: string;\r\n  fileUpload: ReactNode;\r\n  children: (readOnly: boolean) => ReactNode;\r\n};\r\n\r\nexport const DiscoveryEndpointField = ({\r\n  id,\r\n  fileUpload,\r\n  children,\r\n}: DiscoveryEndpointFieldProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const {\r\n    setValue,\r\n    clearErrors,\r\n    formState: { errors },\r\n  } = useFormContext();\r\n  const [discovery, setDiscovery] = useState(true);\r\n  const [discovering, setDiscovering] = useState(false);\r\n  const [discoveryResult, setDiscoveryResult] =\r\n    useState<Record<string, string>>();\r\n\r\n  const setupForm = (result: Record<string, string>) => {\r\n    Object.keys(result).map((k) => setValue(`config.${k}`, result[k]));\r\n  };\r\n\r\n  const discover = async (fromUrl: string) => {\r\n    setDiscovering(true);\r\n    try {\r\n      const result = await adminClient.identityProviders.importFromUrl({\r\n        providerId: id,\r\n        fromUrl,\r\n      });\r\n      setupForm(result);\r\n      setDiscoveryResult(result);\r\n    } catch (error) {\r\n      return (error as Error).message;\r\n    } finally {\r\n      setDiscovering(false);\r\n    }\r\n  };\r\n\r\n  const discoverDebounced = useMemo(() => debouncePromise(discover, 1000), []);\r\n\r\n  return (\r\n    <>\r\n      <FormGroup\r\n        label={t(\r\n          id === \"oidc\" ? \"useDiscoveryEndpoint\" : \"useEntityDescriptor\",\r\n        )}\r\n        fieldId=\"kc-discovery-endpoint\"\r\n        labelIcon={\r\n          <HelpItem\r\n            helpText={t(\r\n              id === \"oidc\"\r\n                ? \"useDiscoveryEndpointHelp\"\r\n                : \"useEntityDescriptorHelp\",\r\n            )}\r\n            fieldLabelId=\"discoveryEndpoint\"\r\n          />\r\n        }\r\n      >\r\n        <Switch\r\n          id=\"kc-discovery-endpoint-switch\"\r\n          label={t(\"on\")}\r\n          labelOff={t(\"off\")}\r\n          isChecked={discovery}\r\n          onChange={(_event, checked) => {\r\n            clearErrors(\"discoveryError\");\r\n            setDiscovery(checked);\r\n          }}\r\n          aria-label={t(\r\n            id === \"oidc\" ? \"useDiscoveryEndpoint\" : \"useEntityDescriptor\",\r\n          )}\r\n        />\r\n      </FormGroup>\r\n      {discovery && (\r\n        <>\r\n          <div style={{ display: \"none\" }} data-testid=\"playwright-result\">\r\n            {errors.discoveryError || errors.discoveryEndpoint\r\n              ? \"error\"\r\n              : !discoveryResult\r\n                ? \"default\"\r\n                : \"success\"}\r\n          </div>\r\n          <TextControl\r\n            name=\"discoveryEndpoint\"\r\n            label={t(\r\n              id === \"oidc\" ? \"discoveryEndpoint\" : \"samlEntityDescriptor\",\r\n            )}\r\n            labelIcon={t(\r\n              id === \"oidc\"\r\n                ? \"discoveryEndpointHelp\"\r\n                : \"samlEntityDescriptorHelp\",\r\n            )}\r\n            type=\"url\"\r\n            placeholder={\r\n              id === \"oidc\"\r\n                ? \"https://hostname/realms/master/.well-known/openid-configuration\"\r\n                : \"\"\r\n            }\r\n            validated={\r\n              errors.discoveryError || errors.discoveryEndpoint\r\n                ? \"error\"\r\n                : !discoveryResult\r\n                  ? \"default\"\r\n                  : \"success\"\r\n            }\r\n            customIcon={discovering ? <Spinner isInline /> : undefined}\r\n            rules={{\r\n              required: t(\"required\"),\r\n              validate: (value: string) => discoverDebounced(value),\r\n            }}\r\n          />\r\n        </>\r\n      )}\r\n      {!discovery && fileUpload}\r\n      {discovery && !errors.discoveryError && children(true)}\r\n      {!discovery && children(false)}\r\n    </>\r\n  );\r\n};\r\n"],"names":["pDebounce","function_","wait","options","leadingValue","timeout","resolveList","rejectList","onAbort","error","reject","arguments_","resolve","shouldCallNow","currentResolveList","currentRejectList","result","resolveFunction","rejectFunction","currentPromise","DiscoveryEndpointField","id","fileUpload","children","adminClient","useAdminClient","t","useTranslation","setValue","clearErrors","errors","useFormContext","discovery","setDiscovery","useState","discovering","setDiscovering","discoveryResult","setDiscoveryResult","setupForm","k","discover","fromUrl","discoverDebounced","useMemo","debouncePromise","jsxs","Fragment","jsx","FormGroup","HelpItem","Switch","_event","checked","TextControl","Spinner","value"],"mappings":"wMAAA,MAAMA,EAAY,CAACC,EAAWC,EAAMC,EAAU,CAAA,IAAO,CACpD,GAAI,CAAC,OAAO,SAASD,CAAI,EACxB,MAAM,IAAI,UAAU,uCAAuC,EAG5D,IAAIE,EACAC,EACAC,EAAc,CAAA,EACdC,EAAa,CAAA,EAEjB,MAAMC,EAAU,IAAM,CACrB,aAAaH,CAAO,EACpBA,EAAU,KAEV,GAAI,CACHF,EAAQ,QAAQ,eAAc,CAC/B,OAASM,EAAO,CACf,UAAWC,KAAUH,EACpBG,EAAOD,CAAK,EAGbH,EAAc,CAAA,EACdC,EAAa,CAAA,CACd,CACD,EAEA,OAAO,YAAaI,EAAY,CAC/B,OAAO,IAAI,QAAQ,CAACC,EAASF,IAAW,CAEvC,GAAI,CACHP,EAAQ,QAAQ,eAAc,CAC/B,OAASM,EAAO,CACfC,EAAOD,CAAK,EACZ,MACD,CAEA,MAAMI,EAAgBV,EAAQ,QAAU,CAACE,EAEzC,aAAaA,CAAO,EAEpBA,EAAU,WAAW,SAAY,CAChCA,EAAU,KAGV,MAAMS,EAAqBR,EACrBS,EAAoBR,EAG1BD,EAAc,CAAA,EACdC,EAAa,CAAA,EAEb,GAAI,CACH,MAAMS,EAASb,EAAQ,OAASC,EAAe,MAAMH,EAAU,MAAM,KAAMU,CAAU,EAErF,UAAWM,KAAmBH,EAC7BG,EAAgBD,CAAM,CAExB,OAASP,EAAO,CACf,UAAWS,KAAkBH,EAC5BG,EAAeT,CAAK,CAEtB,CAGAL,EAAe,OAGfD,EAAQ,QAAQ,oBAAoB,QAASK,CAAO,CACrD,EAAGN,CAAI,EAEHW,GAEF,SAAY,CACZ,GAAI,CACHT,EAAe,MAAMH,EAAU,MAAM,KAAMU,CAAU,EACrDC,EAAQR,CAAY,CACrB,OAASK,EAAO,CACfC,EAAOD,CAAK,CACb,CACD,GAAC,GAGDH,EAAY,KAAKM,CAAO,EACxBL,EAAW,KAAKG,CAAM,EAGlBP,EAAQ,QAAUG,EAAY,SAAW,GAC5CH,EAAQ,OAAO,iBAAiB,QAASK,EAAS,CAAC,KAAM,EAAI,CAAC,EAGjE,CAAC,CACF,CACD,EAEAR,EAAU,QAAUC,GAAa,CAChC,IAAIkB,EAEJ,OAAO,kBAAmBR,EAAY,CACrC,GAAIQ,EACH,OAAOA,EAGR,GAAI,CACH,OAAAA,EAAiBlB,EAAU,MAAM,KAAMU,CAAU,EAC1C,MAAMQ,CACd,QAAC,CACAA,EAAiB,MAClB,CACD,CACD,EC/FO,MAAMC,EAAyB,CAAC,CACrC,GAAAC,EACA,WAAAC,EACA,SAAAC,CACF,IAAmC,CACjC,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CACJ,SAAAC,EACA,YAAAC,EACA,UAAW,CAAE,OAAAC,CAAA,CAAO,EAClBC,EAAA,EACE,CAACC,EAAWC,CAAY,EAAIC,EAAS,EAAI,EACzC,CAACC,EAAaC,CAAc,EAAIF,EAAS,EAAK,EAC9C,CAACG,EAAiBC,CAAkB,EACxCJ,EAAA,EAEIK,EAAavB,GAAmC,CACpD,OAAO,KAAKA,CAAM,EAAE,IAAKwB,GAAMZ,EAAS,UAAUY,CAAC,GAAIxB,EAAOwB,CAAC,CAAC,CAAC,CACnE,EAEMC,EAAW,MAAOC,GAAoB,CAC1CN,EAAe,EAAI,EACnB,GAAI,CACF,MAAMpB,EAAS,MAAMQ,EAAY,kBAAkB,cAAc,CAC/D,WAAYH,EACZ,QAAAqB,CAAA,CACD,EACDH,EAAUvB,CAAM,EAChBsB,EAAmBtB,CAAM,CAC3B,OAASP,EAAO,CACd,OAAQA,EAAgB,OAC1B,QAAA,CACE2B,EAAe,EAAK,CACtB,CACF,EAEMO,EAAoBC,EAAQ,IAAMC,EAAgBJ,EAAU,GAAI,EAAG,EAAE,EAE3E,OACEK,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CACC,MAAOvB,EACLL,IAAO,OAAS,uBAAyB,qBAAA,EAE3C,QAAQ,wBACR,UACE2B,EAACE,EAAA,CACC,SAAUxB,EACRL,IAAO,OACH,2BACA,yBAAA,EAEN,aAAa,mBAAA,CAAA,EAIjB,SAAA2B,EAACG,EAAA,CACC,GAAG,+BACH,MAAOzB,EAAE,IAAI,EACb,SAAUA,EAAE,KAAK,EACjB,UAAWM,EACX,SAAU,CAACoB,EAAQC,IAAY,CAC7BxB,EAAY,gBAAgB,EAC5BI,EAAaoB,CAAO,CACtB,EACA,aAAY3B,EACVL,IAAO,OAAS,uBAAyB,qBAAA,CAC3C,CAAA,CACF,CAAA,EAEDW,GACCc,EAAAC,EAAA,CACE,SAAA,CAAAC,EAAC,OAAI,MAAO,CAAE,QAAS,MAAA,EAAU,cAAY,oBAC1C,SAAAlB,EAAO,gBAAkBA,EAAO,kBAC7B,QACCO,EAEC,UADA,UAER,EACAW,EAACM,EAAA,CACC,KAAK,oBACL,MAAO5B,EACLL,IAAO,OAAS,oBAAsB,sBAAA,EAExC,UAAWK,EACTL,IAAO,OACH,wBACA,0BAAA,EAEN,KAAK,MACL,YACEA,IAAO,OACH,kEACA,GAEN,UACES,EAAO,gBAAkBA,EAAO,kBAC5B,QACCO,EAEC,UADA,UAGR,WAAYF,EAAca,EAACO,EAAA,CAAQ,SAAQ,GAAC,EAAK,OACjD,MAAO,CACL,SAAU7B,EAAE,UAAU,EACtB,SAAW8B,GAAkBb,EAAkBa,CAAK,CAAA,CACtD,CAAA,CACF,EACF,EAED,CAACxB,GAAaV,EACdU,GAAa,CAACF,EAAO,gBAAkBP,EAAS,EAAI,EACpD,CAACS,GAAaT,EAAS,EAAK,CAAA,EAC/B,CAEJ","x_google_ignoreList":[0]}