import{jsx as s,jsxs as x}from"react/jsx-runtime";import{aw as J,av as S,cW as X,aL as Y,u as Z,a as U,y as ee,M as ae,k as O,aB as te,cx as se,cy as F,g as B,v as T,b7 as ie}from"./main-o1hptXRo.js";import*as v from"react";import{useState as p}from"react";import{s as N,D as ne,a as le,b as ce,c as oe,d as re}from"./DataListItemRow-B_0B-ko6.js";const W=e=>{var{children:i,className:n,visibility:o,id:b,"aria-label":f,"aria-labelledby":u,isPlainButtonAction:r}=e,d=J(e,["children","className","visibility","id","aria-label","aria-labelledby","isPlainButtonAction"]);return v.createElement("div",Object.assign({className:S(N.dataListItemAction,X(o,N),n)},d),r?v.createElement("div",{className:S(N.dataListAction)},i):i)};W.displayName="DataListAction";const _=e=>{var{className:i="",onChange:n=(k,c)=>{},isValid:o=!0,isDisabled:b=!1,isChecked:f=!1,checked:u=!1,defaultChecked:r,otherControls:d=!1}=e,l=J(e,["className","onChange","isValid","isDisabled","isChecked","checked","defaultChecked","otherControls"]);const m=v.createElement("div",{className:S(N.dataListCheck)},v.createElement("input",Object.assign({},l,{type:"checkbox",onChange:k=>n(k,k.currentTarget.checked),"aria-invalid":!o,disabled:b},[!0,!1].includes(r)&&{defaultChecked:r},![!0,!1].includes(r)&&{checked:f||u})));return v.createElement(v.Fragment,null,!d&&v.createElement("div",{className:S(N.dataListItemControl,i)},m),d&&m)};_.displayName="DataListCheck";const de=({group:{path:e},onMouseEnter:i,...n})=>{const[o,b]=p(""),u=s("span",{onMouseEnter:r=>{b(e),i?.(r)},...n,children:e});return o!==""?s(Y,{content:o,isVisible:!0,children:u}):u},be=({id:e,type:i,filterGroups:n,text:o,canBrowse:b=!0,isMove:f=!1,onClose:u,onConfirm:r})=>{const{adminClient:d}=Z(),{t:l}=U(),[m,k]=p([]),[c,G]=p([]),[D,z]=p([]),[h,P]=p(""),[H,K]=p([]),[y,w]=p(),[L,E]=p(10),[I,C]=p(0),[Q,R]=p(0),$=()=>c[c.length-1];ee(async()=>{let a,t,M;if(y){if(!c.map(({id:A})=>A).includes(y)&&(a=await d.groups.findOne({id:y}),!a))throw new Error(l("notFound"));const g={first:I,max:L,parentId:y};t=await d.groups.listSubGroups(g)}else{const g={first:I,max:L+1};h!==""&&(g.search=h),t=await d.groups.find(g)}return e&&(M=await d.users.listGroups({id:e})),{group:a,groups:t,existingUserGroups:M}},async({group:a,groups:t,existingUserGroups:M})=>{K(M||[]),a&&(G([...c,a]),R(a.subGroupCount)),t.forEach(g=>{g.checked=!!m.find(A=>A.id===g.id)}),z(t),(h!==""||!y)&&R(t.length)},[y,h,I,L]);const j=a=>[...H.map(t=>t.id),...(n||[]).map(t=>t.id)].some(t=>t===a?.id);return s(ae,{variant:h!==""?O.medium:O.small,title:l(o.title,{group1:n?.[0]?.name,group2:c.length?$().name:l("root")}),isOpen:!0,onClose:u,actions:[s(B,{"data-testid":`${o.ok}-button`,variant:"primary",form:"group-form",onClick:()=>{r(i==="selectMany"?m:c.length?[$()]:void 0)},isDisabled:i==="selectMany"&&m.length===0,children:l(o.ok)},"confirm")],children:x(te,{count:Q,first:I,max:L,onNextClick:C,onPreviousClick:C,onPerPageSelect:(a,t)=>{C(a),E(t)},inputGroupName:"search",inputGroupOnEnter:a=>{P(a),C(0),E(10),G([]),w(void 0)},inputGroupPlaceholder:l("searchForGroups"),children:[x(se,{children:[c.length>0&&s(F,{children:s(B,{variant:"link",onClick:()=>{w(void 0),G([]),C(0),E(10)},children:l("groups")})},"home"),c.map((a,t)=>x(F,{children:[c.length-1!==t&&s(B,{variant:"link",onClick:()=>{w(a.id),G([...c].slice(0,t)),C(0),E(10)},children:a.name}),c.length-1===t&&a.name]},t))]}),s(ne,{"aria-label":l("groups"),isCompact:!0,children:h==""?D.slice(0,L).map(a=>s(V,{group:a,isRowDisabled:j,onSelect:t=>{w(t.id),C(0)},type:i,isSearching:h!=="",setIsSearching:t=>P(t?"":h),selectedRows:m,setSelectedRows:k,canBrowse:b},a.id)):D?.map(a=>q([a])).flat().map(a=>s(V,{group:a,isRowDisabled:j,type:i,isSearching:!0,selectedRows:m,setSelectedRows:k,canBrowse:!1},a.id))}),D.length===0&&h===""&&s(T,{hasIcon:!1,message:l("moveGroupEmpty"),instructions:f?l("moveGroupEmptyInstructions"):void 0}),D.length===0&&h!==""&&s(T,{message:l("noSearchResults"),instructions:l("noSearchResultsInstructions")})]})})};function q(e){const i=[];for(const n of e)i.push(n),n.subGroups&&n.subGroups.length>0&&i.push(...q(n.subGroups));return i}const V=({group:e,type:i,isRowDisabled:n,isSearching:o,setIsSearching:b,onSelect:f,selectedRows:u,setSelectedRows:r,canBrowse:d})=>{const{t:l}=U();return s(le,{"aria-labelledby":e.name,id:e.id,onClick:m=>{i==="selectOne"?f?.(e):m.target.type!=="checkbox"&&e.subGroupCount!==0&&(f?.(e),b?.(!1))},children:x(ce,{className:`join-group-dialog-row${n(e)?"-m-disabled":""}`,"data-testid":e.name,children:[i==="selectMany"&&s(_,{className:"kc-join-group-modal-check","data-testid":`${e.name}-check`,"aria-label":e.name,checked:e.checked,isDisabled:n(e),onChange:(m,k)=>{e.checked=k;let c=[];e.checked?c=[...u,e]:c=u.filter(G=>G.id!==e.id),r(c)},"aria-labelledby":`select-${e.name}`}),s(oe,{dataListCells:[s(re,{className:"keycloak-groups-group-path",children:o?s(de,{id:`select-${e.name}`,group:e}):s("span",{id:`select-${e.name}`,children:e.name})},`name-${e.id}`)]}),s(W,{id:"actions","aria-labelledby":`select-${e.name}`,"aria-label":l("groupName"),isPlainButtonAction:!0,children:(d||i==="selectOne")&&e.subGroupCount!==0&&s(B,{variant:"link","aria-label":l("select"),children:s(ie,{})})})]})},e.id)};export{be as G,de as a};
//# sourceMappingURL=GroupPickerDialog-U3luvxlw.js.map
