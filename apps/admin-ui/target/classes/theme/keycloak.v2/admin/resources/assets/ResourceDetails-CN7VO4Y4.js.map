{"version":3,"file":"ResourceDetails-CN7VO4Y4.js","sources":["../../../../../../../src/clients/authorization/ResourceDetails.tsx"],"sourcesContent":["import type ClientRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientRepresentation\";\r\nimport type ResourceRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/resourceRepresentation\";\r\nimport type ResourceServerRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/resourceServerRepresentation\";\r\nimport {\r\n  HelpItem,\r\n  TextControl,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  Alert,\r\n  AlertVariant,\r\n  Button,\r\n  ButtonVariant,\r\n  DropdownItem,\r\n  FormGroup,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { DefaultSwitchControl } from \"../../components/SwitchControl\";\r\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { KeyValueInput } from \"../../components/key-value-form/KeyValueInput\";\r\nimport type { KeyValueType } from \"../../components/key-value-form/key-value-convert\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { MultiLineInput } from \"../../components/multi-line-input/MultiLineInput\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useAccess } from \"../../context/access/Access\";\r\nimport { convertFormValuesToObject, convertToFormValues } from \"../../util\";\r\nimport { useParams } from \"../../utils/useParams\";\r\nimport { toAuthorizationTab } from \"../routes/AuthenticationTab\";\r\nimport { ResourceDetailsParams, toResourceDetails } from \"../routes/Resource\";\r\nimport { ScopePicker } from \"./ScopePicker\";\r\nimport \"./resource-details.css\";\r\n\r\ntype SubmittedResource = Omit<\r\n  ResourceRepresentation,\r\n  \"attributes\" | \"scopes\"\r\n> & {\r\n  attributes: KeyValueType[];\r\n};\r\n\r\nexport default function ResourceDetails() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const [client, setClient] = useState<ClientRepresentation>();\r\n  const [resource, setResource] = useState<ResourceRepresentation>();\r\n\r\n  const [permissions, setPermission] =\r\n    useState<ResourceServerRepresentation[]>();\r\n\r\n  const { addAlert, addError } = useAlerts();\r\n  const form = useForm<SubmittedResource>({\r\n    mode: \"onChange\",\r\n  });\r\n  const { setValue, handleSubmit } = form;\r\n\r\n  const { id, resourceId, realm } = useParams<ResourceDetailsParams>();\r\n  const navigate = useNavigate();\r\n\r\n  const setupForm = (resource: ResourceRepresentation = {}) => {\r\n    convertToFormValues(resource, setValue);\r\n  };\r\n\r\n  const { hasAccess } = useAccess();\r\n\r\n  const isDisabled = !hasAccess(\"manage-authorization\");\r\n\r\n  useFetch(\r\n    () =>\r\n      Promise.all([\r\n        adminClient.clients.findOne({ id }),\r\n        resourceId\r\n          ? adminClient.clients.getResource({ id, resourceId })\r\n          : Promise.resolve(undefined),\r\n        resourceId\r\n          ? adminClient.clients.listPermissionsByResource({ id, resourceId })\r\n          : Promise.resolve(undefined),\r\n      ]),\r\n    ([client, resource, permissions]) => {\r\n      if (!client) {\r\n        throw new Error(t(\"notFound\"));\r\n      }\r\n      setClient(client);\r\n      setPermission(permissions);\r\n      setResource(resource);\r\n      setupForm(resource);\r\n    },\r\n    [],\r\n  );\r\n\r\n  const submit = async (submitted: SubmittedResource) => {\r\n    const resource = convertFormValuesToObject<\r\n      SubmittedResource,\r\n      ResourceRepresentation\r\n    >(submitted);\r\n\r\n    try {\r\n      if (resourceId) {\r\n        await adminClient.clients.updateResource({ id, resourceId }, resource);\r\n      } else {\r\n        const result = await adminClient.clients.createResource(\r\n          { id },\r\n          resource,\r\n        );\r\n        setResource(resource);\r\n        navigate(toResourceDetails({ realm, id, resourceId: result._id! }));\r\n      }\r\n      addAlert(\r\n        t((resourceId ? \"update\" : \"create\") + \"ResourceSuccess\"),\r\n        AlertVariant.success,\r\n      );\r\n    } catch (error) {\r\n      addError(\"resourceSaveError\", error);\r\n    }\r\n  };\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"deleteResource\",\r\n    children: (\r\n      <>\r\n        {t(\"deleteResourceConfirm\")}\r\n        {permissions?.length !== 0 && (\r\n          <Alert\r\n            variant=\"warning\"\r\n            isInline\r\n            isPlain\r\n            title={t(\"deleteResourceWarning\")}\r\n            className=\"pf-v5-u-pt-lg\"\r\n          >\r\n            <p className=\"pf-v5-u-pt-xs\">\r\n              {permissions?.map((permission) => (\r\n                <strong key={permission.id} className=\"pf-v5-u-pr-md\">\r\n                  {permission.name}\r\n                </strong>\r\n              ))}\r\n            </p>\r\n          </Alert>\r\n        )}\r\n      </>\r\n    ),\r\n    continueButtonLabel: \"confirm\",\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.clients.delResource({\r\n          id,\r\n          resourceId: resourceId!,\r\n        });\r\n        addAlert(t(\"resourceDeletedSuccess\"), AlertVariant.success);\r\n        navigate(toAuthorizationTab({ realm, clientId: id, tab: \"resources\" }));\r\n      } catch (error) {\r\n        addError(\"resourceDeletedError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  if (!client) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <DeleteConfirm />\r\n      <ViewHeader\r\n        titleKey={resourceId ? resource?.name! : \"createResource\"}\r\n        dropdownItems={\r\n          resourceId\r\n            ? [\r\n                <DropdownItem\r\n                  key=\"delete\"\r\n                  data-testid=\"delete-resource\"\r\n                  isDisabled={isDisabled}\r\n                  onClick={() => toggleDeleteDialog()}\r\n                >\r\n                  {t(\"delete\")}\r\n                </DropdownItem>,\r\n              ]\r\n            : undefined\r\n        }\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <FormProvider {...form}>\r\n          <FormAccess\r\n            isHorizontal\r\n            role=\"manage-authorization\"\r\n            className=\"keycloak__resource-details__form\"\r\n            onSubmit={handleSubmit(submit)}\r\n          >\r\n            <TextControl\r\n              name={resourceId ? \"owner.name\" : \"\"}\r\n              label={t(\"owner\")}\r\n              labelIcon={t(\"ownerHelp\")}\r\n              defaultValue={client.clientId}\r\n              readOnly\r\n            />\r\n            <TextControl\r\n              name={\"name\"}\r\n              label={t(\"name\")}\r\n              labelIcon={t(\"resourceNameHelp\")}\r\n              rules={{ required: t(\"required\") }}\r\n            />\r\n            <TextControl\r\n              name=\"displayName\"\r\n              label={t(\"displayName\")}\r\n              labelIcon={t(\"displayNameHelp\")}\r\n              rules={{ required: t(\"required\") }}\r\n            />\r\n            <TextControl\r\n              name=\"type\"\r\n              label={t(\"type\")}\r\n              labelIcon={t(\"resourceDetailsTypeHelp\")}\r\n            />\r\n            <FormGroup\r\n              label={t(\"uris\")}\r\n              fieldId=\"uris\"\r\n              labelIcon={\r\n                <HelpItem helpText={t(\"urisHelp\")} fieldLabelId=\"uris\" />\r\n              }\r\n            >\r\n              <MultiLineInput\r\n                name=\"uris\"\r\n                type=\"url\"\r\n                aria-label={t(\"uris\")}\r\n                addButtonLabel=\"addUri\"\r\n              />\r\n            </FormGroup>\r\n            <ScopePicker clientId={id} />\r\n            <TextControl\r\n              name=\"icon_uri\"\r\n              label={t(\"iconUri\")}\r\n              labelIcon={t(\"iconUriHelp\")}\r\n              type=\"url\"\r\n            />\r\n            <DefaultSwitchControl\r\n              name=\"ownerManagedAccess\"\r\n              label={t(\"ownerManagedAccess\")}\r\n              labelIcon={t(\"ownerManagedAccessHelp\")}\r\n            />\r\n            <FormGroup\r\n              hasNoPaddingTop\r\n              label={t(\"resourceAttribute\")}\r\n              labelIcon={\r\n                <HelpItem\r\n                  helpText={t(\"resourceAttributeHelp\")}\r\n                  fieldLabelId=\"resourceAttribute\"\r\n                />\r\n              }\r\n              fieldId=\"resourceAttribute\"\r\n            >\r\n              <KeyValueInput name=\"attributes\" isDisabled={isDisabled} />\r\n            </FormGroup>\r\n            <ActionGroup>\r\n              <div className=\"pf-v5-u-mt-md\">\r\n                <Button\r\n                  variant={ButtonVariant.primary}\r\n                  type=\"submit\"\r\n                  data-testid=\"save\"\r\n                >\r\n                  {t(\"save\")}\r\n                </Button>\r\n\r\n                <Button\r\n                  variant=\"link\"\r\n                  data-testid=\"cancel\"\r\n                  component={(props) => (\r\n                    <Link\r\n                      {...props}\r\n                      to={toAuthorizationTab({\r\n                        realm,\r\n                        clientId: id,\r\n                        tab: \"resources\",\r\n                      })}\r\n                    ></Link>\r\n                  )}\r\n                >\r\n                  {t(\"cancel\")}\r\n                </Button>\r\n              </div>\r\n            </ActionGroup>\r\n          </FormAccess>\r\n        </FormProvider>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["ResourceDetails","adminClient","useAdminClient","t","useTranslation","client","setClient","useState","resource","setResource","permissions","setPermission","addAlert","addError","useAlerts","form","useForm","setValue","handleSubmit","id","resourceId","realm","useParams","navigate","useNavigate","setupForm","convertToFormValues","hasAccess","useAccess","isDisabled","useFetch","submit","submitted","convertFormValuesToObject","result","toResourceDetails","AlertVariant","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","jsxs","Fragment","jsx","Alert","permission","toAuthorizationTab","ViewHeader","DropdownItem","PageSection","FormProvider","FormAccess","TextControl","FormGroup","HelpItem","MultiLineInput","ScopePicker","DefaultSwitchControl","KeyValueInput","ActionGroup","Button","ButtonVariant","props","Link","KeycloakSpinner"],"mappings":"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"}