import{jsx as e,jsxs as h,Fragment as H}from"react/jsx-runtime";import{a as k,bi as ue,bp as M,ak as K,a0 as E,O as f,bQ as le,bR as G,a3 as ce,u as ne,N as W,y as z,p as me,l as _,Q as F,W as R,U as pe,aa as Q,V as O,R as L,bq as X,S as he,cc as Y,e as ie,C as re,j as se,M as be,k as ve,F as oe,g as D,B as ge,ae as ye,aQ as fe,bo as Te,ay as Z,aK as B,aR as Ce,aP as U,I as Ve,J as ke,b as qe,_ as Se,m as Ne,ef as Ie,P as Ae,eg as de,o as xe,bk as we,L as Re}from"./main-o1hptXRo.js";import{useState as V,useMemo as Pe,useEffect as Oe}from"react";import{F as $,b as Le}from"./FormAccess-BnhQnYb9.js";import{V as He}from"./ViewHeader-BDBsroi3.js";import{u as J}from"./useParams-CGVhlaFZ.js";import{U as De}from"./UserProfileContext-DwkKusZd.js";import{T as Ee,s as We}from"./TranslatableField-C01MzTTh.js";import{K as Me}from"./KeyValueInput-BOsiIUR1.js";import{K as Ke,D as je}from"./DynamicComponents-CnLlz98z.js";/* empty css                               */import{D as Be}from"./SwitchControl-CU1bUhmR.js";import{u as Ue}from"./ConfirmDialog-BkU7melV.js";import{u as Ge,m as ze}from"./useLocaleSort-C-diWts5.js";import{i as Qe}from"./isEqual-B7qkGgF1.js";import"react-dom";import"./useLocale-cOPKcLYS.js";import"./Trans-CicUNvCL.js";import"./ActionListItem-Cy-NQlq4.js";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./CodeEditor-C4IS5oxi.js";const _e=({selectItems:t,...a})=>{const{t:l}=k(),{field:n}=ue(a),[s,u]=V(!1);return e(M,{onToggle:o=>u(o),isOpen:s,onSelect:o=>{n.onChange(o),u(!1)},selections:n.value?[n.value]:l("choose"),placeholderText:l("valuePlaceholder"),children:t.map(o=>e(K,{value:o,children:o},o))})},$e=()=>{const{t}=k(),{register:a}=E();return e($,{role:"manage-realm",isHorizontal:!0,children:e(f,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(le,{className:"kc-annotations",children:e(G,{children:e(Me,{name:"annotations",label:t("annotations"),KeyComponent:l=>e(Ke,{...l,selectItems:[{key:"inputType",value:t("inputType")},{key:"inputHelperTextBefore",value:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",value:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",value:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",value:t("inputTypePlaceholder")},{key:"inputTypeSize",value:t("inputTypeSize")},{key:"inputTypeCols",value:t("inputTypeCols")},{key:"inputTypeRows",value:t("inputTypeRows")},{key:"inputTypeStep",value:t("inputTypeStep")},{key:"kcNumberFormat",value:t("kcNumberFormat")},{key:"kcNumberUnFormat",value:t("kcNumberUnFormat")}]}),ValueComponent:l=>l.keyValue==="inputType"?e(_e,{selectItems:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"],...l}):e(ce,{"aria-label":t("customValue"),"data-testid":l.name,...l,...a(l.name)})})})})})})},ee=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],Je=()=>{const{adminClient:t}=ne(),{t:a}=k(),l=E(),[n,s]=V(),[u,o]=V(),[v,y]=V(!1),[d,b]=V(!1),[x,p]=V(""),T=Ge(),{attributeName:i}=J(),w=!!i,q=W({control:l.control,name:"hasSelector"}),S=W({control:l.control,name:"hasRequiredScopes"}),P=W({control:l.control,name:"isRequired",defaultValue:!1});if(z(()=>t.clientScopes.find(),s,[]),z(()=>t.users.getProfile(),o,[]),!n)return e(me,{});function m(r){l.setValue("hasSelector",r)}function g(r){l.setValue("hasRequiredScopes",r)}const C=()=>T(n,ze("name")).filter(r=>x===""||r.name?.includes(x)).map(r=>e(K,{value:r.name,children:r.name},r.name)),I=[...te,"firstName","lastName"];return e(_,{...l,children:h($,{role:"manage-realm",isHorizontal:!0,children:[e(F,{name:"name",label:a("attributeName"),labelIcon:a("upAttributeNameHelp"),isDisabled:w,rules:{required:a("validateAttributeName")}}),e(f,{label:a("attributeDisplayName"),labelIcon:e(R,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-displayName",children:e(Ee,{attributeName:"name",prefix:"profile.attributes",fieldName:"displayName",predefinedAttributes:["username","email","firstName","lastName"]})}),e(Be,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),!I.includes(i)&&e(F,{name:"defaultValue",label:a("defaultValue"),labelIcon:a("defaultValueHelp")}),e(pe,{name:"group",label:a("attributeGroup"),labelIcon:a("attributeGroupHelp"),controller:{defaultValue:""},options:[{key:"",value:a("none")},...u?.groups?.map(r=>({key:r.name,value:r.name}))||[]]}),!te.includes(i)&&h(H,{children:[e(Q,{}),h(f,{label:a("enabledWhen"),labelIcon:e(R,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(O,{id:"always","data-testid":"always",isChecked:!q,name:"enabledWhen",label:a("always"),onChange:()=>m(!1),className:"pf-v5-u-mb-md"}),e(O,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:q,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>m(!0),className:"pf-v5-u-mb-md"})]}),q&&e(f,{fieldId:"kc-scope-enabled-when",children:e(L,{name:"selector.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(M,{"data-testid":"enabled-when-scope-field",variant:X.typeaheadMulti,onFilter:c=>(p(c),C()),typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:c=>y(c),selections:r.value,onSelect:c=>{const N=c.toString();let A=[""];r.value?A=r.value.includes(N)?r.value.filter(j=>j!==N):[...r.value,N]:A=[N],r.onChange(A)},onClear:()=>{r.onChange([])},isOpen:v,"aria-labelledby":"scope",children:C()})})})]}),i!=="username"&&h(H,{children:[e(Q,{}),e(f,{label:a("required"),labelIcon:e(R,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(L,{name:"isRequired","data-testid":"required",defaultValue:!1,control:l.control,render:({field:r})=>e(he,{id:"kc-required",onChange:r.onChange,isChecked:r.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),P&&h(H,{children:[e(f,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(L,{name:"required.roles","data-testid":"requiredFor",defaultValue:ee[0].value,control:l.control,render:({field:r})=>e("div",{className:"kc-requiredFor",children:ee.map(c=>e(O,{id:c.label,"data-testid":c.label,isChecked:Qe(r.value,c.value),name:"roles",onChange:()=>{r.onChange(c.value)},label:a(c.label),className:"kc-requiredFor-option"},c.label))})})}),h(f,{label:a("requiredWhen"),labelIcon:e(R,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(O,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!S,name:"requiredWhen",label:a("always"),onChange:()=>g(!1),className:"pf-v5-u-mb-md"}),e(O,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:S,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>g(!0),className:"pf-v5-u-mb-md"})]}),S&&e(f,{fieldId:"kc-scope-required-when",children:e(L,{name:"required.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(M,{"data-testid":"required-when-scope-field",variant:X.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:c=>b(c),selections:r.value,onSelect:c=>{const N=c.toString();let A=[""];r.value?A=r.value.includes(N)?r.value.filter(j=>j!==N):[...r.value,N]:A=[N],r.onChange(A)},onClear:()=>{r.onChange([])},isOpen:d,"aria-labelledby":"scope",children:n.map(c=>e(K,{value:c.name,children:c.name},c.name))})})})]})]})]})})},ae=({name:t})=>{const{t:a}=k(),{control:l}=E();return e(le,{children:e(L,{name:`permissions.${t}`,control:l,defaultValue:[],render:({field:n})=>h(H,{children:[e(G,{lg:4,sm:6,children:e(Y,{id:`user-${t}`,label:a("user"),value:"user","data-testid":`user-${t}`,isChecked:n.value.includes("user"),onChange:()=>{const s="user",u=n.value.includes(s)?n.value.filter(o=>o!==s):[...n.value,s];n.onChange(u)}})}),e(G,{lg:8,sm:6,children:e(Y,{id:`admin-${t}`,label:a("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:n.value.includes("admin"),onChange:()=>{const s="admin",u=n.value.includes(s)?n.value.filter(o=>o!==s):[...n.value,s];n.onChange(u)}})})]})})})},Fe=()=>{const{t}=k();return h($,{role:"manage-realm",isHorizontal:!0,children:[e(f,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(R,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(ae,{name:"edit"})}),e(f,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(R,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(ae,{name:"view"})})]})},Xe=({selectedValidators:t,onChange:a})=>{const{t:l}=k(),n=ie().componentTypes?.["org.keycloak.validate.Validator"]||[],s=Pe(()=>n.filter(({id:d})=>!t.includes(d)),[t]),[u,o]=re(),[v,y]=V();return e(f,{label:l("validatorType"),fieldId:"validator",children:e(M,{toggleId:"validator",onToggle:o,onSelect:d=>{const b=d;a(b),y(b),o()},selections:v?.id,variant:"single","aria-label":l("selectOne"),isOpen:u,placeholderText:l("choose"),menuAppendTo:"parent",maxHeight:300,children:s.map(d=>e(K,{selected:v?.id===d.id,value:d,description:d.helpText,children:d.id},d.id))})})},Ye=({selectedValidators:t,toggleDialog:a,onConfirm:l})=>{const{t:n}=k(),[s,u]=V(),o=ie().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,v=se(),{handleSubmit:y}=v,d=b=>{l({...b,id:s?.id}),a()};return e(be,{variant:ve.small,title:n("addValidator"),isOpen:!0,onClose:a,actions:[e(D,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:n("save")},"save"),e(D,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:a,children:n("cancel")},"cancel")],children:o?n("emptyValidators"):h(oe,{id:"add-validator",onSubmit:y(d),children:[e(Xe,{selectedValidators:t.map(b=>b.key),onChange:u}),s&&e(_,{...v,children:e(je,{properties:s.properties})})]})})},Ze=()=>{const{t}=k(),[a,l]=re(),[n,s]=V(),{setValue:u,control:o,register:v,getValues:y}=E(),d=W({name:"validations",control:o,defaultValue:[]});Oe(()=>{v("validations")},[v]);const[b,x]=Ue({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:n}),continueButtonLabel:"delete",continueButtonVariant:ge.danger,onConfirm:async()=>{const p=d.filter(T=>T.key!==n);u("validations",[...p])}});return h(H,{children:[a&&e(Ye,{selectedValidators:d,onConfirm:p=>{const T=y("annotations");p.id==="options"&&!T.find(i=>i.key==="inputType")&&u("annotations",[...T,{key:"inputType",value:"select"}]),u("validations",[...d,{key:p.id,value:p.config}])},toggleDialog:l}),e(x,{}),h("div",{className:"kc-attributes-validations",children:[e(D,{id:"addValidator",onClick:()=>l(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(ye,{}),children:t("addValidator")}),e(Q,{}),d.length!==0?h(fe,{children:[e(Te,{children:h(Z,{children:[e(B,{children:t("validatorColNames.colName")}),e(B,{children:t("validatorColNames.colConfig")}),e(B,{"aria-hidden":"true"})]})}),e(Ce,{children:d.map(p=>h(Z,{children:[e(U,{dataLabel:t("validatorColNames.colName"),children:p.key}),e(U,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(p.value)}),e(U,{className:"kc--attributes-validations--action-cell",children:e(D,{variant:"link","data-testid":"deleteValidator",onClick:()=>{b(),s(p.key)},children:t("delete")},"validator")})]},p.key))})]}):e(Ve,{className:"kc-emptyValidators",component:ke.p,children:t("emptyValidators")})]})]})},te=["username","email"],ea=({save:t})=>{const{t:a}=k(),l=E(),{realm:n,attributeName:s}=J(),u=!!s;return h(De,{children:[e(we,{label:a("jumpToSection"),sections:[{title:a("generalSettings"),panel:e(Je,{})},{title:a("permission"),panel:e(Fe,{})},{title:a("validations"),panel:e(Ze,{})},{title:a("annotations"),panel:e($e,{})}]}),e(oe,{onSubmit:l.handleSubmit(t),children:h(Le,{name:"attribute-settings",children:[e(D,{variant:"primary",type:"submit","data-testid":"attribute-create",children:a(u?"save":"create")}),e(Re,{to:de({realm:n,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:a("cancel")})]})})]})};function Aa(){const{adminClient:t}=ne(),{realm:a,attributeName:l}=J(),n=se(),{t:s}=k(),u=qe(),{addAlert:o,addError:v}=Se(),[y,d]=V(null),b=!!l;z(()=>t.users.getProfile(),p=>{d(p);const{annotations:T,validations:i,permissions:w,selector:q,required:S,multivalued:P,defaultValue:m,...g}=p.attributes.find(C=>C.name===l)||{permissions:{edit:["admin"]}};Ne({...g,hasSelector:typeof q<"u",hasRequiredScopes:typeof S?.scopes<"u"},n.setValue),Object.entries(Ie({permissions:w,selector:q,required:S},{safe:!0})).map(([C,I])=>n.setValue(C,I)),n.setValue("annotations",Object.entries(T||{}).map(([C,I])=>({key:C,value:I}))),n.setValue("validations",Object.entries(i||{}).map(([C,I])=>({key:C,value:I}))),n.setValue("isRequired",S!==void 0),n.setValue("multivalued",P===!0),n.setValue("defaultValue",m)},[]);const x=async({hasSelector:p,hasRequiredScopes:T,...i})=>{p||delete i.selector,T||delete i.required?.scopes;const w=i.validations.reduce((m,g)=>(m[g.key]=g.value||{},m),{}),q=i.annotations.reduce((m,g)=>Object.assign(m,{[g.key]:g.value}),{}),S=()=>(y?.attributes||[]).map(m=>m.name!==l?m:(delete m.required,Object.assign({...m,name:l,displayName:i.displayName,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:q,validations:w},i.defaultValue?{defaultValue:i.defaultValue}:{defaultValue:null},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:{group:null}))),P=()=>(y?.attributes||[]).concat([Object.assign({name:i.name,displayName:i.displayName,required:i.isRequired?i.required:void 0,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:q,validations:w},i.defaultValue?{defaultValue:i.defaultValue}:{defaultValue:null},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:void 0)]);try{const m=b?S():P();if(await t.users.updateProfile({...y,attributes:m,realm:a}),i.translation)try{await We({adminClient:t,realmName:a,translationsData:{translation:i.translation}})}catch(g){v(s("errorSavingTranslations"),g)}u(de({realm:a,tab:"attributes"})),o(s("createAttributeSuccess"),xe.success)}catch(m){v("createAttributeError",m)}};return h(_,{...n,children:[e(He,{titleKey:b?l:s("createAttribute"),subKey:b?"":s("createAttributeSubTitle")}),e(Ae,{variant:"light",children:e(ea,{save:()=>n.handleSubmit(x)()})})]})}export{te as USERNAME_EMAIL,Aa as default};
//# sourceMappingURL=NewAttributeSettings-CLC6AG4r.js.map
