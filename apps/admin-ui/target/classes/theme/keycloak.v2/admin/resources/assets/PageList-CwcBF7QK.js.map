{"version":3,"file":"PageList-CwcBF7QK.js","sources":["../../../../../../../src/page/PageList.tsx"],"sourcesContent":["import ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport type { ComponentQuery } from \"@keycloak/keycloak-admin-client/lib/resources/components\";\r\nimport {\r\n  KeycloakDataTable,\r\n  ListEmptyState,\r\n  useAlerts,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  ButtonVariant,\r\n  PageSection,\r\n  ToolbarItem,\r\n} from \"@patternfly/react-core\";\r\nimport { IRowData } from \"@patternfly/react-table\";\r\nimport { get } from \"lodash-es\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate, useParams } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { useConfirmDialog } from \"../components/confirm-dialog/ConfirmDialog\";\r\nimport { ViewHeader } from \"../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport { useServerInfo } from \"../context/server-info/ServerInfoProvider\";\r\nimport { PAGE_PROVIDER } from \"./constants\";\r\nimport { addDetailPage, PageListParams, toDetailPage } from \"./routes\";\r\n\r\ntype DetailLinkProps = {\r\n  obj: ComponentRepresentation;\r\n  field: string;\r\n};\r\n\r\nconst DetailLink = ({ obj, field }: DetailLinkProps) => {\r\n  const { realm } = useRealm();\r\n  const value = get(obj, field);\r\n  return (\r\n    <Link\r\n      key={value}\r\n      to={toDetailPage({ realm, providerId: obj.providerId!, id: obj.id! })}\r\n    >\r\n      {value}\r\n    </Link>\r\n  );\r\n};\r\nexport default function PageList() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { addAlert, addError } = useAlerts();\r\n  const navigate = useNavigate();\r\n  const { providerId } = useParams<PageListParams>();\r\n  const [key, setKey] = useState(0);\r\n  const refresh = () => setKey(key + 1);\r\n\r\n  const { realm: realmName, realmRepresentation: realm } = useRealm();\r\n  const [selectedItem, setSelectedItem] = useState<ComponentRepresentation>();\r\n  const { componentTypes } = useServerInfo();\r\n  const pages = componentTypes?.[PAGE_PROVIDER];\r\n\r\n  const page = pages?.find((p) => p.id === providerId)!;\r\n\r\n  const loader = async () => {\r\n    const params: ComponentQuery = {\r\n      parent: realm?.id,\r\n      type: PAGE_PROVIDER,\r\n    };\r\n    return await adminClient.components.find({ ...params });\r\n  };\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: \"itemDeleteConfirmTitle\",\r\n    messageKey: \"itemDeleteConfirm\",\r\n    continueButtonLabel: \"delete\",\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.components.del({\r\n          id: selectedItem!.id!,\r\n        });\r\n        addAlert(t(\"itemDeletedSuccess\"));\r\n        refresh();\r\n      } catch (error) {\r\n        addError(\"itemSaveError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <PageSection variant=\"light\" className=\"pf-v5-u-p-0\">\r\n      <DeleteConfirm />\r\n      <ViewHeader titleKey={page.id} subKey={page.helpText} divider={false} />\r\n      <KeycloakDataTable\r\n        key={key}\r\n        toolbarItem={\r\n          <ToolbarItem>\r\n            <Button\r\n              component={(props) => (\r\n                <Link\r\n                  {...props}\r\n                  to={addDetailPage({ realm: realmName, providerId: page.id })}\r\n                />\r\n              )}\r\n            >\r\n              {t(\"createItem\")}\r\n            </Button>\r\n          </ToolbarItem>\r\n        }\r\n        actionResolver={(item: IRowData) => [\r\n          {\r\n            title: t(\"delete\"),\r\n            onClick() {\r\n              setSelectedItem(item.data);\r\n              toggleDeleteDialog();\r\n            },\r\n          },\r\n        ]}\r\n        searchPlaceholderKey=\"searchItem\"\r\n        loader={loader}\r\n        columns={[\r\n          ...(\r\n            page.metadata.displayFields ||\r\n            page.properties.slice(0, 3).map((p) => p.name)\r\n          ).map((name: string, index: number) => ({\r\n            name: `config.${name}[0]`,\r\n            displayKey: page.properties.find((p) => p.name === name)!.label,\r\n            cellRenderer:\r\n              index === 0\r\n                ? (obj: ComponentRepresentation) => (\r\n                    <DetailLink obj={obj} field={`config.${name}`} />\r\n                  )\r\n                : undefined,\r\n          })),\r\n        ]}\r\n        ariaLabelKey=\"list\"\r\n        emptyState={\r\n          <ListEmptyState\r\n            hasIcon\r\n            message={t(\"noItems\")}\r\n            instructions={t(\"noItemsInstructions\")}\r\n            primaryActionText={t(\"createItem\")}\r\n            onPrimaryAction={() =>\r\n              navigate(addDetailPage({ realm: realmName, providerId: page.id }))\r\n            }\r\n          />\r\n        }\r\n      />\r\n    </PageSection>\r\n  );\r\n}\r\n"],"names":["DetailLink","obj","field","realm","useRealm","value","get","jsx","Link","toDetailPage","PageList","adminClient","useAdminClient","t","useTranslation","addAlert","addError","useAlerts","navigate","useNavigate","providerId","useParams","key","setKey","useState","refresh","realmName","selectedItem","setSelectedItem","componentTypes","useServerInfo","page","PAGE_PROVIDER","p","loader","params","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","error","jsxs","PageSection","ViewHeader","KeycloakDataTable","ToolbarItem","Button","props","addDetailPage","item","name","index","ListEmptyState"],"mappings":"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"}