{"version":3,"file":"AddOpenIdConnect-vF7I6OUH.js","sources":["../../../../../../../src/identity-providers/add/AddOpenIdConnect.tsx"],"sourcesContent":["import type IdentityProviderRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/identityProviderRepresentation\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useLocation, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport { toIdentityProvider } from \"../routes/IdentityProvider\";\r\nimport { toIdentityProviders } from \"../routes/IdentityProviders\";\r\nimport { OIDCAuthentication } from \"./OIDCAuthentication\";\r\nimport { OIDCGeneralSettings } from \"./OIDCGeneralSettings\";\r\nimport { OpenIdConnectSettings } from \"./OpenIdConnectSettings\";\r\n\r\ntype DiscoveryIdentity = IdentityProviderRepresentation & {\r\n  discoveryEndpoint?: string;\r\n};\r\n\r\nexport default function AddOpenIdConnect() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { pathname } = useLocation();\r\n  const isKeycloak = pathname.includes(\"keycloak-oidc\");\r\n  const id = `${isKeycloak ? \"keycloak-\" : \"\"}oidc`;\r\n\r\n  const form = useForm<IdentityProviderRepresentation>({\r\n    defaultValues: { alias: id },\r\n    mode: \"onChange\",\r\n  });\r\n  const {\r\n    handleSubmit,\r\n    formState: { isDirty },\r\n  } = form;\r\n\r\n  const { addAlert, addError } = useAlerts();\r\n  const { realm } = useRealm();\r\n\r\n  const onSubmit = async (provider: DiscoveryIdentity) => {\r\n    delete provider.discoveryEndpoint;\r\n    try {\r\n      await adminClient.identityProviders.create({\r\n        ...provider,\r\n        providerId: id,\r\n      });\r\n      addAlert(t(\"createIdentityProviderSuccess\"), AlertVariant.success);\r\n      navigate(\r\n        toIdentityProvider({\r\n          realm,\r\n          providerId: id,\r\n          alias: provider.alias!,\r\n          tab: \"settings\",\r\n        }),\r\n      );\r\n    } catch (error) {\r\n      addError(\"createIdentityProviderError\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader\r\n        titleKey={t(\r\n          isKeycloak ? \"addKeycloakOpenIdProvider\" : \"addOpenIdProvider\",\r\n        )}\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <FormProvider {...form}>\r\n          <FormAccess\r\n            role=\"manage-identity-providers\"\r\n            isHorizontal\r\n            onSubmit={handleSubmit(onSubmit)}\r\n          >\r\n            <OIDCGeneralSettings />\r\n            <OpenIdConnectSettings isOIDC />\r\n            <OIDCAuthentication />\r\n            <ActionGroup>\r\n              <Button\r\n                isDisabled={!isDirty}\r\n                variant=\"primary\"\r\n                type=\"submit\"\r\n                data-testid=\"createProvider\"\r\n              >\r\n                {t(\"add\")}\r\n              </Button>\r\n              <Button\r\n                variant=\"link\"\r\n                data-testid=\"cancel\"\r\n                component={(props) => (\r\n                  <Link {...props} to={toIdentityProviders({ realm })} />\r\n                )}\r\n              >\r\n                {t(\"cancel\")}\r\n              </Button>\r\n            </ActionGroup>\r\n          </FormAccess>\r\n        </FormProvider>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["AddOpenIdConnect","adminClient","useAdminClient","t","useTranslation","navigate","useNavigate","pathname","useLocation","isKeycloak","id","form","useForm","handleSubmit","isDirty","addAlert","addError","useAlerts","realm","useRealm","onSubmit","provider","AlertVariant","toIdentityProvider","error","jsxs","Fragment","jsx","ViewHeader","PageSection","FormProvider","FormAccess","OIDCGeneralSettings","OpenIdConnectSettings","OIDCAuthentication","ActionGroup","Button","props","Link","toIdentityProviders"],"mappings":"w1BAyBA,SAAwBA,IAAmB,CACzC,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACRC,EAAWC,EAAA,EACX,CAAE,SAAAC,CAAA,EAAaC,EAAA,EACfC,EAAaF,EAAS,SAAS,eAAe,EAC9CG,EAAK,GAAGD,EAAa,YAAc,EAAE,OAErCE,EAAOC,EAAwC,CACnD,cAAe,CAAE,MAAOF,CAAA,EACxB,KAAM,UAAA,CACP,EACK,CACJ,aAAAG,EACA,UAAW,CAAE,QAAAC,CAAA,CAAQ,EACnBH,EAEE,CAAE,SAAAI,EAAU,SAAAC,CAAA,EAAaC,EAAA,EACzB,CAAE,MAAAC,CAAA,EAAUC,EAAA,EAEZC,EAAW,MAAOC,GAAgC,CACtD,OAAOA,EAAS,kBAChB,GAAI,CACF,MAAMpB,EAAY,kBAAkB,OAAO,CACzC,GAAGoB,EACH,WAAYX,CAAA,CACb,EACDK,EAASZ,EAAE,+BAA+B,EAAGmB,EAAa,OAAO,EACjEjB,EACEkB,EAAmB,CACjB,MAAAL,EACA,WAAYR,EACZ,MAAOW,EAAS,MAChB,IAAK,UAAA,CACN,CAAA,CAEL,OAASG,EAAO,CACdR,EAAS,8BAA+BQ,CAAK,CAC/C,CACF,EAEA,OACEC,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CACC,SAAUzB,EACRM,EAAa,4BAA8B,mBAAA,CAC7C,CAAA,IAEDoB,EAAA,CAAY,QAAQ,QACnB,SAAAF,EAACG,EAAA,CAAc,GAAGnB,EAChB,SAAAc,EAACM,EAAA,CACC,KAAK,4BACL,aAAY,GACZ,SAAUlB,EAAaO,CAAQ,EAE/B,SAAA,CAAAO,EAACK,EAAA,EAAoB,EACrBL,EAACM,EAAA,CAAsB,OAAM,EAAA,CAAC,IAC7BC,EAAA,EAAmB,IACnBC,EAAA,CACC,SAAA,CAAAR,EAACS,EAAA,CACC,WAAY,CAACtB,EACb,QAAQ,UACR,KAAK,SACL,cAAY,iBAEX,WAAE,KAAK,CAAA,CAAA,EAEVa,EAACS,EAAA,CACC,QAAQ,OACR,cAAY,SACZ,UAAYC,GACVV,EAACW,EAAA,CAAM,GAAGD,EAAO,GAAIE,EAAoB,CAAE,MAAArB,CAAA,CAAO,CAAA,CAAG,EAGtD,WAAE,QAAQ,CAAA,CAAA,CACb,CAAA,CACF,CAAA,CAAA,CAAA,EAEJ,CAAA,CACF,CAAA,EACF,CAEJ"}