import{aw as I,av as K,dJ as re,dK as oe,a as k,L as F,at as le,j as ce,C as q,aM as de,l as me,F as pe,Q as v,U as ue,A as he,g as M,al as Pe,u as ye,_ as ge,d as fe,b as be,y as ve,o as Ce,aW as De,p as Ne,P as xe,dL as $,dM as G,aB as Te,aQ as ke,bo as we,ay as z,aK as g,aR as Ee,aP as p,dN as Se,bt as _e,bl as Ae,bs as Le,br as Re,T as W,v as J}from"./main-o1hptXRo.js";import*as B from"react";import{useEffect as je,useState as f}from"react";import{jsxs as r,jsx as e,Fragment as b}from"react/jsx-runtime";import{u as ze}from"./ConfirmDialog-BkU7melV.js";import{a as Fe,b as Me,c as Oe,D as He}from"./DescriptionListTerm-CNzJUZBE.js";import{N as V}from"./NewPolicyDialog-CIlfdiTN.js";import{u as Ie}from"./useIsAdminPermissionsClient-BY-AG4cQ.js";const Ke=s=>{var{className:t,children:l}=s,i=I(s,["className","children"]);return B.createElement("div",Object.assign({className:K(re.panelHeader,t)},i),l)};Ke.displayName="PanelHeader";var O;(function(s){s.ul="ul",s.ol="ol",s.dl="dl"})(O||(O={}));const Be=s=>{var{children:t=null,className:l="",component:i=O.ul,isPlain:a=!1}=s,c=I(s,["children","className","component","isPlain"]);const o=i;return B.createElement(o,Object.assign({},c,{className:K(a&&oe.modifiers.plain,l)}),t)};Be.displayName="TextList";var H;(function(s){s.li="li",s.dt="dt",s.dd="dd"})(H||(H={}));const Qe=s=>{var{children:t=null,className:l="",component:i=H.li}=s,a=I(s,["children","className","component"]);const c=i;return B.createElement(c,Object.assign({},a,{className:K(l)}),t)};Qe.displayName="TextListItem";function es(s){return e(X,{...s})}function X({name:s,array:t,convert:l,link:i}){const{t:a}=k();return r(Fe,{children:[e(Me,{children:a(s)}),r(Oe,{children:[t?.map(c=>{const o=typeof c=="string"?c:l(c);return i?e(F,{to:i(c),className:"pf-v5-u-pr-sm",children:o},o):e("span",{className:"pf-v5-u-pr-sm",children:o},o)}),t?.length===0&&e("i",{children:a("none")})]})]})}const Ue=({array:s})=>{const{t}=k();return!s||s.length<=1?null:e(le,{color:"blue",children:t("more",{count:s.length-1})})},$e=({types:s,search:t,onSearch:l,type:i})=>{const{t:a}=k(),c=ce({mode:"onChange"}),{reset:o,formState:{isDirty:C},handleSubmit:y}=c,[D,u]=q(),w=m=>{u(),l(m)};return je(()=>o(t),[t]),e(de,{onOpenChange:u,toggle:m=>r(Pe,{"data-testid":"searchdropdown_dorpdown",ref:m,onClick:u,className:"keycloak__client_authentication__searchdropdown",children:[i==="resource"&&a("searchClientAuthorizationResource"),i==="policy"&&a("searchClientAuthorizationPolicy"),i==="permission"&&a("searchClientAuthorizationPermission")]}),isOpen:D,children:e(me,{...c,children:r(pe,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:y(w),children:[e(v,{name:"name",label:a("name")}),i==="resource"&&r(b,{children:[e(v,{name:"type",label:a("type")}),e(v,{name:"uris",label:a("uris")}),e(v,{name:"owner",label:a("owner")})]}),i!=="resource"&&i!=="policy"&&e(v,{name:"resource",label:a("resource")}),i!=="policy"&&e(v,{name:"scope",label:a("scope")}),i!=="resource"&&e(ue,{name:"type",label:a("type"),controller:{defaultValue:""},options:[{key:"",value:a("allTypes")},...(s||[]).map(({type:m,name:E})=>({key:m,value:E}))]}),r(he,{children:[e(M,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!C,children:a("search")}),e(M,{variant:"link","data-testid":"revert-btn",onClick:()=>l({}),children:a("clear")})]})]})})})},Ge=({row:s})=>r(b,{children:[s.dependentPolicies?.[0]?.name," ",e(Ue,{array:s.dependentPolicies})]}),ss=({clientId:s,isDisabled:t=!1})=>{const{adminClient:l}=ye(),{t:i}=k(),{addAlert:a,addError:c}=ge(),{realm:o}=fe(),C=be(),[y,D]=f(),[u,w]=f(),[m,E]=f(),[Q,Y]=f(0),Z=()=>Y(Q+1),[S,ee]=f(10),[_,A]=f(0),[N,se]=f({}),[U,x]=q(),h=Ie(s);ve(async()=>{const n=await l.clients.listPolicies({first:_,max:S+1,id:s,permission:"false",...N});return await Promise.all([l.clients.listPolicyProviders({id:s}),...(n||[]).map(async P=>{const d=await l.clients.listDependentPolicies({id:s,policyId:P.id});return{...P,dependentPolicies:d,isExpanded:!1}})])},([n,...P])=>{E(n.filter(d=>d.type!=="resource"&&d.type!=="scope")),D(P)},[Q,N,_,S]);const[ne,ie]=ze({titleKey:"deletePolicy",children:r(b,{children:[i("deletePolicyConfirm"),u?.dependentPolicies&&u.dependentPolicies.length>0&&e(De,{variant:"warning",isInline:!0,isPlain:!0,component:"p",title:i("deletePolicyWarning"),className:"pf-v5-u-pt-lg",children:e("p",{className:"pf-v5-u-pt-xs",children:u.dependentPolicies.map(n=>e("strong",{className:"pf-v5-u-pr-md",children:n.name},n.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await l.clients.delPolicy({id:s,policyId:u?.id}),a(i("policyDeletedSuccess"),Ce.success),Z()}catch(n){c("policyDeletedError",n)}}});if(!y)return e(Ne,{});const T=y.length===0,L=Object.keys(N).length!==0;return r(xe,{variant:"light",className:"pf-v5-u-p-0",children:[e(ie,{}),(!T||L)&&r(b,{children:[U&&e(V,{policyProviders:m,onSelect:n=>C(h?$({realm:o,permissionClientId:s,policyType:n.type}):G({id:s,realm:o,policyType:n.type})),toggleDialog:x}),e(Te,{count:y.length,first:_,max:S,onNextClick:A,onPreviousClick:A,onPerPageSelect:(n,P)=>{A(n),ee(P)},toolbarItem:r(b,{children:[e(W,{children:e($e,{types:m,search:N,onSearch:se,type:"policy"})}),e(W,{children:e(M,{"data-testid":"createPolicy",onClick:()=>{x()},isDisabled:t,children:i(h?"createPermissionPolicy":"createPolicy")})})]}),children:!T&&r(ke,{"aria-label":i("resources"),variant:"compact",children:[e(we,{children:r(z,{children:[e(g,{"aria-hidden":"true"}),e(g,{children:i("name")}),e(g,{children:i("type")}),e(g,{children:i("dependentPermission")}),e(g,{children:i("description")}),e(g,{"aria-hidden":"true"})]})}),y.map((n,P)=>r(Ee,{isExpanded:n.isExpanded,children:[r(z,{children:[e(p,{expand:{rowIndex:P,isExpanded:n.isExpanded,onToggle:(d,R)=>{const ae=y.map((j,te)=>te===R?{...j,isExpanded:!j.isExpanded}:j);D(ae)}}}),e(p,{"data-testid":`name-column-${n.name}`,children:h?e(F,{to:Se({realm:o,permissionClientId:s,policyId:n.id,policyType:n.type}),children:n.name}):e(F,{to:_e({realm:o,id:s,policyType:n.type,policyId:n.id}),children:n.name})}),e(p,{children:Ae(n.type)}),e(p,{children:e(Ge,{row:n})}),e(p,{children:n.description}),!t&&e(p,{actions:{items:[{title:i("delete"),onClick:()=>{w(n),ne()}}]}})]}),r(z,{isExpanded:n.isExpanded,children:[e(p,{}),e(p,{colSpan:3+(t?0:1),children:r(Le,{children:[n.isExpanded&&!h&&e(He,{isHorizontal:!0,className:"keycloak_resource_details",children:e(X,{name:"dependentPermission",array:n.dependentPolicies,convert:d=>d.name,link:d=>Re({realm:o,id:s,permissionId:d.id,permissionType:d.type})})}),n.isExpanded&&h&&r(b,{children:[e(g,{children:i("dependentPermission")}),n.dependentPolicies.map((d,R)=>e(p,{children:e("span",{style:{marginLeft:"8px"},children:d.name})},R))]})]})})]},`child-${n.id}`)]},n.id))]})})]}),T&&L&&e(J,{isSearchVariant:!0,isDisabled:t,message:i("noSearchResults"),instructions:i("noSearchResultsInstructions")}),T&&!L&&r(b,{children:[U&&e(V,{policyProviders:m?.filter(n=>n.type!=="aggregate"),onSelect:n=>C(h?$({realm:o,permissionClientId:s,policyType:n.type}):G({id:s,realm:o,policyType:n.type})),toggleDialog:x}),e(J,{message:i("emptyPolicies"),instructions:i(h?"emptyPermissionPoliciesInstructions":"emptyPoliciesInstructions"),isDisabled:t,primaryActionText:i(h?"createPermissionPolicy":"createPolicy"),onPrimaryAction:()=>x()})]})]})};export{ss as A,X as D,Ue as M,Ke as P,$e as S,Be as T,Qe as a,es as b,O as c,H as d};
//# sourceMappingURL=Policies-7P-WRxCs.js.map
