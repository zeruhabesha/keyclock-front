{"version":3,"file":"UserFederationLdapSettings-XE-h2J8q.js","sources":["../../../../../../../src/user-federation/ldap/mappers/LdapMapperList.tsx","../../../../../../../src/user-federation/UserFederationLdapSettings.tsx"],"sourcesContent":["import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport {\r\n  Action,\r\n  KeycloakDataTable,\r\n  ListEmptyState,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  AlertVariant,\r\n  Button,\r\n  ButtonVariant,\r\n  ToolbarItem,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, To, useNavigate, useParams } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../../admin-client\";\r\nimport { useConfirmDialog } from \"../../../components/confirm-dialog/ConfirmDialog\";\r\nimport useLocaleSort, { mapByKey } from \"../../../utils/useLocaleSort\";\r\n\r\nexport type LdapMapperListProps = {\r\n  toCreate: To;\r\n  toDetail: (mapperId: string) => To;\r\n};\r\n\r\ntype MapperLinkProps = ComponentRepresentation & {\r\n  toDetail: (mapperId: string) => To;\r\n};\r\n\r\nconst MapperLink = ({ toDetail, ...mapper }: MapperLinkProps) => (\r\n  <Link to={toDetail(mapper.id!)}>{mapper.name}</Link>\r\n);\r\n\r\nexport const LdapMapperList = ({ toCreate, toDetail }: LdapMapperListProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { addAlert, addError } = useAlerts();\r\n  const [key, setKey] = useState(0);\r\n  const refresh = () => setKey(key + 1);\r\n\r\n  const [mappers, setMappers] = useState<ComponentRepresentation[]>([]);\r\n  const localeSort = useLocaleSort();\r\n\r\n  const { id } = useParams<{ id: string }>();\r\n\r\n  const [selectedMapper, setSelectedMapper] =\r\n    useState<ComponentRepresentation>();\r\n\r\n  useFetch(\r\n    () =>\r\n      adminClient.components.find({\r\n        parent: id,\r\n        type: \"org.keycloak.storage.ldap.mappers.LDAPStorageMapper\",\r\n      }),\r\n    (mapper) => {\r\n      setMappers(\r\n        localeSort(\r\n          mapper.map((mapper) => ({\r\n            ...mapper,\r\n            name: mapper.name,\r\n            type: mapper.providerId,\r\n          })),\r\n          mapByKey(\"name\"),\r\n        ),\r\n      );\r\n    },\r\n    [key],\r\n  );\r\n\r\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\r\n    titleKey: t(\"deleteMappingTitle\", { mapperId: selectedMapper?.id }),\r\n    messageKey: \"deleteMappingConfirm\",\r\n    continueButtonLabel: \"delete\",\r\n    continueButtonVariant: ButtonVariant.danger,\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.components.del({\r\n          id: selectedMapper!.id!,\r\n        });\r\n        refresh();\r\n        addAlert(t(\"mappingDeletedSuccess\"), AlertVariant.success);\r\n        setSelectedMapper(undefined);\r\n      } catch (error) {\r\n        addError(\"mappingDeletedError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <DeleteConfirm />\r\n      <KeycloakDataTable\r\n        key={key}\r\n        loader={mappers}\r\n        ariaLabelKey=\"ldapMappersList\"\r\n        searchPlaceholderKey=\"searchForMapper\"\r\n        toolbarItem={\r\n          <ToolbarItem>\r\n            <Button\r\n              data-testid=\"add-mapper-btn\"\r\n              variant=\"primary\"\r\n              component={(props) => <Link {...props} to={toCreate} />}\r\n            >\r\n              {t(\"addMapper\")}\r\n            </Button>\r\n          </ToolbarItem>\r\n        }\r\n        actions={[\r\n          {\r\n            title: t(\"delete\"),\r\n            onRowClick: (mapper) => {\r\n              setSelectedMapper(mapper);\r\n              toggleDeleteDialog();\r\n            },\r\n          } as Action<ComponentRepresentation>,\r\n        ]}\r\n        columns={[\r\n          {\r\n            name: \"name\",\r\n            cellRenderer: (row) => <MapperLink {...row} toDetail={toDetail} />,\r\n          },\r\n          {\r\n            name: \"type\",\r\n          },\r\n        ]}\r\n        emptyState={\r\n          <ListEmptyState\r\n            message={t(\"emptyMappers\")}\r\n            instructions={t(\"emptyMappersInstructions\")}\r\n            primaryActionText={t(\"emptyPrimaryAction\")}\r\n            onPrimaryAction={() => navigate(toCreate)}\r\n          />\r\n        }\r\n      />\r\n    </>\r\n  );\r\n};\r\n","import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport {\r\n  KeycloakSpinner,\r\n  useAlerts,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  AlertVariant,\r\n  PageSection,\r\n  Tab,\r\n  TabTitleText,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport {\r\n  RoutableTabs,\r\n  useRoutableTab,\r\n} from \"../components/routable-tabs/RoutableTabs\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport {\r\n  LdapComponentRepresentation,\r\n  UserFederationLdapForm,\r\n  serializeFormData,\r\n} from \"./UserFederationLdapForm\";\r\nimport { LdapMapperList } from \"./ldap/mappers/LdapMapperList\";\r\nimport {\r\n  UserFederationLdapParams,\r\n  toUserFederationLdap,\r\n} from \"./routes/UserFederationLdap\";\r\nimport { toUserFederationLdapMapper } from \"./routes/UserFederationLdapMapper\";\r\nimport { ExtendedHeader } from \"./shared/ExtendedHeader\";\r\n\r\nexport default function UserFederationLdapSettings() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const form = useForm<LdapComponentRepresentation>({ mode: \"onChange\" });\r\n  const { realm } = useRealm();\r\n  const { id } = useParams<UserFederationLdapParams>();\r\n  const { addAlert, addError } = useAlerts();\r\n  const [component, setComponent] = useState<ComponentRepresentation>();\r\n  const [refreshCount, setRefreshCount] = useState(0);\r\n\r\n  const refresh = () => setRefreshCount((count) => count + 1);\r\n\r\n  useFetch(\r\n    () => adminClient.components.findOne({ id: id! }),\r\n    (component) => {\r\n      if (!component) {\r\n        throw new Error(t(\"notFound\"));\r\n      }\r\n\r\n      setComponent(component);\r\n      setupForm(component);\r\n    },\r\n    [id, refreshCount],\r\n  );\r\n\r\n  const settingsTab = useRoutableTab(\r\n    toUserFederationLdap({ realm, id: id!, tab: \"settings\" }),\r\n  );\r\n  const mappersTab = useRoutableTab(\r\n    toUserFederationLdap({ realm, id: id!, tab: \"mappers\" }),\r\n  );\r\n\r\n  const setupForm = (component: ComponentRepresentation) => {\r\n    form.reset({});\r\n    form.reset(component);\r\n    form.setValue(\r\n      \"config.periodicChangedUsersSync\",\r\n      component.config?.[\"changedSyncPeriod\"]?.[0] !== \"-1\",\r\n    );\r\n\r\n    form.setValue(\r\n      \"config.periodicFullSync\",\r\n      component.config?.[\"fullSyncPeriod\"]?.[0] !== \"-1\",\r\n    );\r\n  };\r\n\r\n  const onSubmit = async (formData: LdapComponentRepresentation) => {\r\n    try {\r\n      await adminClient.components.update(\r\n        { id: id! },\r\n        serializeFormData(formData),\r\n      );\r\n      addAlert(t(\"userProviderSaveSuccess\"), AlertVariant.success);\r\n      refresh();\r\n    } catch (error) {\r\n      addError(\"userProviderSaveError\", error);\r\n    }\r\n  };\r\n\r\n  if (!component) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <FormProvider {...form}>\r\n      <ExtendedHeader\r\n        provider=\"LDAP\"\r\n        noDivider\r\n        editMode={component.config?.editMode}\r\n        save={() => form.handleSubmit(onSubmit)()}\r\n      />\r\n      <PageSection variant=\"light\" className=\"pf-v5-u-p-0\">\r\n        <RoutableTabs\r\n          defaultLocation={toUserFederationLdap({\r\n            realm,\r\n            id: id!,\r\n            tab: \"settings\",\r\n          })}\r\n          isBox\r\n        >\r\n          <Tab\r\n            id=\"settings\"\r\n            title={<TabTitleText>{t(\"settings\")}</TabTitleText>}\r\n            {...settingsTab}\r\n          >\r\n            <PageSection variant=\"light\">\r\n              <UserFederationLdapForm id={id} onSubmit={onSubmit} />\r\n            </PageSection>\r\n          </Tab>\r\n          <Tab\r\n            id=\"mappers\"\r\n            title={<TabTitleText>{t(\"mappers\")}</TabTitleText>}\r\n            data-testid=\"ldap-mappers-tab\"\r\n            {...mappersTab}\r\n          >\r\n            <LdapMapperList\r\n              toCreate={toUserFederationLdapMapper({\r\n                realm,\r\n                id: id!,\r\n                mapperId: \"new\",\r\n              })}\r\n              toDetail={(mapperId) =>\r\n                toUserFederationLdapMapper({\r\n                  realm,\r\n                  id: id!,\r\n                  mapperId,\r\n                })\r\n              }\r\n            />\r\n          </Tab>\r\n        </RoutableTabs>\r\n      </PageSection>\r\n    </FormProvider>\r\n  );\r\n}\r\n"],"names":["MapperLink","toDetail","mapper","jsx","Link","LdapMapperList","toCreate","adminClient","useAdminClient","navigate","useNavigate","useTranslation","addAlert","addError","useAlerts","key","setKey","useState","refresh","mappers","setMappers","localeSort","useLocaleSort","id","useParams","selectedMapper","setSelectedMapper","useFetch","mapByKey","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","AlertVariant","error","jsxs","Fragment","KeycloakDataTable","ToolbarItem","Button","props","row","ListEmptyState","UserFederationLdapSettings","t","form","useForm","realm","useRealm","component","setComponent","refreshCount","setRefreshCount","count","setupForm","settingsTab","useRoutableTab","toUserFederationLdap","mappersTab","onSubmit","formData","serializeFormData","FormProvider","ExtendedHeader","PageSection","RoutableTabs","Tab","TabTitleText","UserFederationLdapForm","toUserFederationLdapMapper","mapperId","KeycloakSpinner"],"mappings":"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"}