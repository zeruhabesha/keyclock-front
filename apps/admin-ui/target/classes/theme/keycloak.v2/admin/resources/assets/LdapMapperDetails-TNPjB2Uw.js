import{jsx as t,jsxs as S,Fragment as R}from"react/jsx-runtime";import{u as U,j as $,b as Q,d as W,a as _,_ as z,y as J,m as X,B as Y,o as A,e$ as V,N as Z,p as ee,D as k,P as ae,l as te,Q as v,O as re,R as oe,bp as ne,bq as pe,W as se,A as ie,g as M,n as de,ak as le}from"./main-o1hptXRo.js";import{useState as c}from"react";import{u as ce}from"./ConfirmDialog-BkU7melV.js";import{c as me,D as ue}from"./DynamicComponents-CnLlz98z.js";import{F as ye}from"./FormAccess-BnhQnYb9.js";import{V as ge}from"./ViewHeader-BDBsroi3.js";import{u as fe}from"./useParams-CGVhlaFZ.js";import"react-dom";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./useLocaleSort-C-diWts5.js";import"./CodeEditor-C4IS5oxi.js";function Ee(){const{adminClient:l}=U(),p=$(),[i,L]=c(),[m,O]=c(),{id:g,mapperId:o}=fe(),u=Q(),{realm:f}=W(),{t:a}=_(),{addAlert:b,addError:h}=z(),[P,x]=c(!1),[q,E]=c(""),[w,K]=c(0),j=()=>K(w+1);J(async()=>{const e=await l.components.listSubComponents({id:g,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const r=await l.components.findOne({id:o});return{components:e,fetchedMapper:r}}return{components:e}},({components:e,fetchedMapper:r})=>{if(L(r),O(e),o!=="new"&&!r)throw new Error(a("notFound"));r&&T(r)},[]);const T=e=>{X(e,p.setValue)},N=async e=>{const r=de(e),n={...r,config:Object.entries(r.config||{}).reduce((y,[G,I])=>(y[G]=Array.isArray(I)?I:[I],y),{})};try{o==="new"?(await l.components.create(n),u(V({realm:f,id:e.parentId,tab:"mappers"}))):await l.components.update({id:o},n),T(n),b(a(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),A.success)}catch(y){h(o==="new"?"mappingCreatedError":"mappingUpdatedError",y)}},D=async e=>{try{const r=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:e});b(a("syncLDAPGroupsSuccessful",{result:r.status}))}catch(r){h("syncLDAPGroupsError",r)}j()},[B,H]=ce({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:Y.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),b(a("mappingDeletedSuccess"),A.success),u(V({id:g,realm:f,tab:"mappers"}))}catch(e){h("mappingDeletedError",e)}}}),F=Z({control:p.control,name:"providerId"}),C=()=>(m||[]).filter(e=>e.id.includes(q)).map(e=>t(le,{value:e.id,children:e.id},e.id));if(!m)return t(ee,{});const d=o==="new",s=m.find(e=>e.id===F);return S(R,{children:[t(H,{}),t(ge,{titleKey:i?i.name:a("createNewMapper"),dropdownItems:d?void 0:[t(k,{onClick:B,children:a("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[t(k,{onClick:()=>D("fedToKeycloak"),children:a(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[t(k,{onClick:async()=>{await D("keycloakToFed")},children:a(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},w),t(ae,{variant:"light",isFilled:!0,children:t(te,{...p,children:S(ye,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>N(p.getValues())),children:[!d&&t(v,{name:"id",label:a("id"),isDisabled:!0}),t(v,{name:"name",label:a("name"),labelIcon:a("mapperNameHelp"),isDisabled:!d,rules:{required:a("required")}}),t("input",{type:"hidden",defaultValue:d?g:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),t("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?t(re,{label:a("mapperType"),labelIcon:t(se,{helpText:s?.helpText?s.helpText:a("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:t(oe,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:e})=>t(ne,{toggleId:"kc-providerId",typeAheadAriaLabel:a("mapperType"),onToggle:x,isOpen:P,onFilter:r=>(E(r),C()),onSelect:r=>{T({providerId:r,...Object.fromEntries(m.find(n=>n.id===r)?.properties.filter(n=>n.type==="List").map(n=>[me(n.name),n.options?.[0]])||[])})},selections:e.value,variant:pe.typeahead,"aria-label":a("selectMapperType"),children:C()})})}):t(v,{name:"providerId",label:a("mapperType"),labelIcon:s?.helpText?s.helpText:a("mapperTypeHelp"),rules:{required:a("required")},isDisabled:!d}),!!F&&t(ue,{properties:s?.properties}),S(ie,{children:[t(M,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:a("save")}),t(M,{variant:"link",onClick:()=>u(d?-1:`/${f}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:a("cancel")})]})]})})})]})}export{Ee as default};
//# sourceMappingURL=LdapMapperDetails-TNPjB2Uw.js.map
