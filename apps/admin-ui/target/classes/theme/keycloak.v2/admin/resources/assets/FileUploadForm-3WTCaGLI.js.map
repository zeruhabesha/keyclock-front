{"version":3,"file":"FileUploadForm-3WTCaGLI.js","sources":["../../../../../../../src/components/json-file-upload/FileUploadForm.tsx"],"sourcesContent":["import {\r\n  Button,\r\n  DropEvent,\r\n  FileUpload,\r\n  FileUploadProps,\r\n  FormGroup,\r\n  FormHelperText,\r\n  HelperText,\r\n  HelperTextItem,\r\n  Modal,\r\n  ModalVariant,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  ChangeEvent,\r\n  DragEvent as ReactDragEvent,\r\n  MouseEvent as ReactMouseEvent,\r\n  useState,\r\n} from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport CodeEditor from \"../form/CodeEditor\";\r\n\r\ntype FileUploadType = {\r\n  value: string;\r\n  filename: string;\r\n  isLoading: boolean;\r\n  modal: boolean;\r\n};\r\n\r\nexport type FileUploadEvent =\r\n  | ReactDragEvent<HTMLElement> // User dragged/dropped a file\r\n  | ChangeEvent<HTMLTextAreaElement> // User typed in the TextArea\r\n  | ReactMouseEvent<HTMLButtonElement, MouseEvent>; // User clicked Clear button\r\n\r\nexport type FileUploadFormProps = Omit<FileUploadProps, \"onChange\"> & {\r\n  id: string;\r\n  extension: string;\r\n  onChange: (value: string) => void;\r\n  helpText?: string;\r\n  unWrap?: boolean;\r\n  language?: string;\r\n  previewMaxLength?: number;\r\n};\r\n\r\nexport const FileUploadForm = ({\r\n  id,\r\n  onChange,\r\n  helpText = \"helpFileUpload\",\r\n  unWrap = false,\r\n  previewMaxLength = 102400, // 100KB\r\n  language,\r\n  extension,\r\n  ...rest\r\n}: FileUploadFormProps) => {\r\n  const { t } = useTranslation();\r\n  const defaultUpload: FileUploadType = {\r\n    value: \"\",\r\n    filename: \"\",\r\n    isLoading: false,\r\n    modal: false,\r\n  };\r\n  const [fileUpload, setFileUpload] = useState<FileUploadType>(defaultUpload);\r\n  const removeDialog = () => setFileUpload({ ...fileUpload, modal: false });\r\n\r\n  const handleFileInputChange = (_event: DropEvent, file: File) => {\r\n    setFileUpload({ ...fileUpload, filename: file.name });\r\n  };\r\n\r\n  const handleTextOrDataChange = (value: string) => {\r\n    setFileUpload({ ...fileUpload, value });\r\n    onChange(value);\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setFileUpload({ ...fileUpload, modal: true });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {fileUpload.modal && (\r\n        <Modal\r\n          variant={ModalVariant.small}\r\n          title={t(\"clearFile\")}\r\n          isOpen\r\n          onClose={removeDialog}\r\n          actions={[\r\n            <Button\r\n              key=\"confirm\"\r\n              variant=\"primary\"\r\n              data-testid=\"clear-button\"\r\n              onClick={() => {\r\n                setFileUpload(defaultUpload);\r\n                onChange(\"\");\r\n              }}\r\n            >\r\n              {t(\"clear\")}\r\n            </Button>,\r\n            <Button\r\n              data-testid=\"cancel\"\r\n              key=\"cancel\"\r\n              variant=\"link\"\r\n              onClick={removeDialog}\r\n            >\r\n              {t(\"cancel\")}\r\n            </Button>,\r\n          ]}\r\n        >\r\n          {t(\"clearFileExplain\")}\r\n        </Modal>\r\n      )}\r\n      {unWrap && (\r\n        <FileUpload\r\n          id={id}\r\n          {...rest}\r\n          type=\"text\"\r\n          value={fileUpload.value}\r\n          filename={fileUpload.filename}\r\n          onFileInputChange={handleFileInputChange}\r\n          onDataChange={(_, value) => handleTextOrDataChange(value)}\r\n          onTextChange={(_, value) => handleTextOrDataChange(value)}\r\n          onClearClick={handleClear}\r\n          onReadStarted={() =>\r\n            setFileUpload({ ...fileUpload, isLoading: true })\r\n          }\r\n          onReadFinished={() =>\r\n            setFileUpload({ ...fileUpload, isLoading: false })\r\n          }\r\n          isLoading={fileUpload.isLoading}\r\n          dropzoneProps={{\r\n            accept: { \"application/text\": [extension] },\r\n          }}\r\n        />\r\n      )}\r\n      {!unWrap && (\r\n        <FormGroup label={t(\"resourceFile\")} fieldId={id + \"-filename\"}>\r\n          <FileUpload\r\n            data-testid={id}\r\n            id={id}\r\n            {...rest}\r\n            type=\"text\"\r\n            value={fileUpload.value}\r\n            filename={fileUpload.filename}\r\n            onFileInputChange={handleFileInputChange}\r\n            onDataChange={(_, value) => handleTextOrDataChange(value)}\r\n            onTextChange={(_, value) => handleTextOrDataChange(value)}\r\n            onClearClick={handleClear}\r\n            onReadStarted={() =>\r\n              setFileUpload({ ...fileUpload, isLoading: true })\r\n            }\r\n            onReadFinished={() =>\r\n              setFileUpload({ ...fileUpload, isLoading: false })\r\n            }\r\n            isLoading={fileUpload.isLoading}\r\n            hideDefaultPreview\r\n          >\r\n            {!rest.hideDefaultPreview &&\r\n              (!fileUpload.value ||\r\n              fileUpload.value.length < previewMaxLength ? (\r\n                <CodeEditor\r\n                  aria-label=\"File content\"\r\n                  value={fileUpload.value}\r\n                  language={language}\r\n                  onChange={(value) => handleTextOrDataChange(value)}\r\n                  readOnly={!rest.allowEditingUploadedText}\r\n                />\r\n              ) : (\r\n                <CodeEditor\r\n                  aria-label=\"File content\"\r\n                  value={t(\"fileUploadPreviewDisabled\")}\r\n                  readOnly\r\n                />\r\n              ))}\r\n          </FileUpload>\r\n          <FormHelperText>\r\n            <HelperText>\r\n              <HelperTextItem>{t(helpText)}</HelperTextItem>\r\n            </HelperText>\r\n          </FormHelperText>\r\n        </FormGroup>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n"],"names":["FileUploadForm","id","onChange","helpText","unWrap","previewMaxLength","language","extension","rest","useTranslation","defaultUpload","fileUpload","setFileUpload","useState","removeDialog","handleFileInputChange","_event","file","handleTextOrDataChange","value","handleClear","jsxs","Fragment","jsx","Modal","ModalVariant","Button","FileUpload","_","FormGroup","CodeEditor","FormHelperText","HelperText","HelperTextItem"],"mappings":"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"}