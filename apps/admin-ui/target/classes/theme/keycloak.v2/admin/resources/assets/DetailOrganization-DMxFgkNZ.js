import{jsx as e,jsxs as O,Fragment as U}from"react/jsx-runtime";import{u as F,d as Q,b as ye,a as L,_ as R,N as ae,a0 as Y,B as $,e0 as fe,R as ce,D as Ie,C as q,y as Z,p as Ce,O as Se,ai as ke,aj as Te,al as Oe,dR as ze,dS as De,Y as Pe,Z as de,dT as Me,g as w,di as Le,a7 as Ee,W as we,ak as ie,j as J,m as Ae,M as me,k as ue,l as X,F as he,U as xe,b3 as re,au as ee,n as Fe,c as Ke,P as j,v as G,e1 as Re,x as te,T as E,S as Ue,Q as W,e2 as Ve,L as Ne,bT as Be,c9 as _e,aS as je,A as Ge,cR as He}from"./main-o1hptXRo.js";import{F as $e}from"./FormAccess-BnhQnYb9.js";import{A as qe}from"./AttributeForm-DTyI1Rh5.js";import{u as We,R as Qe}from"./RoutableTabs-DyhWhd6v.js";import{u as ne}from"./useParams-CGVhlaFZ.js";import{V as Ye}from"./ViewHeader-BDBsroi3.js";import{u as H}from"./ConfirmDialog-BkU7melV.js";import{useState as I,useRef as Ze,useCallback as Je,useEffect as Xe}from"react";import{M as et}from"./ManageOrderDialog-DZujO-TJ.js";import{D as oe}from"./SwitchControl-CU1bUhmR.js";import{d as tt}from"./debounce-Dbkg0MD5.js";import{s as nt}from"./sortBy-DjlFeX8O.js";import{S as ge,C as pe}from"./SearchInputComponent-D_sKM8QK.js";import{u as at}from"./useFormatDate-CuGjRZ4j.js";import{M as it}from"./MembersModal-C7pjKBVL.js";import{t as rt}from"./translationFormatter-DQJeO7lr.js";import{T as ve,a as A,b as x}from"./Tabs-DSwQhKoJ.js";import{O as ot,c as st}from"./OrganizationForm-C-Cv6yUr.js";import{A as se}from"./AdminEvents-DIrkh5pf.js";import"react-dom";import"./KeyValueInput-BOsiIUR1.js";import"./ActionListItem-Cy-NQlq4.js";import"./PageHandler-B1ed5nYb.js";import"./DynamicComponents-CnLlz98z.js";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./useLocaleSort-C-diWts5.js";import"./CodeEditor-C4IS5oxi.js";import"./constants-BclHbWtx.js";import"./DataListControl-DO3by3XW.js";import"./Droppable-daSE-az7.js";import"./_baseFlatten-BLlCkxtA.js";import"./differenceBy-LE-r3AO1.js";import"./DropdownPanel-vRJu3PnV.js";import"./DatePicker-DiXxo4Fo.js";import"./pickBy-JGveacY0.js";import"./DescriptionListTerm-CNzJUZBE.js";const lt=({save:t})=>{const{adminClient:n}=F(),{realm:s}=Q(),y=ye(),{t:r}=L(),{addAlert:o,addError:c}=R(),i=ae({name:"id"}),m=ae({name:"name"}),{setValue:p}=Y(),[T,f]=H({titleKey:"disableConfirmOrganizationTitle",messageKey:"disableConfirmOrganization",continueButtonLabel:"disable",onConfirm:()=>{p("enabled",!1),t()}}),[S,u]=H({titleKey:"organizationDelete",messageKey:"organizationDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:$.danger,onConfirm:async()=>{try{await n.organizations.delById({id:i}),o(r("organizationDeletedSuccess")),y(fe({realm:s}))}catch(g){c("organizationDeleteError",g)}}});return e(ce,{name:"enabled",render:({field:{value:g,onChange:k}})=>O(U,{children:[e(u,{}),e(f,{}),e(Ye,{titleKey:m||"",divider:!1,dropdownItems:[e(Ie,{"data-testid":"delete-client",onClick:S,children:r("delete")},"delete")],isEnabled:g,onToggle:v=>{v?(k(v),t()):T()}})]})})},ct=({name:t,label:n,helpText:s,defaultValue:y,isRequired:r,variant:o="typeahead",isDisabled:c})=>{const{adminClient:i}=F(),{t:m}=L(),{control:p,getValues:T,formState:{errors:f}}=Y(),S=T(t),[u,g,k]=q(),[v,D]=I(""),C=Ze(),[l,N]=I([]),[K,V]=I(""),B=Je(tt(V,1e3),[]);Z(async()=>{const h={max:20,realmOnly:!0};return K&&(h.search=K),await i.identityProviders.find(h)},N,[K]);const _=h=>{const P=h.map(z=>e(ie,{value:z,selected:S?.includes(z.alias),children:z.alias},z.alias));return P.length===0?e(ie,{value:"",children:m("noResultsFound")}):P};return l?O(Se,{label:m(n),isRequired:r,labelIcon:s?e(we,{helpText:s,fieldLabelId:n}):void 0,fieldId:t,children:[e(ce,{name:t,defaultValue:y,control:p,rules:{validate:h=>r&&h.filter(P=>P!==void 0).length===0?m("required"):void 0},render:({field:h})=>e(ke,{id:t,onOpenChange:g,toggle:P=>e(Oe,{"data-testid":t,ref:P,variant:"typeahead",onClick:g,isExpanded:u,isFullWidth:!0,isDisabled:c,status:f[t]?"danger":void 0,children:O(ze,{isPlain:!0,children:[e(De,{value:v||h.value,onClick:g,onChange:(z,b)=>{k(!0),D(b),B(b)},autoComplete:"off",innerRef:C,placeholderText:m("selectAUser"),...h.value&&{"aria-activedescendant":h.value},role:"combobox",isExpanded:u,"aria-controls":"select-create-typeahead-listbox",children:o==="typeaheadMulti"&&Array.isArray(h.value)&&e(Pe,{"aria-label":"Current selections",children:h.value.map((z,b)=>e(de,{onClick:a=>{a.stopPropagation(),h.onChange(h.value.filter(d=>d!==z))},children:z},b))})}),e(Me,{children:!!K&&e(w,{variant:"plain",onClick:()=>{D(""),V(""),h.onChange([]),C?.current?.focus()},"aria-label":m("clear"),children:e(Le,{"aria-hidden":!0})})})]})}),isOpen:u,selected:h.value,onSelect:(P,z)=>{const a=z.alias;if(o!=="typeaheadMulti"){const d=h.value.includes(a);d?h.onChange([]):h.onChange([a]),D(d?"":a||""),k(!1)}else{const d=h.value.find(M=>M===a)?h.value.filter(M=>M!==a):[...h.value,a];h.onChange(d)}},"aria-label":m(t),children:e(Te,{children:_(l)})})}),f[t]&&e(Ee,{message:m("required")})]}):e(Ce,{})},dt=({orgId:t,identityProvider:n,onClose:s})=>{const{adminClient:y}=F(),{t:r}=L(),{addAlert:o,addError:c}=R(),i=J({mode:"onChange"}),{handleSubmit:m,formState:p,setValue:T}=i,{getValues:f}=Y();Xe(()=>Ae({...n,alias:[n?.alias],hideOnLogin:n?.hideOnLogin},T),[]);const S=async u=>{try{const g=await y.identityProviders.findOne({alias:u.alias[0]});if(!g)throw new Error(r("notFound"));const{config:k}=Fe(u);g.config={...g.config,...k},g.hideOnLogin=u.hideOnLogin??!0,await y.identityProviders.update({alias:u.alias[0]},g),n||await y.organizations.linkIdp({orgId:t,alias:u.alias[0]}),o(r(n?"linkUpdatedSuccessful":"linkSuccessful")),s()}catch(g){c(n?"linkUpdatedError":"linkError",g)}};return e(me,{variant:ue.small,title:r("linkIdentityProvider"),isOpen:!0,onClose:s,actions:[e(ee,{formState:p,"data-testid":"confirm",form:"form",allowInvalid:!0,allowNonDirty:!0,children:r("save")},"confirm"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:$.link,onClick:s,children:r("cancel")},"cancel")],children:e(X,{...i,children:O(he,{id:"form",onSubmit:m(S),children:[e(ct,{name:"alias",label:r("identityProvider"),defaultValue:[],isRequired:!0,isDisabled:!!n}),e(xe,{name:re("config.kc.org.domain"),label:r("domain"),controller:{defaultValue:""},options:[{key:"",value:r("none")},{key:"ANY",value:r("any")},...f("domains")?f("domains").map(u=>({key:u,value:u})):[]],menuAppendTo:"parent"}),e(oe,{name:"hideOnLogin",label:r("hideOnLoginPage"),labelIcon:r("hideOnLoginPageHelp"),defaultValue:!0}),e(oe,{name:re("config.kc.org.broker.redirect.mode.email-matches"),label:r("redirectWhenEmailMatches"),labelIcon:r("redirectWhenEmailMatchesHelp"),stringify:!0})]})})})},mt=({row:t,refresh:n})=>{const{adminClient:s}=F(),{addAlert:y,addError:r}=R(),{t:o}=L(),c=async i=>{try{await s.identityProviders.update({alias:t.alias},{...t,hideOnLogin:i}),y(o("linkUpdatedSuccessful")),n()}catch(m){r("linkUpdatedError",m)}};return e(Ue,{label:o("on"),labelOff:o("off"),isChecked:t.hideOnLogin,onChange:(i,m)=>c(m)})},ut=()=>{const{adminClient:t}=F(),{t:n}=L(),{id:s}=Ke(),{addAlert:y,addError:r}=R(),[o,c]=I(0),i=()=>c(o+1),[m,p]=I(!1),[T,f]=I(!1),[S,u]=I(),[g,k]=q();Z(async()=>t.identityProviders.find({max:1}),l=>{f(l.length===1)},[]);const v=async()=>{const l=await t.organizations.listIdentityProviders({orgId:s});return nt(l,"alias")},[D,C]=H({titleKey:"identityProviderUnlink",messageKey:"identityProviderUnlinkConfirm",continueButtonLabel:"unLinkIdentityProvider",continueButtonVariant:$.danger,onConfirm:async()=>{try{await t.organizations.unLinkIdp({orgId:s,alias:S.alias}),u(void 0),y(n("unLinkSuccessful")),i()}catch(l){r("unLinkError",l)}}});return O(U,{children:[m&&e(et,{orgId:s,onClose:()=>{p(!1),i()}}),O(j,{variant:"light",children:[e(C,{}),g&&e(dt,{orgId:s,identityProvider:S,onClose:()=>{k(),i()}}),T?e(te,{loader:v,ariaLabelKey:"identityProviders",searchPlaceholderKey:"searchProvider",toolbarItem:O(U,{children:[e(E,{children:e(w,{onClick:()=>{u(void 0),k()},children:n("linkIdentityProvider")})}),e(E,{children:e(w,{"data-testid":"manageDisplayOrder",variant:"link",onClick:()=>p(!0),children:n("manageDisplayOrder")})})]}),actions:[{title:n("edit"),onRowClick:l=>{u(l),k()}},{title:n("unLinkIdentityProvider"),onRowClick:l=>{u(l),D()}}],columns:[{name:"alias"},{name:"config['kc.org.domain']",displayKey:"domain"},{name:"providerId",displayKey:"providerDetails"},{name:"hideOnLogin",displayKey:"hideOnLoginPage",cellRenderer:l=>e(mt,{row:l,refresh:i})}],emptyState:e(G,{message:n("emptyIdentityProviderLink"),instructions:n("emptyIdentityProviderLinkInstructions"),primaryActionText:n("linkIdentityProvider"),onPrimaryAction:k})},o):e(G,{icon:Re,message:n("noIdentityProvider"),instructions:n("noIdentityProviderInstructions")})]})]})},ht=({orgId:t,onClose:n})=>{const{adminClient:s}=F(),{addAlert:y,addError:r}=R(),{t:o}=L(),c=J(),{handleSubmit:i,formState:m}=c,p=async T=>{try{const f=new FormData;for(const S in T)f.append(S,T[S]);await s.organizations.invite({orgId:t},f),y(o("inviteSent")),n()}catch(f){r("inviteSentError",f)}};return e(me,{variant:ue.small,title:o("inviteMember"),isOpen:!0,onClose:n,actions:[e(ee,{formState:m,"data-testid":"save",form:"form",allowInvalid:!0,allowNonDirty:!0,children:o("send")},"confirm"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:$.link,onClick:n,children:o("cancel")},"cancel")],children:e(X,{...c,children:O(he,{id:"form",onSubmit:i(p),children:[e(W,{name:"email",label:o("email"),rules:{required:o("required")},autoFocus:!0}),e(W,{name:"firstName",label:o("firstName")}),e(W,{name:"lastName",label:o("lastName")})]})})})},gt=({status:t})=>{const{t:n}=L();return e(de,{isReadOnly:!0,children:t?n(`organizationInvitationStatus.${t.toLowerCase()}`):""})},le=({date:t})=>{const n=at();if(!t)return e("span",{children:"-"});try{return e("span",{children:n(new Date(t*1e3))})}catch{return e("span",{children:t})}},pt=()=>{const{t}=L(),{adminClient:n}=F(),{id:s}=ne(),{addAlert:y,addError:r}=R(),[o,c]=I(0),i=()=>c(o+1),[m,p]=q(),[T,f]=I([]),[S,u]=I(""),[g,k]=I(""),[v,D]=I([]),[C,l]=I(!1),N=Object.values(Ve).map(a=>({value:a,label:t(`organizationInvitationStatus.${a.toLowerCase()}`)})),K=async(a,d)=>{try{return await n.organizations.listInvitations({orgId:s,first:a,max:d,search:g,status:v.length===1?v[0]:void 0})}catch(M){return r("organizationsInvitationsListError",M),[]}},V=()=>{k(S),i()},B=()=>{u(""),k(""),i()},_=async a=>{try{await n.organizations.resendInvitation({orgId:s,invitationId:a.id}),y(t("organizationInvitationResent")),i()}catch(d){r("organizationInvitationResendError",d)}},h=async a=>{try{await Promise.all(a.map(d=>n.organizations.deleteInvitation({orgId:s,invitationId:d.id}))),y(t("organizationInvitationsDeleted",{count:a.length})),i()}catch(d){r("organizationInvitationsDeleteError",d)}},[P,z]=H({titleKey:"organizationInvitationsDeleteConfirmTitle",messageKey:"organizationInvitationsDeleteConfirm",continueButtonLabel:"delete",onConfirm:()=>h(T)}),b=(a,d)=>{v.includes(d)?D(v.filter(M=>M!==d)):D([...v,d]),l(!1),i()};return O(U,{children:[e(z,{}),m&&e(ht,{orgId:s,onClose:()=>{p(),i()}}),e(te,{loader:K,isPaginated:!0,ariaLabelKey:"invitationsList",onSelect:f,canSelectAll:!0,toolbarItem:O(U,{children:[e(E,{children:e(ge,{value:S,onChange:u,onSearch:V,onClear:B,placeholder:t("searchInvitations"),"aria-label":t("searchInvitations")})}),e(E,{children:e(w,{variant:"primary",onClick:p,children:t("inviteMember")})}),e(E,{children:e(w,{variant:"plain",isDisabled:T.length===0,onClick:P,children:t("deleteInvitations")})}),e(E,{children:e(pe,{filterPlaceholderText:t("filterByStatus"),isOpen:C,options:N,onOpenChange:l,onToggleClick:()=>l(!C),onSelect:b,selectedItems:v,width:"200px"})})]}),actionResolver:a=>{const d=a.data,M=[{title:t("resendInvitation"),onClick:()=>_(d)},{title:t("deleteInvitation"),onClick:()=>{f([d]),P()}}];return d.inviteLink&&M.splice(1,0,{title:t("copyInviteLink"),onClick:async()=>{try{await navigator.clipboard.writeText(d.inviteLink),y(t("inviteLinkCopied"))}catch(be){r("clipboardCopyError",be)}}}),M},columns:[{name:"email",displayKey:"email"},{name:"firstName",displayKey:"firstName",cellRenderer:a=>a.firstName||"-"},{name:"lastName",displayKey:"lastName",cellRenderer:a=>a.lastName||"-"},{name:"sentDate",displayKey:"sentDate",cellRenderer:a=>e(le,{date:a.sentDate})},{name:"expiresAt",displayKey:"expiresAt",cellRenderer:a=>e(le,{date:a.expiresAt})},{name:"status",displayKey:"status",cellRenderer:a=>e(gt,{status:a.status})}],emptyState:e(G,{message:t("emptyInvitations"),instructions:t("emptyInvitationsInstructions"),secondaryActions:[{text:t("inviteMember"),onClick:p}]}),isSearching:g.length>0||v.length>0},o)]})},vt=t=>{const{realm:n}=Q();return e(Ne,{to:Be({realm:n,id:t.id,tab:"settings"}),children:t.username})},bt=()=>{const{t}=L(),{adminClient:n}=F(),{id:s}=ne(),{addAlert:y,addError:r}=R(),[o,c]=I(0),i=()=>c(o+1),[m,p]=q(),[T,f]=I([]),[S,u]=I(""),[g,k]=I(""),[v,D]=I([]),[C,l]=I(!1),N=[{value:"Managed",label:"Managed"},{value:"Unmanaged",label:"Unmanaged"}],K=()=>{l(!C)},V=(b,a)=>{v.includes(a)?D(v.filter(d=>d!==a)):D([...v,a]),l(!1),i()},B=async(b,a)=>{try{const d=v.length===1?v[0]:void 0;return await n.organizations.listMembers({orgId:s,first:b,max:a,search:g,membershipType:d})}catch(d){return r("organizationsMembersListError",d),[]}},_=b=>{u(b)},h=()=>{k(S),i()},P=()=>{u(""),k(""),i()},z=async b=>{try{await Promise.all(b.map(a=>n.organizations.delMember({orgId:s,userId:a.id}))),y(t("organizationUsersLeft",{count:b.length}))}catch(a){r("organizationUsersLeftError",a)}i()};return O(U,{children:[m&&e(it,{membersQuery:()=>n.organizations.listMembers({orgId:s}),onAdd:async b=>{try{await Promise.all(b.map(a=>n.organizations.addMember({orgId:s,userId:`"${a.id}"`}))),y(t("organizationUsersAdded",{count:b.length}))}catch(a){r("organizationUsersAddedError",a)}},onClose:()=>{p(),i()}}),e(te,{loader:B,isPaginated:!0,ariaLabelKey:"membersList",onSelect:b=>f([...b]),canSelectAll:!0,toolbarItem:O(U,{children:[e(E,{children:e(ge,{value:S,onChange:_,onSearch:h,onClear:P,placeholder:t("searchMembers"),"aria-label":t("searchMembers")})}),e(E,{children:e(w,{variant:"primary",onClick:p,children:t("addMember")})}),e(E,{children:e(w,{variant:"plain",isDisabled:T.length===0,onClick:()=>z(T),children:t("removeMember")})}),e(E,{children:e(pe,{filterPlaceholderText:t("filterByMembershipType"),isOpen:C,options:N,onOpenChange:b=>l(b),onToggleClick:K,onSelect:V,selectedItems:v,width:"260px"})})]}),actions:[{title:t("remove"),onRowClick:async b=>{await z([b])}}],columns:[{name:"username",cellRenderer:vt},{name:"email"},{name:"firstName"},{name:"lastName"},{name:"membershipType",cellFormatters:[rt(t)]}],emptyState:e(G,{message:t("emptyMembers"),instructions:t("emptyMembersInstructions"),secondaryActions:[{text:t("addRealmUser"),onClick:p}]}),isSearching:v.length>0||g.length>0},o)]})},yt=()=>{const{t}=L(),[n,s]=I("members");return O(ve,{activeKey:n,onSelect:(y,r)=>s(r),children:[e(A,{eventKey:"members",title:e(x,{children:t("members")}),"data-testid":"organization-members-tab",children:e(bt,{})}),e(A,{eventKey:"invitations",title:e(x,{children:t("invitations")}),"data-testid":"organization-invitations-tab",children:e(pt,{})})]})};function ln(){const{adminClient:t}=F(),{addAlert:n,addError:s}=R(),{realm:y,realmRepresentation:r}=Q(),{id:o}=ne(),{t:c}=L(),i=J(),m=async C=>{try{const l=st(C);await t.organizations.updateById({id:o},l),n(c("organizationSaveSuccess"))}catch(l){s("organizationSaveError",l)}};Z(()=>t.organizations.findOne({id:o}),C=>{if(!C)throw new Error(c("notFound"));i.reset({...C,domains:C.domains?.map(l=>l.name),attributes:_e(C.attributes)})},[o]);const p=C=>We(He({realm:y,id:o,tab:C})),T=p("settings"),f=p("attributes"),S=p("members"),u=p("identityProviders"),g=p("events"),{hasAccess:k}=je(),[v,D]=I("adminEvents");return e(j,{variant:"light",className:"pf-v5-u-p-0",children:O(X,{...i,children:[e(lt,{save:()=>m(i.getValues())}),O(Qe,{"data-testid":"organization-tabs","aria-label":c("organization"),isBox:!0,mountOnEnter:!0,children:[e(A,{id:"settings","data-testid":"settingsTab",title:e(x,{children:c("settings")}),...T,children:e(j,{children:O($e,{role:"anyone",onSubmit:i.handleSubmit(m),isHorizontal:!0,children:[e(ot,{readOnly:!0}),O(Ge,{children:[e(ee,{formState:i.formState,"data-testid":"save",children:c("save")}),e(w,{onClick:()=>i.reset(),"data-testid":"reset",variant:"link",children:c("reset")})]})]})})}),e(A,{id:"attributes","data-testid":"attributeTab",title:e(x,{children:c("attributes")}),...f,children:e(j,{variant:"light",children:e(qe,{form:i,save:m,reset:()=>i.reset({...i.getValues()}),name:"attributes"})})}),e(A,{id:"members","data-testid":"membersTab",title:e(x,{children:c("members")}),...S,children:e(yt,{})}),e(A,{id:"identityProviders","data-testid":"identityProvidersTab",title:e(x,{children:c("identityProviders")}),...u,children:e(ut,{})}),r?.adminEventsEnabled&&k("view-events")&&e(A,{"data-testid":"admin-events-tab",title:e(x,{children:c("adminEvents")}),...g,children:O(ve,{activeKey:v,onSelect:(C,l)=>D(l),children:[e(A,{eventKey:"adminEvents",title:e(x,{children:c("adminEvents")}),children:e(se,{resourcePath:`organizations/${o}`})}),e(A,{eventKey:"membershipEvents",title:e(x,{children:c("membershipEvents")}),children:e(se,{resourcePath:`organizations/${o}/members`})})]})})]})]})})}export{ln as default};
//# sourceMappingURL=DetailOrganization-DMxFgkNZ.js.map
