{"version":3,"file":"TimeSelector-1gdltitc.js","sources":["../../../../../../../src/components/time-selector/TimeSelector.tsx"],"sourcesContent":["import {\r\n  KeycloakSelect,\r\n  KeycloakSelectProps,\r\n  SelectVariant,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  SelectOption,\r\n  Split,\r\n  SplitItem,\r\n  TextInput,\r\n  TextInputProps,\r\n} from \"@patternfly/react-core\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport type Unit = \"second\" | \"minute\" | \"hour\" | \"day\";\r\n\r\ntype TimeUnit = { unit: Unit; label: string; multiplier: number };\r\n\r\nconst allTimes: TimeUnit[] = [\r\n  { unit: \"second\", label: \"times.seconds\", multiplier: 1 },\r\n  { unit: \"minute\", label: \"times.minutes\", multiplier: 60 },\r\n  { unit: \"hour\", label: \"times.hours\", multiplier: 3600 },\r\n  { unit: \"day\", label: \"times.days\", multiplier: 86400 },\r\n];\r\n\r\nexport type TimeSelectorProps = Omit<\r\n  TextInputProps,\r\n  \"onChange\" | \"defaultValue\"\r\n> &\r\n  Pick<KeycloakSelectProps, \"menuAppendTo\"> & {\r\n    value?: number;\r\n    units?: Unit[];\r\n    onChange?: (time: number | string) => void;\r\n    className?: string;\r\n  };\r\n\r\nconst getTimeUnit = (units: TimeUnit[], value = 0) =>\r\n  units.reduce(\r\n    (v, time) =>\r\n      value % time.multiplier === 0 && v.multiplier < time.multiplier\r\n        ? time\r\n        : v,\r\n    units[0],\r\n  );\r\n\r\nexport const toHumanFormat = (value: number, locale: string) => {\r\n  const timeUnit = getTimeUnit(allTimes, value);\r\n  const formatter = new Intl.NumberFormat(locale, {\r\n    style: \"unit\",\r\n    unit: timeUnit.unit,\r\n    unitDisplay: \"long\",\r\n  });\r\n  return formatter.format(value / timeUnit.multiplier);\r\n};\r\n\r\nexport const TimeSelector = ({\r\n  value,\r\n  units = [\"second\", \"minute\", \"hour\", \"day\"],\r\n  onChange,\r\n  className,\r\n  min,\r\n  menuAppendTo,\r\n  ...rest\r\n}: TimeSelectorProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  const [lastMultiplier, setLastMultiplier] = useState<number>();\r\n\r\n  const defaultMultiplier = useMemo(\r\n    () => allTimes.find((time) => time.unit === units[0])?.multiplier,\r\n    [units],\r\n  );\r\n\r\n  const [timeValue, setTimeValue] = useState<\"\" | number>(\"\");\r\n  const [multiplier, setMultiplier] = useState(defaultMultiplier);\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const times = useMemo(() => {\r\n    const filteredUnits = units.map(\r\n      (unit) => allTimes.find((time) => time.unit === unit)!,\r\n    );\r\n    if (\r\n      !filteredUnits.every((u) => u.multiplier === multiplier) &&\r\n      filteredUnits[0] !== allTimes[0]\r\n    ) {\r\n      filteredUnits.unshift(allTimes[0]);\r\n    }\r\n    return filteredUnits;\r\n  }, [units, multiplier]);\r\n\r\n  useEffect(() => {\r\n    const multiplier = getTimeUnit(times, value).multiplier;\r\n\r\n    if (value) {\r\n      setMultiplier(multiplier);\r\n      setTimeValue(value / multiplier);\r\n      setLastMultiplier(multiplier);\r\n    } else {\r\n      setTimeValue(value || \"\");\r\n      setMultiplier(lastMultiplier ?? defaultMultiplier);\r\n      setLastMultiplier(lastMultiplier ?? defaultMultiplier);\r\n    }\r\n  }, [value, defaultMultiplier]);\r\n\r\n  const updateTimeout = (\r\n    timeout: \"\" | number,\r\n    times: number | undefined = multiplier,\r\n  ) => {\r\n    if (timeout !== \"\") {\r\n      onChange?.(timeout * (times || 1));\r\n      setTimeValue(timeout);\r\n    } else {\r\n      onChange?.(\"\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Split hasGutter className={className}>\r\n      <SplitItem>\r\n        <TextInput\r\n          {...rest}\r\n          type=\"number\"\r\n          aria-label=\"kc-time\"\r\n          min={min || 0}\r\n          value={timeValue}\r\n          className={`${className}-input`}\r\n          onChange={(_event, value) => {\r\n            updateTimeout(\"\" === value ? value : parseInt(value));\r\n          }}\r\n        />\r\n      </SplitItem>\r\n      <SplitItem id={`${className}-select-menu`}>\r\n        <KeycloakSelect\r\n          variant={SelectVariant.single}\r\n          aria-label={t(\"unitLabel\")}\r\n          className={`${className}-select`}\r\n          onSelect={(value) => {\r\n            setMultiplier(value as number);\r\n            updateTimeout(timeValue, value as number);\r\n            setOpen(false);\r\n          }}\r\n          menuAppendTo={menuAppendTo}\r\n          selections={multiplier}\r\n          onToggle={() => {\r\n            setOpen(!open);\r\n          }}\r\n          isOpen={open}\r\n          isDisabled={rest.isDisabled}\r\n        >\r\n          {times.map((time) => (\r\n            <SelectOption\r\n              id={time.label}\r\n              key={time.label}\r\n              value={time.multiplier}\r\n            >\r\n              {t(time.label)}\r\n            </SelectOption>\r\n          ))}\r\n        </KeycloakSelect>\r\n      </SplitItem>\r\n    </Split>\r\n  );\r\n};\r\n"],"names":["allTimes","getTimeUnit","units","value","v","time","toHumanFormat","locale","timeUnit","TimeSelector","onChange","className","min","menuAppendTo","rest","t","useTranslation","lastMultiplier","setLastMultiplier","useState","defaultMultiplier","useMemo","timeValue","setTimeValue","multiplier","setMultiplier","open","setOpen","times","filteredUnits","unit","u","useEffect","updateTimeout","timeout","jsxs","Split","jsx","SplitItem","TextInput","_event","KeycloakSelect","SelectVariant","SelectOption"],"mappings":"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"}