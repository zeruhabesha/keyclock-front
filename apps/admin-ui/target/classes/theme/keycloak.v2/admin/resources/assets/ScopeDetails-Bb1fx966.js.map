{"version":3,"file":"ScopeDetails-Bb1fx966.js","sources":["../../../../../../../src/clients/authorization/ScopeDetails.tsx"],"sourcesContent":["import type ScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/scopeRepresentation\";\r\nimport { TextControl, useAlerts, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  ButtonVariant,\r\n  DropdownItem,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { FormAccess } from \"../../components/form/FormAccess\";\r\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\r\nimport { useParams } from \"../../utils/useParams\";\r\nimport useToggle from \"../../utils/useToggle\";\r\nimport { toAuthorizationTab } from \"../routes/AuthenticationTab\";\r\nimport type { ScopeDetailsParams } from \"../routes/Scope\";\r\nimport { DeleteScopeDialog } from \"./DeleteScopeDialog\";\r\n\r\ntype FormFields = Omit<ScopeRepresentation, \"resources\">;\r\n\r\nexport default function ScopeDetails() {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { id, scopeId, realm } = useParams<ScopeDetailsParams>();\r\n  const navigate = useNavigate();\r\n  const { addAlert, addError } = useAlerts();\r\n  const [deleteDialog, toggleDeleteDialog] = useToggle();\r\n  const [scope, setScope] = useState<ScopeRepresentation>();\r\n  const form = useForm<FormFields>({\r\n    mode: \"onChange\",\r\n  });\r\n  const { reset, handleSubmit } = form;\r\n\r\n  useFetch(\r\n    async () => {\r\n      if (scopeId) {\r\n        const scope = await adminClient.clients.getAuthorizationScope({\r\n          id,\r\n          scopeId,\r\n        });\r\n        if (!scope) {\r\n          throw new Error(t(\"notFound\"));\r\n        }\r\n        return scope;\r\n      }\r\n    },\r\n    (scope) => {\r\n      setScope(scope);\r\n      reset({ ...scope });\r\n    },\r\n    [],\r\n  );\r\n\r\n  const onSubmit = async (scope: ScopeRepresentation) => {\r\n    try {\r\n      if (scopeId) {\r\n        await adminClient.clients.updateAuthorizationScope(\r\n          { id, scopeId },\r\n          scope,\r\n        );\r\n        setScope(scope);\r\n      } else {\r\n        await adminClient.clients.createAuthorizationScope(\r\n          { id },\r\n          {\r\n            name: scope.name!,\r\n            displayName: scope.displayName,\r\n            iconUri: scope.iconUri,\r\n          },\r\n        );\r\n        navigate(toAuthorizationTab({ realm, clientId: id, tab: \"scopes\" }));\r\n      }\r\n      addAlert(\r\n        t((scopeId ? \"update\" : \"create\") + \"ScopeSuccess\"),\r\n        AlertVariant.success,\r\n      );\r\n    } catch (error) {\r\n      addError(\"scopeSaveError\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <DeleteScopeDialog\r\n        clientId={id}\r\n        open={deleteDialog}\r\n        toggleDialog={toggleDeleteDialog}\r\n        selectedScope={scope}\r\n        refresh={() =>\r\n          navigate(toAuthorizationTab({ realm, clientId: id, tab: \"scopes\" }))\r\n        }\r\n      />\r\n      <ViewHeader\r\n        titleKey={scopeId ? scope?.name! : t(\"createAuthorizationScope\")}\r\n        dropdownItems={\r\n          scopeId\r\n            ? [\r\n                <DropdownItem\r\n                  key=\"delete\"\r\n                  data-testid=\"delete-resource\"\r\n                  onClick={() => toggleDeleteDialog()}\r\n                >\r\n                  {t(\"delete\")}\r\n                </DropdownItem>,\r\n              ]\r\n            : undefined\r\n        }\r\n      />\r\n      <PageSection variant=\"light\">\r\n        <FormProvider {...form}>\r\n          <FormAccess\r\n            isHorizontal\r\n            role=\"manage-authorization\"\r\n            onSubmit={handleSubmit(onSubmit)}\r\n          >\r\n            <TextControl\r\n              name=\"name\"\r\n              label={t(\"name\")}\r\n              labelIcon={t(\"scopeNameHelp\")}\r\n              rules={{ required: t(\"required\") }}\r\n            />\r\n            <TextControl\r\n              name=\"displayName\"\r\n              label={t(\"displayName\")}\r\n              labelIcon={t(\"scopeDisplayNameHelp\")}\r\n            />\r\n            <TextControl\r\n              name=\"iconUri\"\r\n              label={t(\"iconUri\")}\r\n              labelIcon={t(\"iconUriHelp\")}\r\n            />\r\n            <ActionGroup>\r\n              <div className=\"pf-v5-u-mt-md\">\r\n                <Button\r\n                  variant={ButtonVariant.primary}\r\n                  type=\"submit\"\r\n                  data-testid=\"save\"\r\n                >\r\n                  {t(\"save\")}\r\n                </Button>\r\n\r\n                {!scope ? (\r\n                  <Button\r\n                    variant=\"link\"\r\n                    data-testid=\"cancel\"\r\n                    component={(props) => (\r\n                      <Link\r\n                        {...props}\r\n                        to={toAuthorizationTab({\r\n                          realm,\r\n                          clientId: id,\r\n                          tab: \"scopes\",\r\n                        })}\r\n                      ></Link>\r\n                    )}\r\n                  >\r\n                    {t(\"cancel\")}\r\n                  </Button>\r\n                ) : (\r\n                  <Button\r\n                    variant=\"link\"\r\n                    data-testid=\"revert\"\r\n                    onClick={() => reset({ ...scope })}\r\n                  >\r\n                    {t(\"revert\")}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            </ActionGroup>\r\n          </FormAccess>\r\n        </FormProvider>\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["ScopeDetails","adminClient","useAdminClient","t","useTranslation","id","scopeId","realm","useParams","navigate","useNavigate","addAlert","addError","useAlerts","deleteDialog","toggleDeleteDialog","useToggle","scope","setScope","useState","form","useForm","reset","handleSubmit","useFetch","onSubmit","toAuthorizationTab","AlertVariant","error","jsxs","Fragment","jsx","DeleteScopeDialog","ViewHeader","DropdownItem","PageSection","FormProvider","FormAccess","TextControl","ActionGroup","Button","ButtonVariant","props","Link"],"mappings":"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"}