import{jsxs as o,Fragment as U,jsx as e}from"react/jsx-runtime";import{u as ae,a as P,d as V,j as re,y as ne,dB as ie,x as le,aX as oe,v as ce,L as de,bT as me,dC as I,K as pe,aL as ue,l as he,aC as ye,aD as S,F as ve,Q as b,O as _,R as g,bp as fe,bq as be,ak as _e,Y as w,Z as F,A as ge,g as N}from"./main-o1hptXRo.js";import{useState as d}from"react";import{D as Fe}from"./DropdownPanel-vRJu3PnV.js";import{u as ke,F as Ce}from"./useFormatDate-CuGjRZ4j.js";import{u as Te}from"./useLocaleSort-C-diWts5.js";import"./AdminEvents-DIrkh5pf.js";import{W as De}from"./warning-triangle-icon-Cc02WUGl.js";import{p as Ae}from"./pickBy-JGveacY0.js";import{D as O}from"./DatePicker-DiXxo4Fo.js";import{D as Ee,a as x,b as L,c as R}from"./DescriptionListTerm-CNzJUZBE.js";const Ie=a=>a.error?e(ue,{content:a.error,children:o("span",{children:[e(I,{status:"warning",children:e(De,{})}),a.type]})}):o("span",{children:[e(I,{status:"success",children:e(pe,{})}),a.type]}),Se=a=>o(Ee,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[a.details&&Object.entries(a.details).map(([i,c])=>o(x,{children:[e(L,{children:i}),e(R,{children:c})]},i)),a.error&&o(x,{children:[e(L,{children:"error"}),e(R,{children:a.error})]},"error")]}),we=a=>{const{t:i}=P(),{realm:c}=V();return o(U,{children:[a.userId&&e(de,{to:me({realm:c,id:a.userId,tab:"settings"}),children:a.userId},`link-${a.time}-${a.type}`),!a.userId&&i("noUserDetails")]})},$e=({user:a,client:i})=>{const{adminClient:c}=ae(),{t:r}=P(),j=Te(),{realm:k}=V(),B=ke(),[u,C]=d(0),[K,T]=d(!1),[G,$]=d(!1),[M,W]=d(),[z,H]=d(),[m,Q]=d({}),D={client:i||"",dateFrom:"",dateTo:"",user:a||"",type:[],ipAddress:""},q={client:r("client"),dateFrom:r("dateFrom"),dateTo:r("dateTo"),user:r("userId"),type:r("eventType"),ipAddress:r("ipAddress")},A=re({mode:"onChange",defaultValues:D}),{getValues:h,reset:y,formState:{isDirty:E},control:v,handleSubmit:X}=A;ne(()=>c.realms.getConfigEvents({realm:k}),s=>{H(s?.eventsEnabled),W(j(s?.enabledEventTypes||[],t=>t))},[]);function Y(s,t){return c.realms.findEvents({client:i,user:a,...m,realm:k,first:s,max:t})}function Z(){T(!1),p()}function J(){y(),p()}function ee(s){const t={...h()};delete t[s],y({...D,...t}),p()}function se(s,t){const n=h(),l=n[s],f=Array.isArray(l)?l.filter(te=>te!==t):l;y({...n,[s]:f}),p()}function p(){const s=Ae(h(),t=>t!==""||Array.isArray(t)&&t.length>0);a&&delete s.user,i&&delete s.client,Q(s),C(u+1)}return o(U,{children:[!z&&e(ie,{type:"userEvents"}),e(le,{loader:Y,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:Se}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:e(he,{...A,children:o(ye,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(S,{children:e(Fe,{buttonText:r("searchUserEventsBtn"),setSearchDropdownOpen:T,searchDropdownOpen:K,marginRight:"2.5rem",width:"15vw",children:o(ve,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:X(Z),isHorizontal:!0,children:[!a&&e(b,{name:"user",label:r("userId"),"data-testid":"userId-searchField"}),e(_,{label:r("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e(g,{name:"type",control:v,render:({field:s})=>e(fe,{className:"keycloak__events_search__type_select","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:r("hide"),collapsedText:r("showRemaining")},variant:be.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:t=>$(t),selections:s.value,onSelect:t=>{const n=t.toString(),l=s.value.includes(n)?s.value.filter(f=>f!==n):[...s.value,n];s.onChange(l)},onClear:()=>{s.onChange([])},isOpen:G,"aria-labelledby":"eventType",chipGroupComponent:e(w,{children:s.value.map(t=>e(F,{onClick:n=>{n.stopPropagation(),s.onChange(s.value.filter(l=>l!==t))},children:r(`eventTypes.${t}.name`)},t))}),children:M?.map(t=>e(_e,{value:t,children:r(`eventTypes.${t}.name`)},t))})})}),!i&&e(b,{name:"client",label:r("client"),"data-testid":"client-searchField"}),e(_,{label:r("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(g,{name:"dateFrom",control:v,render:({field:s})=>e(O,{className:"pf-v5-u-w-100",value:s.value,onChange:(t,n)=>s.onChange(n),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:r("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(g,{name:"dateTo",control:v,render:({field:s})=>e(O,{className:"pf-v5-u-w-100",value:s.value,onChange:(t,n)=>s.onChange(n),inputProps:{id:"kc-dateTo"}})})}),e(b,{name:"ipAddress",label:r("ipAddress"),"data-testid":"ipAddress-searchField"}),o(ge,{children:[e(N,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!E,children:r("searchUserEventsBtn")}),e(N,{variant:"secondary",onClick:J,isDisabled:!E,children:r("resetBtn")})]})]})})}),e(S,{children:Object.entries(m).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(m).map(s=>{const[t,n]=s;return t==="user"&&a||t==="client"&&i?null:e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:q[t],onClick:()=>ee(t),isClosable:!0,children:typeof n=="string"?e(F,{isReadOnly:!0,children:n}):n.map(l=>e(F,{onClick:()=>se(t,l),children:r(`eventTypes.${l}.name`)},l))},t)})})})]})}),columns:[{name:"time",displayKey:"time",cellRenderer:s=>B(new Date(s.time),Ce)},...a?[]:[{name:"userId",cellRenderer:we}],{name:"type",displayKey:"eventType",cellRenderer:Ie},{name:"ipAddress",displayKey:"ipAddress",transforms:[oe(10)]},...i?[]:[{name:"clientId",displayKey:"client"}]],emptyState:e(ce,{message:r("emptyUserEvents"),instructions:r("emptyUserEventsInstructions"),primaryActionText:r("refresh"),onPrimaryAction:()=>C(u+1)}),isSearching:Object.keys(m).length>0},u)]})};export{$e as U};
//# sourceMappingURL=UserEvents-CCx8BrF_.js.map
