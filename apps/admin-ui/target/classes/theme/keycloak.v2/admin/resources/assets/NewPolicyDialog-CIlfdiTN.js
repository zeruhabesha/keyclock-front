import{jsxs as y,jsx as e,Fragment as _}from"react/jsx-runtime";import{ax as Qe,b6 as j,dQ as Ie,aw as mt,ds as ht,dk as ft,dl as gt,dm as Ct,dj as yt,a3 as Tt,av as ve,bw as It,bx as vt,dn as St,dD as bt,dE as xt,u as ie,a as M,a0 as B,C as pe,y as X,O as H,R as F,ai as Ot,aj as Pt,al as de,dR as kt,dS as Dt,Y as Ze,Z as Xe,dT as Rt,g as L,di as $t,a7 as Re,W as U,ak as ne,V as ue,d as Mt,b as et,N as At,B as ae,dM as Et,bp as tt,bq as Se,L as nt,bt as it,bG as wt,an as Vt,ao as _t,M as st,k as ot,x as Nt,v as Ft,aM as be,aN as xe,D as $e,b8 as Ne,aQ as ge,bo as Ce,ay as ee,aK as K,aR as ye,aP as z,cc as Ae,a6 as Ee,Q as me,aO as Ht,$ as Lt,aC as Ut,aD as Fe,a1 as at,a2 as le,a5 as Gt,j as qt,_ as jt,o as He,dU as Le,bV as Ue,p as Kt,P as zt,l as Bt,A as Wt,dN as Yt,H as Jt,I as Ge,J as Qt}from"./main-o1hptXRo.js";import*as P from"react";import{useState as O,useRef as Zt,useCallback as Xt,useEffect as en,useMemo as he}from"react";import{u as lt}from"./ConfirmDialog-BkU7melV.js";import{F as tn}from"./FormAccess-BnhQnYb9.js";import{V as nn}from"./ViewHeader-BDBsroi3.js";import{u as fe}from"./useParams-CGVhlaFZ.js";import{u as we}from"./useIsAdminPermissionsClient-BY-AG4cQ.js";import{u as rt,m as ct}from"./useLocaleSort-C-diWts5.js";import{C as sn}from"./ClientSelect-BY77LEpN.js";import{h as on}from"./ClientScopeTypes-D2w5c8Pp.js";import{g as an}from"./utils-C-TUnOch.js";import{F as qe}from"./filter-icon-DYNmdQ7O.js";import{G as ln}from"./GroupPickerDialog-U3luvxlw.js";import{a as rn}from"./CodeEditor-C4IS5oxi.js";import{D as cn}from"./SwitchControl-CU1bUhmR.js";import{A as dn,a as pn,S as un}from"./RoleMapping-BOcI-Nkp.js";import{d as Oe,D as mn}from"./DatePicker-DiXxo4Fo.js";import{d as hn}from"./debounce-Dbkg0MD5.js";const Q=" AM",Z=" PM",fn=(n,i,o,d,c,l)=>{const a=[],u=new Date(new Date().setHours(0,0,0,0)),h=u.getDay();for(;u.getDay()===h;){let f=u.getHours(),t=Q;i&&(f===0?f=12:f>=12&&(t=Z),f>12&&(f%=12)),f=i?f.toString():f.toString().padStart(2,"0");const p=u.getMinutes().toString().padStart(2,"0"),s=`${f}${o}${p}${i?t:""}`;pt(d,c,s,o,l)&&a.push(s),u.setMinutes(u.getMinutes()+n)}return a},J=(n,i,o,d,c)=>{const l=new Date(n);if(!isNaN(l.getDate())&&(n instanceof Date||n.includes("T"))){const a=d?`${l.getHours()>12?l.getHours()-12:l.getHours()}`:`${l.getHours()}`.padStart(2,"0"),u=`${l.getMinutes()}`.padStart(2,"0"),h=c?`${l.getSeconds()}`.padStart(2,"0"):"",f=h?`${o}${h}`:"";let t="";return d&&l.getHours()>11?t=Z:d&&(t=Q),`${a}${o}${u}${f}${t}`}else if(typeof n=="string"&&(n=n.trim(),n!==""&&dt(n,i,o,d))){const[,a,u,h,f=""]=i.exec(n),t=c?`${o}${h??"00"}`:"";let p="";if(d){const s=f.toUpperCase();s===Q.toUpperCase().trim()?p=Q:s===Z.toUpperCase().trim()?p=Z:p=new Date().getHours()>11?Z:Q}return`${a}${o}${u}${t}${p}`}return n.toString()},dt=(n,i,o,d)=>{const c=new Date(n);if(!isNaN(c.getDate())&&n.includes("T"))return!0;const l=parseInt(n.split(o)[0]),a=l>=(d?1:0)&&l<=(d?12:23);return n===""||i.test(n)&&a},je=(n,i)=>{const o=n.match(i);return o&&o.length?/pm/i.test(o[4])?parseInt(o[1])===12?parseInt(o[1]):parseInt(o[1])+12:/am/i.test(o[4])&&parseInt(o[1])===12?0:parseInt(o[1]):null},Ke=(n,i)=>{const o=n.match(i);return o&&o.length?parseInt(o[2]):null},ze=(n,i)=>{var o;const d=(o=n.match(i))===null||o===void 0?void 0:o[3];return d?parseInt(d):null},pt=(n,i,o,d,c)=>{if(o.trim()==="")return!0;const l=Pe(n,d,c),a=Pe(o,d,c),u=Pe(i,d,c);return l<=a&&a<=u},Pe=(n,i,o)=>{const c=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(n);if(!c||!c.length)return;let l=c[1].padStart(2,"0");const a=c[2];let u=c[3]?`${i}${c[3]}`:"";!u&&o&&(u=`${i}00`);const h=c[4]||"";return h.toUpperCase()==="PM"&&l!=="12"?l=`${parseInt(l)+12}`:h.toUpperCase()==="AM"&&l==="12"&&(l="00"),`${l}${i}${a}${u}`},gn={name:"OutlinedClockIcon",height:512,width:512,svgPath:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z",yOffset:0,xOffset:0},Cn=Qe(gn),yn={name:"--pf-v5-c-date-picker__input--c-form-control--Width"};class Ve extends P.Component{constructor(i){super(i),this.baseComponentRef=P.createRef(),this.toggleRef=P.createRef(),this.inputRef=P.createRef(),this.menuRef=P.createRef(),this.onDocClick=t=>{var p,s,r,m;const T=(s=(p=this.toggleRef)===null||p===void 0?void 0:p.current)===null||s===void 0?void 0:s.contains(t.target),I=(m=(r=this.menuRef)===null||r===void 0?void 0:r.current)===null||m===void 0?void 0:m.contains(t.target);this.state.isTimeOptionsOpen&&!(T||I)&&this.onToggle(!1)},this.handleGlobalKeys=t=>{var p,s,r,m;const{isTimeOptionsOpen:T,focusedIndex:I,scrollIndex:k}=this.state;!((s=(p=this.inputRef)===null||p===void 0?void 0:p.current)===null||s===void 0)&&s.contains(t.target)?!T&&t.key!==j.Tab&&t.key!==j.Escape?this.onToggle(!0):T&&(t.key===j.Escape||t.key===j.Tab?this.onToggle(!1):t.key===j.Enter?I!==null?(this.focusSelection(I),t.stopPropagation()):this.onToggle(!1):(t.key===j.ArrowDown||t.key===j.ArrowUp)&&(this.focusSelection(k),this.updateFocusedIndex(0),t.preventDefault())):!((m=(r=this.menuRef)===null||r===void 0?void 0:r.current)===null||m===void 0)&&m.contains(t.target)&&(t.key===j.ArrowDown?(this.updateFocusedIndex(1),t.preventDefault()):t.key===j.ArrowUp?(this.updateFocusedIndex(-1),t.preventDefault()):(t.key===j.Escape||t.key===j.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=t=>{this.setState(p=>{const s=this.getOptions().length-1;let r=p.focusedIndex!==null?p.focusedIndex+t:p.scrollIndex+t;return r<0?r=s:r>s&&(r=0),this.scrollToIndex(r),{focusedIndex:r}})},this.getIndexToScroll=t=>this.props.menuAppendTo==="inline"?t>0?t-1:0:t,this.scrollToIndex=t=>{this.getOptions()[t].closest(`.${Ie.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(t)].offsetTop},this.focusSelection=t=>{var p;const s=t!==-1?t:0;!((p=this.menuRef)===null||p===void 0)&&p.current&&this.getOptions()[s].querySelector(`.${Ie.menuItem}`).focus()},this.scrollToSelection=t=>{const{delimiter:p,is24Hour:s}=this.props;let r=t.split(this.props.delimiter),m=null;if(r.length<2?(t=`${t}${p}00`,r=t.split(p)):r.length>2&&(t=J(t,this.state.timeRegex,p,!s,!1),r=t.split(p)),!s&&r.length>1&&r[1].length<2){const I=r[1].length===0?"00":r[1]+"0";t=`${r[0]}${p}${I}${new Date().getHours()>11?Z:Q}`}else!s&&r.length>1&&r[1].length===2&&!t.toUpperCase().includes(Q.toUpperCase().trim())&&!t.toUpperCase().includes(Z.toUpperCase().trim())&&(t=`${t}${new Date().getHours()>11?Z:Q}`);let T=this.getOptions().findIndex(I=>I.textContent===t);if(T!==-1)this.scrollToIndex(T),m=T;else if(r.length===2){let I="";s||(r[1].toUpperCase().includes("P")?I=Z:r[1].toUpperCase().includes("A")&&(I=Q)),t=`${r[0]}${p}00${I}`,T=this.getOptions().findIndex(k=>k.textContent===t),T!==-1&&this.scrollToIndex(T)}this.setState({focusedIndex:m,scrollIndex:T})},this.getRegExp=(t=!0)=>{const{is24Hour:p,delimiter:s}=this.props;let r=`\\s*(\\d\\d?)${s}([0-5]\\d)`;return t&&(r+=`${s}?([0-5]\\d)?`),new RegExp(`^${r}${p?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var t;return!((t=this.menuRef)===null||t===void 0)&&t.current?Array.from(this.menuRef.current.querySelectorAll(`.${Ie.menuListItem}`)):[]},this.isValidFormat=t=>{if(this.props.validateTime)return this.props.validateTime(t);const{delimiter:p,is24Hour:s,includeSeconds:r}=this.props;return dt(t,this.getRegExp(r),p,!s)},this.isValidTime=t=>{const{delimiter:p,includeSeconds:s}=this.props,{minTimeState:r,maxTimeState:m}=this.state;return pt(r,m,t,p,s)},this.isValid=t=>this.isValidFormat(t)&&this.isValidTime(t),this.onToggle=t=>{this.setState(p=>{const{timeRegex:s,isInvalid:r,timeState:m}=p,{delimiter:T,is24Hour:I,includeSeconds:k,onChange:E}=this.props,A=J(m,s,T,!I,k);return E&&!t&&A!==m&&E(null,A,je(A,s),Ke(A,s),ze(A,s),this.isValid(A)),{isTimeOptionsOpen:t,timeState:A,isInvalid:t?r:!this.isValid(A)}}),this.props.setIsOpen(t),t||this.inputRef.current.focus()},this.onSelect=t=>{const{timeRegex:p,timeState:s}=this.state,{delimiter:r,is24Hour:m,includeSeconds:T,setIsOpen:I}=this.props,k=J(t.target.textContent,p,r,!m,T);k!==s&&this.onInputChange(t,k),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),I(!1)},this.onInputClick=t=>{this.state.isTimeOptionsOpen||this.onToggle(!0),t.stopPropagation()},this.onInputChange=(t,p)=>{const{onChange:s}=this.props,{timeRegex:r}=this.state;s&&s(t,p,je(p,r),Ke(p,r),ze(p,r),this.isValid(p)),this.scrollToSelection(p),this.setState({timeState:p})};const{is24Hour:o,delimiter:d,time:c,includeSeconds:l,isOpen:a}=this.props;let{minTime:u,maxTime:h}=this.props;if(u===""){const t=l?`${d}00`:"";u=o?`00${d}00${t}`:`12${d}00${t} AM`}if(h===""){const t=l?`${d}59`:"";h=o?`23${d}59${t}`:`11${d}59${t} PM`}const f=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:a,timeState:J(c,f,d,!o,l),focusedIndex:null,scrollIndex:0,timeRegex:f,minTimeState:J(u,f,d,!o,l),maxTimeState:J(h,f,d,!o,l)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,o){const{timeState:d,isTimeOptionsOpen:c,isInvalid:l,timeRegex:a}=this.state,{time:u,is24Hour:h,delimiter:f,includeSeconds:t,isOpen:p,minTime:s,maxTime:r}=this.props;if(i.isOpen!==p&&this.onToggle(p),c&&!o.isTimeOptionsOpen&&d&&!l&&this.scrollToSelection(d),f!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),u!==""&&u!==i.time){const m=J(u,a,f,!h,t);this.setState({timeState:m,isInvalid:!this.isValid(m)})}s!==""&&s!==i.minTime&&this.setState({minTimeState:J(s,a,f,!h,t)}),r!==""&&r!==i.maxTime&&this.setState({maxTimeState:J(r,a,f,!h,t)})}render(){const i=this.props,{"aria-label":o,isDisabled:d,className:c,placeholder:l,id:a,menuAppendTo:u,is24Hour:h,invalidFormatErrorMessage:f,invalidMinMaxErrorMessage:t,stepMinutes:p,width:s,delimiter:r,inputProps:m,onChange:T,setIsOpen:I,isOpen:k,time:E,validateTime:A,minTime:V,maxTime:W,includeSeconds:S,zIndex:R}=i,Y=mt(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","zIndex"]),{timeState:b,isTimeOptionsOpen:g,isInvalid:v,minTimeState:$,maxTimeState:G}=this.state,w={[yn.name]:s},N=fn(p,!h,r,$,G,S),q=this.isValidFormat(b),te=a||ht("time-picker"),re=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Te=P.createElement(ft,{ref:this.menuRef,isScrollable:!0},P.createElement(gt,{maxMenuHeight:"200px"},P.createElement(Ct,{"aria-label":o},N.map((D,se)=>P.createElement(yt,{onClick:this.onSelect,key:D,id:`${te}-option-${se}`},D))))),C=P.createElement(Tt,Object.assign({"aria-haspopup":"menu",id:`${te}-input`,"aria-label":o,validated:v?"error":"default",placeholder:l,value:b||"",type:"text",customIcon:P.createElement(Cn,null),onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:d,isExpanded:g,ref:this.inputRef},m));let x;switch(u){case"inline":x=()=>this.toggleRef.current;break;case"parent":x=re;break;default:x=u}return P.createElement("div",{ref:this.baseComponentRef,className:ve(Oe.datePicker,c)},P.createElement("div",Object.assign({className:ve(Oe.datePickerInput),style:w},Y),P.createElement(It,null,P.createElement(vt,null,P.createElement("div",{id:te},P.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},P.createElement(St,{appendTo:x,trigger:C,triggerRef:this.toggleRef,popper:Te,popperRef:this.menuRef,isVisible:g,zIndex:R}))))),v&&P.createElement("div",{className:ve(Oe.datePickerHelperText)},P.createElement(bt,null,P.createElement(xt,{variant:"error"},q?t:f)))))}}Ve.displayName="TimePicker";Ve.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},zIndex:9999};const Tn={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},In=Qe(Tn),vn=({name:n,label:i,helpText:o,defaultValue:d,isRequired:c,variant:l="typeaheadMulti"})=>{const{adminClient:a}=ie(),{t:u}=M(),{control:h,getValues:f,formState:{errors:t}}=B(),p=f(n),[s,r,m]=pe(),[T,I]=O([]),[k,E]=O([]),[A,V]=O(""),[W,S]=O(""),R=Zt(),Y=Xt(hn(S,500),[]);X(async()=>p?(await Promise.all(p.map($=>a.users.findOne({id:$})))).filter($=>$!==void 0):[],v=>{I(v),l!=="typeaheadMulti"&&V(v[0]?.username||"")},[p]),X(async()=>a.users.find({username:W,max:20}),E,[W]),en(()=>{(!p||p.length===0)&&(I([]),V(""))},[p]);const b=he(()=>[...T,...k],[T,k]),g=v=>v.map($=>e(ne,{value:$.id,selected:p?.includes($.id),children:$.username},$.id));return y(H,{label:u(i),isRequired:c,labelIcon:e(U,{helpText:o,fieldLabelId:u(i)}),fieldId:n,children:[e(F,{name:n,defaultValue:d,control:h,rules:c&&l==="typeaheadMulti"?{validate:v=>v.length>0}:{required:c},render:({field:v})=>e(Ot,{id:n,onOpenChange:r,toggle:$=>e(de,{"data-testid":n,ref:$,variant:"typeahead",onClick:r,isExpanded:s,isFullWidth:!0,status:t[n]?"danger":void 0,children:y(kt,{isPlain:!0,children:[e(Dt,{value:A,onClick:r,onChange:(G,w)=>{m(!0),V(w),Y(w)},autoComplete:"off",innerRef:R,placeholderText:u("selectAUser"),...v.value&&{"aria-activedescendant":v.value},role:"combobox",isExpanded:s,"aria-controls":"select-create-typeahead-listbox",children:l==="typeaheadMulti"&&Array.isArray(v.value)&&e(Ze,{"aria-label":"Current selections",children:v.value.map((G,w)=>e(Xe,{onClick:N=>{N.stopPropagation(),v.onChange(v.value.filter(q=>q!==G))},children:b.find(N=>N?.id===G)?.username},w))})}),e(Rt,{children:!!W&&e(L,{variant:"plain",onClick:()=>{V(""),S(""),v.onChange([]),R?.current?.focus()},"aria-label":"Clear input value",children:e($t,{"aria-hidden":!0})})})]})}),isOpen:s,selected:v.value,onSelect:($,G)=>{const w=G?.toString();if(l!=="typeaheadMulti"){const N=v.value.includes(w);N?v.onChange([]):v.onChange([w]),V(N?"":b.find(q=>q?.id===w)?.username||""),m(!1)}else{const N=v.value.find(q=>q===w)?v.value.filter(q=>q!==w):[...v.value,w];v.onChange(N)}},"aria-label":u(n),children:e(Pt,{children:g(k)})})}),t[n]&&e(Re,{message:u("required")})]})},ke=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],Sn=({helpLabel:n,isDisabled:i=!1,isLimited:o=!1})=>{const{t:d}=M(),{control:c}=B();return e(H,{label:d("decisionStrategy"),labelIcon:e(U,{helpText:d(n||"decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(F,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:ke[0],control:c,render:({field:l})=>e(_,{children:(o?ke.slice(0,2):ke).map(a=>e(ue,{id:a,"data-testid":a,isChecked:l.value===a,isDisabled:i,name:"decisionStrategy",onChange:()=>l.onChange(a),label:d(`decisionStrategies.${a}`),className:"pf-v5-u-mb-md"},a))})})})},bn={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},xn=({name:n,clientId:i,permissionId:o,variant:d=Se.typeaheadMulti,preSelected:c,isRequired:l=!1})=>{const{adminClient:a}=ie(),{realm:u}=Mt(),{t:h}=M(),f=et(),{control:t,formState:{errors:p,isDirty:s}}=B(),[r,m]=O([]),[T,I]=O(""),[k,E]=O(!1),[A,V]=pe(),[W,S]=O(),[R,Y]=O(),b=we(i),[g,v]=O([]),$=bn[n],G=At({control:t,name:n,defaultValue:c?[c]:[]}),w=C=>({id:"_id"in C?C._id:"id"in C?C.id:void 0,name:C.name,type:C.type});X(async()=>{const C=Object.assign({id:i,first:0,max:10,permission:"false"},T===""?null:{name:T});return await Promise.all([a.clients.listPolicyProviders({id:i}),a.clients[$.searchFunction](C),o?a.clients[$.fetchFunction]({id:i,permissionId:o}):Promise.resolve([]),c&&n==="resources"?a.clients.getResource({id:i,resourceId:c}):Promise.resolve([])])},([C,...x])=>{S(C.filter(D=>D.type!=="resource"&&D.type!=="scope")),m(x.flat().filter(D=>typeof D!="string").map(w).filter(({id:D},se,oe)=>se===oe.findIndex(({id:ut})=>D===ut)))},[T]),X(async()=>n==="resources"?await Promise.all((G||[]).map(C=>a.clients.getResource({id:i,resourceId:C}))):await Promise.all((G||[]).map(async C=>a.clients.findOnePolicy({id:i,policyId:C}))),C=>v(C.map(x=>w(x))),[G]);const[N,q]=lt({titleKey:h("unsavedChangesTitle"),messageKey:h("unsavedChangesConfirm"),continueButtonLabel:h("continue"),continueButtonVariant:ae.danger,onConfirm:()=>R?.()}),te=C=>n==="policies"?it({realm:u,id:i,policyId:C.id,policyType:C.type}):wt({realm:u,id:i,resourceId:C.id}),re=()=>r.map(C=>e(ne,{value:C.id,children:C.name},C.id)),Te=C=>e(Ze,{children:g?.map(x=>e(Xe,{onClick:()=>{C.onChange(C.value?.filter(D=>D!==x.id)||[]),v(g?.filter(D=>D.id!==x.id)||[])},children:b?x.name:e(nt,{to:te(x),onClick:D=>{s&&(D.preventDefault(),Y(()=>()=>f(te(x))),N())},children:x.name})},x.id))});return y(_,{children:[e(q,{}),A&&e(Fn,{policyProviders:W,onSelect:C=>{f(Et({id:i,realm:u,policyType:C.type}))},toggleDialog:V}),e(F,{name:n,defaultValue:c?[c]:[],control:t,rules:{validate:C=>!l||C.length>0},render:({field:C})=>e(tt,{toggleId:n,variant:d,onToggle:x=>E(x),onFilter:x=>(I(x),re()),onClear:()=>{C.onChange([]),I("")},selections:d===Se.typeaheadMulti?C.value:r.find(x=>x.id===C.value?.[0])?.name,onSelect:x=>{const D=x.toString();if(d===Se.typeaheadMulti){const se=C.value?.find(oe=>oe===D)?C.value.filter(oe=>oe!==D):[...C.value,D];C.onChange(se)}else C.onChange([D]);I("")},isOpen:k,"aria-label":h(n),validated:p[n]?"error":"default",typeAheadAriaLabel:h(n),chipGroupComponent:Te(C),footer:n==="policies"&&!b?e(L,{variant:"link",isInline:!0,onClick:()=>{s?(E(!1),Y(()=>V),N()):V()},children:h("createPolicy")}):void 0,children:re()})})]})},On=()=>{const{t:n}=M(),{id:i}=fe(),{permissionClientId:o}=fe();return y(_,{children:[e(H,{label:n("applyPolicy"),fieldId:"policies",labelIcon:e(U,{helpText:n("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(xn,{name:"policies",clientId:o||i})}),e(Sn,{helpLabel:"policyDecisionStagey"})]})},Pn=()=>{const{t:n}=M();return e(sn,{name:"clients",label:n("clients"),helpText:n("policyClientHelp"),required:!0,defaultValue:[],variant:"typeaheadMulti",clientKey:"id"})},kn=({clientScopes:n,clientName:i,open:o,toggleDialog:d,onAdd:c,isClientScopesConditionType:l})=>{const{t:a}=M(),u=Vt(),[h,f]=O(!1),[t,p]=O([]),[s,r]=O("Name"),[m,T]=O("All"),I=u(_t.OpenId4VCI),[k,E]=pe(),[A,V]=pe(!1),W=he(()=>m==="OpenID Connect"?n.filter(g=>g.protocol==="openid-connect"):m==="SAML"?n.filter(g=>g.protocol==="saml"):m==="OpenID4VC"?n.filter(g=>g.protocol==="oid4vc"):n,[n,s,m]),S=g=>{const v=t.map($=>({scope:$,type:g}));c(v),f(!1),d()},R=g=>{g==="Name"?r("Protocol"):g==="Protocol"&&(r("Name"),T("All")),E()},Y=g=>{g==="SAML"?T("SAML"):g==="OpenID Connect"?T("OpenID Connect"):g==="OpenID4VC"?T("OpenID4VC"):g==="All"&&T("All"),V()},b=he(()=>{const g=[e(ne,{value:"SAML",children:a("protocolTypes.saml")},1),e(ne,{value:"OpenID Connect",children:a("protocolTypes.openid-connect")},2)];return I&&g.push(e(ne,{value:"OpenID4VC",children:a("protocolTypes.oid4vc")},3)),g.push(e(ne,{value:"All",children:a("protocolTypes.all")},4)),g},[a,I]);return e(st,{variant:ot.medium,title:l?a("addClientScope"):a("addClientScopesTo",{clientName:i}),isOpen:o,onClose:d,actions:l?[e(L,{id:"modal-add","data-testid":"confirm",variant:ae.primary,onClick:()=>{const g=t.map(v=>({scope:v}));c(g),d()},isDisabled:t.length===0,children:a("add")},"add"),e(L,{id:"modal-cancel","data-testid":"cancel",variant:ae.link,onClick:()=>{p([]),d()},children:a("cancel")},"cancel")]:[e(be,{popperProps:{direction:"up"},onOpenChange:g=>f(g),className:"keycloak__client-scopes-add__add-dropdown",isOpen:h,toggle:g=>e(de,{ref:g,isDisabled:t.length===0,onClick:()=>f(!h),variant:"primary",id:"add-dropdown","data-testid":"add-dropdown",statusIcon:e(In,{}),children:a("add")}),children:e(xe,{children:on(a,S)})},"add-dropdown"),e(L,{id:"modal-cancel",variant:ae.link,onClick:()=>{p([]),d()},children:a("cancel")},"cancel")],children:e(Nt,{loader:W,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:s==="Name"?"searchForClientScope":void 0,isSearching:s!=="Name",searchTypeComponent:e(be,{onSelect:()=>{R(s)},onOpenChange:E,toggle:g=>e(de,{ref:g,"data-testid":"filter-type-dropdown",id:"toggle-id-9",onClick:E,icon:e(qe,{}),statusIcon:e(Ne,{}),children:s}),isOpen:k,children:e(xe,{children:e($e,{"data-testid":"filter-type-dropdown-item",children:a(s==="Name"?"protocol":"name")},"filter-type")})}),toolbarItem:s==="Protocol"&&y(_,{children:[e(be,{onSelect:()=>{R(s)},onOpenChange:E,"data-testid":"filter-type-dropdown",toggle:g=>e(de,{ref:g,id:"toggle-id-9",onClick:E,statusIcon:e(Ne,{}),icon:e(qe,{}),children:s}),isOpen:k,children:e(xe,{children:e($e,{"data-testid":"filter-type-dropdown-item",children:a("name")},"filter-type")})}),e(tt,{className:"kc-protocolType-select","aria-label":a("selectOne"),onToggle:V,onSelect:g=>Y(g.toString()),selections:m,isOpen:A,children:b})]}),canSelectAll:!0,onSelect:g=>p(g),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:g=>an(a,g.protocol??"openid-connect")},{name:"description"}],emptyState:e(Ft,{message:a("emptyAddClientScopes"),instructions:a("emptyAddClientScopesInstructions")})})})},Dn=()=>{const{adminClient:n}=ie(),{t:i}=M(),{control:o,getValues:d,setValue:c}=B(),[l,a]=O(!1),[u,h]=O([]),[f,t]=O([]),p=rt();return X(()=>n.clientScopes.find(),(s=[])=>{const r=d("clientScopes")||[];t(r.map(m=>s.find(T=>T.id===m.id))),h(p(s,ct("name")))},[]),y(H,{label:i("clientScopes"),labelIcon:e(U,{helpText:i("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",children:[e(F,{name:"clientScopes",control:o,defaultValue:[],render:({field:s})=>y(_,{children:[l&&e(kn,{clientScopes:u.filter(r=>!s.value.map(m=>m.id).includes(r.id)),isClientScopesConditionType:!0,open:l,toggleDialog:()=>a(!l),onAdd:r=>{t([...f,...r.map(m=>m.scope)]),s.onChange([...s.value,...r.map(m=>m.scope).map(m=>({id:m.id,required:!1}))])}}),e(L,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{a(!0)},children:i("addClientScopes")})]})}),f.length>0&&y(ge,{variant:"compact",children:[e(Ce,{children:y(ee,{children:[e(K,{children:i("clientScopeTitle")}),e(K,{children:i("required")}),e(K,{"aria-hidden":"true"})]})}),e(ye,{children:f.map((s,r)=>y(ee,{children:[e(z,{children:s.name}),e(z,{children:e(F,{name:`clientScopes.${r}.required`,defaultValue:!1,control:o,render:({field:m})=>e(Ae,{id:"required","data-testid":"standard",name:"required",isChecked:m.value,onChange:m.onChange})})}),e(z,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ee,{}),onClick:()=>{c("clientScopes",[...d("clientScopes").filter(m=>m.id!==s.id)]),t([...f.filter(m=>m.id!==s.id)])}})})]},s.id))})]})]})},Rn=()=>{const{adminClient:n}=ie(),{t:i}=M(),{control:o,getValues:d,setValue:c}=B(),l=d("groups"),[a,u]=O(!1),[h,f]=O([]);return X(()=>l&&l.length>0?Promise.all(l.map(t=>n.groups.findOne({id:t.id}))):Promise.resolve([]),t=>{const p=t.filter(s=>s);f(p)},[]),y(_,{children:[e(me,{name:"groupsClaim",label:i("groupsClaim"),labelIcon:i("groupsClaimHelp")}),y(H,{label:i("groups"),labelIcon:e(U,{helpText:i("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",children:[e(F,{name:"groups",control:o,defaultValue:[],render:({field:t})=>y(_,{children:[a&&e(ln,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:p=>{t.onChange([...t.value||[],...(p||[]).map(({id:s})=>({id:s}))]),f([...h,...p||[]]),u(!1)},onClose:()=>{u(!1)},filterGroups:h}),e(L,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{u(!0)},children:i("addGroups")})]})}),h.length>0&&y(ge,{variant:"compact",children:[e(Ce,{children:y(ee,{children:[e(K,{children:i("groups")}),e(K,{children:i("extendToChildren")}),e(K,{"aria-hidden":"true"})]})}),e(ye,{children:h.map((t,p)=>y(ee,{children:[e(z,{children:t.path}),e(z,{children:e(F,{name:`groups.${p}.extendChildren`,defaultValue:!1,control:o,render:({field:s})=>e(Ae,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:s.value,onChange:s.onChange,isDisabled:t.subGroupCount===0})})}),e(z,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ee,{}),onClick:()=>{c("groups",[...(l||[]).filter(({id:s})=>s!==t.id)]),f([...h.filter(({id:s})=>s!==t.id)])}})})]},t.id))})]})]})]})},$n=()=>{const{t:n}=M(),{control:i}=B();return e(H,{label:n("code"),labelIcon:e(U,{helpText:n("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(F,{name:"code",defaultValue:"",control:i,render:({field:o})=>e(rn,{id:"code","data-testid":"code",readOnly:!0,value:o.value,language:"js",height:600})})})},Be=["POSITIVE","NEGATIVE"],Mn=({isDisabled:n})=>{const{t:i}=M(),{control:o}=B();return e(H,{label:i("logic"),labelIcon:e(U,{helpText:i("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(F,{name:"logic","data-testid":"logic",defaultValue:Be[0],control:o,render:({field:d})=>e(_,{children:Be.map(c=>e(ue,{id:c,"data-testid":c,isChecked:d.value===c,name:"logic",onChange:()=>d.onChange(c),label:i(`logicType.${c.toLowerCase()}`),className:"pf-v5-u-mb-md",isDisabled:n},c))})})})},An=({isDisabled:n,clientId:i})=>{const{t:o}=M(),d=we(i);return y(_,{children:[e(me,{name:"name",label:o("name"),labelIcon:d?o("permissionNameHelpText"):"",rules:{required:o("required")},isDisabled:n}),e(Ht,{name:"description",label:o("description"),rules:{maxLength:{message:o("maxLength",{length:255}),value:255}},isDisabled:n})]})},En=()=>{const{t:n}=M();return y(_,{children:[e(me,{name:"targetClaim",label:n("targetClaim"),labelIcon:n("targetClaimHelp"),rules:{required:n("required")}}),e(me,{name:"pattern",label:n("regexPattern"),labelIcon:n("regexPatternHelp"),rules:{required:n("required")}}),e(Lt,{name:"targetContextAttributes",label:n("targetContextAttributes"),labelIcon:n("targetContextAttributesHelp"),labelOn:n("yes"),labelOff:n("no")})]})},wn=()=>{const{adminClient:n}=ie(),{t:i}=M(),{control:o,getValues:d,setValue:c}=B(),l=d("roles"),[a,u]=O(!1),[h,f]=O("clients"),[t,p]=O([]);return X(async()=>{if(l&&l.length>0){const s=await Promise.all(l.map(r=>n.roles.findOneById({id:r.id})));return Promise.all(s.map(async r=>({role:r,client:r.clientRole?await n.clients.findOne({id:r?.containerId}):void 0})))}return Promise.resolve([])},p,[]),y(_,{children:[y(H,{label:i("roles"),labelIcon:e(U,{helpText:i("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",children:[e(F,{name:"roles",control:o,defaultValue:[],render:({field:s})=>y(_,{children:[a&&e(dn,{id:"role",type:"roles",title:i("assignRole"),filterType:h,onAssign:r=>{s.onChange([...s.value||[],...r.map(m=>({id:m.role.id}))]),p([...t,...r]),u(!1)},onClose:()=>{u(!1)}}),e(pn,{"data-testid":"select-role-button",variant:"secondary",onFilerTypeChange:r=>{f(r),u(!0)}})]})}),t.length>0&&y(ge,{variant:"compact",children:[e(Ce,{children:y(ee,{children:[e(K,{children:i("roles")}),e(K,{children:i("required")}),e(K,{"aria-hidden":"true"})]})}),e(ye,{children:t.map((s,r)=>y(ee,{children:[e(z,{children:e(un,{role:s.role,client:s.client})}),e(z,{children:e(F,{name:`roles.${r}.required`,defaultValue:!1,control:o,render:({field:m})=>e(Ae,{id:"required","data-testid":"standard",name:"required",isChecked:m.value,onChange:m.onChange})})}),e(z,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ee,{}),onClick:()=>{c("roles",[...(l||[]).filter(m=>m.id!==s.role.id)]),p([...t.filter(m=>m.role.id!==s.role.id)])}})})]},s.role.id))})]})]}),e(cn,{name:"fetchRoles",label:i("fetchRoles"),labelIcon:i("fetchRolesHelp")})]})},De=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,We=n=>n.toString().padStart(2,"0"),Ye=({name:n})=>{const{control:i}=B(),o=(c,l)=>{if(!l)return c;const a=De.exec(c);return`${[l.getFullYear(),We(l.getMonth()+1),We(l.getDate())].join("-")} ${a?a[2]:"00"}:${a?a[3]:"00"}:00`},d=(c,l,a)=>{const u=De.exec(c);return a!=null?`${u?u[1]:""} ${l}:${a<10?`0${a}`:a}:00`:c};return e(F,{name:n,defaultValue:"",control:i,rules:{required:!0},render:({field:c})=>{const l=c.value.match(De)||["","","0","00"];return y(at,{hasGutter:!0,id:n,children:[e(le,{children:e(mn,{value:l[1],onChange:(a,u,h)=>{c.onChange(o(c.value,h))}})}),e(le,{children:e(Ve,{time:`${l[2]}:${l[3]}`,onChange:(a,u,h,f)=>c.onChange(d(c.value,h,f)),is24Hour:!0})})]})}})},Je=({name:n,min:i,max:o})=>{const{control:d}=B(),c=l=>Math.min(l,o);return e(F,{name:n,defaultValue:"",control:d,render:({field:l})=>e(Gt,{id:n,value:l.value,min:i,max:o,onPlus:()=>l.onChange(Number(l.value)+1),onMinus:()=>l.onChange(Number(l.value)-1),onChange:a=>{const u=Number(a.currentTarget.value);l.onChange(c(isNaN(u)?0:u))}})})},ce=({name:n,...i})=>{const{t:o}=M();return e(H,{label:o(n),fieldId:n,labelIcon:e(U,{helpText:o(`${n}Help`),fieldLabelId:n}),children:y(at,{hasGutter:!0,children:[e(le,{children:e(Je,{name:n,...i})}),e(le,{children:o("to")}),e(le,{children:e(Je,{name:`${n}End`,...i})})]})})},Vn=()=>{const{t:n}=M(),{getValues:i,formState:{errors:o}}=B(),[d,c]=O(i("month"));return y(_,{children:[e(H,{label:n("repeat"),fieldId:"repeat",labelIcon:e(U,{helpText:n("repeatHelp"),fieldLabelId:"repeat"}),children:y(Ut,{children:[e(Fe,{children:e(ue,{id:"notRepeat","data-testid":"notRepeat",isChecked:!d,name:"repeat",onChange:()=>c(!1),label:n("notRepeat"),className:"pf-v5-u-mb-md"})}),e(Fe,{children:e(ue,{id:"repeat","data-testid":"repeat",isChecked:d,name:"repeat",onChange:()=>c(!0),label:n("repeat"),className:"pf-v5-u-mb-md"})})]})}),d&&y(_,{children:[e(ce,{name:"month",min:1,max:12}),e(ce,{name:"dayMonth",min:1,max:31}),e(ce,{name:"hour",min:0,max:23}),e(ce,{name:"minute",min:0,max:59})]}),y(H,{label:n("startTime"),fieldId:"notBefore",labelIcon:e(U,{helpText:n("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,children:[e(Ye,{name:"notBefore"}),o.notBefore&&e(Re,{message:n("required")})]}),y(H,{label:n("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(U,{helpText:n("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,children:[e(Ye,{name:"notOnOrAfter"}),o.notOnOrAfter&&e(Re,{message:n("required")})]})]})},_n=()=>{const{t:n}=M();return e(vn,{name:"users",label:"users",helpText:n("policyUsers"),defaultValue:[],variant:"typeaheadMulti"})},Me={aggregate:On,client:Pn,user:_n,"client-scope":Dn,group:Rn,regex:En,role:wn,time:Vn,js:$n},_e=n=>n in Me;function Nn(){const{adminClient:n}=ie(),{t:i}=M(),{id:o,realm:d,policyId:c,policyType:l}=fe(),{permissionClientId:a}=fe(),u=et(),h=qt(),{reset:f,handleSubmit:t}=h,{addAlert:p,addError:s}=jt(),[r,m]=O(),T=l==="js",I=we(a);X(async()=>{if(c){const S=await Promise.all([n.clients.findOnePolicyWithType({id:a??o,type:l,policyId:c}),n.clients.getAssociatedPolicies({id:a??o,permissionId:c})]);if(!S[0])throw new Error(i("notFound"));return{policy:S[0],policies:S[1].map(R=>R.id)}}return{}},({policy:S,policies:R})=>{f({...S,policies:R}),m(S)},[a,o,l,c]);const k=async S=>{S.groups=S.groups?.filter(b=>b.id),S.clientScopes=S.clientScopes?.filter(b=>b.id),S.roles=S.roles?.filter(b=>b.id).map(b=>({...b,required:b.required||!1}));const R=I?a:o,Y=I?Yt:it;try{if(c)await n.clients.updatePolicy({id:R,type:l,policyId:c},S);else{const b=await n.clients.createPolicy({id:R,type:l},S);u(Y({realm:d,id:R,permissionClientId:R,policyId:b.id,policyType:b.type}))}p(i((c?"update":"create")+"PolicySuccess"),He.success)}catch(b){s("policySaveError",b)}},[E,A]=lt({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.clients.delPolicy({id:I?a:o,policyId:c}),p(i("policyDeletedSuccess"),He.success),u(I?Le({realm:d,permissionClientId:a,tab:"policies"}):Ue({realm:d,clientId:o,tab:"policies"}))}catch(S){s("policyDeletedError",S)}}});if(c&&!r)return e(Kt,{});function V(){return _e(l)?Me[l]:Me.js}const W=V();return y(_,{children:[e(A,{}),e(nn,{titleKey:c?r?.name:i("createPolicyOfType",{policyType:l}),dropdownItems:c?[e($e,{"data-testid":"delete-policy",onClick:()=>E(),children:i("delete")},"delete")]:void 0}),e(zt,{variant:"light",children:y(tn,{isHorizontal:!0,onSubmit:t(S=>k(S)),role:"anyone",children:[y(Bt,{...h,children:[e(An,{isDisabled:T}),e(W,{}),e(Mn,{isDisabled:T})]}),e(Wt,{children:y("div",{className:"pf-v5-u-mt-md",children:[e(L,{isDisabled:T,variant:ae.primary,className:"pf-v5-u-mr-md",type:"submit","data-testid":"save",children:i("save")}),e(L,{variant:"link","data-testid":"cancel",component:S=>e(nt,{...S,to:I?Le({realm:d,permissionClientId:a,tab:"policies"}):Ue({realm:d,clientId:o,tab:"policies"})}),children:i("cancel")})]})})]})})]})}const si=Object.freeze(Object.defineProperty({__proto__:null,default:Nn,isValidComponentType:_e},Symbol.toStringTag,{value:"Module"})),Fn=({policyProviders:n,onSelect:i,toggleDialog:o})=>{const{t:d}=M(),c=rt(),l=he(()=>n?c(n,ct("name")):[],[n]);return e(st,{"aria-label":d("createPolicy"),variant:ot.medium,header:y(Jt,{children:[e(Ge,{component:Qt.h1,children:d("chooseAPolicyType")}),e(Ge,{children:d("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:o,children:y(ge,{"aria-label":d("policies"),variant:"compact",children:[e(Ce,{children:y(ee,{children:[e(K,{children:d("name")}),e(K,{children:d("description")})]})}),e(ye,{children:l.map(a=>y(ee,{"data-testid":a.type,onRowClick:()=>i(a),isClickable:!0,children:[e(z,{children:a.name}),e(z,{style:{textWrap:"wrap"},children:_e(a.type)&&d(`policyProvider.${a.type}`)})]},a.type))})]})})};export{kn as A,Dn as C,Sn as D,Rn as G,$n as J,Mn as L,Fn as N,si as P,xn as R,Vn as T,vn as U,wn as a,En as b,_n as c,Pn as d,On as e,An as f};
//# sourceMappingURL=NewPolicyDialog-CIlfdiTN.js.map
