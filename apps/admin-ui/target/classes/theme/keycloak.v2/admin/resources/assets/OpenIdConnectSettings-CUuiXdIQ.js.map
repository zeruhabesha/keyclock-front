{"version":3,"file":"OpenIdConnectSettings-CUuiXdIQ.js","sources":["../../../../../../../src/identity-providers/add/OpenIdConnectSettings.tsx"],"sourcesContent":["import { FormGroup, Title } from \"@patternfly/react-core\";\r\nimport { useFormContext } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { FormErrorText, HelpItem } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { JsonFileUpload } from \"../../components/json-file-upload/JsonFileUpload\";\r\nimport { DiscoveryEndpointField } from \"../component/DiscoveryEndpointField\";\r\nimport { DiscoverySettings } from \"./DiscoverySettings\";\r\n\r\ntype OpenIdConnectSettingsProps = {\r\n  isOIDC: boolean;\r\n};\r\n\r\nexport const OpenIdConnectSettings = ({\r\n  isOIDC,\r\n}: OpenIdConnectSettingsProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const id = \"oidc\";\r\n\r\n  const {\r\n    setValue,\r\n    setError,\r\n    clearErrors,\r\n    formState: { errors },\r\n  } = useFormContext();\r\n\r\n  const setupForm = (result: any) => {\r\n    Object.keys(result).map((k) => setValue(`config.${k}`, result[k]));\r\n  };\r\n\r\n  const fileUpload = async (obj?: object) => {\r\n    clearErrors(\"discoveryError\");\r\n    if (!obj) {\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"providerId\", id);\r\n    formData.append(\"file\", new Blob([JSON.stringify(obj)]));\r\n\r\n    try {\r\n      const result =\r\n        await adminClient.identityProviders.importFromUrl(formData);\r\n      setupForm(result);\r\n    } catch (error) {\r\n      setError(\"discoveryError\", {\r\n        type: \"manual\",\r\n        message: (error as Error).message,\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Title headingLevel=\"h2\" size=\"xl\" className=\"kc-form-panel__title\">\r\n        {isOIDC ? t(\"oidcSettings\") : t(\"oAuthSettings\")}\r\n      </Title>\r\n\r\n      <DiscoveryEndpointField\r\n        id=\"oidc\"\r\n        fileUpload={\r\n          <FormGroup\r\n            label={t(\"importConfig\")}\r\n            fieldId=\"kc-import-config\"\r\n            labelIcon={\r\n              <HelpItem\r\n                helpText={t(\"importConfigHelp\")}\r\n                fieldLabelId=\"importConfig\"\r\n              />\r\n            }\r\n          >\r\n            <JsonFileUpload\r\n              id=\"kc-import-config\"\r\n              helpText={t(\"identity=providers-help:jsonFileUpload\")}\r\n              hideDefaultPreview\r\n              unWrap\r\n              validated={errors.discoveryError ? \"error\" : \"default\"}\r\n              onChange={(value) => fileUpload(value)}\r\n            />\r\n            {errors.discoveryError && (\r\n              <FormErrorText\r\n                message={errors.discoveryError.message as string}\r\n              />\r\n            )}\r\n          </FormGroup>\r\n        }\r\n      >\r\n        {(readonly) => (\r\n          <DiscoverySettings readOnly={readonly} isOIDC={isOIDC} />\r\n        )}\r\n      </DiscoveryEndpointField>\r\n    </>\r\n  );\r\n};\r\n"],"names":["OpenIdConnectSettings","isOIDC","adminClient","useAdminClient","useTranslation","id","setValue","setError","clearErrors","errors","useFormContext","setupForm","result","k","fileUpload","obj","formData","error","jsxs","Fragment","jsx","Title","DiscoveryEndpointField","FormGroup","HelpItem","JsonFileUpload","value","FormErrorText","readonly","DiscoverySettings"],"mappings":"oTAaO,MAAMA,EAAwB,CAAC,CACpC,OAAAC,CACF,IAAkC,CAChC,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,CAAA,EAAMC,EAAA,EACRC,EAAK,OAEL,CACJ,SAAAC,EACA,SAAAC,EACA,YAAAC,EACA,UAAW,CAAE,OAAAC,CAAA,CAAO,EAClBC,EAAA,EAEEC,EAAaC,GAAgB,CACjC,OAAO,KAAKA,CAAM,EAAE,IAAKC,GAAMP,EAAS,UAAUO,CAAC,GAAID,EAAOC,CAAC,CAAC,CAAC,CACnE,EAEMC,EAAa,MAAOC,GAAiB,CAEzC,GADAP,EAAY,gBAAgB,EACxB,CAACO,EACH,OAGF,MAAMC,EAAW,IAAI,SACrBA,EAAS,OAAO,aAAcX,CAAE,EAChCW,EAAS,OAAO,OAAQ,IAAI,KAAK,CAAC,KAAK,UAAUD,CAAG,CAAC,CAAC,CAAC,EAEvD,GAAI,CACF,MAAMH,EACJ,MAAMV,EAAY,kBAAkB,cAAcc,CAAQ,EAC5DL,EAAUC,CAAM,CAClB,OAASK,EAAO,CACdV,EAAS,iBAAkB,CACzB,KAAM,SACN,QAAUU,EAAgB,OAAA,CAC3B,CACH,CACF,EAEA,OACEC,EAAAC,EAAA,CACE,SAAA,CAAAC,EAACC,EAAA,CAAM,aAAa,KAAK,KAAK,KAAK,UAAU,uBAC1C,SAAS,EAATpB,EAAW,eAAoB,eAAN,EAC5B,EAEAmB,EAACE,EAAA,CACC,GAAG,OACH,WACEJ,EAACK,EAAA,CACC,MAAO,EAAE,cAAc,EACvB,QAAQ,mBACR,UACEH,EAACI,EAAA,CACC,SAAU,EAAE,kBAAkB,EAC9B,aAAa,cAAA,CAAA,EAIjB,SAAA,CAAAJ,EAACK,EAAA,CACC,GAAG,mBACH,SAAU,EAAE,wCAAwC,EACpD,mBAAkB,GAClB,OAAM,GACN,UAAWhB,EAAO,eAAiB,QAAU,UAC7C,SAAWiB,GAAUZ,EAAWY,CAAK,CAAA,CAAA,EAEtCjB,EAAO,gBACNW,EAACO,EAAA,CACC,QAASlB,EAAO,eAAe,OAAA,CAAA,CACjC,CAAA,CAAA,EAKL,SAACmB,GACAR,EAACS,EAAA,CAAkB,SAAUD,EAAU,OAAA3B,CAAA,CAAgB,CAAA,CAAA,CAE3D,EACF,CAEJ"}