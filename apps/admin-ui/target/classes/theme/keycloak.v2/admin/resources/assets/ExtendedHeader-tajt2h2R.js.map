{"version":3,"file":"ExtendedHeader-tajt2h2R.js","sources":["../../../../../../../src/user-federation/shared/ExtendedHeader.tsx"],"sourcesContent":["import { AlertVariant, Divider, DropdownItem } from \"@patternfly/react-core\";\r\nimport { useFormContext, useWatch } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\r\nimport { Header } from \"./Header\";\r\n\r\ntype ExtendedHeaderProps = {\r\n  provider: string;\r\n  editMode?: string | string[];\r\n  save: () => void;\r\n  noDivider?: boolean;\r\n};\r\n\r\nexport const ExtendedHeader = ({\r\n  provider,\r\n  editMode,\r\n  save,\r\n  noDivider = false,\r\n}: ExtendedHeaderProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { id } = useParams<{ id: string }>();\r\n  const { addAlert, addError } = useAlerts();\r\n\r\n  const { control } = useFormContext();\r\n  const hasImportUsers = useWatch({\r\n    name: \"config.importEnabled\",\r\n    control,\r\n    defaultValue: [\"true\"],\r\n  })[0];\r\n\r\n  const [toggleUnlinkUsersDialog, UnlinkUsersDialog] = useConfirmDialog({\r\n    titleKey: \"userFedUnlinkUsersConfirmTitle\",\r\n    messageKey: \"userFedUnlinkUsersConfirm\",\r\n    continueButtonLabel: \"unlinkUsers\",\r\n    onConfirm: () => unlinkUsers(),\r\n  });\r\n\r\n  const [toggleRemoveUsersDialog, RemoveUsersConfirm] = useConfirmDialog({\r\n    titleKey: t(\"removeImportedUsers\"),\r\n    messageKey: t(\"removeImportedUsersMessage\"),\r\n    continueButtonLabel: \"remove\",\r\n    onConfirm: async () => {\r\n      await removeImportedUsers();\r\n    },\r\n  });\r\n\r\n  const removeImportedUsers = async () => {\r\n    try {\r\n      if (id) {\r\n        await adminClient.userStorageProvider.removeImportedUsers({ id });\r\n        addAlert(t(\"removeImportedUsersSuccess\"), AlertVariant.success);\r\n      }\r\n    } catch (error) {\r\n      addError(\"removeImportedUsersError\", error);\r\n    }\r\n  };\r\n\r\n  const syncChangedUsers = async () => {\r\n    try {\r\n      if (id) {\r\n        addAlert(t(\"syncUsersStarted\"), AlertVariant.info);\r\n        const response = await adminClient.userStorageProvider.sync({\r\n          id: id,\r\n          action: \"triggerChangedUsersSync\",\r\n        });\r\n        if (response.ignored) {\r\n          addAlert(`${response.status}.`, AlertVariant.warning);\r\n        } else {\r\n          addAlert(\r\n            t(\"syncUsersSuccess\") +\r\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\r\n            AlertVariant.success,\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      addError(\"syncUsersError\", error);\r\n    }\r\n  };\r\n\r\n  const syncAllUsers = async () => {\r\n    try {\r\n      if (id) {\r\n        addAlert(t(\"syncUsersStarted\"), AlertVariant.info);\r\n        const response = await adminClient.userStorageProvider.sync({\r\n          id: id,\r\n          action: \"triggerFullSync\",\r\n        });\r\n        if (response.ignored) {\r\n          addAlert(`${response.status}.`, AlertVariant.warning);\r\n        } else {\r\n          addAlert(\r\n            t(\"syncUsersSuccess\") +\r\n              `${response.added} users added, ${response.updated} users updated, ${response.removed} users removed, ${response.failed} users failed.`,\r\n            AlertVariant.success,\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      addError(\"syncUsersError\", error);\r\n    }\r\n  };\r\n\r\n  const unlinkUsers = async () => {\r\n    try {\r\n      if (id) {\r\n        await adminClient.userStorageProvider.unlinkUsers({ id });\r\n      }\r\n      addAlert(t(\"unlinkUsersSuccess\"), AlertVariant.success);\r\n    } catch (error) {\r\n      addError(\"unlinkUsersError\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <UnlinkUsersDialog />\r\n      <RemoveUsersConfirm />\r\n      <Header\r\n        provider={provider}\r\n        noDivider={noDivider}\r\n        save={save}\r\n        dropdownItems={[\r\n          <DropdownItem\r\n            key=\"sync\"\r\n            onClick={syncChangedUsers}\r\n            isDisabled={hasImportUsers === \"false\"}\r\n          >\r\n            {t(\"syncChangedUsers\")}\r\n          </DropdownItem>,\r\n          <DropdownItem\r\n            key=\"syncall\"\r\n            onClick={syncAllUsers}\r\n            isDisabled={hasImportUsers === \"false\"}\r\n          >\r\n            {t(\"syncAllUsers\")}\r\n          </DropdownItem>,\r\n          <DropdownItem\r\n            key=\"unlink\"\r\n            isDisabled={editMode ? editMode.includes(\"UNSYNCED\") : false}\r\n            onClick={toggleUnlinkUsersDialog}\r\n          >\r\n            {t(\"unlinkUsers\")}\r\n          </DropdownItem>,\r\n          <DropdownItem key=\"remove\" onClick={toggleRemoveUsersDialog}>\r\n            {t(\"removeImported\")}\r\n          </DropdownItem>,\r\n          <Divider key=\"separator\" />,\r\n        ]}\r\n      />\r\n    </>\r\n  );\r\n};\r\n"],"names":["ExtendedHeader","provider","editMode","save","noDivider","adminClient","useAdminClient","t","useTranslation","id","useParams","addAlert","addError","useAlerts","control","useFormContext","hasImportUsers","useWatch","toggleUnlinkUsersDialog","UnlinkUsersDialog","useConfirmDialog","unlinkUsers","toggleRemoveUsersDialog","RemoveUsersConfirm","removeImportedUsers","AlertVariant","error","syncChangedUsers","response","syncAllUsers","jsxs","Fragment","jsx","Header","DropdownItem","Divider"],"mappings":"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"}