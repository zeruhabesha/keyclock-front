{"version":3,"file":"PermissionTab-CNBT0MGG.js","sources":["../../../../../../../src/components/permission-tab/PermissionTab.tsx"],"sourcesContent":["import type { ManagementPermissionReference } from \"@keycloak/keycloak-admin-client/lib/defs/managementPermissionReference\";\r\nimport { HelpItem, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Card,\r\n  CardBody,\r\n  CardTitle,\r\n  Form,\r\n  FormGroup,\r\n  PageSection,\r\n  Switch,\r\n} from \"@patternfly/react-core\";\r\nimport {\r\n  ActionsColumn,\r\n  Table,\r\n  Tbody,\r\n  Td,\r\n  Th,\r\n  Thead,\r\n  Tr,\r\n} from \"@patternfly/react-table\";\r\nimport { useState } from \"react\";\r\nimport { Trans, useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { toPermissionDetails } from \"../../clients/routes/PermissionDetails\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\nimport useLocaleSort from \"../../utils/useLocaleSort\";\r\nimport { useConfirmDialog } from \"../confirm-dialog/ConfirmDialog\";\r\n\r\nimport \"./permissions-tab.css\";\r\n\r\ntype PermissionScreenType =\r\n  | \"clients\"\r\n  | \"users\"\r\n  | \"groups\"\r\n  | \"roles\"\r\n  | \"identityProviders\";\r\n\r\ntype PermissionsTabProps = {\r\n  id?: string;\r\n  type: PermissionScreenType;\r\n};\r\n\r\nexport const PermissionsTab = ({ id, type }: PermissionsTabProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { realm } = useRealm();\r\n  const [realmId, setRealmId] = useState(\"\");\r\n  const [permission, setPermission] = useState<ManagementPermissionReference>();\r\n  const localeSort = useLocaleSort();\r\n\r\n  const togglePermissionEnabled = (enabled: boolean) => {\r\n    switch (type) {\r\n      case \"clients\":\r\n        return adminClient.clients.updateFineGrainPermission(\r\n          { id: id! },\r\n          { enabled },\r\n        );\r\n      case \"users\":\r\n        return adminClient.realms.updateUsersManagementPermissions({\r\n          realm,\r\n          enabled,\r\n        });\r\n      case \"groups\":\r\n        return adminClient.groups.updatePermission({ id: id! }, { enabled });\r\n      case \"roles\":\r\n        return adminClient.roles.updatePermission({ id: id! }, { enabled });\r\n      case \"identityProviders\":\r\n        return adminClient.identityProviders.updatePermission(\r\n          { alias: id! },\r\n          { enabled },\r\n        );\r\n    }\r\n  };\r\n\r\n  useFetch(\r\n    () =>\r\n      Promise.all([\r\n        adminClient.clients.find({\r\n          search: true,\r\n          clientId: realm === \"master\" ? \"master-realm\" : \"realm-management\",\r\n        }),\r\n        (() => {\r\n          switch (type) {\r\n            case \"clients\":\r\n              return adminClient.clients.listFineGrainPermissions({ id: id! });\r\n            case \"users\":\r\n              return adminClient.realms.getUsersManagementPermissions({\r\n                realm,\r\n              });\r\n            case \"groups\":\r\n              return adminClient.groups.listPermissions({ id: id! });\r\n            case \"roles\":\r\n              return adminClient.roles.listPermissions({ id: id! });\r\n            case \"identityProviders\":\r\n              return adminClient.identityProviders.listPermissions({\r\n                alias: id!,\r\n              });\r\n          }\r\n        })(),\r\n      ]),\r\n    ([clients, permission]) => {\r\n      setRealmId(clients[0]?.id!);\r\n      setPermission(permission);\r\n    },\r\n    [id],\r\n  );\r\n\r\n  const [toggleDisableDialog, DisableConfirm] = useConfirmDialog({\r\n    titleKey: \"permissionsDisable\",\r\n    messageKey: \"permissionsDisableConfirm\",\r\n    continueButtonLabel: \"confirm\",\r\n    onConfirm: async () => {\r\n      const permission = await togglePermissionEnabled(false);\r\n      setPermission(permission);\r\n    },\r\n  });\r\n\r\n  if (!permission) {\r\n    return <KeycloakSpinner />;\r\n  }\r\n\r\n  return (\r\n    <PageSection variant=\"light\">\r\n      <DisableConfirm />\r\n      <Card isFlat>\r\n        <CardTitle>{t(\"permissions\")}</CardTitle>\r\n        <CardBody>\r\n          {t(`${type}PermissionsHint`)}\r\n          <Form isHorizontal className=\"pf-v5-u-pt-md\">\r\n            <FormGroup\r\n              hasNoPaddingTop\r\n              className=\"permission-label\"\r\n              label={t(\"permissionsEnabled\")}\r\n              fieldId=\"permissionsEnabled\"\r\n              labelIcon={\r\n                <HelpItem\r\n                  helpText={t(\"permissionsEnabledHelp\")}\r\n                  fieldLabelId=\"permissionsEnabled\"\r\n                />\r\n              }\r\n            >\r\n              <Switch\r\n                id=\"permissionsEnabled\"\r\n                data-testid=\"permissionSwitch\"\r\n                label={t(\"on\")}\r\n                labelOff={t(\"off\")}\r\n                isChecked={permission.enabled}\r\n                onChange={async (_event, enabled) => {\r\n                  if (enabled) {\r\n                    const permission = await togglePermissionEnabled(enabled);\r\n                    setPermission(permission);\r\n                  } else {\r\n                    toggleDisableDialog();\r\n                  }\r\n                }}\r\n                aria-label={t(\"permissionsEnabled\")}\r\n              />\r\n            </FormGroup>\r\n          </Form>\r\n        </CardBody>\r\n      </Card>\r\n      {permission.enabled && (\r\n        <>\r\n          <Card isFlat className=\"pf-v5-u-mt-lg\">\r\n            <CardTitle>{t(\"permissionsList\")}</CardTitle>\r\n            <CardBody>\r\n              <Trans i18nKey=\"permissionsListIntro\">\r\n                {\" \"}\r\n                <strong>\r\n                  {{\r\n                    realm:\r\n                      realm === \"master\" ? \"master-realm\" : \"realm-management\",\r\n                  }}\r\n                </strong>\r\n                .\r\n              </Trans>\r\n            </CardBody>\r\n          </Card>\r\n          <Card isFlat className=\"keycloak__permission__permission-table\">\r\n            <CardBody className=\"pf-v5-u-p-0\">\r\n              <Table aria-label={t(\"permissionsList\")} variant=\"compact\">\r\n                <Thead>\r\n                  <Tr>\r\n                    <Th id=\"permissionsScopeName\">\r\n                      {t(\"permissionsScopeName\")}\r\n                    </Th>\r\n                    <Th id=\"description\">{t(\"description\")}</Th>\r\n                  </Tr>\r\n                </Thead>\r\n                <Tbody>\r\n                  {localeSort(\r\n                    Object.entries(permission.scopePermissions || {}),\r\n                    ([name]) => name,\r\n                  ).map(([name, id]) => (\r\n                    <Tr key={id}>\r\n                      <Td>\r\n                        <Link\r\n                          to={toPermissionDetails({\r\n                            realm,\r\n                            id: realmId,\r\n                            permissionType: \"scope\",\r\n                            permissionId: id,\r\n                          })}\r\n                        >\r\n                          {name}\r\n                        </Link>\r\n                      </Td>\r\n                      <Td>\r\n                        {t(`scopePermissions.${type}.${name}-description`)}\r\n                      </Td>\r\n                      <Td isActionCell>\r\n                        <ActionsColumn\r\n                          items={[\r\n                            {\r\n                              title: t(\"edit\"),\r\n                              onClick() {\r\n                                navigate(\r\n                                  toPermissionDetails({\r\n                                    realm,\r\n                                    id: realmId,\r\n                                    permissionType: \"scope\",\r\n                                    permissionId: id,\r\n                                  }),\r\n                                );\r\n                              },\r\n                            },\r\n                          ]}\r\n                        />\r\n                      </Td>\r\n                    </Tr>\r\n                  ))}\r\n                </Tbody>\r\n              </Table>\r\n            </CardBody>\r\n          </Card>\r\n        </>\r\n      )}\r\n    </PageSection>\r\n  );\r\n};\r\n"],"names":["PermissionsTab","id","type","adminClient","useAdminClient","t","useTranslation","navigate","useNavigate","realm","useRealm","realmId","setRealmId","useState","permission","setPermission","localeSort","useLocaleSort","togglePermissionEnabled","enabled","useFetch","clients","toggleDisableDialog","DisableConfirm","useConfirmDialog","jsxs","PageSection","jsx","Card","CardTitle","CardBody","Form","FormGroup","HelpItem","Switch","_event","Fragment","Trans","Table","Thead","Tr","Th","Tbody","name","Td","Link","toPermissionDetails","ActionsColumn","KeycloakSpinner"],"mappings":"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"}