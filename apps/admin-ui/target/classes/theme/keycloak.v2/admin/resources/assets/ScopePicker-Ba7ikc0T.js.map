{"version":3,"file":"ScopePicker-Ba7ikc0T.js","sources":["../../../../../../../src/clients/authorization/ScopePicker.tsx"],"sourcesContent":["import type ScopeRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/scopeRepresentation\";\r\nimport {\r\n  FormErrorText,\r\n  HelpItem,\r\n  KeycloakSelect,\r\n  SelectVariant,\r\n  useFetch,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { FormGroup, SelectOption } from \"@patternfly/react-core\";\r\nimport { useState } from \"react\";\r\nimport { Controller, useFormContext } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useIsAdminPermissionsClient } from \"../../utils/useIsAdminPermissionsClient\";\r\n\r\ntype Scope = {\r\n  id: string;\r\n  name: string;\r\n};\r\n\r\ntype ScopePickerProps = {\r\n  clientId: string;\r\n  resourceTypeScopes?: string[];\r\n};\r\n\r\nexport const ScopePicker = ({\r\n  clientId,\r\n  resourceTypeScopes,\r\n}: ScopePickerProps) => {\r\n  const { adminClient } = useAdminClient();\r\n  const { t } = useTranslation();\r\n  const {\r\n    control,\r\n    formState: { errors },\r\n  } = useFormContext();\r\n  const [open, setOpen] = useState(false);\r\n  const [scopes, setScopes] = useState<ScopeRepresentation[]>();\r\n  const [search, setSearch] = useState(\"\");\r\n  const isAdminPermissionsClient = useIsAdminPermissionsClient(clientId);\r\n\r\n  useFetch(\r\n    () => {\r\n      const params = {\r\n        id: clientId,\r\n        first: 0,\r\n        max: 20,\r\n        deep: false,\r\n        name: search,\r\n      };\r\n      return adminClient.clients.listAllScopes(params);\r\n    },\r\n    setScopes,\r\n    [search],\r\n  );\r\n\r\n  const renderScopes = (scopes: ScopeRepresentation[] | string[]) =>\r\n    scopes.map((option, index) => (\r\n      <SelectOption key={index} value={option}>\r\n        {typeof option === \"string\" ? option : option.name}\r\n      </SelectOption>\r\n    ));\r\n\r\n  if (!scopes && !resourceTypeScopes) return <KeycloakSpinner />;\r\n\r\n  const allScopes =\r\n    isAdminPermissionsClient && resourceTypeScopes\r\n      ? resourceTypeScopes\r\n      : scopes?.map((scope) => scope.name!);\r\n\r\n  return (\r\n    <FormGroup\r\n      label={t(\"authorizationScopes\")}\r\n      labelIcon={\r\n        <HelpItem helpText={t(\"clientScopesHelp\")} fieldLabelId=\"scopes\" />\r\n      }\r\n      fieldId=\"scopes\"\r\n      isRequired={isAdminPermissionsClient}\r\n    >\r\n      <Controller\r\n        name=\"scopes\"\r\n        defaultValue={[]}\r\n        control={control}\r\n        rules={isAdminPermissionsClient ? { required: t(\"requiredField\") } : {}}\r\n        render={({ field }) => {\r\n          const selectedValues = field.value.map((o: Scope) => o.name);\r\n          return (\r\n            <>\r\n              <KeycloakSelect\r\n                toggleId=\"scopes\"\r\n                variant={SelectVariant.typeaheadMulti}\r\n                chipGroupProps={{\r\n                  numChips: 3,\r\n                  expandedText: t(\"hide\"),\r\n                  collapsedText: t(\"showRemaining\"),\r\n                }}\r\n                onToggle={(val) => setOpen(val)}\r\n                isOpen={open}\r\n                selections={selectedValues}\r\n                onFilter={(value) => {\r\n                  setSearch(value);\r\n                  return renderScopes(allScopes || []);\r\n                }}\r\n                onSelect={(selectedValue) => {\r\n                  const option =\r\n                    typeof selectedValue === \"string\"\r\n                      ? selectedValue\r\n                      : (selectedValue as Scope).name;\r\n                  const changedValue = field.value.find(\r\n                    (o: Scope) => o.name === option,\r\n                  )\r\n                    ? field.value.filter((item: Scope) => item.name !== option)\r\n                    : [...field.value, { name: option }];\r\n                  field.onChange(changedValue);\r\n                }}\r\n                onClear={() => {\r\n                  setSearch(\"\");\r\n                  field.onChange([]);\r\n                }}\r\n                typeAheadAriaLabel={t(\"authorizationScopes\")}\r\n              >\r\n                {renderScopes(allScopes || [])}\r\n              </KeycloakSelect>\r\n              {isAdminPermissionsClient && errors.scopes && (\r\n                <FormErrorText message={t(\"required\")} />\r\n              )}\r\n            </>\r\n          );\r\n        }}\r\n      />\r\n    </FormGroup>\r\n  );\r\n};\r\n"],"names":["ScopePicker","clientId","resourceTypeScopes","adminClient","useAdminClient","t","useTranslation","control","errors","useFormContext","open","setOpen","useState","scopes","setScopes","search","setSearch","isAdminPermissionsClient","useIsAdminPermissionsClient","useFetch","params","renderScopes","option","index","jsx","SelectOption","KeycloakSpinner","allScopes","scope","FormGroup","HelpItem","Controller","field","selectedValues","o","jsxs","Fragment","KeycloakSelect","SelectVariant","val","value","selectedValue","changedValue","item","FormErrorText"],"mappings":"wRA0BO,MAAMA,EAAc,CAAC,CAC1B,SAAAC,EACA,mBAAAC,CACF,IAAwB,CACtB,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAClB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CACJ,QAAAC,EACA,UAAW,CAAE,OAAAC,CAAA,CAAO,EAClBC,EAAA,EACE,CAACC,EAAMC,CAAO,EAAIC,EAAS,EAAK,EAChC,CAACC,EAAQC,CAAS,EAAIF,EAAA,EACtB,CAACG,EAAQC,CAAS,EAAIJ,EAAS,EAAE,EACjCK,EAA2BC,EAA4BjB,CAAQ,EAErEkB,EACE,IAAM,CACJ,MAAMC,EAAS,CACb,GAAInB,EACJ,MAAO,EACP,IAAK,GACL,KAAM,GACN,KAAMc,CAAA,EAER,OAAOZ,EAAY,QAAQ,cAAciB,CAAM,CACjD,EACAN,EACA,CAACC,CAAM,CAAA,EAGT,MAAMM,EAAgBR,GACpBA,EAAO,IAAI,CAACS,EAAQC,IAClBC,EAACC,GAAyB,MAAOH,EAC9B,gBAAOA,GAAW,SAAWA,EAASA,EAAO,MAD7BC,CAEnB,CACD,EAEH,GAAI,CAACV,GAAU,CAACX,EAAoB,SAAQwB,EAAA,EAAgB,EAE5D,MAAMC,EACJV,GAA4Bf,EACxBA,EACAW,GAAQ,IAAKe,GAAUA,EAAM,IAAK,EAExC,OACEJ,EAACK,EAAA,CACC,MAAOxB,EAAE,qBAAqB,EAC9B,YACGyB,EAAA,CAAS,SAAUzB,EAAE,kBAAkB,EAAG,aAAa,SAAS,EAEnE,QAAQ,SACR,WAAYY,EAEZ,SAAAO,EAACO,EAAA,CACC,KAAK,SACL,aAAc,CAAA,EACd,QAAAxB,EACA,MAAOU,EAA2B,CAAE,SAAUZ,EAAE,eAAe,CAAA,EAAM,CAAA,EACrE,OAAQ,CAAC,CAAE,MAAA2B,KAAY,CACrB,MAAMC,EAAiBD,EAAM,MAAM,IAAKE,GAAaA,EAAE,IAAI,EAC3D,OACEC,EAAAC,EAAA,CACE,SAAA,CAAAZ,EAACa,EAAA,CACC,SAAS,SACT,QAASC,EAAc,eACvB,eAAgB,CACd,SAAU,EACV,aAAcjC,EAAE,MAAM,EACtB,cAAeA,EAAE,eAAe,CAAA,EAElC,SAAWkC,GAAQ5B,EAAQ4B,CAAG,EAC9B,OAAQ7B,EACR,WAAYuB,EACZ,SAAWO,IACTxB,EAAUwB,CAAK,EACRnB,EAAaM,GAAa,EAAE,GAErC,SAAWc,GAAkB,CAC3B,MAAMnB,EACJ,OAAOmB,GAAkB,SACrBA,EACCA,EAAwB,KACzBC,EAAeV,EAAM,MAAM,KAC9BE,GAAaA,EAAE,OAASZ,CAAA,EAEvBU,EAAM,MAAM,OAAQW,GAAgBA,EAAK,OAASrB,CAAM,EACxD,CAAC,GAAGU,EAAM,MAAO,CAAE,KAAMV,EAAQ,EACrCU,EAAM,SAASU,CAAY,CAC7B,EACA,QAAS,IAAM,CACb1B,EAAU,EAAE,EACZgB,EAAM,SAAS,EAAE,CACnB,EACA,mBAAoB3B,EAAE,qBAAqB,EAE1C,SAAAgB,EAAaM,GAAa,CAAA,CAAE,CAAA,CAAA,EAE9BV,GAA4BT,EAAO,QAClCgB,EAACoB,GAAc,QAASvC,EAAE,UAAU,CAAA,CAAG,CAAA,EAE3C,CAEJ,CAAA,CAAA,CACF,CAAA,CAGN"}