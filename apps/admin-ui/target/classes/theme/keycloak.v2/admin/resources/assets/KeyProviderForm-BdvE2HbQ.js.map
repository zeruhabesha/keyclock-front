{"version":3,"file":"KeyProviderForm-BdvE2HbQ.js","sources":["../../../../../../../src/realm-settings/keys/key-providers/KeyProviderForm.tsx"],"sourcesContent":["import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\r\nimport { TextControl, useAlerts, useFetch } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  ActionGroup,\r\n  AlertVariant,\r\n  Button,\r\n  PageSection,\r\n} from \"@patternfly/react-core\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../../../admin-client\";\r\nimport { DynamicComponents } from \"../../../components/dynamic/DynamicComponents\";\r\nimport { FormAccess } from \"../../../components/form/FormAccess\";\r\nimport { ViewHeader } from \"../../../components/view-header/ViewHeader\";\r\nimport { useServerInfo } from \"../../../context/server-info/ServerInfoProvider\";\r\nimport { KEY_PROVIDER_TYPE } from \"../../../util\";\r\nimport { useParams } from \"../../../utils/useParams\";\r\nimport { KeyProviderParams, ProviderType } from \"../../routes/KeyProvider\";\r\nimport { toKeysTab } from \"../../routes/KeysTab\";\r\n\r\ntype KeyProviderFormProps = {\r\n  id?: string;\r\n  providerType: ProviderType;\r\n  onClose?: () => void;\r\n};\r\n\r\nexport const KeyProviderForm = ({\r\n  providerType,\r\n  onClose,\r\n}: KeyProviderFormProps) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { t } = useTranslation();\r\n  const { id } = useParams<{ id: string }>();\r\n  const { addAlert, addError } = useAlerts();\r\n\r\n  const serverInfo = useServerInfo();\r\n  const allComponentTypes =\r\n    serverInfo.componentTypes?.[KEY_PROVIDER_TYPE] ?? [];\r\n\r\n  const form = useForm<ComponentRepresentation>({\r\n    mode: \"onChange\",\r\n  });\r\n  const { handleSubmit, reset } = form;\r\n\r\n  const save = async (component: ComponentRepresentation) => {\r\n    if (component.config)\r\n      Object.entries(component.config).forEach(\r\n        ([key, value]) =>\r\n          (component.config![key] = Array.isArray(value) ? value : [value]),\r\n      );\r\n    try {\r\n      if (id) {\r\n        await adminClient.components.update(\r\n          { id },\r\n          {\r\n            ...component,\r\n            providerType: KEY_PROVIDER_TYPE,\r\n          },\r\n        );\r\n        addAlert(t(\"saveProviderSuccess\"), AlertVariant.success);\r\n      } else {\r\n        await adminClient.components.create({\r\n          ...component,\r\n          providerId: providerType,\r\n          providerType: KEY_PROVIDER_TYPE,\r\n        });\r\n        addAlert(t(\"saveProviderSuccess\"), AlertVariant.success);\r\n        onClose?.();\r\n      }\r\n    } catch (error) {\r\n      addError(\"saveProviderError\", error);\r\n    }\r\n  };\r\n\r\n  useFetch(\r\n    async () => {\r\n      if (id) return await adminClient.components.findOne({ id });\r\n    },\r\n    (result) => {\r\n      if (result) {\r\n        reset({ ...result });\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  return (\r\n    <FormAccess isHorizontal role=\"manage-realm\" onSubmit={handleSubmit(save)}>\r\n      <FormProvider {...form}>\r\n        {id && (\r\n          <TextControl\r\n            name=\"id\"\r\n            label={t(\"providerId\")}\r\n            labelIcon={t(\"providerIdHelp\")}\r\n            rules={{\r\n              required: t(\"required\"),\r\n            }}\r\n            readOnly\r\n          />\r\n        )}\r\n        <TextControl\r\n          name=\"name\"\r\n          defaultValue={providerType}\r\n          label={t(\"name\")}\r\n          labelIcon={t(\"keyProviderMapperNameHelp\")}\r\n          rules={{\r\n            required: t(\"required\"),\r\n          }}\r\n        />\r\n        <DynamicComponents\r\n          properties={\r\n            allComponentTypes.find((type) => type.id === providerType)\r\n              ?.properties || []\r\n          }\r\n        />\r\n        <ActionGroup>\r\n          <Button\r\n            data-testid=\"add-provider-button\"\r\n            variant=\"primary\"\r\n            type=\"submit\"\r\n          >\r\n            {t(\"save\")}\r\n          </Button>\r\n          <Button onClick={() => onClose?.()} variant=\"link\">\r\n            {t(\"cancel\")}\r\n          </Button>\r\n        </ActionGroup>\r\n      </FormProvider>\r\n    </FormAccess>\r\n  );\r\n};\r\n\r\nexport default function KeyProviderFormPage() {\r\n  const { t } = useTranslation();\r\n  const params = useParams<KeyProviderParams>();\r\n  const navigate = useNavigate();\r\n\r\n  return (\r\n    <>\r\n      <ViewHeader titleKey={t(\"editProvider\")} subKey={params.providerType} />\r\n      <PageSection variant=\"light\">\r\n        <KeyProviderForm\r\n          {...params}\r\n          onClose={() =>\r\n            navigate(toKeysTab({ realm: params.realm, tab: \"providers\" }))\r\n          }\r\n        />\r\n      </PageSection>\r\n    </>\r\n  );\r\n}\r\n"],"names":["KeyProviderForm","providerType","onClose","adminClient","useAdminClient","t","useTranslation","id","useParams","addAlert","addError","useAlerts","allComponentTypes","useServerInfo","KEY_PROVIDER_TYPE","form","useForm","handleSubmit","reset","save","component","key","value","AlertVariant","error","useFetch","result","jsx","FormAccess","jsxs","FormProvider","TextControl","DynamicComponents","type","ActionGroup","Button","KeyProviderFormPage","params","navigate","useNavigate","Fragment","ViewHeader","PageSection","toKeysTab"],"mappings":"m0BA2BO,MAAMA,EAAkB,CAAC,CAC9B,aAAAC,EACA,QAAAC,CACF,IAA4B,CAC1B,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CAAE,GAAAC,CAAA,EAAOC,EAAA,EACT,CAAE,SAAAC,EAAU,SAAAC,CAAA,EAAaC,EAAA,EAGzBC,EADaC,EAAA,EAEN,iBAAiBC,CAAiB,GAAK,CAAA,EAE9CC,EAAOC,EAAiC,CAC5C,KAAM,UAAA,CACP,EACK,CAAE,aAAAC,EAAc,MAAAC,CAAA,EAAUH,EAE1BI,EAAO,MAAOC,GAAuC,CACrDA,EAAU,QACZ,OAAO,QAAQA,EAAU,MAAM,EAAE,QAC/B,CAAC,CAACC,EAAKC,CAAK,IACTF,EAAU,OAAQC,CAAG,EAAI,MAAM,QAAQC,CAAK,EAAIA,EAAQ,CAACA,CAAK,CAAA,EAErE,GAAI,CACEf,GACF,MAAMJ,EAAY,WAAW,OAC3B,CAAE,GAAAI,CAAA,EACF,CACE,GAAGa,EACH,aAAcN,CAAA,CAChB,EAEFL,EAASJ,EAAE,qBAAqB,EAAGkB,EAAa,OAAO,IAEvD,MAAMpB,EAAY,WAAW,OAAO,CAClC,GAAGiB,EACH,WAAYnB,EACZ,aAAca,CAAA,CACf,EACDL,EAASJ,EAAE,qBAAqB,EAAGkB,EAAa,OAAO,EACvDrB,IAAA,EAEJ,OAASsB,EAAO,CACdd,EAAS,oBAAqBc,CAAK,CACrC,CACF,EAEAC,OAAAA,EACE,SAAY,CACV,GAAIlB,SAAW,MAAMJ,EAAY,WAAW,QAAQ,CAAE,GAAAI,EAAI,CAC5D,EACCmB,GAAW,CACNA,GACFR,EAAM,CAAE,GAAGQ,EAAQ,CAEvB,EACA,CAAA,CAAC,EAIDC,EAACC,EAAA,CAAW,aAAY,GAAC,KAAK,eAAe,SAAUX,EAAaE,CAAI,EACtE,SAAAU,EAACC,EAAA,CAAc,GAAGf,EACf,SAAA,CAAAR,GACCoB,EAACI,EAAA,CACC,KAAK,KACL,MAAO1B,EAAE,YAAY,EACrB,UAAWA,EAAE,gBAAgB,EAC7B,MAAO,CACL,SAAUA,EAAE,UAAU,CAAA,EAExB,SAAQ,EAAA,CAAA,EAGZsB,EAACI,EAAA,CACC,KAAK,OACL,aAAc9B,EACd,MAAOI,EAAE,MAAM,EACf,UAAWA,EAAE,2BAA2B,EACxC,MAAO,CACL,SAAUA,EAAE,UAAU,CAAA,CACxB,CAAA,EAEFsB,EAACK,EAAA,CACC,WACEpB,EAAkB,KAAMqB,GAASA,EAAK,KAAOhC,CAAY,GACrD,YAAc,CAAA,CAAC,CAAA,IAGtBiC,EAAA,CACC,SAAA,CAAAP,EAACQ,EAAA,CACC,cAAY,sBACZ,QAAQ,UACR,KAAK,SAEJ,WAAE,MAAM,CAAA,CAAA,EAEXR,EAACQ,EAAA,CAAO,QAAS,IAAMjC,IAAA,EAAa,QAAQ,OACzC,SAAAG,EAAE,QAAQ,CAAA,CACb,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ,EAEA,SAAwB+B,IAAsB,CAC5C,KAAM,CAAE,EAAA/B,CAAA,EAAMC,EAAA,EACR+B,EAAS7B,EAAA,EACT8B,EAAWC,EAAA,EAEjB,OACEV,EAAAW,EAAA,CACE,SAAA,CAAAb,EAACc,GAAW,SAAUpC,EAAE,cAAc,EAAG,OAAQgC,EAAO,aAAc,EACtEV,EAACe,EAAA,CAAY,QAAQ,QACnB,SAAAf,EAAC3B,EAAA,CACE,GAAGqC,EACJ,QAAS,IACPC,EAASK,EAAU,CAAE,MAAON,EAAO,MAAO,IAAK,YAAa,CAAC,CAAA,CAAA,CAEjE,CACF,CAAA,EACF,CAEJ"}