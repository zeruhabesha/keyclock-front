import{jsx as t,jsxs as d,Fragment as _}from"react/jsx-runtime";import{useMemo as E,useState as Q,useEffect as z}from"react";import{a as B,u as G,j as Y,d as X,b2 as Z,e as ee,an as te,ao as A,y as ae,N as m,b3 as n,m as ne,l as ie,Q as s,aO as C,U as p,A as se,au as le,g as re,L as oe,aU as ce}from"./main-o1hptXRo.js";import{g as de}from"./utils-C-TUnOch.js";import{D as b}from"./SwitchControl-CU1bUhmR.js";import{b as J}from"./ClientScopeTypes-D2w5c8Pp.js";import{F as ue}from"./FormAccess-BnhQnYb9.js";const L="oid4vc",h="jwt_vc",c="dc+sd-jwt",P=i=>!i||i.trim()===""?!0:i.includes(", ")||i.includes(" ,")?"Comma-separated list must not contain spaces around commas":i.split(",").some(y=>y.trim()==="")?"Comma-separated list contains empty entries":!0,Ie=({clientScope:i,save:S})=>{const{t:e}=B(),{adminClient:y}=G(),f=Y({mode:"onChange"}),{control:u,handleSubmit:M,setValue:g,formState:k}=f,{isDirty:N,isValid:K}=k,{realm:T}=X(),H=Z(),v=ee(),V=te(),O=V(A.DynamicScopes),F=E(()=>v?.providers?.signature?.providers?Object.keys(v.providers.signature.providers):[],[v]),[r,R]=Q([]);ae(async()=>(await y.realms.getKeys({realm:T})).keys||[],R,[]);const W=E(()=>{const a=[{key:"",value:e("useDefaultKey")}];if(r&&r.length>0){const o=r.filter(l=>l.kid&&l.status==="ACTIVE"&&l.algorithm&&F.includes(l.algorithm)).map(l=>({key:l.kid,value:`${l.kid} (${l.algorithm})`}));a.push(...o)}return a},[r,F,e]),D=m({control:u,name:n("attributes.display.on.consent.screen"),defaultValue:i?.attributes?.["display.on.consent.screen"]??"true"}),$=m({control:u,name:n("attributes.is.dynamic.scope"),defaultValue:"false"}),x=m({control:u,name:"protocol"}),I=m({control:u,name:n("attributes.vc.format"),defaultValue:i?.attributes?.["vc.format"]??c}),U=x===L,j=V(A.OpenId4VCI),q=x!="saml",w=(a,o)=>g(n("attributes.dynamic.scope.regexp"),o?`${a}:*`:a,{shouldDirty:!0});return z(()=>{ne(i??{},g)},[i,g]),t(ue,{role:"manage-clients",onSubmit:M(S),isHorizontal:!0,children:d(ie,{...f,children:[t(s,{name:"name",label:e("name"),labelIcon:e("scopeNameHelp"),rules:{required:e("required"),onChange:a=>{O&&w(a.target.validated,!0)}}}),O&&d(_,{children:[t(b,{name:n("attributes.is.dynamic.scope"),label:e("dynamicScope"),labelIcon:e("dynamicScopeHelp"),onChange:(a,o)=>{w(o&&f.getValues("name")||"",o)},stringify:!0}),$==="true"&&t(s,{name:n("attributes.dynamic.scope.regexp"),label:e("dynamicScopeFormat"),labelIcon:e("dynamicScopeFormatHelp"),isDisabled:!0})]}),t(C,{name:"description",label:e("description"),labelIcon:e("scopeDescriptionHelp"),rules:{maxLength:{value:255,message:e("maxLength")}}}),t(p,{id:"kc-type",name:"type",label:e("type"),labelIcon:e("scopeTypeHelp"),controller:{defaultValue:J[0]},options:J.map(a=>({key:a,value:e(`clientScopeType.${a}`)}))}),!i&&t(p,{id:"kc-protocol",name:"protocol",label:e("protocol"),labelIcon:e("protocolHelp"),controller:{defaultValue:H[0]},options:H.filter(a=>a===L?j:!0).map(a=>({key:a,value:de(e,a)}))}),t(b,{name:n("attributes.display.on.consent.screen"),defaultValue:D,label:e("displayOnConsentScreen"),labelIcon:e("displayOnConsentScreenHelp"),stringify:!0}),D==="true"&&t(C,{name:n("attributes.consent.screen.text"),label:e("consentScreenText"),labelIcon:e("consentScreenTextHelp")}),t(b,{name:n("attributes.include.in.token.scope"),label:e("includeInTokenScope"),labelIcon:e("includeInTokenScopeHelp"),stringify:!0}),q&&t(b,{name:n("attributes.include.in.openid.provider.metadata"),defaultValue:"true",label:e("includeInOpenIdProviderMetadata"),labelIcon:e("includeInOpenIdProviderMetadataHelp"),stringify:!0}),t(s,{name:n("attributes.gui.order"),label:e("guiOrder"),labelIcon:e("guiOrderHelp"),type:"number",min:0}),U&&j&&d(_,{children:[t(s,{name:n("attributes.vc.credential_configuration_id"),label:e("credentialConfigurationId"),labelIcon:e("credentialConfigurationIdHelp")}),t(s,{name:n("attributes.vc.credential_identifier"),label:e("credentialIdentifier"),labelIcon:e("credentialIdentifierHelp")}),t(s,{name:n("attributes.vc.issuer_did"),label:e("issuerDid"),labelIcon:e("issuerDidHelp")}),t(s,{name:n("attributes.vc.expiry_in_seconds"),label:e("credentialLifetime"),labelIcon:e("credentialLifetimeHelp"),type:"number",min:1}),t(p,{id:"kc-vc-format",name:n("attributes.vc.format"),label:e("supportedFormats"),labelIcon:e("supportedFormatsHelp"),controller:{defaultValue:c},options:[{key:c,value:`SD-JWT VC (${c})`},{key:h,value:`JWT VC (${h})`}]}),t(s,{name:n("attributes.vc.credential_build_config.token_jws_type"),label:e("tokenJwsType"),labelIcon:e("tokenJwsTypeHelp"),defaultValue:i?.attributes?.["vc.credential_build_config.token_jws_type"]??"JWS"}),r&&r.length>0&&t(p,{id:"kc-signing-key-id",name:n("attributes.vc.signing_key_id"),label:e("signingKeyId"),labelIcon:e("signingKeyIdHelp"),controller:{defaultValue:i?.attributes?.["vc.signing_key_id"]??""},options:W}),t(C,{name:n("attributes.vc.display"),label:e("credentialDisplay"),labelIcon:e("credentialDisplayHelp"),rules:{validate:a=>{if(!a||a.trim()==="")return!0;try{return JSON.parse(a),!0}catch{return"Invalid JSON format"}}}}),(I===h||I===c)&&t(s,{name:n("attributes.vc.supported_credential_types"),label:e("supportedCredentialTypes"),labelIcon:e("supportedCredentialTypesHelp"),rules:{validate:P}}),I===c&&d(_,{children:[t(s,{name:n("attributes.vc.verifiable_credential_type"),label:e("verifiableCredentialType"),labelIcon:e("verifiableCredentialTypeHelp")}),t(s,{name:n("attributes.vc.credential_build_config.sd_jwt.visible_claims"),label:e("visibleClaims"),labelIcon:e("visibleClaimsHelp"),defaultValue:i?.attributes?.["vc.credential_build_config.sd_jwt.visible_claims"]??"id,iat,nbf,exp,jti",rules:{validate:P}})]})]}),d(se,{children:[t(le,{"data-testid":"save",formState:k,disabled:!N||!K,children:e("save")}),t(re,{variant:"link",component:a=>t(oe,{...a,to:ce({realm:T})}),children:e("cancel")})]})]})})};export{Ie as S};
//# sourceMappingURL=ScopeForm-BaMejMtZ.js.map
