{"version":3,"file":"SessionsTable-4N_7uyd-.js","sources":["../../../../../../../../../node_modules/.pnpm/@patternfly+react-icons@5.4_f39c5b970058b42208dac3bfc1f9d8fb/node_modules/@patternfly/react-icons/dist/esm/icons/cubes-icon.js","../../../../../../../src/user/utils.ts","../../../../../../../src/sessions/SessionsTable.tsx"],"sourcesContent":["import { createIcon } from '../createIcon';\n\nexport const CubesIconConfig = {\n  name: 'CubesIcon',\n  height: 512,\n  width: 512,\n  svgPath: 'M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z',\n  yOffset: 0,\n  xOffset: 0,\n};\n\nexport const CubesIcon = createIcon(CubesIconConfig);\n\nexport default CubesIcon;","export const isLightweightUser = (userId?: string) =>\r\n  userId?.startsWith(\"lightweight-\");\r\n","import type UserSessionRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/userSessionRepresentation\";\r\nimport { useEnvironment } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Button,\r\n  Label,\r\n  List,\r\n  ListItem,\r\n  ListVariant,\r\n  ToolbarItem,\r\n  Tooltip,\r\n} from \"@patternfly/react-core\";\r\nimport { CubesIcon, InfoCircleIcon } from \"@patternfly/react-icons\";\r\nimport { IRowData } from \"@patternfly/react-table\";\r\nimport { ReactNode, useMemo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useMatch, useNavigate } from \"react-router-dom\";\r\nimport { useAdminClient } from \"../admin-client\";\r\nimport { toClient } from \"../clients/routes/Client\";\r\nimport { useAlerts } from \"@keycloak/keycloak-ui-shared\";\r\nimport { useConfirmDialog } from \"../components/confirm-dialog/ConfirmDialog\";\r\nimport { ListEmptyState } from \"@keycloak/keycloak-ui-shared\";\r\nimport {\r\n  Action,\r\n  Field,\r\n  KeycloakDataTable,\r\n  LoaderFunction,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { useRealm } from \"../context/realm-context/RealmContext\";\r\nimport { useWhoAmI } from \"../context/whoami/WhoAmI\";\r\nimport { UserRoute, toUser } from \"../user/routes/User\";\r\nimport { toUsers } from \"../user/routes/Users\";\r\nimport { isLightweightUser } from \"../user/utils\";\r\nimport useFormatDate from \"../utils/useFormatDate\";\r\n\r\nexport type ColumnName =\r\n  | \"username\"\r\n  | \"start\"\r\n  | \"lastAccess\"\r\n  | \"clients\"\r\n  | \"type\";\r\n\r\nexport type SessionsTableProps = {\r\n  loader: LoaderFunction<UserSessionRepresentation>;\r\n  hiddenColumns?: ColumnName[];\r\n  emptyInstructions?: string;\r\n  logoutUser?: string;\r\n  filter?: ReactNode;\r\n  isSearching?: boolean;\r\n  isPaginated?: boolean;\r\n};\r\n\r\nconst UsernameCell = (row: UserSessionRepresentation) => {\r\n  const { realm } = useRealm();\r\n  const { t } = useTranslation();\r\n  return (\r\n    <Link to={toUser({ realm, id: row.userId!, tab: \"sessions\" })}>\r\n      {row.username}\r\n      {row.transientUser && (\r\n        <>\r\n          {\" \"}\r\n          <Tooltip content={t(\"transientUserTooltip\")}>\r\n            <Label\r\n              data-testid=\"user-details-label-transient-user\"\r\n              icon={<InfoCircleIcon />}\r\n              isCompact\r\n            >\r\n              {t(\"transientUser\")}\r\n            </Label>\r\n          </Tooltip>\r\n        </>\r\n      )}\r\n    </Link>\r\n  );\r\n};\r\n\r\nconst ClientsCell = (row: UserSessionRepresentation) => {\r\n  const { realm } = useRealm();\r\n  return (\r\n    <List variant={ListVariant.inline}>\r\n      {Object.entries(row.clients!).map(([clientId, client]) => (\r\n        <ListItem key={clientId}>\r\n          <Link to={toClient({ realm, clientId, tab: \"sessions\" })}>\r\n            {client}\r\n          </Link>\r\n        </ListItem>\r\n      ))}\r\n    </List>\r\n  );\r\n};\r\n\r\nexport default function SessionsTable({\r\n  loader,\r\n  hiddenColumns = [],\r\n  emptyInstructions,\r\n  logoutUser,\r\n  filter,\r\n  isSearching,\r\n  isPaginated,\r\n}: SessionsTableProps) {\r\n  const { keycloak } = useEnvironment();\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { realm } = useRealm();\r\n  const { whoAmI } = useWhoAmI();\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { addError } = useAlerts();\r\n  const formatDate = useFormatDate();\r\n  const [key, setKey] = useState(0);\r\n  const refresh = () => setKey((value) => value + 1);\r\n  const isOnUserPage = !!useMatch(UserRoute.path);\r\n\r\n  const columns = useMemo(() => {\r\n    const defaultColumns: Field<UserSessionRepresentation>[] = [\r\n      {\r\n        name: \"username\",\r\n        displayKey: \"user\",\r\n        cellRenderer: UsernameCell,\r\n      },\r\n      {\r\n        name: \"type\",\r\n        displayKey: \"type\",\r\n      },\r\n      {\r\n        name: \"start\",\r\n        displayKey: \"started\",\r\n        cellRenderer: (row) => formatDate(new Date(row.start!)),\r\n      },\r\n      {\r\n        name: \"lastAccess\",\r\n        displayKey: \"lastAccess\",\r\n        cellRenderer: (row) => formatDate(new Date(row.lastAccess!)),\r\n      },\r\n      {\r\n        name: \"ipAddress\",\r\n        displayKey: \"ipAddress\",\r\n      },\r\n      {\r\n        name: \"clients\",\r\n        displayKey: \"clients\",\r\n        cellRenderer: ClientsCell,\r\n      },\r\n    ];\r\n\r\n    return defaultColumns.filter(\r\n      ({ name }) => !hiddenColumns.includes(name as ColumnName),\r\n    );\r\n  }, [realm, hiddenColumns]);\r\n\r\n  const [toggleLogoutDialog, LogoutConfirm] = useConfirmDialog({\r\n    titleKey: \"logoutAllSessions\",\r\n    messageKey: \"logoutAllDescription\",\r\n    continueButtonLabel: \"confirm\",\r\n    onConfirm: async () => {\r\n      try {\r\n        await adminClient.users.logout({ id: logoutUser! });\r\n        if (isOnUserPage && isLightweightUser(logoutUser)) {\r\n          navigate(toUsers({ realm: realm }));\r\n        } else {\r\n          refresh();\r\n        }\r\n      } catch (error) {\r\n        addError(\"logoutAllSessionsError\", error);\r\n      }\r\n    },\r\n  });\r\n\r\n  async function onClickRevoke(rowData: IRowData) {\r\n    const session = rowData.data as UserSessionRepresentation;\r\n    await adminClient.realms.deleteSession({\r\n      realm,\r\n      session: session.id!,\r\n      isOffline: true,\r\n    });\r\n\r\n    refresh();\r\n  }\r\n\r\n  async function onClickSignOut(rowData: IRowData) {\r\n    const session = rowData.data as UserSessionRepresentation;\r\n    await adminClient.realms.deleteSession({\r\n      realm,\r\n      session: session.id!,\r\n      isOffline: false,\r\n    });\r\n\r\n    if (session.userId === whoAmI.userId) {\r\n      await keycloak.logout({ redirectUri: \"\" });\r\n    } else if (isOnUserPage && isLightweightUser(session.userId)) {\r\n      navigate(toUsers({ realm: realm }));\r\n    } else {\r\n      refresh();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <LogoutConfirm />\r\n      <KeycloakDataTable\r\n        key={key}\r\n        loader={loader}\r\n        ariaLabelKey=\"titleSessions\"\r\n        searchPlaceholderKey=\"searchForSession\"\r\n        isPaginated={isPaginated}\r\n        isSearching={isSearching}\r\n        searchTypeComponent={filter}\r\n        toolbarItem={\r\n          logoutUser && (\r\n            <ToolbarItem>\r\n              <Button onClick={toggleLogoutDialog}>\r\n                {t(\"logoutAllSessions\")}\r\n              </Button>\r\n            </ToolbarItem>\r\n          )\r\n        }\r\n        columns={columns}\r\n        actionResolver={(rowData: IRowData) => {\r\n          if (\r\n            rowData.data.type === \"Offline\" ||\r\n            rowData.data.type === \"OFFLINE\"\r\n          ) {\r\n            return [\r\n              {\r\n                title: t(\"revoke\"),\r\n                onClick: () => onClickRevoke(rowData),\r\n              } as Action<UserSessionRepresentation>,\r\n            ];\r\n          }\r\n          return [\r\n            {\r\n              title: t(\"signOut\"),\r\n              onClick: () => onClickSignOut(rowData),\r\n            } as Action<UserSessionRepresentation>,\r\n          ];\r\n        }}\r\n        emptyState={\r\n          <ListEmptyState\r\n            hasIcon\r\n            icon={CubesIcon}\r\n            message={t(\"noSessions\")}\r\n            primaryActionText={t(\"refresh\")}\r\n            onPrimaryAction={refresh}\r\n            instructions={\r\n              emptyInstructions ? emptyInstructions : t(\"noSessionsDescription\")\r\n            }\r\n          />\r\n        }\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":["CubesIconConfig","CubesIcon","createIcon","isLightweightUser","userId","UsernameCell","row","realm","useRealm","t","useTranslation","jsxs","Link","toUser","Fragment","jsx","Tooltip","Label","InfoCircleIcon","ClientsCell","List","ListVariant","clientId","client","ListItem","toClient","SessionsTable","loader","hiddenColumns","emptyInstructions","logoutUser","filter","isSearching","isPaginated","keycloak","useEnvironment","adminClient","useAdminClient","whoAmI","useWhoAmI","navigate","useNavigate","addError","useAlerts","formatDate","useFormatDate","key","setKey","useState","refresh","value","isOnUserPage","useMatch","UserRoute","columns","useMemo","name","toggleLogoutDialog","LogoutConfirm","useConfirmDialog","toUsers","error","onClickRevoke","rowData","session","onClickSignOut","KeycloakDataTable","ToolbarItem","Button","ListEmptyState"],"mappings":"maAEO,MAAMA,GAAkB,CAC7B,KAAM,YACN,OAAQ,IACR,MAAO,IACP,QAAS,kmBACT,QAAS,EACT,QAAS,CACX,EAEaC,GAAYC,EAAWF,EAAe,ECXtCG,EAAqBC,GAChCA,GAAQ,WAAW,cAAc,ECkD7BC,GAAgBC,GAAmC,CACvD,KAAM,CAAE,MAAAC,CAAA,EAAUC,EAAA,EACZ,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACd,OACEC,EAACC,EAAA,CAAK,GAAIC,EAAO,CAAE,MAAAN,EAAO,GAAID,EAAI,OAAS,IAAK,UAAA,CAAY,EACzD,SAAA,CAAAA,EAAI,SACJA,EAAI,eACHK,EAAAG,EAAA,CACG,SAAA,CAAA,IACDC,EAACC,EAAA,CAAQ,QAASP,EAAE,sBAAsB,EACxC,SAAAM,EAACE,EAAA,CACC,cAAY,oCACZ,OAAOC,EAAA,EAAe,EACtB,UAAS,GAER,WAAE,eAAe,CAAA,CAAA,CACpB,CACF,CAAA,CAAA,CACF,CAAA,EAEJ,CAEJ,EAEMC,GAAeb,GAAmC,CACtD,KAAM,CAAE,MAAAC,CAAA,EAAUC,EAAA,EAClB,OACEO,EAACK,EAAA,CAAK,QAASC,EAAY,OACxB,SAAA,OAAO,QAAQf,EAAI,OAAQ,EAAE,IAAI,CAAC,CAACgB,EAAUC,CAAM,IAClDR,EAACS,EAAA,CACC,SAAAT,EAACH,EAAA,CAAK,GAAIa,EAAS,CAAE,MAAAlB,EAAO,SAAAe,EAAU,IAAK,UAAA,CAAY,EACpD,SAAAC,CAAA,CACH,GAHaD,CAIf,CACD,EACH,CAEJ,EAEA,SAAwBI,GAAc,CACpC,OAAAC,EACA,cAAAC,EAAgB,CAAA,EAChB,kBAAAC,EACA,WAAAC,EACA,OAAAC,EACA,YAAAC,EACA,YAAAC,CACF,EAAuB,CACrB,KAAM,CAAE,SAAAC,CAAA,EAAaC,EAAA,EACf,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,MAAA9B,CAAA,EAAUC,EAAA,EACZ,CAAE,OAAA8B,CAAA,EAAWC,EAAA,EACbC,EAAWC,EAAA,EACX,CAAE,EAAAhC,CAAA,EAAMC,EAAA,EACR,CAAE,SAAAgC,CAAA,EAAaC,EAAA,EACfC,EAAaC,GAAA,EACb,CAACC,EAAKC,CAAM,EAAIC,GAAS,CAAC,EAC1BC,EAAU,IAAMF,EAAQG,GAAUA,EAAQ,CAAC,EAC3CC,EAAe,CAAC,CAACC,EAASC,EAAU,IAAI,EAExCC,EAAUC,GAAQ,IACqC,CACzD,CACE,KAAM,WACN,WAAY,OACZ,aAAclD,EAAA,EAEhB,CACE,KAAM,OACN,WAAY,MAAA,EAEd,CACE,KAAM,QACN,WAAY,UACZ,aAAeC,GAAQsC,EAAW,IAAI,KAAKtC,EAAI,KAAM,CAAC,CAAA,EAExD,CACE,KAAM,aACN,WAAY,aACZ,aAAeA,GAAQsC,EAAW,IAAI,KAAKtC,EAAI,UAAW,CAAC,CAAA,EAE7D,CACE,KAAM,YACN,WAAY,WAAA,EAEd,CACE,KAAM,UACN,WAAY,UACZ,aAAca,EAAA,CAChB,EAGoB,OACpB,CAAC,CAAE,KAAAqC,CAAA,IAAW,CAAC5B,EAAc,SAAS4B,CAAkB,CAAA,EAEzD,CAACjD,EAAOqB,CAAa,CAAC,EAEnB,CAAC6B,EAAoBC,CAAa,EAAIC,GAAiB,CAC3D,SAAU,oBACV,WAAY,uBACZ,oBAAqB,UACrB,UAAW,SAAY,CACrB,GAAI,CACF,MAAMvB,EAAY,MAAM,OAAO,CAAE,GAAIN,EAAa,EAC9CqB,GAAgBhD,EAAkB2B,CAAU,EAC9CU,EAASoB,EAAQ,CAAE,MAAArD,CAAA,CAAc,CAAC,EAElC0C,EAAA,CAEJ,OAASY,EAAO,CACdnB,EAAS,yBAA0BmB,CAAK,CAC1C,CACF,CAAA,CACD,EAED,eAAeC,EAAcC,EAAmB,CAC9C,MAAMC,EAAUD,EAAQ,KACxB,MAAM3B,EAAY,OAAO,cAAc,CACrC,MAAA7B,EACA,QAASyD,EAAQ,GACjB,UAAW,EAAA,CACZ,EAEDf,EAAA,CACF,CAEA,eAAegB,EAAeF,EAAmB,CAC/C,MAAMC,EAAUD,EAAQ,KACxB,MAAM3B,EAAY,OAAO,cAAc,CACrC,MAAA7B,EACA,QAASyD,EAAQ,GACjB,UAAW,EAAA,CACZ,EAEGA,EAAQ,SAAW1B,EAAO,OAC5B,MAAMJ,EAAS,OAAO,CAAE,YAAa,GAAI,EAChCiB,GAAgBhD,EAAkB6D,EAAQ,MAAM,EACzDxB,EAASoB,EAAQ,CAAE,MAAArD,CAAA,CAAc,CAAC,EAElC0C,EAAA,CAEJ,CAEA,OACEtC,EAAAG,EAAA,CACE,SAAA,CAAAC,EAAC2C,EAAA,EAAc,EACf3C,EAACmD,EAAA,CAEC,OAAAvC,EACA,aAAa,gBACb,qBAAqB,mBACrB,YAAAM,EACA,YAAAD,EACA,oBAAqBD,EACrB,YACED,GACEf,EAACoD,EAAA,CACC,SAAApD,EAACqD,EAAA,CAAO,QAASX,EACd,SAAAhD,EAAE,mBAAmB,CAAA,CACxB,EACF,EAGJ,QAAA6C,EACA,eAAiBS,GAEbA,EAAQ,KAAK,OAAS,WACtBA,EAAQ,KAAK,OAAS,UAEf,CACL,CACE,MAAOtD,EAAE,QAAQ,EACjB,QAAS,IAAMqD,EAAcC,CAAO,CAAA,CACtC,EAGG,CACL,CACE,MAAOtD,EAAE,SAAS,EAClB,QAAS,IAAMwD,EAAeF,CAAO,CAAA,CACvC,EAGJ,WACEhD,EAACsD,EAAA,CACC,QAAO,GACP,KAAMpE,GACN,QAASQ,EAAE,YAAY,EACvB,kBAAmBA,EAAE,SAAS,EAC9B,gBAAiBwC,EACjB,aACEpB,GAAwCpB,EAAE,uBAAuB,CAAA,CAAA,CAErE,EA9CGqC,CAAA,CAgDP,EACF,CAEJ","x_google_ignoreList":[0]}