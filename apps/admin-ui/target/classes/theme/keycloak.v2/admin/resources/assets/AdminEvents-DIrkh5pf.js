import{jsx as e,jsxs as c,Fragment as ye}from"react/jsx-runtime";import{d as Q,L as Te,aL as _e,bc as be,cC as fe,aT as Ce,bT as ge,as as Ae,ca as Ee,cR as x,u as Re,a as X,e as ve,j as Oe,y as ke,bf as Ie,aQ as Fe,dA as Ne,bo as De,ay as m,aK as G,aR as Pe,aP as d,dB as Se,x as Le,aX as xe,v as Ge,l as we,aC as Me,aD as w,F as Ue,O as g,R as A,bp as M,bq as U,ak as B,Y as k,Z as E,Q as y,A as Be,g as H,M as He,k as Ve}from"./main-o1hptXRo.js";import{useState as u,useMemo as Ke}from"react";import{D as je}from"./DropdownPanel-vRJu3PnV.js";import{a as We}from"./CodeEditor-C4IS5oxi.js";import{u as Ze,F as ze}from"./useFormatDate-CuGjRZ4j.js";import{D as V}from"./DatePicker-DiXxo4Fo.js";import{p as Qe}from"./pickBy-JGveacY0.js";import{D as Xe,a as K,b as j,c as W}from"./DescriptionListTerm-CNzJUZBE.js";const Z=38,Je=({text:t,children:n})=>{const a=t||"",i=a.length>Z,T=a.substring(0,Z);return i?e(_e,{content:t,children:n(T+"â€¦")}):n(a)},qe=t=>t.operationType==="DELETE"?!1:t.resourceType==="USER"||t.resourceType==="GROUP_MEMBERSHIP"||t.resourceType==="GROUP"||t.resourceType==="CLIENT"||t.resourceType==="ORGANIZATION"||t.resourceType==="ORGANIZATION_MEMBERSHIP"||t.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||t.resourceType==="CLIENT_SCOPE"||t.resourceType==="AUTH_FLOW"||t.resourcePath?.startsWith("roles-by-id"),Ye=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),$e=(t,n)=>{const a=Ye.exec(n.resourcePath);if(!a)return console.warn("event didn't contain a valid link",n),"";const i=a[1];return n.resourceType==="CLIENT"||n.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?be({realm:t,clientId:i,tab:n.resourceType==="CLIENT"?"settings":"authorization"}):n.resourceType==="GROUP"?fe({realm:t,id:i}):n.resourceType==="CLIENT_SCOPE"?Ce({realm:t,id:i,tab:"settings"}):n.resourceType==="USER"||n.resourceType==="GROUP_MEMBERSHIP"?ge({realm:t,id:i,tab:"settings"}):n.resourceType==="AUTH_FLOW"?Ae({realm:t,id:i,usedBy:"-"}):n.resourcePath?.startsWith("roles-by-id")?Ee({realm:t,id:i,tab:"details"}):n.resourceType==="ORGANIZATION"?x({realm:t,id:i,tab:"settings"}):n.resourceType==="ORGANIZATION_MEMBERSHIP"?x({realm:t,id:i,tab:"members"}):""},ea=({event:t})=>{const{realm:n}=Q();return e(Je,{text:t.resourcePath,children:a=>qe(t)?e(Te,{to:$e(n,t),children:a}):e("span",{children:a})})},aa=t=>e(ea,{event:t}),z=({titleKey:t,onClose:n,children:a})=>{const{t:i}=X();return e(He,{variant:Ve.medium,title:i(t),isOpen:!0,onClose:n,children:a})},ra=t=>c(Xe,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[t.details&&Object.entries(t.details).map(([n,a])=>c(K,{children:[e(j,{children:n}),e(W,{children:a})]},n)),t.error&&c(K,{children:[e(j,{children:"error"}),e(W,{children:t.error})]},"error")]}),pa=({resourcePath:t})=>{const{adminClient:n}=Re(),{t:a}=X(),{realm:i}=Q(),T=ve(),J=Ze(),q=T.enums?.resourceType,Y=T.enums?.operationType,[R,I]=u(0),[$,F]=u(!1),[ee,ae]=u(!1),[re,te]=u(!1),[_,se]=u({}),N={resourceTypes:[],operationTypes:[],resourcePath:t||"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},[p,D]=u(),[ne,oe]=u(),[b,P]=u(),ie={resourceTypes:a("resourceTypes"),operationTypes:a("operationTypes"),resourcePath:a("resourcePath"),dateFrom:a("dateFrom"),dateTo:a("dateTo"),authClient:a("client"),authUser:a("userId"),authRealm:a("realm"),authIpAddress:a("ipAddress")},S=Oe({mode:"onChange",defaultValues:N}),{getValues:v,reset:O,formState:{isDirty:L},control:f}=S;ke(()=>n.realms.getConfigEvents({realm:i}),r=>{oe(r?.adminEventsEnabled)},[]);function le(r,s){return n.realms.findAdminEvents({resourcePath:t,..._,realm:i,first:r,max:s})}function ce(){F(!1),C()}function de(){O(),C()}function ue(r){const s={...v()};delete s[r],O({...N,...s}),C()}function pe(r,s){const o=v(),l=o[r],h=Array.isArray(l)?l.filter(me=>me!==s):l;O({...o,[r]:h}),C()}function C(){const r=Qe(v(),s=>s!==""||Array.isArray(s)&&s.length>0);t&&delete r.resourcePath,se(r),I(R+1)}const he=Ke(()=>b?.representation?Ie(JSON.parse(b.representation)):"",[b?.representation]);return c(ye,{children:[p&&e(z,{titleKey:"auth",onClose:()=>D(void 0),children:c(Fe,{"aria-label":"authData","data-testid":"auth-dialog",variant:Ne.compact,children:[e(De,{children:c(m,{children:[e(G,{children:a("attribute")}),e(G,{children:a("value")})]})}),c(Pe,{children:[c(m,{children:[e(d,{children:a("realm")}),e(d,{children:p.authDetails?.realmId})]}),c(m,{children:[e(d,{children:a("client")}),e(d,{children:p.authDetails?.clientId})]}),c(m,{children:[e(d,{children:a("user")}),e(d,{children:p.authDetails?.userId})]}),c(m,{children:[e(d,{children:a("ipAddress")}),e(d,{children:p.authDetails?.ipAddress})]})]})]})}),b&&e(z,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>P(void 0),children:e(We,{readOnly:!0,value:he,language:"json"})}),!ne&&e(Se,{type:"adminEvents"}),e(Le,{loader:le,detailColumns:[{name:"details",enabled:r=>r.details!==void 0,cellRenderer:ra}],isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:e(we,{...S,children:c(Me,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(w,{children:e(je,{buttonText:a("searchForAdminEvent"),setSearchDropdownOpen:F,searchDropdownOpen:$,marginRight:"2.5rem",width:"15vw",children:c(Ue,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e(g,{label:a("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e(A,{name:"resourceTypes",control:f,render:({field:r})=>e(M,{className:"keycloak__events_search__type_select","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:a("hide"),collapsedText:a("showRemaining")},variant:U.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>ae(s),selections:r.value,onSelect:s=>{const o=s.toString(),l=r.value.includes(o)?r.value.filter(h=>h!==o):[...r.value,o];r.onChange(l)},onClear:()=>{r.onChange([])},isOpen:ee,"aria-labelledby":"resourceTypes",chipGroupComponent:e(k,{children:r.value.map(s=>e(E,{onClick:o=>{o.stopPropagation(),r.onChange(r.value.filter(l=>l!==s))},children:s},s))}),children:q?.map(s=>e(B,{value:s,children:s},s))})})}),e(g,{label:a("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e(A,{name:"operationTypes",control:f,render:({field:r})=>e(M,{className:"keycloak__events_search__type_select","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:a("hide"),collapsedText:a("showRemaining")},variant:U.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>te(s),selections:r.value,onSelect:s=>{const o=s.toString(),l=r.value.includes(o)?r.value.filter(h=>h!==o):[...r.value,o];r.onChange(l)},onClear:()=>{r.onChange([])},isOpen:re,"aria-labelledby":"operationTypes",chipGroupComponent:e(k,{children:r.value.map(s=>e(E,{onClick:o=>{o.stopPropagation(),r.onChange(r.value.filter(l=>l!==s))},children:s},s))}),children:Y?.map(s=>e(B,{value:s,children:s},s))})})}),!t&&e(y,{name:"resourcePath",label:a("resourcePath")}),e(y,{name:"authRealm",label:a("realm")}),e(y,{name:"authClient",label:a("client")}),e(y,{name:"authUser",label:a("userId")}),e(y,{name:"authIpAddress",label:a("ipAddress")}),e(g,{label:a("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(A,{name:"dateFrom",control:f,render:({field:r})=>e(V,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,o)=>r.onChange(o),inputProps:{id:"kc-dateFrom"}})})}),e(g,{label:a("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(A,{name:"dateTo",control:f,render:({field:r})=>e(V,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,o)=>r.onChange(o),inputProps:{id:"kc-dateTo"}})})}),c(Be,{children:[e(H,{variant:"primary",onClick:ce,"data-testid":"search-events-btn",isDisabled:!L,children:a("searchAdminEventsBtn")}),e(H,{variant:"secondary",onClick:de,isDisabled:!L,children:a("resetBtn")})]})]})})}),e(w,{children:Object.entries(_).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(_).map(r=>{const[s,o]=r;return s==="resourcePath"&&t?null:e(k,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:ie[s],onClick:()=>ue(s),children:typeof o=="string"?e(E,{isReadOnly:!0,children:o}):o.map(l=>e(E,{onClick:()=>pe(s,l),children:l},l))},s)})})})]})}),actions:[{title:a("auth"),onRowClick:r=>D(r)},{title:a("representation"),onRowClick:r=>P(r)}],columns:[{name:"time",displayKey:"time",cellRenderer:r=>J(new Date(r.time),ze)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:aa},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[xe(10)]},{name:"",displayKey:"user",cellRenderer:r=>r.authDetails?.userId||""}],emptyState:e(Ge,{message:a("emptyAdminEvents"),instructions:a("emptyAdminEventsInstructions"),primaryActionText:a("refresh"),onPrimaryAction:()=>I(R+1)}),isSearching:Object.keys(_).length>0},R)]})};export{pa as A};
//# sourceMappingURL=AdminEvents-DIrkh5pf.js.map
