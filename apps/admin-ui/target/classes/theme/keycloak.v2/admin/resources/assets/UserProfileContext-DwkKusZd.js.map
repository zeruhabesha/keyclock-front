{"version":3,"file":"UserProfileContext-DwkKusZd.js","sources":["../../../../../../../src/realm-settings/user-profile/UserProfileContext.tsx"],"sourcesContent":["import type { UserProfileConfig } from \"@keycloak/keycloak-admin-client/lib/defs/userProfileMetadata\";\r\nimport {\r\n  createNamedContext,\r\n  useAlerts,\r\n  useFetch,\r\n  useRequiredContext,\r\n} from \"@keycloak/keycloak-ui-shared\";\r\nimport { AlertVariant } from \"@patternfly/react-core\";\r\nimport { PropsWithChildren, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useAdminClient } from \"../../admin-client\";\r\nimport { useRealm } from \"../../context/realm-context/RealmContext\";\r\n\r\ntype UserProfileProps = {\r\n  config: UserProfileConfig | null;\r\n  save: SaveCallback;\r\n  isSaving: boolean;\r\n};\r\n\r\nexport type SaveCallback = (\r\n  updatedConfig: UserProfileConfig,\r\n  options?: SaveOptions,\r\n) => Promise<boolean>;\r\n\r\nexport type SaveOptions = {\r\n  successMessageKey?: string;\r\n  errorMessageKey?: string;\r\n};\r\n\r\nexport const UserProfileContext = createNamedContext<\r\n  UserProfileProps | undefined\r\n>(\"UserProfileContext\", undefined);\r\n\r\nexport const UserProfileProvider = ({ children }: PropsWithChildren) => {\r\n  const { adminClient } = useAdminClient();\r\n\r\n  const { realm } = useRealm();\r\n  const { addAlert, addError } = useAlerts();\r\n  const { t } = useTranslation();\r\n  const [config, setConfig] = useState<UserProfileConfig | null>(null);\r\n  const [refreshCount, setRefreshCount] = useState(0);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  useFetch(\r\n    () => adminClient.users.getProfile({ realm }),\r\n    (config) => setConfig(config),\r\n    [refreshCount],\r\n  );\r\n\r\n  const save: SaveCallback = async (updatedConfig, options) => {\r\n    setIsSaving(true);\r\n\r\n    try {\r\n      await adminClient.users.updateProfile({\r\n        ...updatedConfig,\r\n        realm,\r\n      });\r\n\r\n      setIsSaving(false);\r\n      setRefreshCount(refreshCount + 1);\r\n      addAlert(\r\n        t(options?.successMessageKey ?? \"userProfileSuccess\"),\r\n        AlertVariant.success,\r\n      );\r\n\r\n      return true;\r\n    } catch (error) {\r\n      setIsSaving(false);\r\n      addError(options?.errorMessageKey ?? \"userProfileError\", error);\r\n\r\n      return false;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <UserProfileContext.Provider value={{ config, save, isSaving }}>\r\n      {children}\r\n    </UserProfileContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useUserProfile = () => useRequiredContext(UserProfileContext);\r\n"],"names":["UserProfileContext","createNamedContext","UserProfileProvider","children","adminClient","useAdminClient","realm","useRealm","addAlert","addError","useAlerts","t","useTranslation","config","setConfig","useState","refreshCount","setRefreshCount","isSaving","setIsSaving","useFetch","save","updatedConfig","options","AlertVariant","error","jsx","useUserProfile","useRequiredContext"],"mappings":"mKA6BO,MAAMA,EAAqBC,EAEhC,qBAAsB,MAAS,EAEpBC,EAAsB,CAAC,CAAE,SAAAC,KAAkC,CACtE,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAElB,CAAE,MAAAC,CAAA,EAAUC,EAAA,EACZ,CAAE,SAAAC,EAAU,SAAAC,CAAA,EAAaC,EAAA,EACzB,CAAE,EAAAC,CAAA,EAAMC,EAAA,EACR,CAACC,EAAQC,CAAS,EAAIC,EAAmC,IAAI,EAC7D,CAACC,EAAcC,CAAe,EAAIF,EAAS,CAAC,EAC5C,CAACG,EAAUC,CAAW,EAAIJ,EAAS,EAAK,EAE9CK,EACE,IAAMhB,EAAY,MAAM,WAAW,CAAE,MAAAE,EAAO,EAC3CO,GAAWC,EAAUD,CAAM,EAC5B,CAACG,CAAY,CAAA,EAGf,MAAMK,EAAqB,MAAOC,EAAeC,IAAY,CAC3DJ,EAAY,EAAI,EAEhB,GAAI,CACF,aAAMf,EAAY,MAAM,cAAc,CACpC,GAAGkB,EACH,MAAAhB,CAAA,CACD,EAEDa,EAAY,EAAK,EACjBF,EAAgBD,EAAe,CAAC,EAChCR,EACEG,EAAEY,GAAS,mBAAqB,oBAAoB,EACpDC,EAAa,OAAA,EAGR,EACT,OAASC,EAAO,CACd,OAAAN,EAAY,EAAK,EACjBV,EAASc,GAAS,iBAAmB,mBAAoBE,CAAK,EAEvD,EACT,CACF,EAEA,OACEC,EAAC1B,EAAmB,SAAnB,CAA4B,MAAO,CAAE,OAAAa,EAAQ,KAAAQ,EAAM,SAAAH,GACjD,SAAAf,EACH,CAEJ,EAEawB,EAAiB,IAAMC,EAAmB5B,CAAkB"}