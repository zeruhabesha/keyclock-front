{"version":3,"file":"MultiLineInput-OP0faqms.js","sources":["../../../../../../../src/components/multi-line-input/MultiLineInput.tsx"],"sourcesContent":["import {\r\n  Button,\r\n  ButtonVariant,\r\n  InputGroup,\r\n  InputGroupItem,\r\n  TextInput,\r\n  TextInputProps,\r\n} from \"@patternfly/react-core\";\r\nimport { MinusCircleIcon, PlusCircleIcon } from \"@patternfly/react-icons\";\r\nimport { Fragment, useEffect, useMemo } from \"react\";\r\nimport { useFormContext, useWatch } from \"react-hook-form\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nfunction stringToMultiline(value?: string): string[] {\r\n  return typeof value === \"string\" ? value.split(\"##\") : [value || \"\"];\r\n}\r\n\r\nfunction toStringValue(formValue: string[]): string {\r\n  return formValue.join(\"##\");\r\n}\r\n\r\nexport type MultiLineInputProps = Omit<TextInputProps, \"form\"> & {\r\n  name: string;\r\n  addButtonLabel?: string;\r\n  isDisabled?: boolean;\r\n  defaultValue?: string[];\r\n  stringify?: boolean;\r\n  isRequired?: boolean;\r\n};\r\n\r\nexport const MultiLineInput = ({\r\n  name,\r\n  addButtonLabel,\r\n  isDisabled = false,\r\n  defaultValue,\r\n  stringify = false,\r\n  isRequired = false,\r\n  id,\r\n  ...rest\r\n}: MultiLineInputProps) => {\r\n  const { t } = useTranslation();\r\n  const { register, setValue, control } = useFormContext();\r\n  const value = useWatch({\r\n    name,\r\n    control,\r\n    defaultValue: defaultValue || \"\",\r\n  });\r\n\r\n  const fields = useMemo<string[]>(() => {\r\n    let values = stringify\r\n      ? stringToMultiline(\r\n          Array.isArray(value) && value.length === 1 ? value[0] : value,\r\n        )\r\n      : Array.isArray(value)\r\n        ? value\r\n        : [value];\r\n\r\n    if (!Array.isArray(values) || values.length === 0) {\r\n      values = (stringify\r\n        ? stringToMultiline(defaultValue as string)\r\n        : defaultValue) || [\"\"];\r\n    }\r\n\r\n    return values;\r\n  }, [value]);\r\n\r\n  const remove = (index: number) => {\r\n    update([...fields.slice(0, index), ...fields.slice(index + 1)]);\r\n  };\r\n\r\n  const append = () => {\r\n    update([...fields, \"\"]);\r\n  };\r\n\r\n  const updateValue = (index: number, value: string) => {\r\n    update([...fields.slice(0, index), value, ...fields.slice(index + 1)]);\r\n  };\r\n\r\n  const update = (values: string[]) => {\r\n    const fieldValue = values.flatMap((field) => field);\r\n    setValue(name, stringify ? toStringValue(fieldValue) : fieldValue, {\r\n      shouldDirty: true,\r\n      shouldValidate: true,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    register(name, {\r\n      validate: (value) =>\r\n        isRequired && toStringValue(value || []).length === 0\r\n          ? t(\"required\")\r\n          : undefined,\r\n    });\r\n  }, [register]);\r\n\r\n  return (\r\n    <div id={id}>\r\n      {fields.map((value, index) => (\r\n        <Fragment key={index}>\r\n          <InputGroup>\r\n            <InputGroupItem isFill>\r\n              <TextInput\r\n                data-testid={name + index}\r\n                onChange={(_event, value) => updateValue(index, value)}\r\n                name={`${name}.${index}.value`}\r\n                value={value}\r\n                isDisabled={isDisabled}\r\n                {...rest}\r\n              />\r\n            </InputGroupItem>\r\n            <InputGroupItem>\r\n              <Button\r\n                data-testid={\"remove\" + index}\r\n                variant={ButtonVariant.link}\r\n                onClick={() => remove(index)}\r\n                tabIndex={-1}\r\n                aria-label={t(\"remove\")}\r\n                isDisabled={fields.length === 1 || isDisabled}\r\n              >\r\n                <MinusCircleIcon />\r\n              </Button>\r\n            </InputGroupItem>\r\n          </InputGroup>\r\n          {index === fields.length - 1 && (\r\n            <Button\r\n              variant={ButtonVariant.link}\r\n              onClick={append}\r\n              tabIndex={-1}\r\n              aria-label={t(\"add\")}\r\n              data-testid={`${name}-addValue`}\r\n              isDisabled={!value || isDisabled}\r\n            >\r\n              <PlusCircleIcon /> {t(addButtonLabel || \"add\")}\r\n            </Button>\r\n          )}\r\n        </Fragment>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n"],"names":["stringToMultiline","value","toStringValue","formValue","MultiLineInput","name","addButtonLabel","isDisabled","defaultValue","stringify","isRequired","id","rest","t","useTranslation","register","setValue","control","useFormContext","useWatch","fields","useMemo","values","remove","index","update","append","updateValue","fieldValue","field","useEffect","jsx","jsxs","Fragment","InputGroup","InputGroupItem","TextInput","_event","Button","ButtonVariant","MinusCircleIcon","PlusCircleIcon"],"mappings":"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"}