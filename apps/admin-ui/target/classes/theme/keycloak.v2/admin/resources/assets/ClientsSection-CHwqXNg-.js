import{jsxs as o,Fragment as K,jsx as e}from"react/jsx-runtime";import{aA as re,b_ as S,u as N,a as p,_ as $,d as C,b as J,B as V,o as Q,x as F,v as U,b$ as O,g as L,L as k,e as oe,M as le,k as ce,c as ee,C as de,y as me,be as te,T as M,bd as j,W as H,aS as ie,ap as ue,P as pe,bb as q,aX as A,bZ as ye,bF as W,bc as he,c0 as ge,aL as fe,aY as Ce,c1 as be,c2 as Te,c3 as De,c4 as Ae}from"./main-o1hptXRo.js";import{useState as P,useMemo as Ie}from"react";import{u as _}from"./ConfirmDialog-BkU7melV.js";import{u as ne,R as ae}from"./RoutableTabs-DyhWhd6v.js";import{V as Re}from"./ViewHeader-BDBsroi3.js";import{t as ke}from"./translationFormatter-DQJeO7lr.js";import{u as Pe,F as X}from"./useFormatDate-CuGjRZ4j.js";import{u as Le,m as Ke}from"./useLocaleSort-C-diWts5.js";import{D as ve,a as Y,b as Z,c as z,d as E}from"./DataListItemRow-B_0B-ko6.js";import{a as I,b as R}from"./Tabs-DSwQhKoJ.js";import{g as xe,i as we}from"./utils-C-TUnOch.js";import{W as Be}from"./warning-triangle-icon-Cc02WUGl.js";import"react-dom";import"./PageHandler-B1ed5nYb.js";import"./DynamicComponents-CnLlz98z.js";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./CodeEditor-C4IS5oxi.js";import"./useParams-CGVhlaFZ.js";import"./constants-BclHbWtx.js";const Se=()=>({className:re.modifiers.wrap}),Ee=({rootUrl:t,baseUrl:i},n)=>i?.startsWith("http")?i:t==="${authAdminUrl}"?S(t.replace(/\$\{(authAdminUrl)\}/,n.adminBaseUrl),i||""):t==="${authBaseUrl}"?S(t.replace(/\$\{(authBaseUrl)\}/,n.serverBaseUrl),i||""):t?.startsWith("http")?i?S(t,i):t:i,Me=()=>{const{adminClient:t}=N(),{t:i}=p(),{addAlert:n,addError:l}=$(),{realm:s}=C(),c=Pe(),y=J(),[d,a]=P(),h=async()=>{try{return await t.realms.getClientsInitialAccess({realm:s})}catch{return[]}},[g,b]=_({titleKey:"tokenDeleteConfirmTitle",messageKey:i("tokenDeleteConfirm",{id:d?.id}),continueButtonLabel:"delete",continueButtonVariant:V.danger,onConfirm:async()=>{try{await t.realms.delClientsInitialAccess({realm:s,id:d.id}),n(i("tokenDeleteSuccess"),Q.success),a(void 0)}catch(r){l("tokenDeleteError",r)}}});return o(K,{children:[e(b,{}),e(F,{ariaLabelKey:"initialAccessToken",searchPlaceholderKey:"searchInitialAccessToken",loader:h,toolbarItem:e(L,{component:r=>e(k,{...r,to:O({realm:s})}),children:i("create")}),actions:[{title:i("delete"),onRowClick:r=>{a(r),g()}}],columns:[{name:"id",displayKey:"id"},{name:"timestamp",displayKey:"timestamp",cellRenderer:r=>c(new Date(r.timestamp*1e3),X)},{name:"expiration",displayKey:"expires",cellRenderer:r=>c(new Date(r.timestamp*1e3+r.expiration*1e3),X)},{name:"count",displayKey:"count"},{name:"remainingCount",displayKey:"remainingCount",transforms:[Se]}],emptyState:e(U,{message:i("noTokens"),instructions:i("noTokensInstructions"),primaryActionText:i("create"),onPrimaryAction:()=>y(O({realm:s}))})},d?.id)]})},Ne=({onConfirm:t,toggleDialog:i})=>{const{t:n}=p(),l=oe(),s=Object.keys(l.providers?.["client-registration-policy"].providers||[]),c=l.componentTypes?.["org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"],y=Le(),d=Ie(()=>y(c?.filter(a=>s.includes(a.id))||[],Ke("id")),[s,c]);return e(le,{variant:ce.medium,title:n("chooseAPolicyProvider"),isOpen:!0,onClose:i,children:o(ve,{onSelectDataListItem:(a,h)=>{t(h),i()},"aria-label":n("addPredefinedMappers"),isCompact:!0,children:[e(Y,{"aria-label":n("headerName"),id:"header",children:e(Z,{children:e(z,{dataListCells:[n("name"),n("description")].map(a=>e(E,{style:{fontWeight:700},children:a},a))})})}),d.map(a=>e(Y,{"aria-label":a.id,"data-testid":a.id,id:a.id,children:e(Z,{children:e(z,{dataListCells:[e(E,{width:2,children:a.id},`name-${a.id}`),e(E,{width:4,children:a.helpText},`description-${a.id}`)]})})},a.id))]})})},$e=t=>{const{realm:i}=C(),{subTab:n}=ee();return e(k,{to:te({realm:i,subTab:n||"anonymous",providerId:t.providerId,id:t.id}),children:t.name},t.id)},G=({subType:t})=>{const{adminClient:i}=N(),{t:n}=p(),{subTab:l}=ee(),s=J(),{addAlert:c,addError:y}=$(),{realm:d}=C(),[a,h]=P([]),[g,b]=P(),[r,f]=de();me(()=>i.components.find({type:"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"}),m=>h(m.filter(w=>w.subType===t)),[g]);const[v,x]=_({titleKey:"clientRegisterPolicyDeleteConfirmTitle",messageKey:n("clientRegisterPolicyDeleteConfirm",{name:g?.name}),continueButtonLabel:"delete",continueButtonVariant:V.danger,onConfirm:async()=>{try{await i.components.del({realm:d,id:g?.id}),c(n("clientRegisterPolicyDeleteSuccess")),b(void 0)}catch(m){y("clientRegisterPolicyDeleteError",m)}}});return o(K,{children:[r&&e(Ne,{onConfirm:m=>s(te({realm:d,subTab:l||"anonymous",providerId:m})),toggleDialog:f}),e(x,{}),e(F,{ariaLabelKey:"clientRegistration",searchPlaceholderKey:n("searchClientRegistration"),"data-testid":`clientRegistration-${t}`,loader:a,toolbarItem:e(M,{children:e(L,{"data-testid":`createPolicy-${t}`,onClick:f,children:n("createPolicy")})}),actions:[{title:n("delete"),onRowClick:m=>{b(m),v()}}],columns:[{name:"name",displayKey:"name",cellRenderer:$e},{name:"providerId",displayKey:"providerId"}],emptyState:e(U,{message:n("noAccessPolicies"),instructions:n("noAccessPoliciesInstructions"),primaryActionText:n("createPolicy"),onPrimaryAction:f})})]})},Ve=()=>{const{t}=p(),{realm:i}=C(),n=c=>ne(j({realm:i,subTab:c})),l=n("anonymous"),s=n("authenticated");return o(ae,{defaultLocation:j({realm:i,subTab:"anonymous"}),mountOnEnter:!0,unmountOnExit:!0,children:[e(I,{"data-testid":"anonymous",title:o(R,{children:[t("anonymousAccessPolicies")," ",e(H,{fieldLabelId:"",helpText:t("anonymousAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...l,children:e(G,{subType:"anonymous"})}),e(I,{"data-testid":"authenticated",title:o(R,{children:[t("authenticatedAccessPolicies")," ",e(H,{fieldLabelId:"",helpText:t("authenticatedAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...s,children:e(G,{subType:"authenticated"})})]})},Fe=t=>{const{t:i}=p(),{realm:n}=C();return o(W,{wrapModifier:"truncate",children:[o(k,{to:he({realm:n,clientId:t.id,tab:"settings"}),children:[t.clientId,!t.enabled&&e(ge,{isRead:!0,className:"pf-v5-u-ml-sm",children:i("disabled")},`${t.id}-disabled`)]},t.id),t.attributes?.is_temporary_admin==="true"&&e(fe,{content:i("temporaryService"),children:e(Be,{className:"pf-v5-u-ml-sm",id:"temporary-admin-label"})})]})},We=t=>{const{t:i}=p();return e(W,{wrapModifier:"truncate",children:ke(i)(t.name)})},_e=t=>e(W,{wrapModifier:"truncate",children:Ce()(t.description)}),Oe=t=>{const{environment:i}=be(),n=Ee(t,i);return n?e(Te,{href:n,"data-testid":`client-home-url-${t.clientId}`}):"â€”"},je=()=>{const{t}=p(),{realm:i}=C(),{hasAccess:n}=ie();return n("manage-clients")?o(K,{children:[e(M,{children:e(L,{"data-testid":"createClient",component:s=>e(k,{...s,to:De({realm:i})}),children:t("createClient")})}),e(M,{children:e(L,{component:s=>e(k,{...s,to:Ae({realm:i})}),variant:"link","data-testid":"importClient",children:t("importClient")})})]}):e("span",{})};function ht(){const{adminClient:t}=N(),{t:i}=p(),{addAlert:n,addError:l}=$(),{realm:s}=C(),[c,y]=P(0),d=()=>y(new Date().getTime()),[a,h]=P(),{hasAccess:g}=ie(),b=g("manage-clients"),r=async(u,T,D)=>{const B={first:u,max:T};return D&&(B.clientId=D,B.search=!0),t.clients.find({...B})},f=u=>ne(q({realm:s,tab:u})),v=f("list"),x=f("initial-access-token"),m=f("client-registration"),[w,se]=_({titleKey:i("clientDelete",{clientId:a?.clientId}),messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:V.danger,onConfirm:async()=>{try{await t.clients.del({id:a.id}),n(i("clientDeletedSuccess"),Q.success),d()}catch(u){l("clientDeleteError",u)}}});return o(K,{children:[e(Re,{titleKey:"clientList",subKey:"clientsExplain",helpUrl:ue.clientsUrl,divider:!1}),e(pe,{variant:"light",className:"pf-v5-u-p-0",children:o(ae,{mountOnEnter:!0,unmountOnExit:!0,isBox:!0,defaultLocation:q({realm:s,tab:"list"}),children:[o(I,{"data-testid":"list",title:e(R,{children:i("clientsList")}),...v,children:[e(se,{}),e(F,{loader:r,isPaginated:!0,ariaLabelKey:"clientList",searchPlaceholderKey:"searchForClient",toolbarItem:e(je,{}),actionResolver:u=>{const T=u.data,D=[{title:i("export"),onClick(){ye(T)}}];return!we(T)&&(b||T.access?.configure)&&D.push({title:i("delete"),onClick(){h(T),w()}}),D},columns:[{name:"clientId",displayKey:"clientId",transforms:[A(20)],cellRenderer:Fe},{name:"clientName",displayKey:"clientName",transforms:[A(20)],cellRenderer:We},{name:"protocol",displayKey:"type",transforms:[A(10)],cellRenderer:u=>xe(i,u.protocol??"openid-connect")},{name:"description",displayKey:"description",transforms:[A(30)],cellRenderer:_e},{name:"baseUrl",displayKey:"homeURL",transforms:[A(20)],cellRenderer:Oe}]},c)]}),e(I,{"data-testid":"initialAccessToken",title:e(R,{children:i("initialAccessToken")}),...x,children:e(Me,{})}),e(I,{"data-testid":"registration",title:e(R,{children:i("clientRegistration")}),...m,children:e(Ve,{})})]})})]})}export{ht as default};
//# sourceMappingURL=ClientsSection-CHwqXNg-.js.map
