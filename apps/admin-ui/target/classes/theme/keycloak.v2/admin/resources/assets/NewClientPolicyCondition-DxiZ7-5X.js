import{jsxs as f,Fragment as z,jsx as n}from"react/jsx-runtime";import{u as K,a as W,_ as $,b as J,d as M,c as Q,e as U,j as X,y as Y,P as Z,O as ii,R as oi,bp as ei,bq as ni,ak as ti,W as si,l as ai,A as ri,g,eo as P,L as ci,o as di}from"./main-o1hptXRo.js";import{useState as r}from"react";import{D as li}from"./DynamicComponents-CnLlz98z.js";import{F as pi}from"./FormAccess-BnhQnYb9.js";import{V as mi}from"./ViewHeader-BDBsroi3.js";import{c as I}from"./camelCase-B6BCqzQB.js";import"react-dom";import"./ClientSelect-BY77LEpN.js";import"./IdentityProviderSelect-rmWlUbIg.js";import"./GroupPickerDialog-U3luvxlw.js";import"./DataListItemRow-B_0B-ko6.js";import"./ActionListItem-Cy-NQlq4.js";import"./MultiLineInput-OP0faqms.js";import"./RoleMapping-BOcI-Nkp.js";import"./translationFormatter-DQJeO7lr.js";import"./ConfirmDialog-BkU7melV.js";import"./useLocaleSort-C-diWts5.js";import"./CodeEditor-C4IS5oxi.js";import"./capitalize-_YB1UYl_.js";import"./_baseSlice-F8doVSIJ.js";function Vi(){const{adminClient:v}=K(),{t:e}=W(),{addAlert:x,addError:D}=$(),b=J(),{realm:C}=M(),[F,h]=r(!1),[d,N]=r(!1),[w,T]=r([]),[G,O]=r([]),[V,H]=r(),[p,j]=r(""),[k,S]=r([]),{policyName:c,conditionName:t}=Q(),B=U(),m=X(),A=B.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],E=s=>{m.reset({config:s.configuration||{}})};Y(()=>v.clientPolicies.listPolicies({includeGlobalPolicies:!0}),s=>{if(T(s.policies??[]),t){let i=s.policies?.find(o=>o.name===c);i===void 0&&(i=s.globalPolicies?.find(o=>o.name===c),N(i!==void 0));const l=i?.conditions?.find(o=>o.condition===t),u=A?.find(o=>o.id===t);H(l),S(u?.properties),E(l)}},[]);const L=async s=>{const i=s.config,l=()=>k.reduce((o,a)=>(o[a.name]=i[a.name],o),{}),u=w.map(o=>{if(o.name!==c)return o;let a=o.conditions??[];if(t){const R={condition:V?.condition,configuration:l()},y=a.findIndex(_=>t===_.condition);if(y===-1)return;const q=[...a.slice(0,y),R,...a.slice(y+1)];return{...o,conditions:q}}return a=a.concat({condition:G[0].condition,configuration:l()}),{...o,conditions:a}});try{await v.clientPolicies.updatePolicy({policies:u}),T(u),b(P({realm:C,policyName:c})),x(e(t?"updateClientConditionSuccess":"createClientConditionSuccess"),di.success)}catch(o){D("createClientConditionError",o)}};return f(z,{children:[n(mi,{titleKey:e(t?d?"viewCondition":"editCondition":"addCondition"),divider:!0}),f(Z,{variant:"light",children:[f(pi,{isHorizontal:!0,role:"manage-realm",isReadOnly:d,className:"pf-v5-u-mt-lg",onSubmit:m.handleSubmit(L),children:[n(ii,{label:e("conditionType"),fieldId:"conditionType",labelIcon:n(si,{helpText:p?`${I(p.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:n(oi,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:s})=>n(ei,{placeholderText:e("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!t,onToggle:i=>h(i),onSelect:i=>{s.onChange(i),S(i.properties),j(i.id),O([{condition:i.id}]),h(!1)},selections:t||p,variant:ni.single,"aria-label":e("conditionType"),isOpen:F,children:A?.map(i=>n(ti,{"data-testid":i.id,selected:i.id===s.value,description:e(I(i.id.replace(/-/g," "))),value:i,children:i.id},i.id))})})}),n(ai,{...m,children:n(li,{properties:k})}),!d&&f(ri,{children:[n(g,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:p===""&&!t&&d,children:e(t?"save":"add")}),n(g,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>b(P({realm:C,policyName:c})),children:e("cancel")})]})]}),d&&n("div",{className:"kc-backToProfile",children:n(g,{component:s=>n(ci,{...s,to:P({realm:C,policyName:c})}),variant:"primary",children:e("back")})})]})]})}export{Vi as default};
//# sourceMappingURL=NewClientPolicyCondition-DxiZ7-5X.js.map
