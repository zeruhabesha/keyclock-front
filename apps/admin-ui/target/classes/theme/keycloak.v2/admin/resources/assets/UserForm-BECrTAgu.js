import{jsx as a,jsxs as d,Fragment as L}from"react/jsx-runtime";import{u as C,aS as R,d as oe,y as j,g as S,L as le,eZ as ce,bC as x,ej as de,eh as ue,c9 as me,a as M,U as pe,bq as be,_ as fe,cX as he,b as Ae,l as ge,O as f,bw as U,bx as g,a3 as E,W as v,aW as ye,o as w,f1 as ke,f2 as Ie,Q as y,eB as Le,$ as ve,S as we,R as Ce,Y as qe,Z as Oe,a7 as Ve,dP as Fe}from"./main-o1hptXRo.js";import{useState as h,useEffect as Ge}from"react";import{D as Te}from"./SwitchControl-CU1bUhmR.js";import{F as xe,b as Ue}from"./FormAccess-BnhQnYb9.js";import{G as Ee}from"./GroupPickerDialog-U3luvxlw.js";import{u as Pe}from"./useFormatDate-CuGjRZ4j.js";import{C as Re}from"./CopyToClipboardButton-Cl576S4v.js";const je=({user:r})=>{const{adminClient:s}=C(),e=R(),{realm:o}=oe(),[n,l]=h();return j(()=>e.hasAccess("view-realm")?s.components.findOne({id:r.federationLink}):s.userStorageProvider.name({id:r.federationLink}),l,[]),n?e.hasAccess("view-realm")?a(S,{variant:"link",component:m=>a(le,{...m,to:ce({id:n.id,providerId:n.providerId,realm:o})}),children:n.name}):a("span",{children:n.name}):null};function P(r){const s={};Object.entries(r.attributes||{}).forEach(([o,n])=>s[ue(o)]=n);const e=me(r.unmanagedAttributes);return{...r,attributes:s,unmanagedAttributes:e}}function Ke(r){const s=r.username?.trim(),e=Array.isArray(r.attributes)?x(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([n,l])=>[de(n),l])),o=Array.isArray(r.unmanagedAttributes)?x(r.unmanagedAttributes):r.unmanagedAttributes;for(const n in o)if(e&&Object.hasOwn(e,n))throw Error(`Attribute ${n} is a managed attribute and is already available from the user details.`);return{...r,username:s,attributes:{...o,...e},unmanagedAttributes:void 0}}function Qe(r={},s={}){return Object.fromEntries(Object.entries(r).filter(([e])=>!Object.hasOwn(s,e)))}const Se=({name:r,label:s,help:e})=>{const{adminClient:o}=C(),{t:n}=M(),[l,m]=h([]);return j(()=>o.authenticationManagement.getRequiredActions(),c=>{const p=c.filter(A=>A.enabled);m(p)},[]),a(pe,{name:r,label:n(s),labelIcon:n(e),controller:{defaultValue:[]},isScrollable:!0,maxMenuHeight:"375px",variant:be.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:n("requiredActionPlaceholder"),menuAppendTo:"parent",options:l.map(({alias:c,name:p})=>({key:c,value:p||c}))})},Ye=({form:r,realm:s,user:e,bruteForce:{isBruteForceProtected:o,isLocked:n}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:l,save:m,refresh:c,onGroupsUpdate:p})=>{const{adminClient:A}=C(),{t}=M(),D=Pe(),{addAlert:q,addError:k}=fe(),{hasAccess:O}=R(),N=O("manage-users"),H=O("view-realm"),{whoAmI:B}=he(),{handleSubmit:_,setValue:V,control:W,reset:$,formState:K}=r,{errors:Q}=K,[b,F]=h([]),[G,I]=h(!1),[T,Y]=h(n),Z=Ae();Ge(()=>{V("requiredActions",e?.requiredActions||[])},[e,V]);const z=async()=>{try{await A.users.update({id:e.id},{enabled:!0}),q(t("unlockSuccess"),w.success),c&&c()}catch(i){k("unlockError",i)}},J=i=>{F(b.filter(u=>u.name!==i)),p?.(b)},X=async i=>{F([...b,...i]),p?.([...b,...i])},ee=async i=>{i.forEach(async ne=>{try{await A.users.addToGroup({id:e.id,groupId:ne.id}),q(t("addedGroupMembership"),w.success)}catch(se){k("addedGroupMembershipError",se)}})},te=()=>{I(!G)},ae=()=>{e?.id?$(P(e)):Z(Fe({realm:s.realm}))},ie=()=>e?.userProfileMetadata?.attributes&&!e?.userProfileMetadata?.attributes?.map(i=>i.readOnly).reduce((i,u)=>i&&u,!0),re=async()=>{try{m(P({...e,requiredActions:e?.requiredActions?.filter(i=>i!=="UPDATE_EMAIL"),attributes:{...e?.attributes,"kc.email.pending":""}})),c&&c()}catch(i){k("emailPendingVerificationUpdateError",i)}};return d(xe,{isHorizontal:!0,onSubmit:_(m),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-v5-u-mt-lg",children:[d(ge,{...r,children:[G&&a(Ee,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:N,onConfirm:async i=>{e?.id?await ee(i||[]):await X(i||[]),I(!1)},onClose:()=>I(!1),filterGroups:b}),e?.id&&d(L,{children:[a(f,{label:t("id"),fieldId:"kc-id",isRequired:!0,children:d(U,{children:[a(g,{isFill:!0,children:a(E,{id:e.id,"aria-label":t("userID"),value:e.id,readOnly:!0})}),a(g,{children:a(Re,{id:`user-${e.id}`,text:e.id,label:t("userID"),variant:"control"})})]})}),a(f,{label:t("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:a(E,{value:D(new Date(e.createdTimestamp)),id:"kc-created-at",readOnly:!0})})]}),a(Se,{name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),e?.federationLink&&H&&a(f,{label:t("federationLink"),labelIcon:a(v,{helpText:t("federationLinkHelp"),fieldLabelId:"federationLink"}),children:a(je,{user:e})}),l?d(L,{children:[a(Te,{name:"emailVerified",label:t("emailVerified"),labelIcon:t("emailVerifiedHelp")}),e?.attributes?.["kc.email.pending"]&&d(ye,{variant:w.warning,isInline:!0,isPlain:!0,title:t("emailPendingVerificationAlertTitle"),children:[t("userNotYetConfirmedNewEmail",{email:e.attributes["kc.email.pending"]}),a(ke,{buttonTitle:t("emailPendingVerificationResetAction"),modalTitle:t("confirmEmailPendingVerificationAction"),continueLabel:t("confirm"),cancelLabel:t("cancel"),buttonVariant:"link",onContinue:re,children:t("emailPendingVerificationActionMessage")})]}),a(Ie,{form:r,userProfileMetadata:{...l,attributes:l.attributes?.filter(i=>i.name!=="kc.email.pending")},hideReadOnly:!e,supportedLocales:s.supportedLocales||[],currentLocale:B.locale,t:((i,u)=>t(i,u))})]}):d(L,{children:[!s.registrationEmailAsUsername&&a(y,{name:"username",label:t("username"),readOnly:!!e?.id&&!s.editUsernameAllowed&&s.editUsernameAllowed!==void 0,rules:{required:t("required")}}),a(y,{name:"email",label:t("email"),type:"email",rules:{pattern:{value:Le,message:t("emailInvalid")}}}),a(ve,{name:"emailVerified",label:t("emailVerified"),labelIcon:t("emailVerifiedHelp"),labelOn:t("yes"),labelOff:t("no")}),a(y,{name:"firstName",label:t("firstName")}),a(y,{name:"lastName",label:t("lastName")})]}),o&&a(f,{label:t("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:a(v,{helpText:t("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:a(we,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:async(i,u)=>{await z(),Y(u)},isChecked:T,isDisabled:!T,label:t("on"),labelOff:t("off")})}),!e?.id&&d(f,{label:t("groups"),fieldId:"kc-groups",labelIcon:a(v,{helpText:t("groupsHelp"),fieldLabelId:"groups"}),children:[a(Ce,{name:"groups",defaultValue:[],control:W,render:()=>d(U,{children:[a(g,{children:a(qe,{categoryName:" ",children:b.map(i=>a(Oe,{onClick:()=>J(i.name),children:i.path},i.id))})}),a(g,{children:a(S,{id:"kc-join-groups-button",onClick:te,variant:"secondary","data-testid":"join-groups-button",children:t("joinGroups")})})]})}),Q.requiredActions&&a(Ve,{message:t("required")})]})]}),a(Ue,{name:"user-creation",saveText:e?.id?t("save"):t("create"),reset:ae,resetText:e?.id?t("revert"):t("cancel"),isDisabled:ie(),isSubmit:!0})]})};export{je as F,Se as R,Ye as U,P as a,Qe as f,Ke as t};
//# sourceMappingURL=UserForm-BECrTAgu.js.map
