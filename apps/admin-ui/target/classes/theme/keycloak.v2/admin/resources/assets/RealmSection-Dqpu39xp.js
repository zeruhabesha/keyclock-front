import{jsx as e,jsxs as b,Fragment as S}from"react/jsx-runtime";import{u as A,a as w,b as x,cX as E,_ as N,j as B,M as W,l as _,Q as q,au as H,g as I,m as J,n as Q,eU as K,d as X,o as $,P as z,x as G,aX as O,L as T,cg as V,E as Y,c0 as Z,T as F,bm as ee,eV as ae,eW as te,aM as P,aN as L,D as M,al as U,a_ as re}from"./main-o1hptXRo.js";import{useState as d}from"react";import{u as le}from"./ConfirmDialog-BkU7melV.js";import{V as ne}from"./ViewHeader-BDBsroi3.js";import{t as oe}from"./translationFormatter-DQJeO7lr.js";import{F as se}from"./FormAccess-BnhQnYb9.js";import{J as ie}from"./JsonFileUpload-CXVaTh71.js";import{D as ce}from"./SwitchControl-CU1bUhmR.js";import"react-dom";import"./FileUploadForm-3WTCaGLI.js";import"./CodeEditor-C4IS5oxi.js";function me({onClose:t}){const{adminClient:i}=A(),{t:r}=w(),n=x(),{refresh:l,whoAmI:o}=E(),{addAlert:C,addError:c}=N(),[u,v]=d(),h=B({mode:"onChange"}),{handleSubmit:f,setValue:y,formState:g}=h,D=m=>{const a={id:"",realm:"",enabled:!0};J(m||a,y),v(m||a)},p=async m=>{try{await i.realms.create({...u,...Q(m)}),C(r("saveRealmSuccess")),l(),t(),n(K({realm:m.realm}))}catch(a){c("saveRealmError",a)}};return e(W,{variant:"medium",title:r("createRealm"),description:r("realmExplain"),onClose:t,isOpen:!0,actions:[e(H,{form:"realm-form","data-testid":"create",formState:g,allowInvalid:!0,allowNonDirty:!0,children:r("create")},"confirm"),e(I,{variant:"link",onClick:t,"data-testid":"cancel",children:r("cancel")},"cancel")],children:e(_,{...h,children:b(se,{id:"realm-form",isHorizontal:!0,onSubmit:f(p),role:"view-realm",isReadOnly:!o.createRealm,children:[e(ie,{id:"kc-realm-filename",allowEditingUploadedText:!0,onChange:D}),e(q,{name:"realm",label:r("realmNameField"),rules:{required:r("required")}}),e(ce,{name:"enabled",label:r("enabled"),defaultValue:!0})]})})})}const de=()=>{const{t}=w(),[i,r]=d(!1),n=te();return n.length<3?null:e(P,{shouldFocusToggleOnSelect:!0,onOpenChange:l=>r(l),toggle:l=>e(U,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:l,onClick:()=>r(!i),children:t("recentRealms")}),isOpen:i,children:e(L,{children:n.map(({name:l})=>e(M,{component:o=>e(T,{...o,to:V({realm:l})}),children:l},"server info"))})})},ue=({onClick:t,isDisabled:i})=>{const{t:r}=w(),[n,l]=d(!1);return e(P,{shouldFocusToggleOnSelect:!0,onOpenChange:o=>l(o),toggle:o=>e(U,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:o,onClick:()=>l(!n),variant:"plain",isDisabled:i,children:e(re,{})}),isOpen:n,children:e(L,{children:e(M,{"data-testid":"delete",onClick:()=>{l(!1),t()},children:r("delete")})})})};function Fe(){const{t}=w(),i=x(),{whoAmI:r}=E(),{realm:n}=X(),{adminClient:l}=A(),{addAlert:o,addError:C}=N(),[c,u]=d([]),[v,h]=d(!1),[f,y]=d(0),g=()=>y(f+1),D=async(a,s,j)=>{try{return(await ee(l,"ui-ext/realms/names",{first:`${a}`,max:`${s}`,search:j||""})).map(k=>({...k,id:k.name}))}catch(R){if(R instanceof ae&&R.response.status<500)return[];throw R}},[p,m]=le({titleKey:t("deleteConfirmRealm",{count:c.length,name:c[0]?.name}),messageKey:"deleteConfirmRealmSetting",continueButtonLabel:"delete",onConfirm:async()=>{try{c.filter(({name:s})=>s==="master").length>0&&o(t("cantDeleteMasterRealm"),$.warning);const a=c.filter(({name:s})=>s!=="master");if(a.length===0)return;await Promise.all(a.map(({name:s})=>l.realms.del({realm:s}))),o(t("deletedSuccessRealmSetting")),c.filter(({name:s})=>s===n).length>0&&i(K({realm:"master"})),g(),u([])}catch(a){C("deleteError",a)}}});return b(S,{children:[e(m,{}),v&&e(me,{onClose:()=>{h(!1),g()}}),e(ne,{titleKey:"manageRealms",divider:!1}),e(z,{variant:"light",className:"pf-v5-u-p-0",children:e(G,{loader:D,isPaginated:!0,onSelect:u,canSelectAll:!0,ariaLabelKey:"selectRealm",searchPlaceholderKey:"search",actions:[{title:t("delete"),onRowClick:a=>{u([a]),p()}}],toolbarItem:b(S,{children:[e(F,{children:r.createRealm&&e(I,{onClick:()=>h(!0),"data-testid":"add-realm",children:t("createRealm")})}),e(F,{children:e(de,{})}),e(F,{children:e(ue,{onClick:p,isDisabled:c.length===0})})]}),columns:[{name:"name",transforms:[O(20)],cellRenderer:({name:a})=>a!==n?e(T,{to:V({realm:a}),children:a}):e(Y,{bodyContent:t("currentRealmExplain"),triggerAction:"hover",children:b(S,{children:[a," ",e(Z,{isRead:!0,children:t("currentRealm")})]})})},{name:"displayName",transforms:[O(80)],cellFormatters:[oe(t)]}]},f)})]})}export{Fe as default};
//# sourceMappingURL=RealmSection-Dqpu39xp.js.map
