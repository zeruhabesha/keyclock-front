import{jsxs as g,jsx as e,Fragment as L}from"react/jsx-runtime";import{u as U,a as S,d as w,_ as F,N,l as D,Q as c,O as d,R as b,S as f,W as p,U as T,g as V,bp as x,bq as E,ak as P,cU as z,o as _,h as K,a0 as j,b as $,an as B,bk as M,ao as G,F as W,eL as Y}from"./main-o1hptXRo.js";import{F as k,b as Q}from"./FormAccess-BnhQnYb9.js";import{W as C,S as J}from"./SettingsCache-Cam5Obyz.js";import{useState as q,useEffect as X}from"react";import{i as Z}from"./isEqual-B7qkGgF1.js";const ee=["connectionUrl","bindDn","bindCredential","useTruststoreSpi","connectionTimeout","startTls","authType"],R=t=>{const l={};return ee.forEach(r=>{const a=K(t.getValues(),`config.${r}`);l[r]=Array.isArray(a)?a[0]:""}),l},ae=({form:t,id:l,showSectionHeading:r=!1,showSectionDescription:a=!1})=>{const{adminClient:o}=U(),{t:n}=S(),{realm:i}=w(),{addAlert:u,addError:h}=F(),A=!!l,s=async y=>{try{const I=R(t);await o.realms.testLDAPConnection({realm:i},{...I,action:y,componentId:l}),u(n("testSuccess"),_.success)}catch(I){h("testError",I)}},[m,v]=q(!1),H=N({control:t.control,name:"config.authType",defaultValue:["simple"]});return g(D,{...t,children:[r&&e(C,{title:n("connectionAndAuthenticationSettings"),description:n("ldapConnectionAndAuthorizationSettingsDescription"),showDescription:a}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e(c,{name:"config.connectionUrl.0",label:n("connectionURL"),labelIcon:n("consoleDisplayConnectionUrlHelp"),type:"url",rules:{required:n("validateConnectionUrl")}}),e(d,{label:n("enableStartTls"),labelIcon:e(p,{helpText:n("enableStartTlsHelp"),fieldLabelId:"enableStartTls"}),fieldId:"kc-enable-start-tls",hasNoPaddingTop:!0,children:e(b,{name:"config.startTls",defaultValue:["false"],control:t.control,render:({field:y})=>e(f,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",isDisabled:!1,onChange:(I,O)=>y.onChange([`${O}`]),isChecked:y.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("enableStartTls")})})}),e(T,{id:"useTruststoreSpi",name:"config.useTruststoreSpi[0]",label:n("useTruststoreSpi"),labelIcon:n("useTruststoreSpiHelp"),controller:{defaultValue:"always"},options:[{key:"always",value:n("always")},{key:"never",value:n("never")}]}),e(d,{label:n("connectionPooling"),labelIcon:e(p,{helpText:n("connectionPoolingHelp"),fieldLabelId:"connectionPooling"}),fieldId:"kc-connection-pooling",hasNoPaddingTop:!0,children:e(b,{name:"config.connectionPooling",defaultValue:["true"],control:t.control,render:({field:y})=>e(f,{id:"kc-connection-pooling","data-testid":"connection-pooling",isDisabled:!1,onChange:(I,O)=>y.onChange([`${O}`]),isChecked:y.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("connectionPooling")})})}),e(c,{name:"config.connectionTimeout.0",label:n("connectionTimeout"),labelIcon:n("connectionTimeoutHelp"),type:"number",min:0}),e(d,{fieldId:"kc-test-connection-button",children:e(V,{variant:"secondary",id:"kc-test-connection-button","data-testid":"test-connection-button",onClick:()=>s("testConnection"),children:n("testConnection")})}),e(d,{label:n("bindType"),labelIcon:e(p,{helpText:n("bindTypeHelp"),fieldLabelId:"bindType"}),fieldId:"kc-bind-type",isRequired:!0,children:e(b,{name:"config.authType[0]",defaultValue:"simple",control:t.control,render:({field:y})=>g(x,{toggleId:"kc-bind-type",onToggle:()=>v(!m),isOpen:m,onSelect:I=>{y.onChange(I),v(!1)},selections:y.value,variant:E.single,"data-testid":"ldap-bind-type","aria-label":n("selectBindType"),children:[e(P,{value:"simple",children:"simple"}),e(P,{value:"none",children:"none"})]})})}),Z(H,["simple"])&&g(L,{children:[e(c,{name:"config.bindDn.0",label:n("bindDn"),labelIcon:n("bindDnHelp"),rules:{required:n("validateBindDn")}}),e(z,{name:"config.bindCredential.0",label:n("bindCredentials"),labelIcon:n("bindCredentialsHelp"),hasReveal:!A,rules:{required:n("validateBindCredentials")}})]}),e(d,{fieldId:"kc-test-auth-button",children:e(V,{variant:"secondary",id:"kc-test-auth-button","data-testid":"test-auth-button",onClick:()=>s("testAuthentication"),children:n("testAuthentication")})})]})]})},ne="1.3.6.1.4.1.4203.1.11.1",te=({id:t,form:l,showSectionHeading:r=!1,showSectionDescription:a=!1})=>{const{adminClient:o}=U(),{t:n}=S(),{realm:i}=w(),{addAlert:u,addError:h}=F(),A=async()=>{if(await l.trigger())try{const s=R(l),m=await o.realms.ldapServerCapabilities({realm:i},{...s,componentId:t});u(n("testSuccess"));const v=m.filter(H=>H.oid===ne);l.setValue("config.usePasswordModifyExtendedOp",[(v.length>0).toString()])}catch(s){h("testError",s)}};return g(L,{children:[r&&e(C,{title:n("advancedSettings"),description:n("ldapAdvancedSettingsDescription"),showDescription:a}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e(d,{label:n("enableLdapv3Password"),labelIcon:e(p,{helpText:n("enableLdapv3PasswordHelp"),fieldLabelId:"enableLdapv3Password"}),fieldId:"kc-enable-ldapv3-password",hasNoPaddingTop:!0,children:e(b,{name:"config.usePasswordModifyExtendedOp",defaultValue:["false"],control:l.control,render:({field:s})=>e(f,{id:"kc-enable-ldapv3-password","data-testid":"ldapv3-password",isDisabled:!1,onChange:(m,v)=>s.onChange([`${v}`]),isChecked:s.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("enableLdapv3Password")})})}),e(d,{label:n("validatePasswordPolicy"),labelIcon:e(p,{helpText:n("validatePasswordPolicyHelp"),fieldLabelId:"validatePasswordPolicy"}),fieldId:"kc-validate-password-policy",hasNoPaddingTop:!0,children:e(b,{name:"config.validatePasswordPolicy",defaultValue:["false"],control:l.control,render:({field:s})=>e(f,{id:"kc-validate-password-policy","data-testid":"password-policy",isDisabled:!1,onChange:(m,v)=>s.onChange([`${v}`]),isChecked:s.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("validatePasswordPolicy")})})}),e(d,{label:n("trustEmail"),labelIcon:e(p,{helpText:n("trustEmailHelp"),fieldLabelId:"trustEmail"}),fieldId:"kc-trust-email",hasNoPaddingTop:!0,children:e(b,{name:"config.trustEmail",defaultValue:["false"],control:l.control,render:({field:s})=>e(f,{id:"kc-trust-email","data-testid":"trust-email",isDisabled:!1,onChange:(m,v)=>s.onChange([`${v}`]),isChecked:s.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("trustEmail")})})}),e(d,{label:n("connectionTrace"),labelIcon:e(p,{helpText:n("connectionTraceHelp"),fieldLabelId:"connectionTrace"}),fieldId:"kc-connection-trace",hasNoPaddingTop:!0,children:e(b,{name:"config.connectionTrace",defaultValue:["false"],control:l.control,render:({field:s})=>e(f,{id:"kc-connection-trace","data-testid":"connection-trace",isDisabled:!1,onChange:(m,v)=>s.onChange([`${v}`]),isChecked:s.value[0]==="true",label:n("on"),labelOff:n("off"),"aria-label":n("connectionTrace")})})}),e(d,{fieldId:"query-extensions",children:e(V,{variant:"secondary",id:"query-extensions","data-testid":"query-extensions",onClick:A,children:n("queryExtensions")})})]})]})},le=({form:t,showSectionHeading:l=!1,showSectionDescription:r=!1,vendorEdit:a=!1})=>{const{t:o}=S(),{realm:n,realmRepresentation:i}=w();X(()=>t.setValue("parentId",i?.id),[]);const[u,h]=q(!1),A=()=>{switch(t.getValues("config.vendor[0]")){case"ad":t.setValue("config.usernameLDAPAttribute[0]","cn"),t.setValue("config.rdnLDAPAttribute[0]","cn"),t.setValue("config.uuidLDAPAttribute[0]","objectGUID"),t.setValue("config.krbPrincipalAttribute[0]","userPrincipalName"),t.setValue("config.userObjectClasses[0]","person, organizationalPerson, user");break;case"rhds":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","nsuniqueid"),t.setValue("config.krbPrincipalAttribute[0]","krbPrincipalName"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"tivoli":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","uniqueidentifier"),t.setValue("config.krbPrincipalAttribute[0]","krb5PrincipalName"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"edirectory":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","guid"),t.setValue("config.krbPrincipalAttribute[0]","krb5PrincipalName"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"other":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","entryUUID"),t.setValue("config.krbPrincipalAttribute[0]","krb5PrincipalName"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;default:return""}};return g(D,{...t,children:[l&&e(C,{title:o("generalOptions"),description:o("ldapGeneralOptionsSettingsDescription"),showDescription:r}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e("input",{type:"hidden",defaultValue:"ldap",...t.register("providerId")}),e("input",{type:"hidden",defaultValue:"org.keycloak.storage.UserStorageProvider",...t.register("providerType")}),e("input",{type:"hidden",defaultValue:n,...t.register("parentId")}),e(c,{name:"name",label:o("uiDisplayName"),labelIcon:o("uiDisplayNameHelp"),defaultValue:"ldap",rules:{required:o("validateName")}}),e(d,{label:o("vendor"),labelIcon:e(p,{helpText:o("vendorHelp"),fieldLabelId:"vendor"}),fieldId:"kc-vendor",isRequired:!0,children:e(b,{name:"config.vendor[0]",defaultValue:"ad",control:t.control,render:({field:s})=>g(x,{isDisabled:a,toggleId:"kc-vendor",onToggle:()=>h(!u),isOpen:u,onSelect:m=>{s.onChange(m),h(!1),A()},selections:s.value,variant:E.single,"aria-label":o("selectVendor"),children:[e(P,{value:"ad",children:"Active Directory"},0),e(P,{value:"rhds",children:"Red Hat Directory Server"},1),e(P,{value:"tivoli",children:"Tivoli"},2),e(P,{value:"edirectory",children:"Novell eDirectory"},3),e(P,{value:"other",children:"Other"},4)]})})})]})]})},ie=({form:t,showSectionHeading:l=!1,showSectionDescription:r=!1})=>{const{t:a}=S(),o=N({control:t.control,name:"config.allowKerberosAuthentication",defaultValue:["false"]});return g(D,{...t,children:[l&&e(C,{title:a("kerberosIntegration"),description:a("ldapKerberosSettingsDescription"),showDescription:r}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e(d,{label:a("allowKerberosAuthentication"),labelIcon:e(p,{helpText:a("allowKerberosAuthenticationHelp"),fieldLabelId:"allowKerberosAuthentication"}),fieldId:"kc-allow-kerberos-authentication",hasNoPaddingTop:!0,children:e(b,{name:"config.allowKerberosAuthentication",defaultValue:["false"],control:t.control,render:({field:n})=>e(f,{id:"kc-allow-kerberos-authentication","data-testid":"allow-kerberos-auth",isDisabled:!1,onChange:(i,u)=>n.onChange([`${u}`]),isChecked:n.value[0]==="true",label:a("on"),labelOff:a("off"),"aria-label":a("allowKerberosAuthentication")})})}),o[0]==="true"&&g(L,{children:[e(c,{name:"config.kerberosRealm.0",label:a("kerberosRealm"),labelIcon:a("kerberosRealmHelp"),rules:{required:a("validateRealm")}}),e(c,{name:"config.serverPrincipal.0",label:a("serverPrincipal"),labelIcon:a("serverPrincipalHelp"),rules:{required:a("validateServerPrincipal")}}),e(c,{name:"config.keyTab.0",label:a("keyTab"),labelIcon:a("keyTabHelp"),rules:{required:a("validateKeyTab")}}),e(c,{name:"config.krbPrincipalAttribute.0",label:a("krbPrincipalAttribute"),labelIcon:a("krbPrincipalAttributeHelp")}),e(d,{label:a("debug"),labelIcon:e(p,{helpText:a("debugHelp"),fieldLabelId:"debug"}),fieldId:"kc-debug",hasNoPaddingTop:!0,children:e(b,{name:"config.debug",defaultValue:["false"],control:t.control,render:({field:n})=>e(f,{id:"kc-debug","data-testid":"debug",isDisabled:!1,onChange:(i,u)=>n.onChange([`${u}`]),isChecked:n.value[0]==="true",label:a("on"),labelOff:a("off"),"aria-label":a("debug")})})})]}),e(d,{label:a("useKerberosForPasswordAuthentication"),labelIcon:e(p,{helpText:a("useKerberosForPasswordAuthenticationHelp"),fieldLabelId:"useKerberosForPasswordAuthentication"}),fieldId:"kc-use-kerberos-password-authentication",hasNoPaddingTop:!0,children:e(b,{name:"config.useKerberosForPasswordAuthentication",defaultValue:["false"],control:t.control,render:({field:n})=>e(f,{id:"kc-use-kerberos-password-authentication","data-testid":"use-kerberos-pw-auth",isDisabled:!1,onChange:(i,u)=>n.onChange([`${u}`]),isChecked:n.value[0]==="true",label:a("on"),labelOff:a("off"),"aria-label":a("useKerberosForPasswordAuthentication")})})})]})]})},re=({form:t,showSectionHeading:l=!1,showSectionDescription:r=!1})=>{const{t:a}=S();return g(D,{...t,children:[l&&e(C,{title:a("ldapSearchingAndUpdatingSettings"),description:a("ldapSearchingAndUpdatingSettingsDescription"),showDescription:r}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e(T,{id:"editMode",name:"config.editMode[0]",label:a("editMode"),labelIcon:a("editModeLdapHelp"),controller:{defaultValue:"",rules:{required:{value:!0,message:a("validateEditMode")}}},options:["","READ_ONLY","WRITABLE","UNSYNCED"]}),e(c,{name:"config.usersDn.0",label:a("usersDN"),labelIcon:a("usersDNHelp"),rules:{required:a("validateUsersDn")}}),e(c,{name:"config.relativeCreateDn.0",label:a("relativeUserCreateDn"),labelIcon:a("relativeUserCreateDnHelp")}),e(c,{name:"config.usernameLDAPAttribute.0",label:a("usernameLdapAttribute"),labelIcon:a("usernameLdapAttributeHelp"),defaultValue:"cn",rules:{required:a("validateUsernameLDAPAttribute")}}),e(c,{name:"config.rdnLDAPAttribute.0",label:a("rdnLdapAttribute"),labelIcon:a("rdnLdapAttributeHelp"),defaultValue:"cn",rules:{required:a("validateRdnLdapAttribute")}}),e(c,{name:"config.uuidLDAPAttribute.0",label:a("uuidLdapAttribute"),labelIcon:a("uuidLdapAttributeHelp"),defaultValue:"objectGUID",rules:{required:a("validateUuidLDAPAttribute")}}),e(c,{name:"config.userObjectClasses.0",label:a("userObjectClasses"),labelIcon:a("userObjectClassesHelp"),defaultValue:"person, organizationalPerson, user",rules:{required:a("validateUserObjectClasses")}}),e(c,{name:"config.customUserSearchFilter.0",label:a("userLdapFilter"),labelIcon:a("userLdapFilterHelp"),rules:{pattern:{value:/(\(.*\))$/,message:a("validateCustomUserSearchFilter")}}}),e(T,{id:"kc-search-scope",name:"config.searchScope[0]",label:a("searchScope"),labelIcon:a("searchScopeHelp"),controller:{defaultValue:"1"},options:[{key:"1",value:a("oneLevel")},{key:"2",value:a("subtree")}]}),e(c,{name:"config.readTimeout.0",label:a("readTimeout"),labelIcon:a("readTimeoutHelp"),type:"number",min:0}),e(d,{label:a("pagination"),labelIcon:e(p,{helpText:a("paginationHelp"),fieldLabelId:"pagination"}),fieldId:"kc-ui-pagination",hasNoPaddingTop:!0,children:e(b,{name:"config.pagination",defaultValue:["true"],control:t.control,render:({field:o})=>e(f,{id:"kc-ui-pagination","data-testid":"ui-pagination",isDisabled:!1,onChange:(n,i)=>o.onChange([`${i}`]),isChecked:o.value[0]==="true",label:a("on"),labelOff:a("off"),"aria-label":a("pagination")})})}),e(T,{name:"config.referral.0",label:a("referral"),labelIcon:a("referralHelp"),controller:{defaultValue:""},options:["ignore","follow"]})]})]})},oe=({form:t,showSectionHeading:l=!1,showSectionDescription:r=!1})=>{const{t:a}=S(),o=t.watch("config.periodicFullSync",!1),n=t.watch("config.periodicChangedUsersSync",!1);return g(D,{...t,children:[l&&e(C,{title:a("synchronizationSettings"),description:a("ldapSynchronizationSettingsDescription"),showDescription:r}),g(k,{role:"manage-realm",isHorizontal:!0,children:[e(d,{hasNoPaddingTop:!0,label:a("importUsers"),labelIcon:e(p,{helpText:a("importUsersHelp"),fieldLabelId:"importUsers"}),fieldId:"kc-import-users",children:e(b,{name:"config.importEnabled",defaultValue:["true"],control:t.control,render:({field:i})=>e(f,{id:"kc-import-users","data-testid":"import-users",name:"importEnabled",label:a("on"),labelOff:a("off"),onChange:(u,h)=>i.onChange([`${h}`]),isChecked:i.value[0]==="true",isDisabled:!1,"aria-label":a("importUsers")})})}),e(d,{hasNoPaddingTop:!0,label:a("syncRegistrations"),labelIcon:e(p,{helpText:a("syncRegistrations"),fieldLabelId:"syncRegistrations"}),fieldId:"syncRegistrations",children:e(b,{name:"config.syncRegistrations",defaultValue:["true"],control:t.control,render:({field:i})=>e(f,{id:"syncRegistrations","data-testid":"syncRegistrations",label:a("on"),labelOff:a("off"),onChange:(u,h)=>i.onChange([`${h}`]),isChecked:i.value[0]==="true","aria-label":a("syncRegistrations")})})}),e(c,{name:"config.batchSizeForSync.0",type:"number",min:0,label:a("batchSize"),labelIcon:a("batchSizeHelp")}),e(d,{label:a("periodicFullSync"),labelIcon:e(p,{helpText:a("periodicFullSyncHelp"),fieldLabelId:"periodicFullSync"}),fieldId:"kc-periodic-full-sync",hasNoPaddingTop:!0,children:e(b,{name:"config.periodicFullSync",defaultValue:!1,control:t.control,render:({field:i})=>e(f,{id:"kc-periodic-full-sync","data-testid":"periodic-full-sync",isDisabled:!1,onChange:(u,h)=>i.onChange(h),isChecked:i.value===!0,label:a("on"),labelOff:a("off"),"aria-label":a("periodicFullSync")})})}),o&&e(c,{name:"config.fullSyncPeriod.0",label:a("fullSyncPeriod"),labelIcon:a("fullSyncPeriodHelp"),type:"number",min:-1,defaultValue:604800}),e(d,{label:a("periodicChangedUsersSync"),labelIcon:e(p,{helpText:a("periodicChangedUsersSyncHelp"),fieldLabelId:"periodicChangedUsersSync"}),fieldId:"kc-periodic-changed-users-sync",hasNoPaddingTop:!0,children:e(b,{name:"config.periodicChangedUsersSync",defaultValue:!1,control:t.control,render:({field:i})=>e(f,{id:"kc-periodic-changed-users-sync","data-testid":"periodic-changed-users-sync",isDisabled:!1,onChange:(u,h)=>i.onChange(h),isChecked:i.value===!0,label:a("on"),labelOff:a("off"),"aria-label":a("periodicChangedUsersSync")})})}),n&&e(c,{name:"config.changedSyncPeriod.0",label:a("changedUsersSyncPeriod"),labelIcon:a("changedUsersSyncHelp"),type:"number",min:-1,defaultValue:86400}),e(d,{label:a("removeInvalidUsers"),labelIcon:e(p,{helpText:a("removeInvalidUsersHelp"),fieldLabelId:"removeInvalidUsers"}),fieldId:"kc-remove-invalid-users",hasNoPaddingTop:!0,children:e(b,{name:"config.removeInvalidUsersEnabled",defaultValue:["true"],control:t.control,render:({field:i})=>e(f,{id:"kc-remove-invalid-users","data-testid":"remove-invalid-users",isDisabled:!1,onChange:(u,h)=>i.onChange([`${h}`]),isChecked:i.value[0]==="true",label:a("on"),labelOff:a("off"),"aria-label":a("removeInvalidUsers")})})})]})]})},ge=({id:t,onSubmit:l})=>{const{t:r}=S(),a=j(),o=$(),{realm:n}=w(),i=B();return g(L,{children:[e(M,{label:r("jumpToSection"),sections:[{title:r("generalOptions"),panel:e(le,{form:a,vendorEdit:!!t})},{title:r("connectionAndAuthenticationSettings"),panel:e(ae,{form:a,id:t})},{title:r("ldapSearchingAndUpdatingSettings"),panel:e(re,{form:a})},{title:r("synchronizationSettings"),panel:e(oe,{form:a})},{title:r("kerberosIntegration"),panel:e(ie,{form:a}),isHidden:!i(G.Kerberos)},{title:r("cacheSettings"),panel:e(J,{form:a})},{title:r("advancedSettings"),panel:e(te,{form:a,id:t})}]}),e(W,{onSubmit:a.handleSubmit(l),children:e(Q,{name:"ldap",isDisabled:!a.formState.isDirty,isSubmit:!0,children:e(V,{variant:"link",onClick:()=>o(Y({realm:n})),"data-testid":"ldap-cancel",children:r("cancel")})})})]})};function he(t){const{config:l}=t;return l?.periodicChangedUsersSync!==void 0&&(l.periodicChangedUsersSync===!1&&(l.changedSyncPeriod=["-1"]),delete l.periodicChangedUsersSync),l?.periodicFullSync!==void 0&&(l.periodicFullSync===!1&&(l.fullSyncPeriod=["-1"]),delete l.periodicFullSync),t}export{ge as U,he as s};
//# sourceMappingURL=UserFederationLdapForm-CTqZPRi6.js.map
